(function(){(function(e,t){typeof module=="object"&&typeof module.exports=="object"?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)})(typeof window!="undefined"?window:this,function(e,t){function y(e){var t=e.length,n=p.type(e);return n==="function"||p.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||t===0||typeof t=="number"&&t>0&&t-1 in e}function x(e,t,n){if(p.isFunction(t))return p.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return p.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(S.test(t))return p.filter(t,e,n);t=p.filter(t,e)}return p.grep(e,function(e){return p.inArray(e,t)>=0!==n})}function O(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function D(e){var t=_[e]={};return p.each(e.match(M)||[],function(e,n){t[n]=!0}),t}function H(){N.addEventListener?(N.removeEventListener("DOMContentLoaded",B,!1),e.removeEventListener("load",B,!1)):(N.detachEvent("onreadystatechange",B),e.detachEvent("onload",B))}function B(){if(N.addEventListener||event.type==="load"||N.readyState==="complete")H(),p.ready()}function R(e,t,n){if(n===undefined&&e.nodeType===1){var r="data-"+t.replace(q,"-$1").toLowerCase();n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:I.test(n)?p.parseJSON(n):n}catch(i){}p.data(e,t,n)}else n=undefined}return n}function U(e){var t;for(t in e){if(t==="data"&&p.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function z(e,t,r,i){if(!p.acceptData(e))return;var s,o,u=p.expando,a=e.nodeType,f=a?p.cache:e,l=a?e[u]:e[u]&&u;if((!l||!f[l]||!i&&!f[l].data)&&r===undefined&&typeof t=="string")return;l||(a?l=e[u]=n.pop()||p.guid++:l=u),f[l]||(f[l]=a?{}:{toJSON:p.noop});if(typeof t=="object"||typeof t=="function")i?f[l]=p.extend(f[l],t):f[l].data=p.extend(f[l].data,t);return o=f[l],i||(o.data||(o.data={}),o=o.data),r!==undefined&&(o[p.camelCase(t)]=r),typeof t=="string"?(s=o[t],s==null&&(s=o[p.camelCase(t)])):s=o,s}function W(e,t,n){if(!p.acceptData(e))return;var r,i,s=e.nodeType,o=s?p.cache:e,u=s?e[p.expando]:p.expando;if(!o[u])return;if(t){r=n?o[u]:o[u].data;if(r){p.isArray(t)?t=t.concat(p.map(t,p.camelCase)):t in r?t=[t]:(t=p.camelCase(t),t in r?t=[t]:t=t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!U(r):!p.isEmptyObject(r))return}}if(!n){delete o[u].data;if(!U(o[u]))return}s?p.cleanData([e],!0):c.deleteExpando||o!=o.window?delete o[u]:o[u]=null}function tt(){return!0}function nt(){return!1}function rt(){try{return N.activeElement}catch(e){}}function it(e){var t=st.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Et(e,t){var n,r,i=0,s=typeof e.getElementsByTagName!==j?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==j?e.querySelectorAll(t||"*"):undefined;if(!s)for(s=[],n=e.childNodes||e;(r=n[i])!=null;i++)!t||p.nodeName(r,t)?s.push(r):p.merge(s,Et(r,t));return t===undefined||t&&p.nodeName(e,t)?p.merge([e],s):s}function St(e){K.test(e.type)&&(e.defaultChecked=e.checked)}function xt(e,t){return p.nodeName(e,"table")&&p.nodeName(t.nodeType!==11?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function Tt(e){return e.type=(p.find.attr(e,"type")!==null)+"/"+e.type,e}function Nt(e){var t=mt.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Ct(e,t){var n,r=0;for(;(n=e[r])!=null;r++)p._data(n,"globalEval",!t||p._data(t[r],"globalEval"))}function kt(e,t){if(t.nodeType!==1||!p.hasData(e))return;var n,r,i,s=p._data(e),o=p._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)p.event.add(t,n,u[n][r])}o.data&&(o.data=p.extend({},o.data))}function Lt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!c.noCloneEvent&&t[p.expando]){i=p._data(t);for(r in i.events)p.removeEvent(t,r,i.handle);t.removeAttribute(p.expando)}if(n==="script"&&t.text!==e.text)Tt(t).text=e.text,Nt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),c.html5Clone&&e.innerHTML&&!p.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&K.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function Mt(t,n){var r=p(n.createElement(t)).appendTo(n.body),i=e.getDefaultComputedStyle?e.getDefaultComputedStyle(r[0]).display:p.css(r[0],"display");return r.detach(),i}function _t(e){var t=N,n=Ot[e];if(!n){n=Mt(e,t);if(n==="none"||!n)At=(At||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(At[0].contentWindow||At[0].contentDocument).document,t.write(),t.close(),n=Mt(e,t),At.detach();Ot[e]=n}return n}function Ft(e,t){return{get:function(){var n=e();if(n==null)return;if(n){delete this.get;return}return(this.get=t).apply(this,arguments)}}}function $t(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Vt.length;while(i--){t=Vt[i]+n;if(t in e)return t}return r}function Jt(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=p._data(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&$(r)&&(s[o]=p._data(r,"olddisplay",_t(r.nodeName)))):s[o]||(i=$(r),(n&&n!=="none"||!i)&&p._data(r,"olddisplay",i?n:p.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function Kt(e,t,n){var r=Ut.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Qt(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=p.css(e,n+V[s],!0,i)),r?(n==="content"&&(o-=p.css(e,"padding"+V[s],!0,i)),n!=="margin"&&(o-=p.css(e,"border"+V[s]+"Width",!0,i))):(o+=p.css(e,"padding"+V[s],!0,i),n!=="padding"&&(o+=p.css(e,"border"+V[s]+"Width",!0,i)));return o}function Gt(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=Ht(e),o=c.boxSizing()&&p.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=Bt(e,t,s);if(i<0||i==null)i=e.style[t];if(Pt.test(i))return i;r=o&&(c.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+Qt(e,t,n||(o?"border":"content"),r,s)+"px"}function Yt(e,t,n,r,i){return new Yt.prototype.init(e,t,n,r,i)}function un(){return setTimeout(function(){Zt=undefined}),Zt=p.now()}function an(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=V[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function fn(e,t,n){var r,i=(on[t]||[]).concat(on["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function ln(e,t,n){var r,i,s,o,u,a,f,l,h=this,d={},v=e.style,m=e.nodeType&&$(e),g=p._data(e,"fxshow");n.queue||(u=p._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,h.always(function(){h.always(function(){u.unqueued--,p.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[v.overflow,v.overflowX,v.overflowY],f=p.css(e,"display"),l=_t(e.nodeName),f==="none"&&(f=l),f==="inline"&&p.css(e,"float")==="none"&&(!c.inlineBlockNeedsLayout||l==="inline"?v.display="inline-block":v.zoom=1)),n.overflow&&(v.overflow="hidden",c.shrinkWrapBlocks()||h.always(function(){v.overflow=n.overflow[0],v.overflowX=n.overflow[1],v.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(tn.exec(i)){delete t[r],s=s||i==="toggle";if(i===(m?"hide":"show")){if(i!=="show"||!g||g[r]===undefined)continue;m=!0}d[r]=g&&g[r]||p.style(e,r)}}if(!p.isEmptyObject(d)){g?"hidden"in g&&(m=g.hidden):g=p._data(e,"fxshow",{}),s&&(g.hidden=!m),m?p(e).show():h.done(function(){p(e).hide()}),h.done(function(){var t;p._removeData(e,"fxshow");for(t in d)p.style(e,t,d[t])});for(r in d)o=fn(m?g[r]:0,r,h),r in g||(g[r]=o.start,m&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function cn(e,t){var n,r,i,s,o;for(n in e){r=p.camelCase(n),i=t[r],s=e[n],p.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=p.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function hn(e,t,n){var r,i,s=0,o=sn.length,u=p.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Zt||un(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:p.extend({},t),opts:p.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Zt||un(),duration:n.duration,tweens:[],createTween:function(t,n){var r=p.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;cn(l,f.opts.specialEasing);for(;s<o;s++){r=sn[s].call(f,e,l,f.opts);if(r)return r}return p.map(l,fn,f),p.isFunction(f.opts.start)&&f.opts.start.call(e,f),p.fx.timer(p.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function In(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(M)||[];if(p.isFunction(n))while(r=s[i++])r.charAt(0)==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function qn(e,t,n,r){function o(u){var a;return i[u]=!0,p.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===Bn;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Rn(e,t){var n,r,i=p.ajaxSettings.flatOptions||{};for(r in t)t[r]!==undefined&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&p.extend(!0,e,n),e}function Un(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),i===undefined&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in u)if(u[o]&&u[o].test(i)){a.unshift(o);break}if(a[0]in n)s=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){s=o;break}r||(r=o)}s=s||r}if(s)return s!==a[0]&&a.unshift(s),n[s]}function zn(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function Kn(e,t,n,r){var i;if(p.isArray(t))p.each(t,function(t,i){n||Xn.test(e)?r(e,i):Kn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&p.type(t)==="object")for(i in t)Kn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Zn(){try{return new e.XMLHttpRequest}catch(t){}}function er(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function sr(e){return p.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n=[],r=n.slice,i=n.concat,s=n.push,o=n.indexOf,u={},a=u.toString,f=u.hasOwnProperty,l="".trim,c={},h="1.11.0",p=function(e,t){return new p.fn.init(e,t)},d=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,v=/^-ms-/,m=/-([\da-z])/gi,g=function(e,t){return t.toUpperCase()};p.fn=p.prototype={jquery:h,constructor:p,selector:"",length:0,toArray:function(){return r.call(this)},get:function(e){return e!=null?e<0?this[e+this.length]:this[e]:r.call(this)},pushStack:function(e){var t=p.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return p.each(this,e,t)},map:function(e){return this.pushStack(p.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(r.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:s,sort:n.sort,splice:n.splice},p.extend=p.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[u]||{},u++),typeof o!="object"&&!p.isFunction(o)&&(o={}),u===a&&(o=this,u--);for(;u<a;u++)if((i=arguments[u])!=null)for(r in i){e=o[r],n=i[r];if(o===n)continue;f&&n&&(p.isPlainObject(n)||(t=p.isArray(n)))?(t?(t=!1,s=e&&p.isArray(e)?e:[]):s=e&&p.isPlainObject(e)?e:{},o[r]=p.extend(f,s,n)):n!==undefined&&(o[r]=n)}return o},p.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return p.type(e)==="function"},isArray:Array.isArray||function(e){return p.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return e-parseFloat(e)>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||p.type(e)!=="object"||e.nodeType||p.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(c.ownLast)for(t in e)return f.call(e,t);for(t in e);return t===undefined||f.call(e,t)},type:function(e){return e==null?e+"":typeof e=="object"||typeof e=="function"?u[a.call(e)]||"object":typeof e},globalEval:function(t){t&&p.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(v,"ms-").replace(m,g)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=y(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:l&&!l.call("﻿ ")?function(e){return e==null?"":l.call(e)}:function(e){return e==null?"":(e+"").replace(d,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(y(Object(e))?p.merge(n,typeof e=="string"?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(o)return o.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){var n=+t.length,r=0,i=e.length;while(r<n)e[i++]=t[r++];if(n!==n)while(t[r]!==undefined)e[i++]=t[r++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length,u=!n;for(;s<o;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(e,t,n){var r,s=0,o=e.length,u=y(e),a=[];if(u)for(;s<o;s++)r=t(e[s],s,n),r!=null&&a.push(r);else for(s in e)r=t(e[s],s,n),r!=null&&a.push(r);return i.apply([],a)},guid:1,proxy:function(e,t){var n,i,s;return typeof t=="string"&&(s=e[t],t=e,e=s),p.isFunction(e)?(n=r.call(arguments,2),i=function(){return e.apply(t||this,n.concat(r.call(arguments)))},i.guid=e.guid=e.guid||p.guid++,i):undefined},now:function(){return+(new Date)},support:c}),p.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var b=function(e){function rt(e,t,r,i){var s,o,u,a,f,h,v,m,w,E;(t?t.ownerDocument||t:b)!==c&&l(t),t=t||c,r=r||[];if(!e||typeof e!="string")return r;if((a=t.nodeType)!==1&&a!==9)return[];if(p&&!i){if(s=G.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return r;if(o.id===u)return r.push(o),r}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&g(t,o)&&o.id===u)return r.push(o),r}else{if(s[2])return _.apply(r,t.getElementsByTagName(e)),r;if((u=s[3])&&n.getElementsByClassName&&t.getElementsByClassName)return _.apply(r,t.getElementsByClassName(u)),r}if(n.qsa&&(!d||!d.test(e))){m=v=y,w=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){h=dt(e),(v=t.getAttribute("id"))?m=v.replace(Z,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=h.length;while(f--)h[f]=m+vt(h[f]);w=Y.test(e)&&ht(t.parentNode)||t,E=h.join(",")}if(E)try{return _.apply(r,w.querySelectorAll(E)),r}catch(S){}finally{v||t.removeAttribute("id")}}}return xt(e.replace(R,"$1"),t,r,i)}function it(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function st(e){return e[y]=!0,e}function ot(e){var t=c.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ut(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function at(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||k)-(~e.sourceIndex||k);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e){return e&&typeof e.getElementsByTagName!==C&&e}function pt(){}function dt(e,t){var n,i,s,o,u,a,f,l=x[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){if(!n||(i=U.exec(u)))i&&(u=u.slice(i[0].length)||u),a.push(s=[]);n=!1;if(i=z.exec(u))n=i.shift(),s.push({value:n,type:i[0].replace(R," ")}),u=u.slice(n.length);for(o in r.filter)(i=$[o].exec(u))&&(!f[o]||(i=f[o](i)))&&(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?rt.error(e):x(e,a).slice(0)}function vt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function mt(e,t,n){var r=t.dir,i=n&&r==="parentNode",s=E++;return t.first?function(t,n,s){while(t=t[r])if(t.nodeType===1||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[w,s];if(o){while(t=t[r])if(t.nodeType===1||i)if(e(t,n,o))return!0}else while(t=t[r])if(t.nodeType===1||i){a=t[y]||(t[y]={});if((u=a[r])&&u[0]===w&&u[1]===s)return f[2]=u[2];a[r]=f;if(f[2]=e(t,n,o))return!0}}}function gt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function yt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function bt(e,t,n,r,i,s){return r&&!r[y]&&(r=bt(r)),i&&!i[y]&&(i=bt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||St(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?yt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=yt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=yt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function wt(e){var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],f=o?1:0,l=mt(function(e){return e===t},a,!0),c=mt(function(e){return P.call(t,e)>-1},a,!0),h=[function(e,n,r){return!o&&(r||n!==u)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;f<s;f++)if(n=r.relative[e[f].type])h=[mt(gt(h),n)];else{n=r.filter[e[f].type].apply(null,e[f].matches);if(n[y]){i=++f;for(;i<s;i++)if(r.relative[e[i].type])break;return bt(f>1&&gt(h),f>1&&vt(e.slice(0,f-1).concat({value:e[f-2].type===" "?"*":""})).replace(R,"$1"),n,f<i&&wt(e.slice(f,i)),i<s&&wt(e=e.slice(i)),i<s&&vt(e))}h.push(n)}return gt(h)}function Et(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,a,f,l){var h,p,d,v=0,m="0",g=s&&[],y=[],b=u,E=s||i&&r.find.TAG("*",l),S=w+=b==null?1:Math.random()||.1,x=E.length;l&&(u=o!==c&&o);for(;m!==x&&(h=E[m])!=null;m++){if(i&&h){p=0;while(d=e[p++])if(d(h,o,a)){f.push(h);break}l&&(w=S)}n&&((h=!d&&h)&&v--,s&&g.push(h))}v+=m;if(n&&m!==v){p=0;while(d=t[p++])d(g,y,o,a);if(s){if(v>0)while(m--)!g[m]&&!y[m]&&(y[m]=O.call(f));y=yt(y)}_.apply(f,y),l&&!s&&y.length>0&&v+t.length>1&&rt.uniqueSort(f)}return l&&(w=S,u=b),g};return n?st(s):s}function St(e,t,n){var r=0,i=t.length;for(;r<i;r++)rt(e,t[r],n);return n}function xt(e,t,i,s){var u,a,f,l,c,h=dt(e);if(!s&&h.length===1){a=h[0]=h[0].slice(0);if(a.length>2&&(f=a[0]).type==="ID"&&n.getById&&t.nodeType===9&&p&&r.relative[a[1].type]){t=(r.find.ID(f.matches[0].replace(et,tt),t)||[])[0];if(!t)return i;e=e.slice(a.shift().value.length)}u=$.needsContext.test(e)?0:a.length;while(u--){f=a[u];if(r.relative[l=f.type])break;if(c=r.find[l])if(s=c(f.matches[0].replace(et,tt),Y.test(a[0].type)&&ht(t.parentNode)||t)){a.splice(u,1),e=s.length&&vt(a);if(!e)return _.apply(i,s),i;break}}}return o(e,h)(s,t,!p,i,Y.test(e)&&ht(t.parentNode)||t),i}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y="sizzle"+ -(new Date),b=e.document,w=0,E=0,S=it(),x=it(),T=it(),N=function(e,t){return e===t&&(f=!0),0},C=typeof undefined,k=1<<31,L={}.hasOwnProperty,A=[],O=A.pop,M=A.push,_=A.push,D=A.slice,P=A.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},H="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",B="[\\x20\\t\\r\\n\\f]",j="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",F=j.replace("w","w#"),I="\\["+B+"*("+j+")"+B+"*(?:([*^$|!~]?=)"+B+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+F+")|)|)"+B+"*\\]",q=":("+j+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+B+"+|((?:^|[^\\\\])(?:\\\\.)*)"+B+"+$","g"),U=new RegExp("^"+B+"*,"+B+"*"),z=new RegExp("^"+B+"*([>+~]|"+B+")"+B+"*"),W=new RegExp("="+B+"*([^\\]'\"]*?)"+B+"*\\]","g"),X=new RegExp(q),V=new RegExp("^"+F+"$"),$={ID:new RegExp("^#("+j+")"),CLASS:new RegExp("^\\.("+j+")"),TAG:new RegExp("^("+j.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+B+"*(even|odd|(([+-]|)(\\d*)n|)"+B+"*(?:([+-]|)"+B+"*(\\d+)|))"+B+"*\\)|)","i"),bool:new RegExp("^(?:"+H+")$","i"),needsContext:new RegExp("^"+B+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+B+"*((?:-\\d)?\\d*)"+B+"*\\)|)(?=[^-]|$)","i")},J=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,Q=/^[^{]+\{\s*\[native \w/,G=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Y=/[+~]/,Z=/'|\\/g,et=new RegExp("\\\\([\\da-f]{1,6}"+B+"?|("+B+")|.)","ig"),tt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{_.apply(A=D.call(b.childNodes),b.childNodes),A[b.childNodes.length].nodeType}catch(nt){_={apply:A.length?function(e,t){M.apply(e,D.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=rt.support={},s=rt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=rt.setDocument=function(e){var t,i=e?e.ownerDocument||e:b,o=i.defaultView;if(i===c||i.nodeType!==9||!i.documentElement)return c;c=i,h=i.documentElement,p=!s(i),o&&o!==o.top&&(o.addEventListener?o.addEventListener("unload",function(){l()},!1):o.attachEvent&&o.attachEvent("onunload",function(){l()})),n.attributes=ot(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ot(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Q.test(i.getElementsByClassName)&&ot(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),n.getById=ot(function(e){return h.appendChild(e).id=y,!i.getElementsByName||!i.getElementsByName(y).length}),n.getById?(r.find.ID=function(e,t){if(typeof t.getElementById!==C&&p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==C&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==C)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==C&&p)return t.getElementsByClassName(e)},v=[],d=[];if(n.qsa=Q.test(i.querySelectorAll))ot(function(e){e.innerHTML="<select t=''><option selected=''></option></select>",e.querySelectorAll("[t^='']").length&&d.push("[*^$]="+B+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||d.push("\\["+B+"*(?:value|"+H+")"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){var t=i.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&d.push("name"+B+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(n.matchesSelector=Q.test(m=h.webkitMatchesSelector||h.mozMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){n.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=d.length&&new RegExp(d.join("|")),v=v.length&&new RegExp(v.join("|")),t=Q.test(h.compareDocumentPosition),g=t||Q.test(h.contains)?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return f=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,r&1||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===i||e.ownerDocument===b&&g(b,e)?-1:t===i||t.ownerDocument===b&&g(b,t)?1:a?P.call(a,e)-P.call(a,t):0:r&4?-1:1)}:function(e,t){if(e===t)return f=!0,0;var n,r=0,s=e.parentNode,o=t.parentNode,u=[e],l=[t];if(!s||!o)return e===i?-1:t===i?1:s?-1:o?1:a?P.call(a,e)-P.call(a,t):0;if(s===o)return at(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)l.unshift(n);while(u[r]===l[r])r++;return r?at(u[r],l[r]):u[r]===b?-1:l[r]===b?1:0},i},rt.matches=function(e,t){return rt(e,null,null,t)},rt.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(W,"='$1']");if(n.matchesSelector&&p&&(!v||!v.test(t))&&(!d||!d.test(t)))try{var r=m.call(e,t);if(r||n.disconnectedMatch||e.document&&e.document.nodeType!==11)return r}catch(i){}return rt(t,c,null,[e]).length>0},rt.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},rt.attr=function(e,t){(e.ownerDocument||e)!==c&&l(e);var i=r.attrHandle[t.toLowerCase()],s=i&&L.call(r.attrHandle,t.toLowerCase())?i(e,t,!p):undefined;return s!==undefined?s:n.attributes||!p?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},rt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},rt.uniqueSort=function(e){var t,r=[],i=0,s=0;f=!n.detectDuplicates,a=!n.sortStable&&e.slice(0),e.sort(N);if(f){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return a=null,e},i=rt.getText=function(e){var t,n="",r=0,s=e.nodeType;if(!s)while(t=e[r++])n+=i(t);else if(s===1||s===9||s===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(s===3||s===4)return e.nodeValue;return n},r=rt.selectors={cacheLength:50,createPseudo:st,match:$,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||rt.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&rt.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return $.CHILD.test(e[0])?null:(e[3]&&e[4]!==undefined?e[2]=e[4]:n&&X.test(n)&&(t=dt(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(et,tt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=S[e+" "];return t||(t=new RegExp("(^|"+B+")"+e+"("+B+"|$)"))&&S(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==C&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=rt.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),b=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&b){l=m[y]||(m[y]={}),f=l[e]||[],p=f[0]===w&&f[1],h=f[0]===w&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[w,p,h];break}}else if(b&&(f=(t[y]||(t[y]={}))[e])&&f[0]===w)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){b&&((c[y]||(c[y]={}))[e]=[w,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||rt.error("unsupported pseudo: "+e);return i[y]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=P.call(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:st(function(e){var t=[],n=[],r=o(e.replace(R,"$1"));return r[y]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return rt(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:st(function(e){return V.test(e||"")||rt.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return J.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()==="text")},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ft(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=lt(t);return pt.prototype=r.filters=r.pseudos,r.setFilters=new pt,o=rt.compile=function(e,t){var n,r=[],i=[],s=T[e+" "];if(!s){t||(t=dt(e)),n=t.length;while(n--)s=wt(t[n]),s[y]?r.push(s):i.push(s);s=T(e,Et(i,r))}return s},n.sortStable=y.split("").sort(N).join("")===y,n.detectDuplicates=!!f,l(),n.sortDetached=ot(function(e){return e.compareDocumentPosition(c.createElement("div"))&1}),ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild.getAttribute("href")==="#"})||ut("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!n.attributes||!ot(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ut("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),ot(function(e){return e.getAttribute("disabled")==null})||ut(H,function(e,t,n){var r;if(!n)return e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),rt}(e);p.find=b,p.expr=b.selectors,p.expr[":"]=p.expr.pseudos,p.unique=b.uniqueSort,p.text=b.getText,p.isXMLDoc=b.isXML,p.contains=b.contains;var w=p.expr.match.needsContext,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;p.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?p.find.matchesSelector(r,e)?[r]:[]:p.find.matches(e,p.grep(t,function(e){return e.nodeType===1}))},p.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(p(e).filter(function(){for(t=0;t<i;t++)if(p.contains(r[t],this))return!0}));for(t=0;t<i;t++)p.find(e,r[t],n);return n=this.pushStack(i>1?p.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,typeof e=="string"&&w.test(e)?p(e):e||[],!1).length}});var T,N=e.document,C=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,k=p.fn.init=function(e,t){var n,r;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?n=[null,e,null]:n=C.exec(e);if(n&&(n[1]||!t)){if(n[1]){t=t instanceof p?t[0]:t,p.merge(this,p.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:N,!0));if(E.test(n[1])&&p.isPlainObject(t))for(n in t)p.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}r=N.getElementById(n[2]);if(r&&r.parentNode){if(r.id!==n[2])return T.find(e);this.length=1,this[0]=r}return this.context=N,this.selector=e,this}return!t||t.jquery?(t||T).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):p.isFunction(e)?typeof T.ready!="undefined"?T.ready(e):e(p):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),p.makeArray(e,this))};k.prototype=p.fn,T=p(N);var L=/^(?:parents|prev(?:Until|All))/,A={children:!0,contents:!0,next:!0,prev:!0};p.extend({dir:function(e,t,n){var r=[],i=e[t];while(i&&i.nodeType!==9&&(n===undefined||i.nodeType!==1||!p(i).is(n)))i.nodeType===1&&r.push(i),i=i[t];return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}}),p.fn.extend({has:function(e){var t,n=p(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(p.contains(this,n[t]))return!0})},closest:function(e,t){var n,r=0,i=this.length,s=[],o=w.test(e)||typeof e!="string"?p(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&p.find.matchesSelector(n,e))){s.push(n);break}return this.pushStack(s.length>1?p.unique(s):s)},index:function(e){return e?typeof e=="string"?p.inArray(this[0],p(e)):p.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(p.unique(p.merge(this.get(),p(e,t))))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),p.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return p.dir(e,"parentNode")},parentsUntil:function(e,t,n){return p.dir(e,"parentNode",n)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return p.dir(e,"nextSibling")},prevAll:function(e){return p.dir(e,"previousSibling")},nextUntil:function(e,t,n){return p.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return p.dir(e,"previousSibling",n)},siblings:function(e){return p.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return p.sibling(e.firstChild)},contents:function(e){return p.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:p.merge([],e.childNodes)}},function(e,t){p.fn[e]=function(n,r){var i=p.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=p.filter(r,i)),this.length>1&&(A[e]||(i=p.unique(i)),L.test(e)&&(i=i.reverse())),this.pushStack(i)}});var M=/\S+/g,_={};p.Callbacks=function(e){e=typeof e=="string"?_[e]||D(e):p.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){n=e.memory&&c,r=!0,s=o||0,o=0,i=u.length,t=!0;for(;u&&s<i;s++)if(u[s].apply(c[0],c[1])===!1&&e.stopOnFalse){n=!1;break}t=!1,u&&(a?a.length&&f(a.shift()):n?u=[]:l.disable())},l={add:function(){if(u){var r=u.length;(function s(t){p.each(t,function(t,n){var r=p.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&s(n)})})(arguments),t?i=u.length:n&&(o=r,f(n))}return this},remove:function(){return u&&p.each(arguments,function(e,n){var r;while((r=p.inArray(n,u,r))>-1)u.splice(r,1),t&&(r<=i&&i--,r<=s&&s--)}),this},has:function(e){return e?p.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],i=0,this},disable:function(){return u=a=n=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,n||l.disable(),this},locked:function(){return!a},fireWith:function(e,n){return u&&(!r||a)&&(n=n||[],n=[e,n.slice?n.slice():n],t?a.push(n):f(n)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!r}};return l},p.extend({Deferred:function(e){var t=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return p.Deferred(function(n){p.each(t,function(t,s){var o=p.isFunction(e[t])&&e[t];i[s[1]](function(){var e=o&&o.apply(this,arguments);e&&p.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s[0]+"With"](this===r?n.promise():this,o?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?p.extend(e,r):r}},i={};return r.pipe=r.then,p.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=r.call(arguments),i=n.length,s=i!==1||e&&p.isFunction(e.promise)?i:0,o=s===1?e:p.Deferred(),u=function(e,t,n){return function(i){t[e]=this,n[e]=arguments.length>1?r.call(arguments):i,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1){a=new Array(i),f=new Array(i),l=new Array(i);for(;t<i;t++)n[t]&&p.isFunction(n[t].promise)?n[t].promise().done(u(t,l,n)).fail(o.reject).progress(u(t,f,a)):--s}return s||o.resolveWith(l,n),o.promise()}});var P;p.fn.ready=function(e){return p.ready.promise().done(e),this},p.extend({isReady:!1,readyWait:1,holdReady:function(e){e?p.readyWait++:p.ready(!0)},ready:function(e){if(e===!0?--p.readyWait:p.isReady)return;if(!N.body)return setTimeout(p.ready);p.isReady=!0;if(e!==!0&&--p.readyWait>0)return;P.resolveWith(N,[p]),p.fn.trigger&&p(N).trigger("ready").off("ready")}}),p.ready.promise=function(t){if(!P){P=p.Deferred();if(N.readyState==="complete")setTimeout(p.ready);else if(N.addEventListener)N.addEventListener("DOMContentLoaded",B,!1),e.addEventListener("load",B,!1);else{N.attachEvent("onreadystatechange",B),e.attachEvent("onload",B);var n=!1;try{n=e.frameElement==null&&N.documentElement}catch(r){}n&&n.doScroll&&function i(){if(!p.isReady){try{n.doScroll("left")}catch(e){return setTimeout(i,50)}H(),p.ready()}}()}}return P.promise(t)};var j=typeof undefined,F;for(F in p(c))break;c.ownLast=F!=="0",c.inlineBlockNeedsLayout=!1,p(function(){var e,t,n=N.getElementsByTagName("body")[0];if(!n)return;e=N.createElement("div"),e.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",t=N.createElement("div"),n.appendChild(e).appendChild(t);if(typeof t.style.zoom!==j){t.style.cssText="border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1";if(c.inlineBlockNeedsLayout=t.offsetWidth===3)n.style.zoom=1}n.removeChild(e),e=t=null}),function(){var e=N.createElement("div");if(c.deleteExpando==null){c.deleteExpando=!0;try{delete e.test}catch(t){c.deleteExpando=!1}}e=null}(),p.acceptData=function(e){var t=p.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return n!==1&&n!==9?!1:!t||t!==!0&&e.getAttribute("classid")===t};var I=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/([A-Z])/g;p.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?p.cache[e[p.expando]]:e[p.expando],!!e&&!U(e)},data:function(e,t,n){return z(e,t,n)},removeData:function(e,t){return W(e,t)},_data:function(e,t,n){return z(e,t,n,!0)},_removeData:function(e,t){return W(e,t,!0)}}),p.fn.extend({data:function(e,t){var n,r,i,s=this[0],o=s&&s.attributes;if(e===undefined){if(this.length){i=p.data(s);if(s.nodeType===1&&!p._data(s,"parsedAttrs")){n=o.length;while(n--)r=o[n].name,r.indexOf("data-")===0&&(r=p.camelCase(r.slice(5)),R(s,r,i[r]));p._data(s,"parsedAttrs",!0)}}return i}return typeof e=="object"?this.each(function(){p.data(this,e)}):arguments.length>1?this.each(function(){p.data(this,e,t)}):s?R(s,e,p.data(s,e)):undefined},removeData:function(e){return this.each(function(){p.removeData(this,e)})}}),p.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=p._data(e,t),n&&(!r||p.isArray(n)?r=p._data(e,t,p.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=p.queue(e,t),r=n.length,i=n.shift(),s=p._queueHooks(e,t),o=function(){p.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return p._data(e,n)||p._data(e,n,{empty:p.Callbacks("once memory").add(function(){p._removeData(e,t+"queue"),p._removeData(e,n)})})}}),p.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?p.queue(this[0],e):t===undefined?this:this.each(function(){var n=p.queue(this,e,t);p._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&p.dequeue(this,e)})},dequeue:function(e){return this.each(function(){p.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=p.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=p._data(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var X=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,V=["Top","Right","Bottom","Left"],$=function(e,t){return e=t||e,p.css(e,"display")==="none"||!p.contains(e.ownerDocument,e)},J=p.access=function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(p.type(n)==="object"){i=!0;for(u in n)p.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,p.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(p(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},K=/^(?:checkbox|radio)$/i;(function(){var e=N.createDocumentFragment(),t=N.createElement("div"),n=N.createElement("input");t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a>",c.leadingWhitespace=t.firstChild.nodeType===3,c.tbody=!t.getElementsByTagName("tbody").length,c.htmlSerialize=!!t.getElementsByTagName("link").length,c.html5Clone=N.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",n.type="checkbox",n.checked=!0,e.appendChild(n),c.appendChecked=n.checked,t.innerHTML="<textarea>x</textarea>",c.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,e.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",c.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,c.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){c.noCloneEvent=!1}),t.cloneNode(!0).click());if(c.deleteExpando==null){c.deleteExpando=!0;try{delete t.test}catch(r){c.deleteExpando=!1}}e=t=n=null})(),function(){var t,n,r=N.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(c[t+"Bubbles"]=n in e)||(r.setAttribute(n,"t"),c[t+"Bubbles"]=r.attributes[n].expando===!1);r=null}();var Q=/^(?:input|select|textarea)$/i,G=/^key/,Y=/^(?:mouse|contextmenu)|click/,Z=/^(?:focusinfocus|focusoutblur)$/,et=/^([^.]*)(?:\.(.+)|)$/;p.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p._data(e);if(!g)return;n.handler&&(a=n,n=a.handler,i=a.selector),n.guid||(n.guid=p.guid++),(o=g.events)||(o=g.events={}),(l=g.handle)||(l=g.handle=function(e){return typeof p===j||!!e&&p.event.triggered===e.type?undefined:p.event.dispatch.apply(l.elem,arguments)},l.elem=e),t=(t||"").match(M)||[""],u=t.length;while(u--){s=et.exec(t[u])||[],d=m=s[1],v=(s[2]||"").split(".").sort();if(!d)continue;f=p.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=p.event.special[d]||{},c=p.extend({type:d,origType:m,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&p.expr.match.needsContext.test(i),namespace:v.join(".")},a);if(!(h=o[d])){h=o[d]=[],h.delegateCount=0;if(!f.setup||f.setup.call(e,r,v,l)===!1)e.addEventListener?e.addEventListener(d,l,!1):e.attachEvent&&e.attachEvent("on"+d,l)}f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,c):h.push(c),p.event.global[d]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,d,v,m,g=p.hasData(e)&&p._data(e);if(!g||!(l=g.events))return;t=(t||"").match(M)||[""],f=t.length;while(f--){u=et.exec(t[f])||[],d=m=u[1],v=(u[2]||"").split(".").sort();if(!d){for(d in l)p.event.remove(e,d+t[f],n,r,!0);continue}c=p.event.special[d]||{},d=(r?c.delegateType:c.bindType)||d,h=l[d]||[],u=u[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],(i||m===o.origType)&&(!n||n.guid===o.guid)&&(!u||u.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)&&(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&((!c.teardown||c.teardown.call(e,v,g.handle)===!1)&&p.removeEvent(e,d,g.handle),delete l[d])}p.isEmptyObject(l)&&(delete g.handle,p._removeData(e,"events"))},trigger:function(t,n,r,i){var s,o,u,a,l,c,h,d=[r||N],v=f.call(t,"type")?t.type:t,m=f.call(t,"namespace")?t.namespace.split("."):[];u=c=r=r||N;if(r.nodeType===3||r.nodeType===8)return;if(Z.test(v+p.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),o=v.indexOf(":")<0&&"on"+v,t=t[p.expando]?t:new p.Event(v,typeof t=="object"&&t),t.isTrigger=i?2:3,t.namespace=m.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=undefined,t.target||(t.target=r),n=n==null?[t]:p.makeArray(n,[t]),l=p.event.special[v]||{};if(!i&&l.trigger&&l.trigger.apply(r,n)===!1)return;if(!i&&!l.noBubble&&!p.isWindow(r)){a=l.delegateType||v,Z.test(a+v)||(u=u.parentNode);for(;u;u=u.parentNode)d.push(u),c=u;c===(r.ownerDocument||N)&&d.push(c.defaultView||c.parentWindow||e)}h=0;while((u=d[h++])&&!t.isPropagationStopped())t.type=h>1?a:l.bindType||v,s=(p._data(u,"events")||{})[t.type]&&p._data(u,"handle"),s&&s.apply(u,n),s=o&&u[o],s&&s.apply&&p.acceptData(u)&&(t.result=s.apply(u,n),t.result===!1&&t.preventDefault());t.type=v;if(!i&&!t.isDefaultPrevented()&&(!l._default||l._default.apply(d.pop(),n)===!1)&&p.acceptData(r)&&o&&r[v]&&!p.isWindow(r)){c=r[o],c&&(r[o]=null),p.event.triggered=v;try{r[v]()}catch(g){}p.event.triggered=undefined,c&&(r[o]=c)}return t.result},dispatch:function(e){e=p.event.fix(e);var t,n,i,s,o,u=[],a=r.call(arguments),f=(p._data(this,"events")||{})[e.type]||[],l=p.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=p.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(i.namespace))e.handleObj=i,e.data=i.data,n=((p.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),n!==undefined&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!=this;a=a.parentNode||this)if(a.nodeType===1&&(a.disabled!==!0||e.type!=="click")){i=[];for(s=0;s<u;s++)r=t[s],n=r.selector+" ",i[n]===undefined&&(i[n]=r.needsContext?p(n,this).index(a)>=0:p.find(n,this,null,[a]).length),i[n]&&i.push(r);i.length&&o.push({elem:a,handlers:i})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},fix:function(e){if(e[p.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=Y.test(i)?this.mouseHooks:G.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new p.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||N),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,o.filter?o.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button,o=t.fromElement;return e.pageX==null&&t.clientX!=null&&(r=e.target.ownerDocument||N,i=r.documentElement,n=r.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?t.toElement:o),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==rt()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===rt()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(p.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1},_default:function(e){return p.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=p.extend(new p.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?p.event.trigger(i,null,t):p.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},p.removeEvent=N.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===j&&(e[r]=null),e.detachEvent(r,n))},p.Event=function(e,t){if(!(this instanceof p.Event))return new p.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.defaultPrevented===undefined&&(e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault())?tt:nt):this.type=e,t&&p.extend(this,t),this.timeStamp=e&&e.timeStamp||p.now(),this[p.expando]=!0},p.Event.prototype={isDefaultPrevented:nt,isPropagationStopped:nt,isImmediatePropagationStopped:nt,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=tt;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=tt;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){p.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!p.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),c.submitBubbles||(p.event.special.submit={setup:function(){if(p.nodeName(this,"form"))return!1;p.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=p.nodeName(t,"input")||p.nodeName(t,"button")?t.form:undefined;n&&!p._data(n,"submitBubbles")&&(p.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),p._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&p.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(p.nodeName(this,"form"))return!1;p.event.remove(this,"._submit")}}),c.changeBubbles||(p.event.special.change={setup:function(){if(Q.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")p.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),p.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),p.event.simulate("change",this,e,!0)});return!1}p.event.add(this,"beforeactivate._change",function(e){var t=e.target;Q.test(t.nodeName)&&!p._data(t,"changeBubbles")&&(p.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&p.event.simulate("change",this.parentNode,e,!0)}),p._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return p.event.remove(this,"._change"),!Q.test(this.nodeName)}}),c.focusinBubbles||p.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){p.event.simulate(t,e.target,p.event.fix(e),!0)};p.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=p._data(r,t);i||r.addEventListener(e,n,!0),p._data(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=p._data(r,t)-1;i?p._data(r,t,i):(r.removeEventListener(e,n,!0),p._removeData(r,t))}}}),p.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(s in e)this.on(s,t,n,e[s],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=nt;else if(!r)return this;return i===1&&(o=r,r=function(e){return p().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=p.guid++)),this.each(function(){p.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,p(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=nt),this.each(function(){p.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){p.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return p.event.trigger(e,t,n,!0)}});var st="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ot=/ jQuery\d+="(?:null|\d+)"/g,ut=new RegExp("<(?:"+st+")[\\s/>]","i"),at=/^\s+/,ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,lt=/<([\w:]+)/,ct=/<tbody/i,ht=/<|&#?\w+;/,pt=/<(?:script|style|link)/i,dt=/checked\s*(?:[^=]|=\s*.checked.)/i,vt=/^$|\/(?:java|ecma)script/i,mt=/^true\/(.*)/,gt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,yt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:c.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},bt=it(N),wt=bt.appendChild(N.createElement("div"));yt.optgroup=yt.option,yt.tbody=yt.tfoot=yt.colgroup=yt.caption=yt.thead,yt.th=yt.td,p.extend({clone:function(e,t,n){var r,i,s,o,u,a=p.contains(e.ownerDocument,e);c.html5Clone||p.isXMLDoc(e)||!ut.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(wt.innerHTML=e.outerHTML,wt.removeChild(s=wt.firstChild));if((!c.noCloneEvent||!c.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!p.isXMLDoc(e)){r=Et(s),u=Et(e);for(o=0;(i=u[o])!=null;++o)r[o]&&Lt(i,r[o])}if(t)if(n){u=u||Et(e),r=r||Et(s);for(o=0;(i=u[o])!=null;o++)kt(i,r[o])}else kt(e,s);return r=Et(s,"script"),r.length>0&&Ct(r,!a&&Et(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,h=e.length,d=it(t),v=[],m=0;for(;m<h;m++){s=e[m];if(s||s===0)if(p.type(s)==="object")p.merge(v,s.nodeType?[s]:s);else if(!ht.test(s))v.push(t.createTextNode(s));else{u=u||d.appendChild(t.createElement("div")),a=(lt.exec(s)||["",""])[1].toLowerCase(),l=yt[a]||yt._default,u.innerHTML=l[1]+s.replace(ft,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;!c.leadingWhitespace&&at.test(s)&&v.push(t.createTextNode(at.exec(s)[0]));if(!c.tbody){s=a==="table"&&!ct.test(s)?u.firstChild:l[1]==="<table>"&&!ct.test(s)?u:0,i=s&&s.childNodes.length;while(i--)p.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}p.merge(v,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=d.lastChild}}u&&d.removeChild(u),c.appendChecked||p.grep(Et(v,"input"),St),m=0;while(s=v[m++]){if(r&&p.inArray(s,r)!==-1)continue;o=p.contains(s.ownerDocument,s),u=Et(d.appendChild(s),"script"),o&&Ct(u);if(n){i=0;while(s=u[i++])vt.test(s.type||"")&&n.push(s)}}return u=null,d},cleanData:function(e,t){var r,i,s,o,u=0,a=p.expando,f=p.cache,l=c.deleteExpando,h=p.event.special;for(;(r=e[u])!=null;u++)if(t||p.acceptData(r)){s=r[a],o=s&&f[s];if(o){if(o.events)for(i in o.events)h[i]?p.event.remove(r,i):p.removeEvent(r,i,o.handle);f[s]&&(delete f[s],l?delete r[a]:typeof r.removeAttribute!==j?r.removeAttribute(a):r[a]=null,n.push(s))}}}}),p.fn.extend({text:function(e){return J(this,function(e){return e===undefined?p.text(this):this.empty().append((this[0]&&this[0].ownerDocument||N).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=xt(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=xt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?p.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&p.cleanData(Et(n)),n.parentNode&&(t&&p.contains(n.ownerDocument,n)&&Ct(Et(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&p.cleanData(Et(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&p.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return p.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined)return t.nodeType===1?t.innerHTML.replace(ot,""):undefined;if(typeof e=="string"&&!pt.test(e)&&(c.htmlSerialize||!ut.test(e))&&(c.leadingWhitespace||!at.test(e))&&!yt[(lt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ft,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(p.cleanData(Et(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,p.cleanData(Et(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=i.apply([],e);var n,r,s,o,u,a,f=0,l=this.length,h=this,d=l-1,v=e[0],m=p.isFunction(v);if(m||l>1&&typeof v=="string"&&!c.checkClone&&dt.test(v))return this.each(function(n){var r=h.eq(n);m&&(e[0]=v.call(this,n,r.html())),r.domManip(e,t)});if(l){a=p.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,a.childNodes.length===1&&(a=n);if(n){o=p.map(Et(a,"script"),Tt),s=o.length;for(;f<l;f++)r=a,f!==d&&(r=p.clone(r,!0,!0),s&&p.merge(o,Et(r,"script"))),t.call(this[f],r,f);if(s){u=o[o.length-1].ownerDocument,p.map(o,Nt);for(f=0;f<s;f++)r=o[f],vt.test(r.type||"")&&!p._data(r,"globalEval")&&p.contains(u,r)&&(r.src?p._evalUrl&&p._evalUrl(r.src):p.globalEval((r.text||r.textContent||r.innerHTML||"").replace(gt,"")))}a=n=null}}return this}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){p.fn[e]=function(e){var n,r=0,i=[],o=p(e),u=o.length-1;for(;r<=u;r++)n=r===u?this:this.clone(!0),p(o[r])[t](n),s.apply(i,n.get());return this.pushStack(i)}});var At,Ot={};(function(){var e,t,n=N.createElement("div"),r="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=n.getElementsByTagName("a")[0],e.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(e.style.opacity),c.cssFloat=!!e.style.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle=n.style.backgroundClip==="content-box",e=n=null,c.shrinkWrapBlocks=function(){var e,n,i,s;if(t==null){e=N.getElementsByTagName("body")[0];if(!e)return;s="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",n=N.createElement("div"),i=N.createElement("div"),e.appendChild(n).appendChild(i),t=!1,typeof i.style.zoom!==j&&(i.style.cssText=r+";width:1px;padding:1px;zoom:1",i.innerHTML="<div></div>",i.firstChild.style.width="5px",t=i.offsetWidth!==3),e.removeChild(n),e=n=i=null}return t}})();var Dt=/^margin/,Pt=new RegExp("^("+X+")(?!px)[a-z%]+$","i"),Ht,Bt,jt=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ht=function(e){return e.ownerDocument.defaultView.getComputedStyle(e,null)},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n.getPropertyValue(t)||n[t]:undefined,n&&(o===""&&!p.contains(e.ownerDocument,e)&&(o=p.style(e,t)),Pt.test(o)&&Dt.test(t)&&(r=u.width,i=u.minWidth,s=u.maxWidth,u.minWidth=u.maxWidth=u.width=o,o=n.width,u.width=r,u.minWidth=i,u.maxWidth=s)),o===undefined?o:o+""}):N.documentElement.currentStyle&&(Ht=function(e){return e.currentStyle},Bt=function(e,t,n){var r,i,s,o,u=e.style;return n=n||Ht(e),o=n?n[t]:undefined,o==null&&u&&u[t]&&(o=u[t]),Pt.test(o)&&!jt.test(t)&&(r=u.left,i=e.runtimeStyle,s=i&&i.left,s&&(i.left=e.currentStyle.left),u.left=t==="fontSize"?"1em":o,o=u.pixelLeft+"px",u.left=r,s&&(i.left=s)),o===undefined?o:o+""||"auto"}),function(){function l(){var t,n,u=N.getElementsByTagName("body")[0];if(!u)return;t=N.createElement("div"),n=N.createElement("div"),t.style.cssText=a,u.appendChild(t).appendChild(n),n.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;display:block;padding:1px;border:1px;width:4px;margin-top:1%;top:1%",p.swap(u,u.style.zoom!=null?{zoom:1}:{},function(){r=n.offsetWidth===4}),i=!0,s=!1,o=!0,e.getComputedStyle&&(s=(e.getComputedStyle(n,null)||{}).top!=="1%",i=(e.getComputedStyle(n,null)||{width:"4px"}).width==="4px"),u.removeChild(t),n=u=null}var t,n,r,i,s,o,u=N.createElement("div"),a="border:0;width:0;height:0;position:absolute;top:0;left:-9999px",f="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;padding:0;margin:0;border:0";u.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",t=u.getElementsByTagName("a")[0],t.style.cssText="float:left;opacity:.5",c.opacity=/^0.5/.test(t.style.opacity),c.cssFloat=!!t.style.cssFloat,u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",c.clearCloneStyle=u.style.backgroundClip==="content-box",t=u=null,p.extend(c,{reliableHiddenOffsets:function(){if(n!=null)return n;var e,t,r,i=N.createElement("div"),s=N.getElementsByTagName("body")[0];if(!s)return;return i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=N.createElement("div"),e.style.cssText=a,s.appendChild(e).appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",t=i.getElementsByTagName("td"),t[0].style.cssText="padding:0;margin:0;border:0;display:none",r=t[0].offsetHeight===0,t[0].style.display="",t[1].style.display="none",n=r&&t[0].offsetHeight===0,s.removeChild(e),i=s=null,n},boxSizing:function(){return r==null&&l(),r},boxSizingReliable:function(){return i==null&&l(),i},pixelPosition:function(){return s==null&&l(),s},reliableMarginRight:function(){var t,n,r,i;if(o==null&&e.getComputedStyle){t=N.getElementsByTagName("body")[0];if(!t)return;n=N.createElement("div"),r=N.createElement("div"),n.style.cssText=a,t.appendChild(n).appendChild(r),i=r.appendChild(N.createElement("div")),i.style.cssText=r.style.cssText=f,i.style.marginRight=i.style.width="0",r.style.width="1px",o=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight),t.removeChild(n)}return o}})}(),p.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var It=/alpha\([^)]*\)/i,qt=/opacity\s*=\s*([^)]*)/,Rt=/^(none|table(?!-c[ea]).+)/,Ut=new RegExp("^("+X+")(.*)$","i"),zt=new RegExp("^([+-])=("+X+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:0,fontWeight:400},Vt=["Webkit","O","Moz","ms"];p.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Bt(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":c.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=p.camelCase(t),a=e.style;t=p.cssProps[u]||(p.cssProps[u]=$t(a,u)),o=p.cssHooks[t]||p.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=zt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(p.css(e,t)),s="number");if(n==null||n!==n)return;s==="number"&&!p.cssNumber[u]&&(n+="px"),!c.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)try{a[t]="",a[t]=n}catch(f){}},css:function(e,t,n,r){var i,s,o,u=p.camelCase(t);return t=p.cssProps[u]||(p.cssProps[u]=$t(e.style,u)),o=p.cssHooks[t]||p.cssHooks[u],o&&"get"in o&&(s=o.get(e,!0,n)),s===undefined&&(s=Bt(e,t,r)),s==="normal"&&t in Xt&&(s=Xt[t]),n===""||n?(i=parseFloat(s),n===!0||p.isNumeric(i)?i||0:s):s}}),p.each(["height","width"],function(e,t){p.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&Rt.test(p.css(e,"display"))?p.swap(e,Wt,function(){return Gt(e,t,r)}):Gt(e,t,r)},set:function(e,n,r){var i=r&&Ht(e);return Kt(e,n,r?Qt(e,t,r,c.boxSizing()&&p.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),c.opacity||(p.cssHooks.opacity={get:function(e,t){return qt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=p.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&p.trim(s.replace(It,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=It.test(s)?s.replace(It,i):s+" "+i}}),p.cssHooks.marginRight=Ft(c.reliableMarginRight,function(e,t){if(t)return p.swap(e,{display:"inline-block"},Bt,[e,"marginRight"])}),p.each({margin:"",padding:"",border:"Width"},function(e,t){p.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+V[r]+t]=s[r]||s[r-2]||s[0];return i}},Dt.test(e)||(p.cssHooks[e+t].set=Kt)}),p.fn.extend({css:function(e,t){return J(this,function(e,t,n){var r,i,s={},o=0;if(p.isArray(t)){r=Ht(e),i=t.length;for(;o<i;o++)s[t[o]]=p.css(e,t[o],!1,r);return s}return n!==undefined?p.style(e,t,n):p.css(e,t)},e,t,arguments.length>1)},show:function(){return Jt(this,!0)},hide:function(){return Jt(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){$(this)?p(this).show():p(this).hide()})}}),p.Tween=Yt,Yt.prototype={constructor:Yt,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(p.cssNumber[n]?"":"px")},cur:function(){var e=Yt.propHooks[this.prop];return e&&e.get?e.get(this):Yt.propHooks._default.get(this)},run:function(e){var t,n=Yt.propHooks[this.prop];return this.options.duration?this.pos=t=p.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yt.propHooks._default.set(this),this}},Yt.prototype.init.prototype=Yt.prototype,Yt.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=p.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){p.fx.step[e.prop]?p.fx.step[e.prop](e):e.elem.style&&(e.elem.style[p.cssProps[e.prop]]!=null||p.cssHooks[e.prop])?p.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yt.propHooks.scrollTop=Yt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},p.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},p.fx=Yt.prototype.init,p.fx.step={};var Zt,en,tn=/^(?:toggle|show|hide)$/,nn=new RegExp("^(?:([+-])=|)("+X+")([a-z%]*)$","i"),rn=/queueHooks$/,sn=[ln],on={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=nn.exec(t),s=i&&i[3]||(p.cssNumber[e]?"":"px"),o=(p.cssNumber[e]||s!=="px"&&+r)&&nn.exec(p.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,p.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};p.Animation=p.extend(hn,{tweener:function(e,t){p.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],on[n]=on[n]||[],on[n].unshift(t)},prefilter:function(e,t){t?sn.unshift(e):sn.push(e)}}),p.speed=function(e,t,n){var r=e&&typeof e=="object"?p.extend({},e):{complete:n||!n&&t||p.isFunction(e)&&e,duration:e,easing:n&&t||t&&!p.isFunction(t)&&t};r.duration=p.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in p.fx.speeds?p.fx.speeds[r.duration]:p.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){p.isFunction(r.old)&&r.old.call(this),r.queue&&p.dequeue(this,r.queue)},r},p.fn.extend({fadeTo:function(e,t,n,r){return this.filter($).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=p.isEmptyObject(e),s=p.speed(t,n,r),o=function(){var t=hn(this,p.extend({},e),s);(i||p._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=p.timers,o=p._data(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rn.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&p.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=p._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=p.timers,o=r?r.length:0;n.finish=!0,p.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),p.each(["toggle","show","hide"],function(e,t){var n=p.fn[t];p.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(an(t,!0),e,r,i)}}),p.each({slideDown:an("show"),slideUp:an("hide"),slideToggle:an("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){p.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),p.timers=[],p.fx.tick=function(){var e,t=p.timers,n=0;Zt=p.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||p.fx.stop(),Zt=undefined},p.fx.timer=function(e){p.timers.push(e),e()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){en||(en=setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){clearInterval(en),en=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(e,t){return e=p.fx?p.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e,t,n,r,i=N.createElement("div");i.setAttribute("className","t"),i.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",e=i.getElementsByTagName("a")[0],n=N.createElement("select"),r=n.appendChild(N.createElement("option")),t=i.getElementsByTagName("input")[0],e.style.cssText="top:1px",c.getSetAttribute=i.className!=="t",c.style=/top/.test(e.getAttribute("style")),c.hrefNormalized=e.getAttribute("href")==="/a",c.checkOn=!!t.value,c.optSelected=r.selected,c.enctype=!!N.createElement("form").enctype,n.disabled=!0,c.optDisabled=!r.disabled,t=N.createElement("input"),t.setAttribute("value",""),c.input=t.getAttribute("value")==="",t.value="t",t.setAttribute("type","radio"),c.radioValue=t.value==="t",e=t=n=r=i=null}();var pn=/\r/g;p.fn.extend({val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=p.valHooks[i.type]||p.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(pn,""):n==null?"":n);return}return r=p.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,p(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":p.isArray(i)&&(i=p.map(i,function(e){return e==null?"":e+""})),t=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),p.extend({valHooks:{option:{get:function(e){var t=p.find.attr(e,"value");return t!=null?t:p.text(e)}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(c.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!p.nodeName(n.parentNode,"optgroup"))){t=p(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=p.makeArray(t),o=i.length;while(o--){r=i[o];if(p.inArray(p.valHooks.option.get(r),s)>=0)try{r.selected=n=!0}catch(u){r.scrollHeight}else r.selected=!1}return n||(e.selectedIndex=-1),i}}}}),p.each(["radio","checkbox"],function(){p.valHooks[this]={set:function(e,t){if(p.isArray(t))return e.checked=p.inArray(p(e).val(),t)>=0}},c.checkOn||(p.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var dn,vn,mn=p.expr.attrHandle,gn=/^(?:checked|selected)$/i,yn=c.getSetAttribute,bn=c.input;p.fn.extend({attr:function(e,t){return J(this,p.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){p.removeAttr(this,e)})}}),p.extend({attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===j)return p.prop(e,t,n);if(s!==1||!p.isXMLDoc(e))t=t.toLowerCase(),r=p.attrHooks[t]||(p.expr.match.bool.test(t)?vn:dn);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=p.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);p.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(M);if(s&&e.nodeType===1)while(n=s[i++])r=p.propFix[n]||n,p.expr.match.bool.test(n)?bn&&yn||!gn.test(n)?e[r]=!1:e[p.camelCase("default-"+n)]=e[r]=!1:p.attr(e,n,""),e.removeAttribute(yn?n:r)},attrHooks:{type:{set:function(e,t){if(!c.radioValue&&t==="radio"&&p.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),vn={set:function(e,t,n){return t===!1?p.removeAttr(e,n):bn&&yn||!gn.test(n)?e.setAttribute(!yn&&p.propFix[n]||n,n):e[p.camelCase("default-"+n)]=e[n]=!0,n}},p.each(p.expr.match.bool.source.match(/\w+/g),function(e,t){var n=mn[t]||p.find.attr;mn[t]=bn&&yn||!gn.test(t)?function(e,t,r){var i,s;return r||(s=mn[t],mn[t]=i,i=n(e,t,r)!=null?t.toLowerCase():null,mn[t]=s),i}:function(e,t,n){if(!n)return e[p.camelCase("default-"+t)]?t.toLowerCase():null}});if(!bn||!yn)p.attrHooks.value={set:function(e,t,n){if(!p.nodeName(e,"input"))return dn&&dn.set(e,t,n);e.defaultValue=t}};yn||(dn={set:function(e,t,n){var r=e.getAttributeNode(n);r||e.setAttributeNode(r=e.ownerDocument.createAttribute(n)),r.value=t+="";if(n==="value"||t===e.getAttribute(n))return t}},mn.id=mn.name=mn.coords=function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.value!==""?r.value:null},p.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);if(n&&n.specified)return n.value},set:dn.set},p.attrHooks.contenteditable={set:function(e,t,n){dn.set(e,t===""?!1:t,n)}},p.each(["width","height"],function(e,t){p.attrHooks[t]={set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}}})),c.style||(p.attrHooks.style={get:function(e){return e.style.cssText||undefined},set:function(e,t){return e.style.cssText=t+""}});var wn=/^(?:input|select|textarea|button|object)$/i,En=/^(?:a|area)$/i;p.fn.extend({prop:function(e,t){return J(this,p.prop,e,t,arguments.length>1)},removeProp:function(e){return e=p.propFix[e]||e,this.each(function(){try{this[e]=undefined,delete this[e]}catch(t){}})}}),p.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!p.isXMLDoc(e),s&&(t=p.propFix[t]||t,i=p.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=p.find.attr(e,"tabindex");return t?parseInt(t,10):wn.test(e.nodeName)||En.test(e.nodeName)&&e.href?0:-1}}}}),c.hrefNormalized||p.each(["href","src"],function(e,t){p.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),c.optSelected||(p.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){p.propFix[this.toLowerCase()]=this}),c.enctype||(p.propFix.enctype="encoding");var Sn=/[\t\r\n\f]/g;p.fn.extend({addClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=typeof e=="string"&&e;if(p.isFunction(e))return this.each(function(t){p(this).addClass(e.call(this,t,this.className))});if(f){t=(e||"").match(M)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(Sn," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");o=p.trim(r),n.className!==o&&(n.className=o)}}}return this},removeClass:function(e){var t,n,r,i,s,o,u=0,a=this.length,f=arguments.length===0||typeof e=="string"&&e;if(p.isFunction(e))return this.each(function(t){p(this).removeClass(e.call(this,t,this.className))});if(f){t=(e||"").match(M)||[];for(;u<a;u++){n=this[u],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(Sn," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");o=e?p.trim(r):"",n.className!==o&&(n.className=o)}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):p.isFunction(e)?this.each(function(n){p(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=p(this),s=e.match(M)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===j||n==="boolean")this.className&&p._data(this,"__className__",this.className),this.className=this.className||e===!1?"":p._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(Sn," ").indexOf(t)>=0)return!0;return!1}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){p.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),p.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var xn=p.now(),Tn=/\?/,Nn=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;p.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return t=t||"{}",e.JSON.parse(t+"");var n,r=null,i=p.trim(t+"");return i&&!p.trim(i.replace(Nn,function(e,t,i,s){return n&&t&&(r=0),r===0?e:(n=i||t,r+=!s-!i,"")}))?Function("return "+i)():p.error("Invalid JSON: "+t)},p.parseXML=function(t){var n,r;if(!t||typeof t!="string")return null;try{e.DOMParser?(r=new DOMParser,n=r.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(i){n=undefined}return(!n||!n.documentElement||n.getElementsByTagName("parsererror").length)&&p.error("Invalid XML: "+t),n};var Cn,kn,Ln=/#.*$/,An=/([?&])_=[^&]*/,On=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,Mn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_n=/^(?:GET|HEAD)$/,Dn=/^\/\//,Pn=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hn={},Bn={},jn="*/".concat("*");try{kn=location.href}catch(Fn){kn=N.createElement("a"),kn.href="",kn=kn.href}Cn=Pn.exec(kn.toLowerCase())||[],p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:kn,type:"GET",isLocal:Mn.test(Cn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jn,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Rn(Rn(e,p.ajaxSettings),t):Rn(p.ajaxSettings,e)},ajaxPrefilter:In(Hn),ajaxTransport:In(Bn),ajax:function(e,t){function x(e,t,n,r){var f,g,y,w,S,x=t;if(b===2)return;b=2,o&&clearTimeout(o),a=undefined,s=r||"",E.readyState=e>0?4:0,f=e>=200&&e<300||e===304,n&&(w=Un(l,E,n)),w=zn(l,w,E,f);if(f)l.ifModified&&(S=E.getResponseHeader("Last-Modified"),S&&(p.lastModified[i]=S),S=E.getResponseHeader("etag"),S&&(p.etag[i]=S)),e===204||l.type==="HEAD"?x="nocontent":e===304?x="notmodified":(x=w.state,g=w.data,y=w.error,f=!y);else{y=x;if(e||!x)x="error",e<0&&(e=0)}E.status=e,E.statusText=(t||x)+"",f?d.resolveWith(c,[g,x,E]):d.rejectWith(c,[E,x,y]),E.statusCode(m),m=undefined,u&&h.trigger(f?"ajaxSuccess":"ajaxError",[E,l,f?g:y]),v.fireWith(c,[E,x]),u&&(h.trigger("ajaxComplete",[E,l]),--p.active||p.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=p.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?p(c):p.event,d=p.Deferred(),v=p.Callbacks("once memory"),m=l.statusCode||{},g={},y={},b=0,w="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(b===2){if(!f){f={};while(t=On.exec(s))f[t[1].toLowerCase()]=t[2]}t=f[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return b===2?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(b<2)for(t in e)m[t]=[m[t],e[t]];else E.always(e[E.status]);return this},abort:function(e){var t=e||w;return a&&a.abort(t),x(0,t),this}};d.promise(E).complete=v.add,E.success=E.done,E.error=E.fail,l.url=((e||l.url||kn)+"").replace(Ln,"").replace(Dn,Cn[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=p.trim(l.dataType||"*").toLowerCase().match(M)||[""],l.crossDomain==null&&(n=Pn.exec(l.url.toLowerCase()),l.crossDomain=!(!n||n[1]===Cn[1]&&n[2]===Cn[2]&&(n[3]||(n[1]==="http:"?"80":"443"))===(Cn[3]||(Cn[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=p.param(l.data,l.traditional)),qn(Hn,l,t,E);if(b===2)return E;u=l.global,u&&p.active++===0&&p.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!_n.test(l.type),i=l.url,l.hasContent||(l.data&&(i=l.url+=(Tn.test(i)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=An.test(i)?i.replace(An,"$1_="+xn++):i+(Tn.test(i)?"&":"?")+"_="+xn++)),l.ifModified&&(p.lastModified[i]&&E.setRequestHeader("If-Modified-Since",p.lastModified[i]),p.etag[i]&&E.setRequestHeader("If-None-Match",p.etag[i])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&E.setRequestHeader("Content-Type",l.contentType),E.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+jn+"; q=0.01":""):l.accepts["*"]);for(r in l.headers)E.setRequestHeader(r,l.headers[r]);if(!l.beforeSend||l.beforeSend.call(c,E,l)!==!1&&b!==2){w="abort";for(r in{success:1,error:1,complete:1})E[r](l[r]);a=qn(Bn,l,t,E);if(!a)x(-1,"No Transport");else{E.readyState=1,u&&h.trigger("ajaxSend",[E,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){E.abort("timeout")},l.timeout));try{b=1,a.send(g,x)}catch(S){if(!(b<2))throw S;x(-1,S)}}return E}return E.abort()},getJSON:function(e,t,n){return p.get(e,t,n,"json")},getScript:function(e,t){return p.get(e,undefined,t,"script")}}),p.each(["get","post"],function(e,t){p[t]=function(e,n,r,i){return p.isFunction(n)&&(i=i||r,r=n,n=undefined),p.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){p.fn[t]=function(e){return this.on(t,e)}}),p._evalUrl=function(e){return p.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},p.fn.extend({wrapAll:function(e){if(p.isFunction(e))return this.each(function(t){p(this).wrapAll(e.call(this,t))});if(this[0]){var t=p(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return p.isFunction(e)?this.each(function(t){p(this).wrapInner(e.call(this,t))}):this.each(function(){var t=p(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=p.isFunction(e);return this.each(function(n){p(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)}).end()}}),p.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!c.reliableHiddenOffsets()&&(e.style&&e.style.display||p.css(e,"display"))==="none"},p.expr.filters.visible=function(e){return!p.expr.filters.hidden(e)};var Wn=/%20/g,Xn=/\[\]$/,Vn=/\r?\n/g,$n=/^(?:submit|button|image|reset|file)$/i,Jn=/^(?:input|select|textarea|keygen)/i;p.param=function(e,t){var n,r=[],i=function(e,t){t=p.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=p.ajaxSettings&&p.ajaxSettings.traditional);if(p.isArray(e)||e.jquery&&!p.isPlainObject(e))p.each(e,function(){i(this.name,this.value)});else for(n in e)Kn(n,e[n],t,i);return r.join("&").replace(Wn,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=p.prop(this,"elements");return e?p.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!p(this).is(":disabled")&&Jn.test(this.nodeName)&&!$n.test(e)&&(this.checked||!K.test(e))}).map(function(e,t){var n=p(this).val();return n==null?null:p.isArray(n)?p.map(n,function(e){return{name:t.name,value:e.replace(Vn,"\r\n")}}):{name:t.name,value:n.replace(Vn,"\r\n")}}).get()}}),p.ajaxSettings.xhr=e.ActiveXObject!==undefined?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zn()||er()}:Zn;var Qn=0,Gn={},Yn=p.ajaxSettings.xhr();e.ActiveXObject&&p(e).on("unload",function(){for(var e in Gn)Gn[e](undefined,!0)}),c.cors=!!Yn&&"withCredentials"in Yn,Yn=c.ajax=!!Yn,Yn&&p.ajaxTransport(function(e){if(!e.crossDomain||c.cors){var t;return{send:function(n,r){var i,s=e.xhr(),o=++Qn;s.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)n[i]!==undefined&&s.setRequestHeader(i,n[i]+"");s.send(e.hasContent&&e.data||null),t=function(n,i){var u,a,f;if(t&&(i||s.readyState===4)){delete Gn[o],t=undefined,s.onreadystatechange=p.noop;if(i)s.readyState!==4&&s.abort();else{f={},u=s.status,typeof s.responseText=="string"&&(f.text=s.responseText);try{a=s.statusText}catch(l){a=""}!u&&e.isLocal&&!e.crossDomain?u=f.text?200:404:u===1223&&(u=204)}}f&&r(u,a,f,s.getAllResponseHeaders())},e.async?s.readyState===4?setTimeout(t):s.onreadystatechange=Gn[o]=t:t()},abort:function(){t&&t(undefined,!0)}}}}),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return p.globalEval(e),e}}}),p.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),p.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=N.head||p("head")[0]||N.documentElement;return{send:function(r,i){t=N.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){if(n||!t.readyState||/loaded|complete/.test(t.readyState))t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success")},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(undefined,!0)}}}});var tr=[],nr=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=tr.pop()||p.expando+"_"+xn++;return this[e]=!0,e}}),p.ajaxPrefilter("json jsonp",function(t,n,r){var i,s,o,u=t.jsonp!==!1&&(nr.test(t.url)?"url":typeof t.data=="string"&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&nr.test(t.data)&&"data");if(u||t.dataTypes[0]==="jsonp")return i=t.jsonpCallback=p.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,u?t[u]=t[u].replace(nr,"$1"+i):t.jsonp!==!1&&(t.url+=(Tn.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return o||p.error(i+" was not called"),o[0]},t.dataTypes[0]="json",s=e[i],e[i]=function(){o=arguments},r.always(function(){e[i]=s,t[i]&&(t.jsonpCallback=n.jsonpCallback,tr.push(i)),o&&p.isFunction(s)&&s(o[0]),o=s=undefined}),"script"}),p.parseHTML=function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||N;var r=E.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=p.buildFragment([e],t,i),i&&i.length&&p(i).remove(),p.merge([],r.childNodes))};var rr=p.fn.load;p.fn.load=function(e,t,n){if(typeof e!="string"&&rr)return rr.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u,e.length),e=e.slice(0,u)),p.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(s="POST"),o.length>0&&p.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){i=arguments,o.html(r?p("<div>").append(p.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,i||[e.responseText,t,e])}),this},p.expr.filters.animated=function(e){return p.grep(p.timers,function(t){return e===t.elem}).length};var ir=e.document.documentElement;p.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=p.css(e,"position"),c=p(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=p.css(e,"top"),a=p.css(e,"left"),f=(l==="absolute"||l==="fixed")&&p.inArray("auto",[s,a])>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),p.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},p.fn.extend({offset:function(e){if(arguments.length)return e===undefined?this:this.each(function(t){p.offset.setOffset(this,e,t)});var t,n,r={top:0,left:0},i=this[0],s=i&&i.ownerDocument;if(!s)return;return t=s.documentElement,p.contains(t,i)?(typeof i.getBoundingClientRect!==j&&(r=i.getBoundingClientRect()),n=sr(s),{top:r.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:r.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):r},position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return p.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),p.nodeName(e[0],"html")||(n=e.offset()),n.top+=p.css(e[0],"borderTopWidth",!0),n.left+=p.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-p.css(r,"marginTop",!0),left:t.left-n.left-p.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||ir;while(e&&!p.nodeName(e,"html")&&p.css(e,"position")==="static")e=e.offsetParent;return e||ir})}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);p.fn[e]=function(r){return J(this,function(e,r,i){var s=sr(e);if(i===undefined)return s?t in s?s[t]:s.document.documentElement[r]:e[r];s?s.scrollTo(n?p(s).scrollLeft():i,n?i:p(s).scrollTop()):e[r]=i},e,r,arguments.length,null)}}),p.each(["top","left"],function(e,t){p.cssHooks[t]=Ft(c.pixelPosition,function(e,n){if(n)return n=Bt(e,t),Pt.test(n)?p(e).position()[t]+"px":n})}),p.each({Height:"height",Width:"width"},function(e,t){p.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){p.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return J(this,function(t,n,r){var i;return p.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?p.css(t,n,o):p.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),p.fn.size=function(){return this.length},p.fn.andSelf=p.fn.addBack,p.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},p.browser||(matched=p.uaMatch(navigator.userAgent),browser={},matched.browser&&(browser[matched.browser]=!0,browser.version=matched.version),browser.chrome?browser.webkit=!0:browser.webkit&&(browser.safari=!0),p.browser=browser),typeof define=="function"&&define.amd&&define("jquery",[],function(){return p});var or=e.jQuery,ur=e.$;return p.noConflict=function(t){return e.$===p&&(e.$=ur),t&&e.jQuery===p&&(e.jQuery=or),p},typeof t===j&&(e.jQuery=e.$=p),p}),$.noConflict(!0),function(){function x(e,t,n){var r=(n||0)-1,i=e?e.length:0;while(++r<i)if(e[r]===t)return r;return-1}function T(e,t){var n=e.criteria,r=t.criteria,i=-1,s=n.length;while(++i<s){var o=n[i],u=r[i];if(o!==u){if(o>u||typeof o=="undefined")return 1;if(o<u||typeof u=="undefined")return-1}}return e.index-t.index}function N(e){return"\\"+g[e]}function C(e,t,n){t||(t=0),typeof n=="undefined"&&(n=e?e.length:0);var r=-1,i=n-t||0,s=Array(i<0?0:i);while(++r<i)s[r]=e[t+r];return s}function X(e){return e instanceof X?e:new V(e)}function V(e,t){this.__chain__=!!t,this.__wrapped__=e}function J(e){function i(){if(n){var e=C(n);H.apply(e,arguments)}if(this instanceof i){var s=K(t.prototype),o=t.apply(s,e||arguments);return _t(o)?o:s}return t.apply(r,e||arguments)}var t=e[0],n=e[2],r=e[4];return i}function K(e,t){return _t(e)?j(e):{}}function Q(e,t,n){if(typeof e!="function")return Vn;if(typeof t!="undefined"&&"prototype"in e){switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return Dn(e,t)}return e}function G(e){function h(){var e=u?s:this;if(r){var p=C(r);H.apply(p,arguments)}if(i||f){p||(p=C(arguments)),i&&H.apply(p,i);if(f&&p.length<o)return n|=16,G([t,l?n:n&-4,p,null,s,o])}p||(p=arguments),a&&(t=e[c]);if(this instanceof h){e=K(t.prototype);var d=t.apply(e,p);return _t(d)?d:e}return t.apply(e,p)}var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=n&1,a=n&2,f=n&4,l=n&8,c=t;return h}function Y(e,t){var n=-1,r=ot(),i=e?e.length:0,s=[];while(++n<i){var o=e[n];r(t,o)<0&&s.push(o)}return s}function Z(e,t,n,r){var i=(r||0)-1,s=e?e.length:0,o=[];while(++i<s){var u=e[i];if(u&&typeof u=="object"&&typeof u.length=="number"&&(lt(u)||ft(u))){t||(u=Z(u,t,n));var a=-1,f=u.length,l=o.length;o.length+=f;while(++a<f)o[l++]=u[a]}else n||o.push(u)}return o}function et(e,t,r,i){if(e===t)return e!==0||1/e==1/t;var s=typeof e,o=typeof t;if(e===e&&(!e||!m[s])&&(!t||!m[o]))return!1;if(e==null||t==null)return e===t;var u=O.call(e),c=O.call(t);if(u!=c)return!1;switch(u){case f:case l:return+e==+t;case h:return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case d:case v:return e==String(t)}var g=u==a;if(!g){var y=e instanceof X,b=t instanceof X;if(y||b)return et(y?e.__wrapped__:e,b?t.__wrapped__:t,r,i);if(u!=p)return!1;var w=e.constructor,E=t.constructor;if(w!=E&&!(Mt(w)&&w instanceof w&&Mt(E)&&E instanceof E)&&"constructor"in e&&"constructor"in t)return!1}r||(r=[]),i||(i=[]);var S=r.length;while(S--)if(r[S]==e)return i[S]==t;var x=!0,T=0;r.push(e),i.push(t);if(g){T=t.length,x=T==e.length;if(x)while(T--)if(!(x=et(e[T],t[T],r,i)))break}else wt(t,function(t,s,o){if(P.call(o,s))return T++,!(x=P.call(e,s)&&et(e[s],t,r,i))&&n}),x&&wt(e,function(e,t,r){if(P.call(r,t))return!(x=--T>-1)&&n});return r.pop(),i.pop(),x}function tt(e,t){return e+D(W()*(t-e+1))}function nt(e,t,n){var r=-1,i=ot(),s=e?e.length:0,o=[],u=n?[]:o;while(++r<s){var a=e[r],f=n?n(a,r,e):a;if(t?!r||u[u.length-1]!==f:i(u,f)<0)n&&u.push(f),o.push(a)}return o}function rt(e){return function(t,n,r){var i={};n=Wn(n,r,3);var s=-1,o=t?t.length:0;if(typeof o=="number")while(++s<o){var u=t[s];e(i,u,n(u,s,t),t)}else Et(t,function(t,r,s){e(i,t,n(t,r,s),s)});return i}}function it(e,t,n,r,i,s){var o=t&1,u=t&2,a=t&4,f=t&8,l=t&16,c=t&32;if(!u&&!Mt(e))throw new TypeError;l&&!n.length&&(t&=-17,l=n=!1),c&&!r.length&&(t&=-33,c=r=!1);var h=t==1||t===17?J:G;return h([e,t,n,r,i,s])}function st(e){return pt[e]}function ot(){var e=(e=X.indexOf)===bn?x:e;return e}function ut(e){return typeof e=="function"&&M.test(e)}function at(e){return dt[e]}function ft(e){return e&&typeof e=="object"&&typeof e.length=="number"&&O.call(e)==u||!1}function gt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)e[i]=r[i]}return e}function yt(e){return _t(e)?lt(e)?C(e):gt({},e):e}function bt(e){if(!e)return e;for(var t=1,n=arguments.length;t<n;t++){var r=arguments[t];if(r)for(var i in r)typeof e[i]=="undefined"&&(e[i]=r[i])}return e}function St(e){var t=[];return wt(e,function(e,n){Mt(e)&&t.push(n)}),t.sort()}function xt(e,t){return e?P.call(e,t):!1}function Tt(e){var t=-1,n=ht(e),r=n.length,i={};while(++t<r){var s=n[t];i[e[s]]=s}return i}function Nt(e){return e===!0||e===!1||e&&typeof e=="object"&&O.call(e)==f||!1}function Ct(e){return e&&typeof e=="object"&&O.call(e)==l||!1}function kt(e){return e&&e.nodeType===1||!1}function Lt(e){if(!e)return!0;if(lt(e)||jt(e))return!e.length;for(var t in e)if(P.call(e,t))return!1;return!0}function At(e,t){return et(e,t)}function Ot(e){return I(e)&&!q(parseFloat(e))}function Mt(e){return typeof e=="function"}function _t(e){return!!e&&!!m[typeof e]}function Dt(e){return Ht(e)&&e!=+e}function Pt(e){return e===null}function Ht(e){return typeof e=="number"||e&&typeof e=="object"&&O.call(e)==h||!1}function Bt(e){return e&&m[typeof e]&&O.call(e)==d||!1}function jt(e){return typeof e=="string"||e&&typeof e=="object"&&O.call(e)==v||!1}function Ft(e){return typeof e=="undefined"}function It(e){var t=[];wt(e,function(e,n){t.push(n)}),t=Y(t,Z(arguments,!0,!1,1));var n=-1,r=t.length,i={};while(++n<r){var s=t[n];i[s]=e[s]}return i}function qt(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r){var s=n[t];i[t]=[s,e[s]]}return i}function Rt(e){var t=-1,n=Z(arguments,!0,!1,1),r=n.length,i={};while(++t<r){var s=n[t];s in e&&(i[s]=e[s])}return i}function Ut(e){var t=-1,n=ht(e),r=n.length,i=Array(r);while(++t<r)i[t]=e[n[t]];return i}function zt(e,t){var r=ot(),i=e?e.length:0,s=!1;return i&&typeof i=="number"?s=r(e,t)>-1:Et(e,function(e){return(s=e===t)&&n}),s}function Xt(e,t,r){var i=!0;t=Wn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(!(i=!!t(e[s],s,e)))break}else Et(e,function(e,r,s){return!(i=!!t(e,r,s))&&n});return i}function Vt(e,t,n){var r=[];t=Wn(t,n,3);var i=-1,s=e?e.length:0;if(typeof s=="number")while(++i<s){var o=e[i];t(o,i,e)&&r.push(o)}else Et(e,function(e,n,i){t(e,n,i)&&r.push(e)});return r}function $t(e,t,r){t=Wn(t,r,3);var i=-1,s=e?e.length:0;if(typeof s!="number"){var u;return Et(e,function(e,r,i){if(t(e,r,i))return u=e,n}),u}while(++i<s){var o=e[i];if(t(o,i,e))return o}}function Jt(e,t){return dn(e,t,!0)}function Kt(e,t,r){var i=-1,s=e?e.length:0;t=t&&typeof r=="undefined"?t:Q(t,r,3);if(typeof s=="number"){while(++i<s)if(t(e[i],i,e)===n)break}else Et(e,t)}function Qt(e,t){var r=e?e.length:0;if(typeof r=="number"){while(r--)if(t(e[r],r,e)===!1)break}else{var i=ht(e);r=i.length,Et(e,function(e,s,o){return s=i?i[--r]:--r,t(o[s],s,o)===!1&&n})}}function Zt(e,t){var n=C(arguments,2),r=-1,i=typeof t=="function",s=e?e.length:0,o=Array(typeof s=="number"?s:0);return Kt(e,function(e){o[++r]=(i?t:e[t]).apply(e,n)}),o}function en(e,t,n){var r=-1,i=e?e.length:0;t=Wn(t,n,3);if(typeof i=="number"){var s=Array(i);while(++r<i)s[r]=t(e[r],r,e)}else s=[],Et(e,function(e,n,i){s[++r]=t(e,n,i)});return s}function tn(e,t,n){var r=-Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number")while(++s<o){var u=e[s];u>i&&(i=u)}else t=Wn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o>r&&(r=o,i=e)});return i}function nn(e,t,n){var r=Infinity,i=r;typeof t!="function"&&n&&n[t]===e&&(t=null);var s=-1,o=e?e.length:0;if(t==null&&typeof o=="number")while(++s<o){var u=e[s];u<i&&(i=u)}else t=Wn(t,n,3),Kt(e,function(e,n,s){var o=t(e,n,s);o<r&&(r=o,i=e)});return i}function sn(e,t,n,r){if(!e)return n;var i=arguments.length<3;t=Wn(t,r,4);var s=-1,o=e.length;if(typeof o=="number"){i&&(n=e[++s]);while(++s<o)n=t(n,e[s],s,e)}else Et(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)});return n}function on(e,t,n,r){var i=arguments.length<3;return t=Wn(t,r,4),Qt(e,function(e,r,s){n=i?(i=!1,e):t(n,e,r,s)}),n}function un(e,t,n){return t=Wn(t,n,3),Vt(e,function(e,n,r){return!t(e,n,r)})}function an(t,n,r){t&&typeof t.length!="number"&&(t=Ut(t));if(n==null||r)return t?t[tt(0,t.length-1)]:e;var i=fn(t);return i.length=z(U(0,n),i.length),i}function fn(e){var t=-1,n=e?e.length:0,r=Array(typeof n=="number"?n:0);return Kt(e,function(e){var n=tt(0,++t);r[t]=r[n],r[n]=e}),r}function ln(e){var t=e?e.length:0;return typeof t=="number"?t:ht(e).length}function cn(e,t,r){var i;t=Wn(t,r,3);var s=-1,o=e?e.length:0;if(typeof o=="number"){while(++s<o)if(i=t(e[s],s,e))break}else Et(e,function(e,r,s){return(i=t(e,r,s))&&n});return!!i}function hn(e,t,n){var r=-1,i=e?e.length:0,s=Array(typeof i=="number"?i:0);t=Wn(t,n,3),Kt(e,function(e,n,i){s[++r]={criteria:[t(e,n,i)],index:r,value:e}}),i=s.length,s.sort(T);while(i--)s[i]=s[i].value;return s}function pn(e){return lt(e)?C(e):e&&typeof e.length=="number"?en(e):Ut(e)}function dn(t,n,r){return r&&Lt(n)?e:(r?$t:Vt)(t,n)}function vn(e){var t=-1,n=e?e.length:0,r=[];while(++t<n){var i=e[t];i&&r.push(i)}return r}function mn(e){return Y(e,Z(arguments,!0,!0,1))}function gn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=-1;n=Wn(n,r,3);while(++o<s&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[0]:e}return C(t,0,z(U(0,i),s))}function yn(e,t){return Z(e,t)}function bn(e,t,n){if(typeof n=="number"){var r=e?e.length:0;n=n<0?U(0,r+n):n||0}else if(n){var i=Cn(e,t);return e[i]===t?i:-1}return x(e,t,n)}function wn(e,t,n){var r=0,i=e?e.length:0;if(typeof t!="number"&&t!=null){var s=i;t=Wn(t,n,3);while(s--&&t(e[s],s,e))r++}else r=t==null||n?1:t||r;return C(e,0,z(U(0,i-r),i))}function En(){var e=[],t=-1,n=arguments.length;while(++t<n){var r=arguments[t];(lt(r)||ft(r))&&e.push(r)}var i=e[0],s=-1,o=ot(),u=i?i.length:0,a=[];e:while(++s<u){r=i[s];if(o(a,r)<0){var t=n;while(--t)if(o(e[t],r)<0)continue e;a.push(r)}}return a}function Sn(t,n,r){var i=0,s=t?t.length:0;if(typeof n!="number"&&n!=null){var o=s;n=Wn(n,r,3);while(o--&&n(t[o],o,t))i++}else{i=n;if(i==null||r)return t?t[s-1]:e}return C(t,U(0,s-i))}function xn(e,t,n){var r=e?e.length:0;typeof n=="number"&&(r=(n<0?U(0,r+n):z(n,r-1))+1);while(r--)if(e[r]===t)return r;return-1}function Tn(e,t,n){e=+e||0,n=+n||1,t==null&&(t=e,e=0);var r=-1,i=U(0,_((t-e)/n)),s=Array(i);while(++r<i)s[r]=e,e+=n;return s}function Nn(e,t,n){if(typeof t!="number"&&t!=null){var r=0,i=-1,s=e?e.length:0;t=Wn(t,n,3);while(++i<s&&t(e[i],i,e))r++}else r=t==null||n?1:U(0,t);return C(e,r)}function Cn(e,t,n,r){var i=0,s=e?e.length:i;n=n?Wn(n,r,1):Vn,t=n(t);while(i<s){var o=i+s>>>1;n(e[o])<t?i=o+1:s=o}return i}function kn(){return nt(Z(arguments,!0,!0))}function Ln(e,t,n,r){return typeof t!="boolean"&&t!=null&&(r=n,n=typeof t!="function"&&r&&r[t]===e?null:t,t=!1),n!=null&&(n=Wn(n,r,3)),nt(e,t,n)}function An(e){return Y(e,C(arguments,1))}function On(){var e=-1,t=tn(rn(arguments,"length")),n=Array(t<0?0:t);while(++e<t)n[e]=rn(arguments,e);return n}function Mn(e,t){var n=-1,r=e?e.length:0,i={};!t&&r&&!lt(e[0])&&(t=[]);while(++n<r){var s=e[n];t?i[s]=t[n]:s&&(i[s[0]]=s[1])}return i}function _n(e,t){if(!Mt(t))throw new TypeError;return function(){if(--e<1)return t.apply(this,arguments)}}function Dn(e,t){return arguments.length>2?it(e,17,C(arguments,2),null,t):it(e,1,null,null,t)}function Pn(e){var t=arguments.length>1?Z(arguments,!0,!1,1):St(e),n=-1,r=t.length;while(++n<r){var i=t[n];e[i]=it(e[i],1,null,null,e)}return e}function Hn(){var e=arguments,t=e.length;while(t--)if(!Mt(e[t]))throw new TypeError;return function(){var t=arguments,n=e.length;while(n--)t=[e[n].apply(this,t)];return t[0]}}function Bn(t,n,r){var i,s,o,u,a,f,l,c=0,h=!1,p=!0;if(!Mt(t))throw new TypeError;n=U(0,n)||0;if(r===!0){var d=!0;p=!1}else _t(r)&&(d=r.leading,h="maxWait"in r&&(U(n,r.maxWait)||0),p="trailing"in r?r.trailing:p);var v=function(){var r=n-(Qn()-u);if(r<=0){s&&clearTimeout(s);var h=l;s=f=l=e,h&&(c=Qn(),o=t.apply(a,i),!f&&!s&&(i=a=null))}else f=setTimeout(v,r)},m=function(){f&&clearTimeout(f),s=f=l=e;if(p||h!==n)c=Qn(),o=t.apply(a,i),!f&&!s&&(i=a=null)};return function(){i=arguments,u=Qn(),a=this,l=p&&(f||!d);if(h===!1)var e=d&&!f;else{!s&&!d&&(c=u);var r=h-(u-c),g=r<=0;g?(s&&(s=clearTimeout(s)),c=u,o=t.apply(a,i)):s||(s=setTimeout(m,r))}return g&&f?f=clearTimeout(f):!f&&n!==h&&(f=setTimeout(v,n)),e&&(g=!0,o=t.apply(a,i)),g&&!f&&!s&&(i=a=null),o}}function jn(t){if(!Mt(t))throw new TypeError;var n=C(arguments,1);return setTimeout(function(){t.apply(e,n)},1)}function Fn(t,n){if(!Mt(t))throw new TypeError;var r=C(arguments,2);return setTimeout(function(){t.apply(e,r)},n)}function In(e,t){var n={};return function(){var i=t?t.apply(this,arguments):r+arguments[0];return P.call(n,i)?n[i]:n[i]=e.apply(this,arguments)}}function qn(e){var t,n;if(!Mt(e))throw new TypeError;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Rn(e){return it(e,16,C(arguments,1))}function Un(e,t,n){var r=!0,i=!0;if(!Mt(e))throw new TypeError;return n===!1?r=!1:_t(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),n={},n.leading=r,n.maxWait=t,n.trailing=i,Bn(e,t,n)}function zn(e,t){return it(t,16,[e])}function Wn(e,t,n){var r=typeof e;if(e==null||r=="function")return Q(e,t,n);if(r!="object")return Gn(e);var i=ht(e);return function(t){var n=i.length,r=!1;while(n--)if(!(r=t[i[n]]===e[i[n]]))break;return r}}function Xn(e){return e==null?"":String(e).replace(mt,st)}function Vn(e){return e}function $n(e){Kt(St(e),function(t){var n=X[t]=e[t];X.prototype[t]=function(){var e=[this.__wrapped__];H.apply(e,arguments);var t=n.apply(X,e);return this.__chain__?new V(t,!0):t}})}function Jn(){return y._=A,this}function Kn(){}function Gn(e){return function(t){return t[e]}}function Yn(e,t){return e==null&&t==null&&(t=1),e=+e||0,t==null?(t=e,e=0):t=+t||0,e+D(W()*(t-e+1))}function Zn(e,t){if(e){var n=e[t];return Mt(n)?e[t]():n}}function er(e,t,n){var r=X,i=r.templateSettings;e=String(e||""),n=bt({},n,i);var u=0,a="__p += '",f=n.variable,l=RegExp((n.escape||s).source+"|"+(n.interpolate||s).source+"|"+(n.evaluate||s).source+"|$","g");e.replace(l,function(t,n,r,i,s){return a+=e.slice(u,s).replace(o,N),n&&(a+="' +\n_.escape("+n+") +\n'"),i&&(a+="';\n"+i+";\n__p += '"),r&&(a+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),u=s+t.length,t}),a+="';\n",f||(f="obj",a="with ("+f+" || {}) {\n"+a+"\n}\n"),a="function("+f+") {\n"+"var __t, __p = '', __j = Array.prototype.join;\n"+"function print() { __p += __j.call(arguments, '') }\n"+a+"return __p\n}";try{var c=Function("_","return "+a)(r)}catch(h){throw h.source=a,h}return t?c(t):(c.source=a,c)}function tr(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=Array(e);t=Q(t,n,1);while(++r<e)i[r]=t(r);return i}function nr(e){return e==null?"":String(e).replace(vt,at)}function rr(e){var n=++t+"";return e?e+n:n}function ir(e){return e=new V(e),e.__chain__=!0,e}function sr(e,t){return t(e),e}function or(){return this.__chain__=!0,this}function ur(){return this.__wrapped__}var e,t=0,n={},r=+(new Date)+"",i=/<%=([\s\S]+?)%>/g,s=/($^)/,o=/['\n\r\t\u2028\u2029\\]/g,u="[object Arguments]",a="[object Array]",f="[object Boolean]",l="[object Date]",c="[object Function]",h="[object Number]",p="[object Object]",d="[object RegExp]",v="[object String]",m={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},g={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},y=m[typeof window]&&window||this,b=m[typeof exports]&&exports&&!exports.nodeType&&exports,w=m[typeof module]&&module&&!module.nodeType&&module,E=w&&w.exports===b&&b,S=m[typeof global]&&global;S&&(S.global===S||S.window===S)&&(y=S);var k=[],L=Object.prototype,A=y._,O=L.toString,M=RegExp("^"+String(O).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),_=Math.ceil,D=Math.floor,P=L.hasOwnProperty,H=k.push,B=L.propertyIsEnumerable,j=ut(j=Object.create)&&j,F=ut(F=Array.isArray)&&F,I=y.isFinite,q=y.isNaN,R=ut(R=Object.keys)&&R,U=Math.max,z=Math.min,W=Math.random;V.prototype=X.prototype;var $={};(function(){var e={0:1,length:1};$.spliceObjects=(k.splice.call(e,0,1),!e[0])})(1),X.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:i,variable:""},j||(K=function(){function e(){}return function(t){if(_t(t)){e.prototype=t;var n=new e;e.prototype=null}return n||y.Object()}}()),ft(arguments)||(ft=function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&P.call(e,"callee")&&!B.call(e,"callee")||!1});var lt=F||function(e){return e&&typeof e=="object"&&typeof e.length=="number"&&O.call(e)==a||!1},ct=function(e){var t,n=e,r=[];if(!n)return r;if(!m[typeof e])return r;for(t in n)P.call(n,t)&&r.push(t);return r},ht=R?function(e){return _t(e)?R(e):[]}:ct,pt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},dt=Tt(pt),vt=RegExp("("+ht(dt).join("|")+")","g"),mt=RegExp("["+ht(pt).join("")+"]","g"),wt=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(t(i[r],r,e)===n)return s;return s},Et=function(e,t){var r,i=e,s=i;if(!i)return s;if(!m[typeof i])return s;for(r in i)if(P.call(i,r)&&t(i[r],r,e)===n)return s;return s};Mt(/x/)&&(Mt=function(e){return typeof e=="function"&&O.call(e)==c});var Wt=rt(function(e,t,n){P.call(e,n)?e[n]++:e[n]=1}),Gt=rt(function(e,t,n){(P.call(e,n)?e[n]:e[n]=[]).push(t)}),Yt=rt(function(e,t,n){e[n]=t}),rn=en,Qn=ut(Qn=Date.now)&&Qn||function(){return(new Date).getTime()};X.after=_n,X.bind=Dn,X.bindAll=Pn,X.chain=ir,X.compact=vn,X.compose=Hn,X.countBy=Wt,X.debounce=Bn,X.defaults=bt,X.defer=jn,X.delay=Fn,X.difference=mn,X.filter=Vt,X.flatten=yn,X.forEach=Kt,X.functions=St,X.groupBy=Gt,X.indexBy=Yt,X.initial=wn,X.intersection=En,X.invert=Tt,X.invoke=Zt,X.keys=ht,X.map=en,X.max=tn,X.memoize=In,X.min=nn,X.omit=It,X.once=qn,X.pairs=qt,X.partial=Rn,X.pick=Rt,X.pluck=rn,X.range=Tn,X.reject=un,X.rest=Nn,X.shuffle=fn,X.sortBy=hn,X.tap=sr,X.throttle=Un,X.times=tr,X.toArray=pn,X.union=kn,X.uniq=Ln,X.values=Ut,X.where=dn,X.without=An,X.wrap=zn,X.zip=On,X.collect=en,X.drop=Nn,X.each=Kt,X.extend=gt,X.methods=St,X.object=Mn,X.select=Vt,X.tail=Nn,X.unique=Ln,X.clone=yt,X.contains=zt,X.escape=Xn,X.every=Xt,X.find=$t,X.has=xt,X.identity=Vn,X.indexOf=bn,X.isArguments=ft,X.isArray=lt,X.isBoolean=Nt,X.isDate=Ct,X.isElement=kt,X.isEmpty=Lt,X.isEqual=At,X.isFinite=Ot,X.isFunction=Mt,X.isNaN=Dt,X.isNull=Pt,X.isNumber=Ht,X.isObject=_t,X.isRegExp=Bt,X.isString=jt,X.isUndefined=Ft,X.lastIndexOf=xn,X.mixin=$n,X.noConflict=Jn,X.random=Yn,X.reduce=sn,X.reduceRight=on,X.result=Zn,X.size=ln,X.some=cn,X.sortedIndex=Cn,X.template=er,X.unescape=nr,X.uniqueId=rr,X.all=Xt,X.any=cn,X.detect=$t,X.findWhere=Jt,X.foldl=sn,X.foldr=on,X.include=zt,X.inject=sn,X.first=gn,X.last=Sn,X.sample=an,X.take=gn,X.head=gn,$n(X),X.VERSION="2.4.1",X.prototype.chain=or,X.prototype.value=ur,Kt(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=k[e];X.prototype[e]=function(){var e=this.__wrapped__;return t.apply(e,arguments),!$.spliceObjects&&e.length===0&&delete e[0],this}}),Kt(["concat","join","slice"],function(e){var t=k[e];X.prototype[e]=function(){var e=this.__wrapped__,n=t.apply(e,arguments);return this.__chain__&&(n=new V(n),n.__chain__=!0),n}}),typeof define=="function"&&typeof define.amd=="object"&&define.amd?(y._=X,define("underscore",[],function(){return X})):b&&w?E?(w.exports=X)._=X:b._=X:y._=X}.call(this),define("modules/jquery_plugin",["jquery"],function(e){e.fn.htmlWithEvent=function(t,n){return this.each(function(){e(this).html(t)}),e(document).trigger(n),this},e.fn.disabledOverlay=function(t){function r(t){var n=e('<div class="disabled-overlay" />');t.find(".disabled-overlay").length==0&&t.prepend(n)}t=t||{};var n=t.remove||!1;this.each(function(){n?e(this).find(".disabled-overlay").remove():r(e(this))})},e.fn.csrfToken=function(){var t=e("meta[name='csrf-token']").attr("content"),n=e("meta[name='access-token']").attr("content");return this.each(function(){e(this).append('<input type="hidden" name="authenticity_token" value="'+t+'">'),e(this).append('<input type="hidden" name="access_token" value="'+n+'">')})},e.fn.observeField=function(t,n){return this.each(function(){var r=e(this),i=r.val(),s=function(){var e=r.val();i!=e&&(i=e,r.map(n))};s(),t*=100;var o=setInterval(s,t);r.on("keyup",function(){o&&clearInterval(o),o=setInterval(s,t)})})},e.fn.ellipsis=function(){return this.each(function(){var t=e(this);if(t.css("overflow")==="hidden"){var n=t.html(),r=t.hasClass("multiline"),i=e(this.cloneNode(!0)).hide().css("position","absolute").css("overflow","visible").width(r?t.width():"auto").height(r?"auto":t.height());t.after(i);function s(){return i.height()>t.height()}function o(){return i.width()>t.width()}var u=r?s:o;while(n.length>0&&u())n=n.substr(0,n.length-1),i.html(n+"...");t.html(i.html()),t.attr("title")&&t.qtip({content:{attr:"title"},position:{my:"bottom left",at:"top left",adjust:{x:15}},style:{classes:"ui-tooltip-tipsy qtip-shadow",tip:{corner:!0,mimic:"bottom center",offset:15}}}),i.remove()}})},e.cookie=function(t,n,r){if(typeof n=="undefined"){var f=null;if(document.cookie&&document.cookie!=""){var l=document.cookie.split(";");for(var c=0;c<l.length;c++){var h=e.trim(l[c]);if(h.substring(0,t.length+1)==t+"="){f=decodeURIComponent(h.substring(t.length+1));break}}}return f}r=r||{},n===null&&(n="",r.expires=-1);var i="";if(r.expires&&(typeof r.expires=="number"||r.expires.toUTCString)){var s;typeof r.expires=="number"?(s=new Date,s.setTime(s.getTime()+r.expires*24*60*60*1e3)):s=r.expires,i="; expires="+s.toUTCString()}var o=r.path?"; path="+r.path:"",u=r.domain?"; domain="+r.domain:"",a=r.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(n),i,o,u,a].join("")},e.fn.TextAreaExpander=function(t,n){function i(e){e=e.target||e;var t=e.value.length,n=e.offsetWidth;if(t!=e.valLength||n!=e.boxWidth){r&&(t<e.valLength||n!=e.boxWidth)&&(e.style.height="0px");var i=Math.max(e.expandMin,Math.min(e.scrollHeight,e.expandMax));e.style.overflow=e.scrollHeight>i?"auto":"hidden",e.style.height=i+"px",e.valLength=t,e.boxWidth=n}return!0}var r=!e.browser.msie&&!e.browser.opera;return this.each(function(){if(this.nodeName.toLowerCase()!="textarea")return;var r=this.className.match(/expand(\d+)\-*(\d+)*/i);this.expandMin=t||(r?parseInt("0"+r[1],10):0),this.expandMax=n||(r?parseInt("0"+r[2],10):99999),i(this),this.Initialized||(this.Initialized=!0,e(this).bind("keyup",i).bind("focus",i))}),this},e.simplePlaceholder={placeholderClass:null,hidePlaceholder:function(){var t=e(this);t.val()==t.attr("placeholder")&&t.val("").removeClass(e.simplePlaceholder.placeholderClass)},showPlaceholder:function(){var t=e(this);t.val()==""&&t.val(t.attr("placeholder")).addClass(e.simplePlaceholder.placeholderClass).blur()},preventPlaceholderSubmit:function(){return e(this).find(".simple-placeholder").each(function(t){var n=e(this);n.val()==n.attr("placeholder")&&n.val("")}),!0}},e.fn.simplePlaceholder=function(t){if(window.Modernizr&&Modernizr.input.placeholder===!1){var n={placeholderClass:"placeholder"};t&&e.extend(n,t),e.simplePlaceholder.placeholderClass=n.placeholderClass,this.each(function(){var t=e(this);t.focus(e.simplePlaceholder.hidePlaceholder),t.blur(e.simplePlaceholder.showPlaceholder),t.val()==""&&(t.val(t.attr("placeholder")),t.addClass(e.simplePlaceholder.placeholderClass)),t.addClass("simple-placeholder"),e(this.form).submit(e.simplePlaceholder.preventPlaceholderSubmit)})}return this},e.fn.textfill=function(t){var n={maxFontPixels:40,innerTag:"span"},r=e.extend(n,t);return this.each(function(){var t=r.maxFontPixels,n=e(r.innerTag+":visible:first",this),i=e(this).height(),s=e(this).width(),o,u;do n.css("font-size",t),o=n.height(),u=n.width(),t-=1;while((o>i||u>s)&&t>3)})};var t=function(e){return parseInt(e,10)||0};e.each(["min","max"],function(n,r){e.fn[r+"Size"]=function(e){var n,i;return e?(e.width!==undefined&&this.css(r+"-width",e.width),e.height!==undefined&&this.css(r+"-height",e.height),this):(n=this.css(r+"-width"),i=this.css(r+"-height"),{width:r==="max"&&(n===undefined||n==="none"||t(n)===-1)&&Number.MAX_VALUE||t(n),height:r==="max"&&(i===undefined||i==="none"||t(i)===-1)&&Number.MAX_VALUE||t(i)})}}),e.fn.isVisible=function(){return this.is(":visible")},e.each(["border","margin","padding"],function(n,r){e.fn[r]=function(e){return e?(e.top!==undefined&&this.css(r+"-top"+(r==="border"?"-width":""),e.top),e.bottom!==undefined&&this.css(r+"-bottom"+(r==="border"?"-width":""),e.bottom),e.left!==undefined&&this.css(r+"-left"+(r==="border"?"-width":""),e.left),e.right!==undefined&&this.css(r+"-right"+(r==="border"?"-width":""),e.right),this):{top:t(this.css(r+"-top"+(r==="border"?"-width":""))),bottom:t(this.css(r+"-bottom"+(r==="border"?"-width":""))),left:t(this.css(r+"-left"+(r==="border"?"-width":""))),right:t(this.css(r+"-right"+(r==="border"?"-width":"")))}}}),function(e){e.idleTimer=function(t,n,r){r=e.extend({startImmediately:!0,idle:!1,enabled:!0,timeout:3e4,events:"mousemove keydown DOMMouseScroll mousewheel mousedown touchstart touchmove"},r),n=n||document;var i=function(t){typeof t=="number"&&(t=undefined);var s=e.data(t||n,"idleTimerObj");s.idle=!s.idle;var o=+(new Date)-s.olddate;s.olddate=+(new Date);if(s.idle&&o<r.timeout){s.idle=!1,clearTimeout(e.idleTimer.tId),r.enabled&&(e.idleTimer.tId=setTimeout(i,r.timeout));return}var u=jQuery.Event(e.data(n,"idleTimer",s.idle?"idle":"active")+".idleTimer");e(n).trigger(u)},s=function(t){var n=e.data(t,"idleTimerObj")||{};n.enabled=!1,clearTimeout(n.tId),e(t).off(".idleTimer")},o=function(){var t=e.data(this,"idleTimerObj");clearTimeout(t.tId),t.enabled&&(t.idle&&i(this),t.tId=setTimeout(i,t.timeout))},u=e.data(n,"idleTimerObj")||{};u.olddate=u.olddate||+(new Date);if(typeof t=="number")r.timeout=t;else{if(t==="destroy")return s(n),this;if(t==="getElapsedTime")return+(new Date)-u.olddate}e(n).on(e.trim((r.events+" ").split(" ").join(".idleTimer ")),o),u.idle=r.idle,u.enabled=r.enabled,u.timeout=r.timeout,r.startImmediately&&(u.tId=setTimeout(i,u.timeout)),e.data(n,"idleTimer","active"),e.data(n,"idleTimerObj",u)},e.fn.idleTimer=function(t,n){return n||(n={}),this[0]&&e.idleTimer(t,this[0],n),this}}(e);var n={version:"1.0.7",clients:{},moviePath:"ZeroClipboard.swf",nextId:1,$:function(e){return typeof e=="string"&&(e=document.getElementById(e)),e.addClass||(e.hide=function(){this.style.display="none"},e.show=function(){this.style.display=""},e.addClass=function(e){this.removeClass(e),this.className+=" "+e},e.removeClass=function(e){var t=this.className.split(/\s+/),n=-1;for(var r=0;r<t.length;r++)t[r]==e&&(n=r,r=t.length);return n>-1&&(t.splice(n,1),this.className=t.join(" ")),this},e.hasClass=function(e){return!!this.className.match(new RegExp("\\s*"+e+"\\s*"))}),e},setMoviePath:function(e){this.moviePath=e},dispatch:function(e,t,n){var r=this.clients[e];r&&r.receiveEvent(t,n)},register:function(e,t){this.clients[e]=t},getDOMObjectPosition:function(e,t){var n={left:0,top:0,width:e.width?e.width:e.offsetWidth,height:e.height?e.height:e.offsetHeight};return e&&e!=t&&(n.left+=e.offsetLeft,n.top+=e.offsetTop),n},Client:function(e){this.handlers={},this.id=n.nextId++,this.movieId="ZeroClipboardMovie_"+this.id,n.register(this.id,this),e&&this.glue(e)}};n.Client.prototype={id:0,ready:!1,movie:null,clipText:"",handCursorEnabled:!0,cssEffects:!0,handlers:null,glue:function(t,r,i){this.domElement=n.$(t);var s=99;this.domElement.style.zIndex&&(s=parseInt(this.domElement.style.zIndex,10)+1),typeof r=="string"?r=n.$(r):typeof r=="undefined"&&(r=document.getElementsByTagName("body")[0]);var o=n.getDOMObjectPosition(this.domElement,r);this.div=document.createElement("div"),this.div.className="zclip",this.div.id="zclip-"+this.movieId,e(this.domElement).data("zclipId","zclip-"+this.movieId);var u=this.div.style;u.position="absolute",u.left=""+o.left+"px",u.top=""+o.top+"px",u.width=""+o.width+"px",u.height=""+o.height+"px",u.zIndex=s;if(typeof i=="object")for(addedStyle in i)u[addedStyle]=i[addedStyle];r.appendChild(this.div),this.div.innerHTML=this.getHTML(o.width,o.height)},getHTML:function(e,t){var r="",i="id="+this.id+"&width="+e+"&height="+t;if(navigator.userAgent.match(/MSIE/)){var s=location.href.match(/^https/i)?"https://":"http://";r+='<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="'+s+'download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+e+'" height="'+t+'" id="'+this.movieId+'" align="middle"><param name="allowScriptAccess" value="sameDomain" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+n.moviePath+'" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="best" /><param name="bgcolor" value="#ffffff" /><param name="flashvars" value="'+i+'"/><param name="wmode" value="transparent"/></object>'}else r+='<embed id="'+this.movieId+'" src="'+n.moviePath+'" loop="false" menu="false" quality="best" bgcolor="#ffffff" width="'+e+'" height="'+t+'" name="'+this.movieId+'" align="middle" allowScriptAccess="sameDomain" allowFullScreen="false" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" wmode="transparent" />';return r},hide:function(){this.div&&(this.div.style.left="-2000px")},show:function(){this.reposition()},destroy:function(){if(this.domElement&&this.div){this.hide(),this.div.innerHTML="";var e=document.getElementsByTagName("body")[0];try{e.removeChild(this.div)}catch(t){}this.domElement=null,this.div=null}},reposition:function(e){e&&(this.domElement=n.$(e),this.domElement||this.hide());if(this.domElement&&this.div){var t=n.getDOMObjectPosition(this.domElement),r=this.div.style;r.left=""+t.left+"px",r.top=""+t.top+"px"}},setText:function(e){this.clipText=e,this.ready&&this.movie.setText(e)},addEventListener:function(e,t){e=e.toString().toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=[]),this.handlers[e].push(t)},setHandCursor:function(e){this.handCursorEnabled=e,this.ready&&this.movie.setHandCursor(e)},setCSSEffects:function(e){this.cssEffects=!!e},receiveEvent:function(e,t){e=e.toString().toLowerCase().replace(/^on/,"");switch(e){case"load":this.movie=document.getElementById(this.movieId);if(!this.movie){var n=this;setTimeout(function(){n.receiveEvent("load",null)},1);return}if(!this.ready&&navigator.userAgent.match(/Firefox/)&&navigator.userAgent.match(/Windows/)){var n=this;setTimeout(function(){n.receiveEvent("load",null)},100),this.ready=!0;return}this.ready=!0;try{this.movie.setText(this.clipText)}catch(r){}try{this.movie.setHandCursor(this.handCursorEnabled)}catch(r){}break;case"mouseover":this.domElement&&this.cssEffects&&(this.domElement.addClass("hover"),this.recoverActive&&this.domElement.addClass("active"));break;case"mouseout":this.domElement&&this.cssEffects&&(this.recoverActive=!1,this.domElement.hasClass("active")&&(this.domElement.removeClass("active"),this.recoverActive=!0),this.domElement.removeClass("hover"));break;case"mousedown":this.domElement&&this.cssEffects&&this.domElement.addClass("active");break;case"mouseup":this.domElement&&this.cssEffects&&(this.domElement.removeClass("active"),this.recoverActive=!1)}if(this.handlers[e])for(var i=0,s=this.handlers[e].length;i<s;i++){var o=this.handlers[e][i];typeof o=="function"?o(this,t):typeof o=="object"&&o.length==2?o[0][o[1]](this,t):typeof o=="string"&&window[o](this,t)}}},window.ZeroClipboard=n,function(e){e.fn.zclip=function(t){if(typeof t=="object"&&!t.length){var r=e.extend({path:"ZeroClipboard.swf",copy:null,beforeCopy:null,afterCopy:null,clickAfter:!0,setHandCursor:!0,setCSSEffects:!0},t);return this.each(function(){var t=e(this);if(t.is(":visible")&&(typeof r.copy=="string"||e.isFunction(r.copy))){n.setMoviePath(r.path);var i=new n.Client;e.isFunction(r.copy)&&t.bind("zClip_copy",r.copy),e.isFunction(r.beforeCopy)&&t.bind("zClip_beforeCopy",r.beforeCopy),e.isFunction(r.afterCopy)&&t.bind("zClip_afterCopy",r.afterCopy),i.setHandCursor(r.setHandCursor),i.setCSSEffects(r.setCSSEffects),i.addEventListener("mouseOver",function(e){t.trigger("mouseenter")}),i.addEventListener("mouseOut",function(e){t.trigger("mouseleave")}),i.addEventListener("mouseDown",function(n){t.trigger("mousedown"),e.isFunction(r.copy)?i.setText(t.triggerHandler("zClip_copy")):i.setText(r.copy),e.isFunction(r.beforeCopy)&&t.trigger("zClip_beforeCopy")}),i.addEventListener("complete",function(n,i){e.isFunction(r.afterCopy)?t.trigger("zClip_afterCopy"):(i.length>500&&(i=i.substr(0,500)+"...\n\n("+(i.length-500)+" characters not shown)"),t.removeClass("hover"),alert("Copied text to clipboard:\n\n "+i)),r.clickAfter&&t.trigger("click")}),i.glue(t[0],t.parent()[0]),e(window).bind("load resize",function(){i.reposition()})}})}if(typeof t=="string")return this.each(function(){var n=e(this);t=t.toLowerCase();var r=n.data("zclipId"),i=e("#"+r+".zclip");t=="remove"?(i.remove(),n.removeClass("active hover")):t=="hide"?(i.hide(),n.removeClass("active hover")):t=="show"&&i.show()})}}(e),e.fn.tibbrLeftMenu=function(){},e.fn.serializeJSON=function(){var t={};return e.map(e(this).serializeArray(),function(e,n){var r=e.name.indexOf("[");if(r>-1){var i=t,s=e.name.replace(/\]/gi,"").split("[");for(var n=0,o=s.length;n<o;n++)n==o-1?i[s[n]]?(typeof i[s[n]]=="string"&&(i[s[n]]=[i[s[n]]]),i[s[n]].push(e.value)):i[s[n]]=e.value||"":i=i[s[n]]=i[s[n]]||{}}else t[e.name]!==undefined?(t[e.name].push||(t[e.name]=[t[e.name]]),t[e.name].push(e.value||"")):t[e.name]=e.value||""}),t},e.fn.serializeObject=function(){var t,n,r,i=this;return t={},r={},n={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/},this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return r[e]===void 0&&(r[e]=0),r[e]++},e.each(e(this).serializeArray(),function(r,s){var o,u,a,f,l;if(!n.validate.test(s.name))return;u=s.name.match(n.key),a=s.value,l=s.name;while((o=u.pop())!==void 0)n.push.test(o)?(f=new RegExp("\\["+o+"\\]$"),l=l.replace(f,""),a=i.build([],i.push_counter(l),a)):n.fixed.test(o)?a=i.build([],o,a):n.named.test(o)&&(a=i.build({},o,a));return t=e.extend(!0,t,a)}),t}}),function(e,t,n){(function(e){typeof define=="function"&&define.amd?define("require/qtip",["jquery"],e):jQuery&&!jQuery.fn.qtip&&e(jQuery)})(function(r){function I(e,t,n,i){this.id=n,this.target=e,this.tooltip=o,this.elements={target:e},this._id=T+"-"+n,this.timers={img:{}},this.options=t,this.plugins={},this.cache={event:{},target:r(),disabled:s,attr:i,onTooltip:s,lastClass:""},this.rendered=this.destroyed=this.disabled=this.waiting=this.hiddenDuringWait=this.positioning=this.triggering=s}function q(e){return e===o||r.type(e)!=="object"}function R(e){return!(r.isFunction(e)||e&&e.attr||e.length||r.type(e)==="object"&&(e.jquery||e.then))}function U(e){var t,n,u,a;return q(e)?s:(q(e.metadata)&&(e.metadata={type:e.metadata}),"content"in e&&(t=e.content,q(t)||t.jquery||t.done?t=e.content={text:n=R(t)?s:t}:n=t.text,"ajax"in t&&(u=t.ajax,a=u&&u.once!==s,delete t.ajax,t.text=function(e,t){var i=n||r(this).attr(t.options.content.attr)||"Loading...",s=r.ajax(r.extend({},u,{context:t})).then(u.success,o,u.error).then(function(e){return e&&a&&t.set("content.text",e),e},function(e,n,r){if(t.destroyed||e.status===0)return;t.set("content.text",n+": "+r)});return a?i:(t.set("content.text",i),s)}),"title"in t&&(q(t.title)||(t.button=t.title.button,t.title=t.title.text),R(t.title||s)&&(t.title=s))),"position"in e&&q(e.position)&&(e.position={my:e.position,at:e.position}),"show"in e&&q(e.show)&&(e.show=e.show.jquery?{target:e.show}:e.show===i?{ready:i}:{event:e.show}),"hide"in e&&q(e.hide)&&(e.hide=e.hide.jquery?{target:e.hide}:{event:e.hide}),"style"in e&&q(e.style)&&(e.style={classes:e.style}),r.each(x,function(){this.sanitize&&this.sanitize(e)}),e)}function z(e,t){var n=0,r,i=e,s=t.split(".");while(i=i[s[n++]])n<s.length&&(r=i);return[r||e,s.pop()]}function W(e,t){var n,r,i;for(n in this.checks)for(r in this.checks[n])if(i=(new RegExp(r,"i")).exec(e))t.push(i),(n==="builtin"||this.plugins[n])&&this.checks[n][r].apply(this.plugins[n]||this,t)}function J(e){return k.concat("").join(e?"-"+e+" ":" ")}function K(n){return n&&{type:n.type,pageX:n.pageX,pageY:n.pageY,target:n.target,relatedTarget:n.relatedTarget,scrollX:n.scrollX||e.pageXOffset||t.body.scrollLeft||t.documentElement.scrollLeft,scrollY:n.scrollY||e.pageYOffset||t.body.scrollTop||t.documentElement.scrollTop}||{}}function Q(e,t){if(t>0)return setTimeout(r.proxy(e,this),t);e.call(this)}function G(e){if(this.tooltip.hasClass(P))return s;clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this.timers.show=Q.call(this,function(){this.toggle(i,e)},this.options.show.delay)}function Y(e){if(this.tooltip.hasClass(P))return s;var t=r(e.relatedTarget),n=t.closest(L)[0]===this.tooltip[0],i=t[0]===this.options.show.target[0];clearTimeout(this.timers.show),clearTimeout(this.timers.hide);if(this!==t[0]&&this.options.position.target==="mouse"&&n||this.options.hide.fixed&&/mouse(out|leave|move)/.test(e.type)&&(n||i)){try{e.preventDefault(),e.stopImmediatePropagation()}catch(o){}return}this.timers.hide=Q.call(this,function(){this.toggle(s,e)},this.options.hide.delay,this)}function Z(e){if(this.tooltip.hasClass(P)||!this.options.hide.inactive)return s;clearTimeout(this.timers.inactive),this.timers.inactive=Q.call(this,function(){this.hide(e)},this.options.hide.inactive)}function et(e){this.rendered&&this.tooltip[0].offsetWidth>0&&this.reposition(e)}function nt(e,n,i){r(t.body).delegate(e,(n.split?n:n.join(tt+" "))+tt,function(){var e=b.api[r.attr(this,C)];e&&!e.disabled&&i.apply(e,arguments)})}function rt(e,n,u){var a,f,l,c,h,p=r(t.body),d=e[0]===t?p:e,v=e.metadata?e.metadata(u.metadata):o,m=u.metadata.type==="html5"&&v?v[u.metadata.name]:o,g=e.data(u.metadata.name||"qtipopts");try{g=typeof g=="string"?r.parseJSON(g):g}catch(y){}c=r.extend(i,{},b.defaults,u,typeof g=="object"?U(g):o,U(m||v)),f=c.position,c.id=n;if("boolean"==typeof c.content.text){l=e.attr(c.content.attr);if(c.content.attr===s||!l)return s;c.content.text=l}f.container.length||(f.container=p),f.target===s&&(f.target=d),c.show.target===s&&(c.show.target=d),c.show.solo===i&&(c.show.solo=f.container.closest("body")),c.hide.target===s&&(c.hide.target=d),c.position.viewport===i&&(c.position.viewport=f.container),f.container=f.container.eq(0),f.at=new E(f.at,i),f.my=new E(f.my);if(e.data(T))if(c.overwrite)e.qtip("destroy",!0);else if(c.overwrite===s)return s;return e.attr(N,n),c.suppress&&(h=e.attr("title"))&&e.removeAttr("title").attr(B,h).attr("title",""),a=new I(e,c,n,!!l),e.data(T,a),e.one("remove.qtip-"+n+" removeqtip.qtip-"+n,function(){var e;(e=r(this).data(T))&&e.destroy(!0)}),a}function dt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function gt(e,t){var r=t.charAt(0).toUpperCase()+t.slice(1),i=(t+" "+mt.join(r+" ")+r).split(" "),s,o,u=0;if(vt[t])return e.css(vt[t]);while(s=i[u++])if((o=e.css(s))!==n)return vt[t]=s,o}function yt(e,t){return Math.ceil(parseFloat(gt(e,t)))}function xt(e,t){this._ns="tip",this.options=t,this.offset=t.offset,this.size=[t.width,t.height],this.init(this.qtip=e)}function Lt(e,t){this.options=t,this._ns="-modal",this.init(this.qtip=e)}function Mt(e,t){this._ns="ie6",this.init(this.qtip=e)}var i=!0,s=!1,o=null,u="x",a="y",f="width",l="height",c="top",h="left",p="bottom",d="right",v="center",m="flip",g="flipinvert",y="shift",b,w,E,S,x={},T="qtip",N="data-hasqtip",C="data-qtip-id",k=["ui-widget","ui-tooltip"],L="."+T,A="click dblclick mousedown mouseup mousemove mouseleave mouseenter".split(" "),O=T+"-fixed",M=T+"-default",_=T+"-focus",D=T+"-hover",P=T+"-disabled",H="_replacedByqTip",B="oldtitle",j,F={ie:function(){var e=3,n=t.createElement("div");while(n.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")if(!n.getElementsByTagName("i")[0])break;return e>4?e:NaN}(),iOS:parseFloat((""+(/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))||s};w=I.prototype,w._when=function(e){return r.when.apply(r,e)},w.render=function(e){if(this.rendered||this.destroyed)return this;var t=this,n=this.options,o=this.cache,u=this.elements,a=n.content.text,f=n.content.title,l=n.content.button,c=n.position,h="."+this._id+" ",p=[],d;return r.attr(this.target[0],"aria-describedby",this._id),this.tooltip=u.tooltip=d=r("<div/>",{id:this._id,"class":[T,M,n.style.classes,T+"-pos-"+n.position.my.abbrev()].join(" "),width:n.style.width||"",height:n.style.height||"",tracking:c.target==="mouse"&&c.adjust.mouse,role:"alert","aria-live":"polite","aria-atomic":s,"aria-describedby":this._id+"-content","aria-hidden":i}).toggleClass(P,this.disabled).attr(C,this.id).data(T,this).appendTo(c.container).append(u.content=r("<div />",{"class":T+"-content",id:this._id+"-content","aria-atomic":i})),this.rendered=-1,this.positioning=i,f&&(this._createTitle(),r.isFunction(f)||p.push(this._updateTitle(f,s))),l&&this._createButton(),r.isFunction(a)||p.push(this._updateContent(a,s)),this.rendered=i,this._setWidget(),r.each(x,function(e){var n;this.initialize==="render"&&(n=this(t))&&(t.plugins[e]=n)}),this._unassignEvents(),this._assignEvents(),this._when(p).then(function(){t._trigger("render"),t.positioning=s,!t.hiddenDuringWait&&(n.show.ready||e)&&t.toggle(i,o.event,s),t.hiddenDuringWait=s}),b.api[this.id]=this,this},w.destroy=function(e){function t(){if(this.destroyed)return;this.destroyed=i;var e=this.target,t=e.attr(B);this.rendered&&this.tooltip.stop(1,0).find("*").remove().end().remove(),r.each(this.plugins,function(e){this.destroy&&this.destroy()}),clearTimeout(this.timers.show),clearTimeout(this.timers.hide),this._unassignEvents(),e.removeData(T).removeAttr(C).removeAttr(N).removeAttr("aria-describedby"),this.options.suppress&&t&&e.attr("title",t).removeAttr(B),this._unbind(e),this.options=this.elements=this.cache=this.timers=this.plugins=this.mouse=o,delete b.api[this.id]}return this.destroyed?this.target:(e===i&&this.triggering!=="hide"||!this.rendered?t.call(this):(this.tooltip.one("tooltiphidden",r.proxy(t,this)),!this.triggering&&this.hide()),this.target)},S=w.checks={builtin:{"^id$":function(e,t,n,o){var u=n===i?b.nextid:n,a=T+"-"+u;u!==s&&u.length>0&&!r("#"+a).length?(this._id=a,this.rendered&&(this.tooltip[0].id=this._id,this.elements.content[0].id=this._id+"-content",this.elements.title[0].id=this._id+"-title")):e[t]=o},"^prerender":function(e,t,n){n&&!this.rendered&&this.render(this.options.show.ready)},"^content.text$":function(e,t,n){this._updateContent(n)},"^content.attr$":function(e,t,n,r){this.options.content.text===this.target.attr(r)&&this._updateContent(this.target.attr(n))},"^content.title$":function(e,t,n){if(!n)return this._removeTitle();n&&!this.elements.title&&this._createTitle(),this._updateTitle(n)},"^content.button$":function(e,t,n){this._updateButton(n)},"^content.title.(text|button)$":function(e,t,n){this.set("content."+t,n)},"^position.(my|at)$":function(e,t,n){"string"==typeof n&&(e[t]=new E(n,t==="at"))},"^position.container$":function(e,t,n){this.rendered&&this.tooltip.appendTo(n)},"^show.ready$":function(e,t,n){n&&(!this.rendered&&this.render(i)||this.toggle(i))},"^style.classes$":function(e,t,n,r){this.rendered&&this.tooltip.removeClass(r).addClass(n)},"^style.(width|height)":function(e,t,n){this.rendered&&this.tooltip.css(t,n)},"^style.widget|content.title":function(){this.rendered&&this._setWidget()},"^style.def":function(e,t,n){this.rendered&&this.tooltip.toggleClass(M,!!n)},"^events.(render|show|move|hide|focus|blur)$":function(e,t,n){this.rendered&&this.tooltip[(r.isFunction(n)?"":"un")+"bind"]("tooltip"+t,n)},"^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)":function(){if(!this.rendered)return;var e=this.options.position;this.tooltip.attr("tracking",e.target==="mouse"&&e.adjust.mouse),this._unassignEvents(),this._assignEvents()}}},w.get=function(e){if(this.destroyed)return this;var t=z(this.options,e.toLowerCase()),n=t[0][t[1]];return n.precedance?n.string():n};var X=/^position\.(my|at|adjust|target|container|viewport)|style|content|show\.ready/i,V=/^prerender|show\.ready/i;w.set=function(e,t){if(this.destroyed)return this;var n=this.rendered,u=s,a=this.options,f=this.checks,l;return"string"==typeof e?(l=e,e={},e[l]=t):e=r.extend({},e),r.each(e,function(t,i){if(n&&V.test(t)){delete e[t];return}var s=z(a,t.toLowerCase()),o;o=s[0][s[1]],s[0][s[1]]=i&&i.nodeType?r(i):i,u=X.test(t)||u,e[t]=[s[0],s[1],i,o]}),U(a),this.positioning=i,r.each(e,r.proxy(W,this)),this.positioning=s,this.rendered&&this.tooltip[0].offsetWidth>0&&u&&this.reposition(a.position.target==="mouse"?o:this.cache.event),this},w._update=function(e,t,n){var u=this,a=this.cache;return!this.rendered||!e?s:(r.isFunction(e)&&(e=e.call(this.elements.target,a.event,this)||""),r.isFunction(e.then)?(a.waiting=i,e.then(function(e){return a.waiting=s,u._update(e,t)},o,function(e){return u._update(e,t)})):e===s||!e&&e!==""?s:(e.jquery&&e.length>0?t.empty().append(e.css({display:"block",visibility:"visible"})):t.html(e),this._waitForContent(t).then(function(e){e.images&&e.images.length&&u.rendered&&u.tooltip[0].offsetWidth>0&&u.reposition(a.event,!e.length)})))},w._waitForContent=function(e){var t=this.cache;return t.waiting=i,(r.fn.imagesLoaded?e.imagesLoaded():r.Deferred().resolve([])).done(function(){t.waiting=s}).promise()},w._updateContent=function(e,t){this._update(e,this.elements.content,t)},w._updateTitle=function(e,t){this._update(e,this.elements.title,t)===s&&this._removeTitle(s)},w._createTitle=function(){var e=this.elements,t=this._id+"-title";e.titlebar&&this._removeTitle(),e.titlebar=r("<div />",{"class":T+"-titlebar "+(this.options.style.widget?J("header"):"")}).append(e.title=r("<div />",{id:t,"class":T+"-title","aria-atomic":i})).insertBefore(e.content).delegate(".qtip-close","mousedown keydown mouseup keyup mouseout",function(e){r(this).toggleClass("ui-state-active ui-state-focus",e.type.substr(-4)==="down")}).delegate(".qtip-close","mouseover mouseout",function(e){r(this).toggleClass("ui-state-hover",e.type==="mouseover")}),this.options.content.button&&this._createButton()},w._removeTitle=function(e){var t=this.elements;t.title&&(t.titlebar.remove(),t.titlebar=t.title=t.button=o,e!==s&&this.reposition())},w.reposition=function(n,o){if(!this.rendered||this.positioning||this.destroyed)return this;this.positioning=i;var u=this.cache,a=this.tooltip,f=this.options.position,l=f.target,m=f.my,g=f.at,y=f.viewport,b=f.container,w=f.adjust,E=w.method.split(" "),S=a.outerWidth(s),T=a.outerHeight(s),N=0,C=0,k=a.css("position"),L={left:0,top:0},A=a[0].offsetWidth>0,O=n&&n.type==="scroll",M=r(e),_=b[0].ownerDocument,D=this.mouse,P,H;if(r.isArray(l)&&l.length===2)g={x:h,y:c},L={left:l[0],top:l[1]};else if(l==="mouse"){g={x:h,y:c};if(D&&D.pageX&&(w.mouse||!n||!n.pageX))n=D;else if(!n||!n.pageX)if((!w.mouse||this.options.show.distance)&&u.origin&&u.origin.pageX)n=u.origin;else if(!n||n&&(n.type==="resize"||n.type==="scroll"))n=u.event;k!=="static"&&(L=b.offset()),_.body.offsetWidth!==(e.innerWidth||_.documentElement.clientWidth)&&(H=r(t.body).offset()),L={left:n.pageX-L.left+(H&&H.left||0),top:n.pageY-L.top+(H&&H.top||0)},w.mouse&&O&&D&&(L.left-=(D.scrollX||0)-M.scrollLeft(),L.top-=(D.scrollY||0)-M.scrollTop())}else{l==="event"?n&&n.target&&n.type!=="scroll"&&n.type!=="resize"?u.target=r(n.target):n.target||(u.target=this.elements.target):l!=="event"&&(u.target=r(l.jquery?l:this.elements.target)),l=u.target,l=r(l).eq(0);if(l.length===0)return this;l[0]===t||l[0]===e?(N=F.iOS?e.innerWidth:l.width(),C=F.iOS?e.innerHeight:l.height(),l[0]===e&&(L={top:(y||l).scrollTop(),left:(y||l).scrollLeft()})):x.imagemap&&l.is("area")?P=x.imagemap(this,l,g,x.viewport?E:s):x.svg&&l&&l[0].ownerSVGElement?P=x.svg(this,l,g,x.viewport?E:s):(N=l.outerWidth(s),C=l.outerHeight(s),L=l.offset()),P&&(N=P.width,C=P.height,H=P.offset,L=P.position),L=this.reposition.offset(l,L,b);if(F.iOS>3.1&&F.iOS<4.1||F.iOS>=4.3&&F.iOS<4.33||!F.iOS&&k==="fixed")L.left-=M.scrollLeft(),L.top-=M.scrollTop();if(!P||P&&P.adjustable!==s)L.left+=g.x===d?N:g.x===v?N/2:0,L.top+=g.y===p?C:g.y===v?C/2:0}return L.left+=w.x+(m.x===d?-S:m.x===v?-S/2:0),L.top+=w.y+(m.y===p?-T:m.y===v?-T/2:0),x.viewport?(L.adjusted=x.viewport(this,L,f,N,C,S,T),H&&L.adjusted.left&&(L.left+=H.left),H&&L.adjusted.top&&(L.top+=H.top)):L.adjusted={left:0,top:0},this._trigger("move",[L,y.elem||y],n)?(delete L.adjusted,o===s||!A||isNaN(L.left)||isNaN(L.top)||l==="mouse"||!r.isFunction(f.effect)?a.css(L):r.isFunction(f.effect)&&(f.effect.call(a,this,r.extend({},L)),a.queue(function(e){r(this).css({opacity:"",height:""}),F.ie&&this.style.removeAttribute("filter"),e()})),this.positioning=s,this):this},w.reposition.offset=function(e,n,i){function h(e,t){n.left+=t*e.scrollLeft(),n.top+=t*e.scrollTop()}if(!i[0])return n;var s=r(e[0].ownerDocument),o=!!F.ie&&t.compatMode!=="CSS1Compat",u=i[0],a,f,l,c;do(f=r.css(u,"position"))!=="static"&&(f==="fixed"?(l=u.getBoundingClientRect(),h(s,-1)):(l=r(u).position(),l.left+=parseFloat(r.css(u,"borderLeftWidth"))||0,l.top+=parseFloat(r.css(u,"borderTopWidth"))||0),n.left-=l.left+(parseFloat(r.css(u,"marginLeft"))||0),n.top-=l.top+(parseFloat(r.css(u,"marginTop"))||0),!a&&(c=r.css(u,"overflow"))!=="hidden"&&c!=="visible"&&(a=r(u)));while(u=u.offsetParent);return a&&(a[0]!==s[0]||o)&&h(a,1),n};var $=(E=w.reposition.Corner=function(e,t){e=(""+e).replace(/([A-Z])/," $1").replace(/middle/gi,v).toLowerCase(),this.x=(e.match(/left|right/i)||e.match(/center/)||["inherit"])[0].toLowerCase(),this.y=(e.match(/top|bottom|center/i)||["inherit"])[0].toLowerCase(),this.forceY=!!t;var n=e.charAt(0);this.precedance=n==="t"||n==="b"?a:u}).prototype;$.invert=function(e,t){this[e]=this[e]===h?d:this[e]===d?h:t||this[e]},$.string=function(){var e=this.x,t=this.y;return e===t?e:this.precedance===a||this.forceY&&t!=="center"?t+" "+e:e+" "+t},$.abbrev=function(){var e=this.string().split(" ");return e[0].charAt(0)+(e[1]&&e[1].charAt(0)||"")},$.clone=function(){return new E(this.string(),this.forceY)},w.toggle=function(e,n){var u=this.cache,a=this.options,f=this.tooltip;if(n){if(/over|enter/.test(n.type)&&/out|leave/.test(u.event.type)&&a.show.target.add(n.target).length===a.show.target.length&&f.has(n.relatedTarget).length)return this;u.event=K(n)}this.waiting&&!e&&(this.hiddenDuringWait=i);if(!this.rendered)return e?this.render(1):this;if(this.destroyed||this.disabled)return this;var l=e?"show":"hide",c=this.options[l],h=this.options[e?"hide":"show"],p=this.options.position,d=this.options.content,v=this.tooltip.css("width"),m=this.tooltip.is(":visible"),g=e||c.target.length===1,y=!n||c.target.length<2||u.target[0]===n.target,b,w,E,S,x;return(typeof e).search("boolean|number")&&(e=!m),b=!f.is(":animated")&&m===e&&y,w=b?o:!!this._trigger(l,[90]),this.destroyed?this:(w!==s&&e&&this.focus(n),!w||b?this:(r.attr(f[0],"aria-hidden",!e),e?(u.origin=K(this.mouse),r.isFunction(d.text)&&this._updateContent(d.text,s),r.isFunction(d.title)&&this._updateTitle(d.title,s),!j&&p.target==="mouse"&&p.adjust.mouse&&(r(t).bind("mousemove."+T,this._storeMouse),j=i),v||f.css("width",f.outerWidth(s)),this.reposition(n,arguments[2]),v||f.css("width",""),!c.solo||(typeof c.solo=="string"?r(c.solo):r(L,c.solo)).not(f).not(c.target).qtip("hide",r.Event("tooltipsolo"))):(clearTimeout(this.timers.show),delete u.origin,j&&!r(L+'[tracking="true"]:visible',c.solo).not(f).length&&(r(t).unbind("mousemove."+T),j=s),this.blur(n)),x=r.proxy(function(){e?(F.ie&&f[0].style.removeAttribute("filter"),f.css("overflow",""),"string"==typeof c.autofocus&&r(this.options.show.autofocus,f).focus(),this.options.show.target.trigger("qtip-"+this.id+"-inactive")):f.css({display:"",visibility:"",opacity:"",left:"",top:""}),this._trigger(e?"visible":"hidden")},this),c.effect===s||g===s?(f[l](),x()):r.isFunction(c.effect)?(f.stop(1,1),c.effect.call(f,this),f.queue("fx",function(e){x(),e()})):f.fadeTo(90,e?1:0,x),e&&c.target.trigger("qtip-"+this.id+"-inactive"),this))},w.show=function(e){return this.toggle(i,e)},w.hide=function(e){return this.toggle(s,e)},w.focus=function(e){if(!this.rendered||this.destroyed)return this;var t=r(L),n=this.tooltip,i=parseInt(n[0].style.zIndex,10),s=b.zindex+t.length,o;return n.hasClass(_)||this._trigger("focus",[s],e)&&(i!==s&&(t.each(function(){this.style.zIndex>i&&(this.style.zIndex=this.style.zIndex-1)}),t.filter("."+_).qtip("blur",e)),n.addClass(_)[0].style.zIndex=s),this},w.blur=function(e){return!this.rendered||this.destroyed?this:(this.tooltip.removeClass(_),this._trigger("blur",[this.tooltip.css("zIndex")],e),this)},w.disable=function(e){return this.destroyed?this:(e==="toggle"?e=this.rendered?!this.tooltip.hasClass(P):!this.disabled:"boolean"!=typeof e&&(e=i),this.rendered&&this.tooltip.toggleClass(P,e).attr("aria-disabled",e),this.disabled=!!e,this)},w.enable=function(){return this.disable(s)},w._createButton=function(){var e=this,t=this.elements,n=t.tooltip,i=this.options.content.button,o=typeof i=="string",u=o?i:"Close tooltip";t.button&&t.button.remove(),i.jquery?t.button=i:t.button=r("<a />",{"class":"qtip-close "+(this.options.style.widget?"":T+"-icon"),title:u,"aria-label":u}).prepend(r("<span />",{"class":"ui-icon ui-icon-close",html:"&times;"})),t.button.appendTo(t.titlebar||n).attr("role","button").click(function(t){return n.hasClass(P)||e.hide(t),s})},w._updateButton=function(e){if(!this.rendered)return s;var t=this.elements.button;e?this._createButton():t.remove()},w._setWidget=function(){var e=this.options.style.widget,t=this.elements,n=t.tooltip,r=n.hasClass(P);n.removeClass(P),P=e?"ui-state-disabled":"qtip-disabled",n.toggleClass(P,r),n.toggleClass("ui-helper-reset "+J(),e).toggleClass(M,this.options.style.def&&!e),t.content&&t.content.toggleClass(J("content"),e),t.titlebar&&t.titlebar.toggleClass(J("header"),e),t.button&&t.button.toggleClass(T+"-icon",!e)},w._storeMouse=function(e){(this.mouse=K(e)).type="mousemove"},w._bind=function(e,t,n,i,s){var o="."+this._id+(i?"-"+i:"");t.length&&r(e).bind((t.split?t:t.join(o+" "))+o,r.proxy(n,s||this))},w._unbind=function(e,t){r(e).unbind("."+this._id+(t?"-"+t:""))};var tt="."+T;r(function(){nt(L,["mouseenter","mouseleave"],function(e){var t=e.type==="mouseenter",n=r(e.currentTarget),i=r(e.relatedTarget||e.target),s=this.options;t?(this.focus(e),n.hasClass(O)&&!n.hasClass(P)&&clearTimeout(this.timers.hide)):s.position.target==="mouse"&&s.hide.event&&s.show.target&&!i.closest(s.show.target[0]).length&&this.hide(e),n.toggleClass(D,t)}),nt("["+C+"]",A,Z)}),w._trigger=function(e,t,n){var i=r.Event("tooltip"+e);return i.originalEvent=n&&r.extend({},n)||this.cache.event||o,this.triggering=e,this.tooltip.trigger(i,[this].concat(t||[])),this.triggering=s,!i.isDefaultPrevented()},w._bindEvents=function(e,t,n,i,s,o){if(i.add(n).length===i.length){var u=[];t=r.map(t,function(t){var n=r.inArray(t,e);if(n>-1){u.push(e.splice(n,1)[0]);return}return t}),u.length&&this._bind(n,u,function(e){var t=this.rendered?this.tooltip[0].offsetWidth>0:!1;(t?o:s).call(this,e)})}this._bind(n,e,s),this._bind(i,t,o)},w._assignInitialEvents=function(e){function l(e){if(this.disabled||this.destroyed)return s;this.cache.event=K(e),this.cache.target=e?r(e.target):[n],clearTimeout(this.timers.show),this.timers.show=Q.call(this,function(){this.render(typeof e=="object"||t.show.ready)},t.show.delay)}var t=this.options,o=t.show.target,u=t.hide.target,a=t.show.event?r.trim(""+t.show.event).split(" "):[],f=t.hide.event?r.trim(""+t.hide.event).split(" "):[];/mouse(over|enter)/i.test(t.show.event)&&!/mouse(out|leave)/i.test(t.hide.event)&&f.push("mouseleave"),this._bind(o,"mousemove",function(e){this._storeMouse(e),this.cache.onTarget=i}),this._bindEvents(a,f,o,u,l,function(){try{clearTimeout(this.timers.show)}catch(e){console.log(e)}}),(t.show.ready||t.prerender)&&l.call(this,e)},w._assignEvents=function(){var n=this,i=this.options,s=i.position,o=this.tooltip,u=i.show.target,a=i.hide.target,f=s.container,l=s.viewport,c=r(t),h=r(t.body),p=r(e),d=i.show.event?r.trim(""+i.show.event).split(" "):[],v=i.hide.event?r.trim(""+i.hide.event).split(" "):[];r.each(i.events,function(e,t){n._bind(o,e==="toggle"?["tooltipshow","tooltiphide"]:["tooltip"+e],t,null,o)}),/mouse(out|leave)/i.test(i.hide.event)&&i.hide.leave==="window"&&this._bind(c,["mouseout","blur"],function(e){!/select|option/.test(e.target.nodeName)&&!e.relatedTarget&&this.hide(e)}),i.hide.fixed?a=a.add(o.addClass(O)):/mouse(over|enter)/i.test(i.show.event)&&this._bind(a,"mouseleave",function(){clearTimeout(this.timers.show)}),(""+i.hide.event).indexOf("unfocus")>-1&&this._bind(f.closest("html"),["mousedown","touchstart"],function(e){var t=r(e.target),n=this.rendered&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0,i=t.parents(L).filter(this.tooltip[0]).length>0;t[0]!==this.target[0]&&t[0]!==this.tooltip[0]&&!i&&!this.target.has(t[0]).length&&n&&this.hide(e)}),"number"==typeof i.hide.inactive&&(this._bind(u,"qtip-"+this.id+"-inactive",Z),this._bind(a.add(o),b.inactiveEvents,Z,"-inactive")),this._bindEvents(d,v,u,a,G,Y),this._bind(u.add(o),"mousemove",function(e){if("number"==typeof i.hide.distance){var t=this.cache.origin||{},n=this.options.hide.distance,r=Math.abs;(r(e.pageX-t.pageX)>=n||r(e.pageY-t.pageY)>=n)&&this.hide(e)}this._storeMouse(e)}),s.target==="mouse"&&s.adjust.mouse&&(i.hide.event&&this._bind(u,["mouseenter","mouseleave"],function(e){this.cache.onTarget=e.type==="mouseenter"}),this._bind(c,"mousemove",function(e){this.rendered&&this.cache.onTarget&&!this.tooltip.hasClass(P)&&this.tooltip[0].offsetWidth>0&&this.reposition(e)})),(s.adjust.resize||l.length)&&this._bind(r.event.special.resize?l:p,"resize",et),s.adjust.scroll&&this._bind(p.add(s.container),"scroll",et)},w._unassignEvents=function(){var n=[this.options.show.target[0],this.options.hide.target[0],this.rendered&&this.tooltip[0],this.options.position.container[0],this.options.position.viewport[0],this.options.position.container.closest("html")[0],e,t];this._unbind(r([]).pushStack(r.grep(n,function(e){return typeof e=="object"})))},b=r.fn.qtip=function(e,t,u){var a=(""+e).toLowerCase(),f=o,l=r.makeArray(arguments).slice(1),c=l[l.length-1],h=this[0]?r.data(this[0],T):o;if(!arguments.length&&h||a==="api")return h;if("string"==typeof e)return this.each(function(){var e=r.data(this,T);if(!e)return i;c&&c.timeStamp&&(e.cache.event=c);if(!t||a!=="option"&&a!=="options")e[a]&&e[a].apply(e,l);else{if(u===n&&!r.isPlainObject(t))return f=e.get(t),s;e.set(t,u)}}),f!==o?f:this;if("object"==typeof e||!arguments.length)return h=U(r.extend(i,{},e)),this.each(function(e){var t,n;n=r.isArray(h.id)?h.id[e]:h.id,n=!n||n===s||n.length<1||b.api[n]?b.nextid++:n,t=rt(r(this),n,h);if(t===s)return i;b.api[n]=t,r.each(x,function(){this.initialize==="initialize"&&this(t)}),t._assignInitialEvents(c)})},r.qtip=I,b.api={},r.each({attr:function(e,t){if(this.length){var n=this[0],i="title",s=r.data(n,"qtip");if(e===i&&s&&"object"==typeof s&&s.options.suppress)return arguments.length<2?r.attr(n,B):(s&&s.options.content.attr===i&&s.cache.attr&&s.set("content.text",t),this.attr(B,t))}return r.fn["attr"+H].apply(this,arguments)},clone:function(e){var t=r([]),n="title",i=r.fn["clone"+H].apply(this,arguments);return e||i.filter("["+B+"]").attr("title",function(){return r.attr(this,B)}).removeAttr(B),i}},function(e,t){if(!t||r.fn[e+H])return i;var n=r.fn[e+H]=r.fn[e];r.fn[e]=function(){return t.apply(this,arguments)||n.apply(this,arguments)}}),r.ui||(r["cleanData"+H]=r.cleanData,r.cleanData=function(e){for(var t=0,n;(n=r(e[t])).length;t++)if(n.attr(N))try{n.triggerHandler("removeqtip")}catch(i){}r["cleanData"+H].apply(this,arguments)}),b.version="2.2.0",b.nextid=0,b.inactiveEvents=A,b.zindex=15e3,b.defaults={prerender:s,id:s,overwrite:i,suppress:i,content:{text:i,attr:"title",title:s,button:s},position:{my:"top left",at:"bottom right",target:s,container:s,viewport:s,adjust:{x:0,y:0,mouse:i,scroll:i,resize:i,method:"flipinvert flipinvert"},effect:function(e,t,n){r(this).animate(t,{duration:200,queue:s})}},show:{target:s,event:"mouseenter",effect:i,delay:90,solo:s,ready:s,autofocus:s},hide:{target:s,event:"mouseleave",effect:i,delay:0,fixed:s,inactive:s,leave:"window",distance:s},style:{classes:"",widget:s,width:s,height:s,def:i},events:{render:o,move:o,show:o,hide:o,toggle:o,visible:o,hidden:o,focus:o,blur:o}};var it,st=".qtip-tip",ot="margin",ut="border",at="color",ft="background-color",lt="transparent",ct=" !important",ht=!!t.createElement("canvas").getContext,pt=/rgba?\(0, 0, 0(, 0)?\)|transparent|#123456/i,vt={},mt=["Webkit","O","Moz","ms"];if(!ht)var bt=function(e,t,n){return"<qtipvml:"+e+' xmlns="urn:schemas-microsoft.com:vml" class="qtip-vml" '+(t||"")+' style="behavior: url(#default#VML); '+(n||"")+'" />'};else var wt=e.devicePixelRatio||1,Et=function(){var e=t.createElement("canvas").getContext("2d");return e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1}(),St=wt/Et;r.extend(xt.prototype,{init:function(e){var t,n;n=this.element=e.elements.tip=r("<div />",{"class":T+"-tip"}).prependTo(e.tooltip),ht?(t=r("<canvas />").appendTo(this.element)[0].getContext("2d"),t.lineJoin="miter",t.miterLimit=1e5,t.save()):(t=bt("shape",'coordorigin="0,0"',"position:absolute;"),this.element.html(t+t),e._bind(r("*",n).add(n),["click","mousedown"],function(e){e.stopPropagation()},this._ns)),e._bind(e.tooltip,"tooltipmove",this.reposition,this._ns,this),this.create()},_swapDimensions:function(){this.size[0]=this.options.height,this.size[1]=this.options.width},_resetDimensions:function(){this.size[0]=this.options.width,this.size[1]=this.options.height},_useTitle:function(e){var t=this.qtip.elements.titlebar;return t&&(e.y===c||e.y===v&&this.element.position().top+this.size[1]/2+this.options.offset<t.outerHeight(i))},_parseCorner:function(e){var t=this.qtip.options.position.my;return e===s||t===s?e=s:e===i?e=new E(t.string()):e.string||(e=new E(e),e.fixed=i),e},_parseWidth:function(e,t,n){var r=this.qtip.elements,i=ut+dt(t)+"Width";return(n?yt(n,i):yt(r.content,i)||yt(this._useTitle(e)&&r.titlebar||r.content,i)||yt(r.tooltip,i))||0},_parseRadius:function(e){var t=this.qtip.elements,n=ut+dt(e.y)+dt(e.x)+"Radius";return F.ie<9?0:yt(this._useTitle(e)&&t.titlebar||t.content,n)||yt(t.tooltip,n)||0},_invalidColour:function(e,t,n){var r=e.css(t);return!r||n&&r===e.css(n)||pt.test(r)?s:r},_parseColours:function(e){var t=this.qtip.elements,n=this.element.css("cssText",""),i=ut+dt(e[e.precedance])+dt(at),s=this._useTitle(e)&&t.titlebar||t.content,o=this._invalidColour,u=[];return u[0]=o(n,ft)||o(s,ft)||o(t.content,ft)||o(t.tooltip,ft)||n.css(ft),u[1]=o(n,i,at)||o(s,i,at)||o(t.content,i,at)||o(t.tooltip,i,at)||t.tooltip.css(i),r("*",n).add(n).css("cssText",ft+":"+lt+ct+";"+ut+":0"+ct+";"),u},_calculateSize:function(e){var t=e.precedance===a,n=this.options.width,r=this.options.height,i=e.abbrev()==="c",s=(t?n:r)*(i?.5:1),o=Math.pow,u=Math.round,f,l,c,h=Math.sqrt(o(s,2)+o(r,2)),p=[this.border/s*h,this.border/r*h];return p[2]=Math.sqrt(o(p[0],2)-o(this.border,2)),p[3]=Math.sqrt(o(p[1],2)-o(this.border,2)),f=h+p[2]+p[3]+(i?0:p[0]),l=f/h,c=[u(l*n),u(l*r)],t?c:c.reverse()},_calculateTip:function(e,t,n){n=n||1,t=t||this.size;var r=t[0]*n,i=t[1]*n,s=Math.ceil(r/2),o=Math.ceil(i/2),u={br:[0,0,r,i,r,0],bl:[0,0,r,0,0,i],tr:[0,i,r,0,r,i],tl:[0,0,0,i,r,i],tc:[0,i,s,0,r,i],bc:[0,0,r,0,s,i],rc:[0,0,r,o,0,i],lc:[r,0,r,i,0,o]};return u.lt=u.br,u.rt=u.bl,u.lb=u.tr,u.rb=u.tl,u[e.abbrev()]},_drawCoords:function(e,t){e.beginPath(),e.moveTo(t[0],t[1]),e.lineTo(t[2],t[3]),e.lineTo(t[4],t[5]),e.closePath()},create:function(){var e=this.corner=(ht||F.ie)&&this._parseCorner(this.options.corner);if(this.enabled=!!this.corner&&this.corner.abbrev()!=="c")this.qtip.cache.corner=e.clone(),this.update();return this.element.toggle(this.enabled),this.corner},update:function(t,n){if(!this.enabled)return this;var o=this.qtip.elements,m=this.element,g=m.children(),y=this.options,b=this.size,w=y.mimic,S=Math.round,x,T,N,C,k,L,A,O,M;t||(t=this.qtip.cache.corner||this.corner),w===s?w=t:(w=new E(w),w.precedance=t.precedance,w.x==="inherit"?w.x=t.x:w.y==="inherit"?w.y=t.y:w.x===w.y&&(w[t.precedance]=t[t.precedance])),T=w.precedance,t.precedance===u?this._swapDimensions():this._resetDimensions(),x=this.color=this._parseColours(t),x[1]!==lt?(O=this.border=this._parseWidth(t,t[t.precedance]),y.border&&O<1&&!pt.test(x[1])&&(x[0]=x[1]),this.border=O=y.border!==i?y.border:O):this.border=O=0,A=this.size=this._calculateSize(t),m.css({width:A[0],height:A[1],lineHeight:A[1]+"px"}),t.precedance===a?L=[S(w.x===h?O:w.x===d?A[0]-b[0]-O:(A[0]-b[0])/2),S(w.y===c?A[1]-b[1]:0)]:L=[S(w.x===h?A[0]-b[0]:0),S(w.y===c?O:w.y===p?A[1]-b[1]-O:(A[1]-b[1])/2)],ht?(N=g[0].getContext("2d"),N.restore(),N.save(),N.clearRect(0,0,6e3,6e3),C=this._calculateTip(w,b,St),k=this._calculateTip(w,this.size,St),g.attr(f,A[0]*St).attr(l,A[1]*St),g.css(f,A[0]).css(l,A[1]),this._drawCoords(N,k),N.fillStyle=x[1],N.fill(),N.translate(L[0]*St,L[1]*St),this._drawCoords(N,C),N.fillStyle=x[0],N.fill()):(C=this._calculateTip(w),C="m"+C[0]+","+C[1]+" l"+C[2]+","+C[3]+" "+C[4]+","+C[5]+" xe",L[2]=O&&/^(r|b)/i.test(t.string())?F.ie===8?2:1:0,g.css({coordsize:A[0]+O+" "+(A[1]+O),antialias:""+(w.string().indexOf(v)>-1),left:L[0]-L[2]*Number(T===u),top:L[1]-L[2]*Number(T===a),width:A[0]+O,height:A[1]+O}).each(function(e){var t=r(this);t[t.prop?"prop":"attr"]({coordsize:A[0]+O+" "+(A[1]+O),path:C,fillcolor:x[0],filled:!!e,stroked:!e}).toggle(!!O||!!e),!e&&t.html(bt("stroke",'weight="'+O*2+'px" color="'+x[1]+'" miterlimit="1000" joinstyle="miter"'))})),e.opera&&setTimeout(function(){o.tip.css({display:"inline-block",visibility:"visible"})},1),n!==s&&this.calculate(t,A)},calculate:function(e,t){if(!this.enabled)return s;var n=this,i=this.qtip.elements,o=this.element,f=this.options.offset,l=i.tooltip.hasClass("ui-widget"),p={},d,m;return e=e||this.corner,d=e.precedance,t=t||this._calculateSize(e),m=[e.x,e.y],d===u&&m.reverse(),r.each(m,function(r,s){var o,u,l;s===v?(o=d===a?h:c,p[o]="50%",p[ot+"-"+o]=-Math.round(t[d===a?0:1]/2)+f):(o=n._parseWidth(e,s,i.tooltip),u=n._parseWidth(e,s,i.content),l=n._parseRadius(e),p[s]=Math.max(-n.border,r?u:f+(l>o?l:-o)))}),p[e[d]]-=t[d===u?0:1],o.css({margin:"",top:"",bottom:"",left:"",right:""}).css(p),p},reposition:function(e,t,r,o){function N(e,t,n,r,i){e===y&&l.precedance===t&&m[r]&&l[n]!==v?l.precedance=l.precedance===u?a:u:e!==y&&m[r]&&(l[t]=l[t]===v?m[r]>0?r:i:l[t]===r?i:r)}function C(e,t,i){l[e]===v?x[ot+"-"+t]=E[e]=S[ot+"-"+t]-m[t]:(T=S[i]!==n?[m[t],-S[t]]:[-m[t],S[t]],(E[e]=Math.max(T[0],T[1]))>T[0]&&(r[t]-=m[t],E[t]=s),x[S[i]!==n?i:t]=E[e])}if(!this.enabled)return;var f=t.cache,l=this.corner.clone(),m=r.adjusted,g=t.options.position.adjust.method.split(" "),b=g[0],w=g[1]||g[0],E={left:s,top:s,x:0,y:0},S,x={},T;this.corner.fixed!==i&&(N(b,u,a,h,d),N(w,a,u,c,p),l.string()!==f.corner.string()&&(f.cornerTop!==m.top||f.cornerLeft!==m.left)&&this.update(l,s)),S=this.calculate(l),S.right!==n&&(S.left=-S.right),S.bottom!==n&&(S.top=-S.bottom),S.user=this.offset,(E.left=b===y&&!!m.left)&&C(u,h,d),(E.top=w===y&&!!m.top)&&C(a,c,p),this.element.css(x).toggle(!(E.x&&E.y||l.x===v&&E.y||l.y===v&&E.x)),r.left-=S.left.charAt?S.user:b!==y||E.top||!E.left&&!E.top?S.left+this.border:0,r.top-=S.top.charAt?S.user:w!==y||E.left||!E.left&&!E.top?S.top+this.border:0,f.cornerLeft=m.left,f.cornerTop=m.top,f.corner=l.clone()},destroy:function(){this.qtip._unbind(this.qtip.tooltip,this._ns),this.qtip.elements.tip&&this.qtip.elements.tip.find("*").remove().end().remove()}}),it=x.tip=function(e){return new xt(e,e.options.style.tip)},it.initialize="render",it.sanitize=function(e){if(e.style&&"tip"in e.style){var t=e.style.tip;typeof t!="object"&&(t=e.style.tip={corner:t}),/string|boolean/i.test(typeof t.corner)||(t.corner=i)}},S.tip={"^position.my|style.tip.(corner|mimic|border)$":function(){this.create(),this.qtip.reposition()},"^style.tip.(height|width)$":function(e){this.size=[e.width,e.height],this.update(),this.qtip.reposition()},"^content.title|style.(classes|widget)$":function(){this.update()}},r.extend(i,b.defaults,{style:{tip:{corner:i,mimic:s,width:6,height:6,border:i,offset:0}}});var Tt,Nt,Ct="qtip-modal",kt="."+Ct;Nt=function(){function c(e){if(r.expr[":"].focusable)return r.expr[":"].focusable;var t=!isNaN(r.attr(e,"tabindex")),n=e.nodeName&&e.nodeName.toLowerCase(),i,s,o;return"area"===n?(i=e.parentNode,s=i.name,!e.href||!s||i.nodeName.toLowerCase()!=="map"?!1:(o=r("img[usemap=#"+s+"]")[0],!!o&&o.is(":visible"))):/input|select|textarea|button|object/.test(n)?!e.disabled:"a"===n?e.href||t:t}function h(e){n.length<1&&e.length?e.not("body").blur():n.first().focus()}function p(e){if(!l.is(":visible"))return;var t=r(e.target),i=u.tooltip,o=t.closest(L),f;f=o.length<1?s:parseInt(o[0].style.zIndex,10)>parseInt(i[0].style.zIndex,10),!f&&t.closest(L)[0]!==i[0]&&h(t),a=e.target===n[n.length-1]}var e=this,n={},u,a,f,l;r.extend(e,{init:function(){return l=e.elem=r("<div />",{id:"qtip-overlay",html:"<div></div>",mousedown:function(){return s}}).hide(),r(t.body).bind("focusin"+kt,p),r(t).bind("keydown"+kt,function(e){u&&u.options.show.modal.escape&&e.keyCode===27&&u.hide(e)}),l.bind("click"+kt,function(e){u&&u.options.show.modal.blur&&u.hide(e)}),e},update:function(e){u=e,e.options.show.modal.stealfocus!==s?n=e.tooltip.find("*").filter(function(){return c(this)}):n=[]},toggle:function(n,a,c){var p=r(t.body),d=n.tooltip,v=n.options.show.modal,m=v.effect,g=a?"show":"hide",y=l.is(":visible"),b=r(kt).filter(":visible:not(:animated)").not(d),w;return e.update(n),a&&v.stealfocus!==s&&h(r(":focus")),l.toggleClass("blurs",v.blur),a&&l.appendTo(t.body),l.is(":animated")&&y===a&&f!==s||!a&&b.length?e:(l.stop(i,s),r.isFunction(m)?m.call(l,a):m===s?l[g]():l.fadeTo(parseInt(c,10)||90,a?1:0,function(){a||l.hide()}),a||l.queue(function(e){l.css({left:"",top:""}),r(kt).length||l.detach(),e()}),f=a,u.destroyed&&(u=o),e)}}),e.init()},Nt=new Nt,r.extend(Lt.prototype,{init:function(e){var t=e.tooltip;if(!this.options.on)return this;e.elements.overlay=Nt.elem,t.addClass(Ct).css("z-index",b.modal_zindex+r(kt).length),e._bind(t,["tooltipshow","tooltiphide"],function(e,n,i){var s=e.originalEvent;if(e.target===t[0])if(s&&e.type==="tooltiphide"&&/mouse(leave|enter)/.test(s.type)&&r(s.relatedTarget).closest(Nt.elem[0]).length)try{e.preventDefault()}catch(o){}else(!s||s&&s.type!=="tooltipsolo")&&this.toggle(e,e.type==="tooltipshow",i)},this._ns,this),e._bind(t,"tooltipfocus",function(e,n){if(e.isDefaultPrevented()||e.target!==t[0])return;var i=r(kt),s=b.modal_zindex+i.length,o=parseInt(t[0].style.zIndex,10);Nt.elem[0].style.zIndex=s-1,i.each(function(){this.style.zIndex>o&&(this.style.zIndex-=1)}),i.filter("."+_).qtip("blur",e.originalEvent),t.addClass(_)[0].style.zIndex=s,Nt.update(n);try{e.preventDefault()}catch(u){}},this._ns,this),e._bind(t,"tooltiphide",function(e){e.target===t[0]&&r(kt).filter(":visible").not(t).last().qtip("focus",e)},this._ns,this)},toggle:function(e,t,n){if(e&&e.isDefaultPrevented())return this;Nt.toggle(this.qtip,!!t,n)},destroy:function(){this.qtip.tooltip.removeClass(Ct),this.qtip._unbind(this.qtip.tooltip,this._ns),Nt.toggle(this.qtip,s),delete this.qtip.elements.overlay}}),Tt=x.modal=function(e){return new Lt(e,e.options.show.modal)},Tt.sanitize=function(e){e.show&&(typeof e.show.modal!="object"?e.show.modal={on:!!e.show.modal}:typeof e.show.modal.on=="undefined"&&(e.show.modal.on=i))},b.modal_zindex=b.zindex-200,Tt.initialize="render",S.modal={"^show.modal.(on|blur)$":function(){this.destroy(),this.init(),this.qtip.elems.overlay.toggle(this.qtip.tooltip[0].offsetWidth>0)}},r.extend(i,b.defaults,{show:{modal:{on:s,effect:i,blur:i,stealfocus:i,escape:i}}}),x.viewport=function(n,r,i,o,m,b,w){function z(e,t,n,i,s,o,u,a,l){var c=r[s],h=x[e],p=N[e],d=n===y,m=h===s?l:h===o?-l:-l/2,b=p===s?a:p===o?-a:-a/2,w=R[s]+U[s]-(F?0:j[s]),E=w-c,S=c+l-(u===f?I:q)-w,T=m-(x.precedance===e||h===x[t]?b:0)-(p===v?a/2:0);return d?(T=(h===s?1:-1)*m,r[s]+=E>0?E:S>0?-S:0,r[s]=Math.max(-j[s]+U[s],c-T,Math.min(Math.max(-j[s]+U[s]+(u===f?I:q),c+T),r[s],h==="center"?c-m:1e9))):(i*=n===g?2:0,E>0&&(h!==s||S>0)?(r[s]-=T+i,H.invert(e,s)):S>0&&(h!==o||E>0)&&(r[s]-=(h===v?-T:T)+i,H.invert(e,o)),r[s]<R&&-r[s]>S&&(r[s]=c,H=x.clone())),r[s]-c}var E=i.target,S=n.elements.tooltip,x=i.my,N=i.at,C=i.adjust,k=C.method.split(" "),L=k[0],A=k[1]||k[0],O=i.viewport,M=i.container,_=n.cache,D={left:0,top:0},P,H,B,j,F,I,q,R,U;if(!O.jquery||E[0]===e||E[0]===t.body||C.method==="none")return D;j=M.offset()||D,F=M.css("position")==="static",P=S.css("position")==="fixed",I=O[0]===e?O.width():O.outerWidth(s),q=O[0]===e?O.height():O.outerHeight(s),R={left:P?0:O.scrollLeft(),top:P?0:O.scrollTop()},U=O.offset()||D;if(L!=="shift"||A!=="shift")H=x.clone();return D={left:L!=="none"?z(u,a,L,C.x,h,d,f,o,b):0,top:A!=="none"?z(a,u,A,C.y,c,p,l,m,w):0},H&&_.lastClass!==(B=T+"-pos-"+H.abbrev())&&S.removeClass(n.cache.lastClass).addClass(n.cache.lastClass=B),D},x.polys={polygon:function(e,t){var n={width:0,height:0,position:{top:1e10,right:0,bottom:0,left:1e10},adjustable:s},r=0,i,o=[],u=1,a=1,f=0,l=0,m,g;r=e.length;while(r--)i=[parseInt(e[--r],10),parseInt(e[r+1],10)],i[0]>n.position.right&&(n.position.right=i[0]),i[0]<n.position.left&&(n.position.left=i[0]),i[1]>n.position.bottom&&(n.position.bottom=i[1]),i[1]<n.position.top&&(n.position.top=i[1]),o.push(i);m=n.width=Math.abs(n.position.right-n.position.left),g=n.height=Math.abs(n.position.bottom-n.position.top);if(t.abbrev()==="c")n.position={left:n.position.left+n.width/2,top:n.position.top+n.height/2};else{while(m>0&&g>0&&u>0&&a>0){m=Math.floor(m/2),g=Math.floor(g/2),t.x===h?u=m:t.x===d?u=n.width-m:u+=Math.floor(m/2),t.y===c?a=g:t.y===p?a=n.height-g:a+=Math.floor(g/2),r=o.length;while(r--){if(o.length<2)break;f=o[r][0]-n.position.left,l=o[r][1]-n.position.top,(t.x===h&&f>=u||t.x===d&&f<=u||t.x===v&&(f<u||f>n.width-u)||t.y===c&&l>=a||t.y===p&&l<=a||t.y===v&&(l<a||l>n.height-a))&&o.splice(r,1)}}n.position={left:o[0][0],top:o[0][1]}}return n},rect:function(e,t,n,r){return{width:Math.abs(n-e),height:Math.abs(r-t),position:{left:Math.min(e,n),top:Math.min(t,r)}}},_angles:{tc:1.5,tr:7/4,tl:5/4,bc:.5,br:.25,bl:.75,rc:2,lc:1,c:0},ellipse:function(e,t,n,r,i){var o=x.polys._angles[i.abbrev()],u=o===0?0:n*Math.cos(o*Math.PI),a=r*Math.sin(o*Math.PI);return{width:n*2-Math.abs(u),height:r*2-Math.abs(a),position:{left:e+u,top:t+a},adjustable:s}},circle:function(e,t,n,r){return x.polys.ellipse(e,t,n,n,r)}},x.svg=function(e,n,i){var o=r(t),u=n[0],a=r(u.ownerSVGElement),f=1,l=1,c=!0,h,p,d,v,m,g,y,b,w,E,S,T;while(!u.getBBox)u=u.parentNode;if(!u.getBBox||!u.parentNode)return s;h=a.attr("width")||a.width()||parseInt(a.css("width"),10),p=a.attr("height")||a.height()||parseInt(a.css("height"),10);var N=(parseInt(n.css("stroke-width"),10)||0)/2;N&&(f+=N/h,l+=N/p);switch(u.nodeName){case"ellipse":case"circle":E=x.polys.ellipse(u.cx.baseVal.value,u.cy.baseVal.value,(u.rx||u.r).baseVal.value+N,(u.ry||u.r).baseVal.value+N,i);break;case"line":case"polygon":case"polyline":w=u.points||[{x:u.x1.baseVal.value,y:u.y1.baseVal.value},{x:u.x2.baseVal.value,y:u.y2.baseVal.value}];for(E=[],b=-1,g=w.numberOfItems||w.length;++b<g;)y=w.getItem?w.getItem(b):w[b],E.push.apply(E,[y.x,y.y]);E=x.polys.polygon(E,i);break;default:E=u.getBoundingClientRect(),E={width:E.width,height:E.height,position:{left:E.left,top:E.top}},c=!1}return S=E.position,a=a[0],c&&(a.createSVGPoint&&(d=u.getScreenCTM(),w=a.createSVGPoint(),w.x=S.left,w.y=S.top,v=w.matrixTransform(d),S.left=v.x,S.top=v.y),a.viewBox&&(m=a.viewBox.baseVal)&&m.width&&m.height&&(f*=h/m.width,l*=p/m.height)),S.left+=o.scrollLeft(),S.top+=o.scrollTop(),E},x.imagemap=function(e,t,n,i){t.jquery||(t=r(t));var o=t.attr("shape").toLowerCase().replace("poly","polygon"),u=r('img[usemap="#'+t.parent("map").attr("name")+'"]'),a=r.trim(t.attr("coords")),f=a.replace(/,$/,"").split(","),l,c,h,p,d,v;if(!u.length)return s;if(o==="polygon")d=x.polys.polygon(f,n);else{if(!x.polys[o])return s;for(h=-1,v=f.length,c=[];++h<v;)c.push(parseInt(f[h],10));d=x.polys[o].apply(this,c.concat(n))}return l=u.offset(),l.left+=Math.ceil((u.outerWidth(s)-u.width())/2),l.top+=Math.ceil((u.outerHeight(s)-u.height())/2),d.position.left+=l.left,d.position.top+=l.top,d};var At,Ot='<iframe class="qtip-bgiframe" frameborder="0" tabindex="-1" src="javascript:\'\';"  style="display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";"></iframe>';r.extend(Mt.prototype,{_scroll:function(){var t=this.qtip.elements.overlay;t&&(t[0].style.top=r(e).scrollTop()+"px")},init:function(n){var i=n.tooltip,s;r("select, object").length<1&&(this.bgiframe=n.elements.bgiframe=r(Ot).appendTo(i),n._bind(i,"tooltipmove",this.adjustBGIFrame,this._ns,this)),this.redrawContainer=r("<div/>",{id:T+"-rcontainer"}).appendTo(t.body),n.elements.overlay&&n.elements.overlay.addClass("qtipmodal-ie6fix")&&(n._bind(e,["scroll","resize"],this._scroll,this._ns,this),n._bind(i,["tooltipshow"],this._scroll,this._ns,this)),this.redraw()},adjustBGIFrame:function(){var e=this.qtip.tooltip,t={height:e.outerHeight(s),width:e.outerWidth(s)},n=this.qtip.plugins.tip,r=this.qtip.elements.tip,i,o;o=parseInt(e.css("borderLeftWidth"),10)||0,o={left:-o,top:-o},n&&r&&(i=n.corner.precedance==="x"?[f,h]:[l,c],o[i[1]]-=r[i[0]]()),this.bgiframe.css(o).css(t)},redraw:function(){if(this.qtip.rendered<1||this.drawing)return this;var e=this.qtip.tooltip,t=this.qtip.options.style,n=this.qtip.options.position.container,r,i,s,o;return this.qtip.drawing=1,t.height&&e.css(l,t.height),t.width?e.css(f,t.width):(e.css(f,"").appendTo(this.redrawContainer),i=e.width(),i%2<1&&(i+=1),s=e.css("maxWidth")||"",o=e.css("minWidth")||"",r=(s+o).indexOf("%")>-1?n.width()/100:0,s=(s.indexOf("%")>-1?r:1)*parseInt(s,10)||i,o=(o.indexOf("%")>-1?r:1)*parseInt(o,10)||0,i=s+o?Math.min(Math.max(i,o),s):i,e.css(f,Math.round(i)).appendTo(n)),this.drawing=0,this},destroy:function(){this.bgiframe&&this.bgiframe.remove(),this.qtip._unbind([e,this.qtip.tooltip],this._ns)}}),At=x.ie6=function(e){return F.ie===6?new Mt(e):s},At.initialize="render",S.ie6={"^content|style$":function(){this.redraw()}}})}(window,document),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){return t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.0",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this._constructor.apply(this,arguments),this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},_constructor:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=!0);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i],a instanceof d?o=u=a:o=a[h.prototype.idAttribute];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),u.on("all",this._onModelEvent,this),this._byId[u.cid]=u,u.id!=null&&(this._byId[u.id]=u)}x&&x.push(f||u)}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(i){var s=e.update?"update":e.reset?"reset":"set";n.include(["reset","set"],s)&&(r[s](i,e),typeof r._fetchPresence=="function"&&r._fetchPresence(),t&&t(r,i,e)),r.trigger("sync",r,i,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.get("useAPI")===!0&&(r.useAPI=!0),r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),typeof this._setUp=="function"&&this._setUp(e||{}),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events","layout","controller","parent","useAPI"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,x)),this.options=e},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);i&&i.apply(s,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e){return e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/[?#].*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,u=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),function(e,t){var n=e.I18n||{};n.defaultLocale="en",n.fallbacks=!1,n.defaultSeparator=".",n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,n.isValidNode=function(e,t,n){return e[t]!==null&&e[t]!==n},n.lookup=function(e,t){var t=t||{},r=e,i=n.prepareOptions(n.translations),s=i[t.locale||n.currentLocale()],t=n.prepareOptions(t),o;if(!s)return;typeof e=="object"&&(e=e.join(n.defaultSeparator)),t.scope&&(e=t.scope.toString()+n.defaultSeparator+e),e=e.split(n.defaultSeparator);while(e.length>0){o=e.shift(),s=s[o];if(!s){n.fallbacks&&!t.fallback&&(s=n.lookup(r,n.prepareOptions({locale:n.defaultLocale,fallback:!0},t)));break}}return!s&&n.isValidNode(t,"defaultValue")&&(s=t.defaultValue),s},n.prepareOptions=function(){var e={},t,r=arguments.length;for(var i=0;i<r;i++){t=arguments[i];if(!t)continue;for(var s in t)n.isValidNode(e,s)||(e[s]=t[s])}return e},n.interpolate=function(e,t){t=n.prepareOptions(t);var r=e.match(n.PLACEHOLDER),i,s,o;if(!r)return e;for(var u=0;i=r[u];u++)o=i.replace(n.PLACEHOLDER,"$1"),s=t[o],n.isValidNode(t,o)||(s="[missing "+i+" value]"),regex=new RegExp(i.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(regex,s);return e},n.translate=function(e,t){t=n.prepareOptions(t);var r=n.lookup(e,t);try{return typeof r=="object"?typeof t.count=="number"?n.pluralize(t.count,e,t):r:n.interpolate(r,t)}catch(i){return n.missingTranslation(e)}},n.localize=function(e,t){switch(e){case"currency":return n.toCurrency(t);case"number":return e=n.lookup("number.format"),n.toNumber(t,e);case"percentage":return n.toPercentage(t);default:return e.match(/^(date|time)/)?n.toTime(e,t):t.toString()}},n.parseDate=function(e){var t,n;if(typeof e=="object")return e;t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/);if(t){for(var r=1;r<=6;r++)t[r]=parseInt(t[r],10)||0;t[2]-=1,t[7]?n=new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):n=new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else typeof e=="number"?(n=new Date,n.setTime(e)):e.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(n=new Date,n.setTime(Date.parse(e))):(n=new Date,n.setTime(Date.parse(e)));return n},n.toTime=function(e,t){var r=n.parseDate(t),i=n.lookup(e);return r.toString().match(/invalid/i)?r.toString():i?n.strftime(r,i):r.toString()},n.strftime=function(e,t){var r=n.lookup("date");if(!r)return e.toString();r.meridian=r.meridian||["AM","PM"];var i=e.getDay(),s=e.getDate(),o=e.getFullYear(),u=e.getMonth()+1,a=e.getHours(),f=a,l=a>11?1:0,c=e.getSeconds(),h=e.getMinutes(),p=e.getTimezoneOffset(),d=Math.floor(Math.abs(p/60)),v=Math.abs(p)-d*60,m=(p>0?"-":"+")+(d.toString().length<2?"0"+d:d)+(v.toString().length<2?"0"+v:v);f>12?f-=12:f===0&&(f=12);var g=function(e){var t="0"+e.toString();return t.substr(t.length-2)},y=t;return y=y.replace("%a",r.abbr_day_names[i]),y=y.replace("%A",r.day_names[i]),y=y.replace("%b",r.abbr_month_names[u]),y=y.replace("%B",r.month_names[u]),y=y.replace("%d",g(s)),y=y.replace("%e",s),y=y.replace("%-d",s),y=y.replace("%H",g(a)),y=y.replace("%-H",a),y=y.replace("%I",g(f)),y=y.replace("%-I",f),y=y.replace("%m",g(u)),y=y.replace("%-m",u),y=y.replace("%M",g(h)),y=y.replace("%-M",h),y=y.replace("%p",r.meridian[l]),y=y.replace("%S",g(c)),y=y.replace("%-S",c),y=y.replace("%w",i),y=y.replace("%y",g(o)),y=y.replace("%-y",g(o).replace(/^0+/,"")),y=y.replace("%Y",o),y=y.replace("%z",m),y},n.toNumber=function(e,t){t=n.prepareOptions(t,n.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var r=e<0,i=Math.abs(e).toFixed(t.precision).toString(),s=i.split("."),o,u=[],a;e=s[0],o=s[1];while(e.length>0)u.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);a=u.join(t.delimiter),t.precision>0&&(a+=t.separator+s[1]),r&&(a="-"+a);if(t.strip_insignificant_zeros){var f={separator:new RegExp(t.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};a=a.replace(f.zeros,"").replace(f.separator,"")}return a},n.toCurrency=function(e,t){return t=n.prepareOptions(t,n.lookup("number.currency.format"),n.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=n.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e),e},n.toHumanSize=function(e,t){var r=1024,i=e,s=0,o,u;while(i>=r&&s<4)i/=r,s+=1;return s===0?(o=n.t("number.human.storage_units.units.byte",{count:i}),u=0):(o=n.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][s]),u=i-Math.floor(i)===0?0:1),t=n.prepareOptions(t,{precision:u,format:"%n%u",delimiter:""}),e=n.toNumber(i,t),e=t.format.replace("%u",o).replace("%n",e),e},n.toPercentage=function(e,t){return t=n.prepareOptions(t,n.lookup("number.percentage.format"),n.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=n.toNumber(e,t),e+"%"},n.pluralize=function(e,t,r){var i;try{i=n.lookup(t,r)}catch(s){}if(!i)return n.missingTranslation(t);var o;r=n.prepareOptions(r),r.count=e.toString();switch(Math.abs(e)){case 0:o=n.isValidNode(i,"zero")?i.zero:n.isValidNode(i,"none")?i.none:n.isValidNode(i,"other")?i.other:n.missingTranslation(t,"zero");break;case 1:o=n.isValidNode(i,"one")?i.one:n.missingTranslation(t,"one");break;default:o=n.isValidNode(i,"other")?i.other:n.missingTranslation(t,"other")}return n.interpolate(o,r)},n.missingTranslation=function(){var e='[missing "'+n.currentLocale(),t=arguments.length;for(var r=0;r<t;r++)e+="."+arguments[r];return e+='" translation]',e},n.currentLocale=function(){return n.locale||n.defaultLocale},n.t=n.translate,n.l=n.localize,n.p=n.pluralize,typeof define=="function"&&define.amd&&define("require/i18n-js",[],function(){return n})}(this),define("modules/backbone/super",["underscore"],function(e){var t=function(e){throw"Super does not implement this method: "+e},n=function(){},r=function(r,i,s){var o,u=r.prototype,a=/\b_super\b/;i&&i.hasOwnProperty("constructor")?o=i.constructor:o=function(){return r.apply(this,arguments)},e.extend(o,r,s),n.prototype=r.prototype,o.prototype=new n;if(i){e.extend(o.prototype,i);for(var f in i)typeof i[f]=="function"&&a.test(i[f])&&(o.prototype[f]=function(e,n){var r=function(){var r=this._super;this._super=u[e]||t(e);var i;try{i=n.apply(this,arguments)}finally{this._super=r}return i};for(var i in n)r[i]=n[i],delete n[i];return r}(f,i[f]))}return s&&e.extend(o,s),o.prototype.constructor=o,o.__super__=r.prototype,o};return function(e,t){var n=r(this,e,t);return n.extend=this.extend,n}}),define("routes",[],function(){return function(){var e=requirejs("tibbr"),t={"":"index","client-stream":"index","!/users/*path":"users","!/subjects/*path":"subjects","!/messages/*path":"messages","!/explore/*path":"explore","!/apps/*path":"apps","!/applications/*path":"applications","!/files/*path":"files","!/groups/*path":"groups","!/insight/*path":"analytics","!/static_pages/*path":"static_pages","!/subscribe/*path":"subscribe","!/help_center/*path":"help_center","!/developer_center/*path":"developer_center","!/admin/*path":"admin","!/logout":"logout"};return e.configuration.get("ui_config","config","features","resources",{"default":!1})&&(t["!/resources/*path"]="resources"),t["*any"]="unmatched",t}}),define("require/md5",[],function(){return function(){var e=0,t="",n=8,r=function(e,t){var n=(e&65535)+(t&65535),r=(e>>16)+(t>>16)+(n>>16);return r<<16|n&65535},i=function(e,t){return e<<t|e>>>32-t},s=function(e){var t=[],r=(1<<n)-1;for(var i=0;i<e.length*n;i+=n)t[i>>5]|=(e.charCodeAt(i/n)&r)<<i%32;return t},o=function(e){var t="",r=(1<<n)-1;for(var i=0;i<e.length*32;i+=n)t+=String.fromCharCode(e[i>>5]>>>i%32&r);return t},u=function(t){var n=e?"0123456789ABCDEF":"0123456789abcdef",r="";for(var i=0;i<t.length*4;i++)r+=n.charAt(t[i>>2]>>i%4*8+4&15)+n.charAt(t[i>>2]>>i%4*8&15);return r},a=function(e){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",i,s;for(var o=0;o<e.length*4;o+=3){i=(e[o>>2]>>8*(o%4)&255)<<16|(e[o+1>>2]>>8*((o+1)%4)&255)<<8|e[o+2>>2]>>8*((o+2)%4)&255;for(s=0;s<4;s++)o*8+s*6>e.length*32?r+=t:r+=n.charAt(i>>6*(3-s)&63)}return r},f=function(e,t,n,s,o,u){return r(i(r(r(t,e),r(s,u)),o),n)},l=function(e,t,n,r,i,s,o){return f(t&n|~t&r,e,t,i,s,o)},c=function(e,t,n,r,i,s,o){return f(t&r|n&~r,e,t,i,s,o)},h=function(e,t,n,r,i,s,o){return f(t^n^r,e,t,i,s,o)},p=function(e,t,n,r,i,s,o){return f(n^(t|~r),e,t,i,s,o)},d=function(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var n=1732584193,i=-271733879,s=-1732584194,o=271733878,u,a,f,d;for(var v=0;v<e.length;v+=16)u=n,a=i,f=s,d=o,n=l(n,i,s,o,e[v+0],7,-680876936),o=l(o,n,i,s,e[v+1],12,-389564586),s=l(s,o,n,i,e[v+2],17,606105819),i=l(i,s,o,n,e[v+3],22,-1044525330),n=l(n,i,s,o,e[v+4],7,-176418897),o=l(o,n,i,s,e[v+5],12,1200080426),s=l(s,o,n,i,e[v+6],17,-1473231341),i=l(i,s,o,n,e[v+7],22,-45705983),n=l(n,i,s,o,e[v+8],7,1770035416),o=l(o,n,i,s,e[v+9],12,-1958414417),s=l(s,o,n,i,e[v+10],17,-42063),i=l(i,s,o,n,e[v+11],22,-1990404162),n=l(n,i,s,o,e[v+12],7,1804603682),o=l(o,n,i,s,e[v+13],12,-40341101),s=l(s,o,n,i,e[v+14],17,-1502002290),i=l(i,s,o,n,e[v+15],22,1236535329),n=c(n,i,s,o,e[v+1],5,-165796510),o=c(o,n,i,s,e[v+6],9,-1069501632),s=c(s,o,n,i,e[v+11],14,643717713),i=c(i,s,o,n,e[v+0],20,-373897302),n=c(n,i,s,o,e[v+5],5,-701558691),o=c(o,n,i,s,e[v+10],9,38016083),s=c(s,o,n,i,e[v+15],14,-660478335),i=c(i,s,o,n,e[v+4],20,-405537848),n=c(n,i,s,o,e[v+9],5,568446438),o=c(o,n,i,s,e[v+14],9,-1019803690),s=c(s,o,n,i,e[v+3],14,-187363961),i=c(i,s,o,n,e[v+8],20,1163531501),n=c(n,i,s,o,e[v+13],5,-1444681467),o=c(o,n,i,s,e[v+2],9,-51403784),s=c(s,o,n,i,e[v+7],14,1735328473),i=c(i,s,o,n,e[v+12],20,-1926607734),n=h(n,i,s,o,e[v+5],4,-378558),o=h(o,n,i,s,e[v+8],11,-2022574463),s=h(s,o,n,i,e[v+11],16,1839030562),i=h(i,s,o,n,e[v+14],23,-35309556),n=h(n,i,s,o,e[v+1],4,-1530992060),o=h(o,n,i,s,e[v+4],11,1272893353),s=h(s,o,n,i,e[v+7],16,-155497632),i=h(i,s,o,n,e[v+10],23,-1094730640),n=h(n,i,s,o,e[v+13],4,681279174),o=h(o,n,i,s,e[v+0],11,-358537222),s=h(s,o,n,i,e[v+3],16,-722521979),i=h(i,s,o,n,e[v+6],23,76029189),n=h(n,i,s,o,e[v+9],4,-640364487),o=h(o,n,i,s,e[v+12],11,-421815835),s=h(s,o,n,i,e[v+15],16,530742520),i=h(i,s,o,n,e[v+2],23,-995338651),n=p(n,i,s,o,e[v+0],6,-198630844),o=p(o,n,i,s,e[v+7],10,1126891415),s=p(s,o,n,i,e[v+14],15,-1416354905),i=p(i,s,o,n,e[v+5],21,-57434055),n=p(n,i,s,o,e[v+12],6,1700485571),o=p(o,n,i,s,e[v+3],10,-1894986606),s=p(s,o,n,i,e[v+10],15,-1051523),i=p(i,s,o,n,e[v+1],21,-2054922799),n=p(n,i,s,o,e[v+8],6,1873313359),o=p(o,n,i,s,e[v+15],10,-30611744),s=p(s,o,n,i,e[v+6],15,-1560198380),i=p(i,s,o,n,e[v+13],21,1309151649),n=p(n,i,s,o,e[v+4],6,-145523070),o=p(o,n,i,s,e[v+11],10,-1120210379),s=p(s,o,n,i,e[v+2],15,718787259),i=p(i,s,o,n,e[v+9],21,-343485551),n=r(n,u),i=r(i,a),s=r(s,f),o=r(o,d);return[n,i,s,o]},v=function(e,t){var r=s(e);r.length>16&&(r=d(r,e.length*n));var i=new Array(16),o=new Array(16);for(var u=0;u<16;u++)i[u]=r[u]^909522486,o[u]=r[u]^1549556828;var a=d(i.concat(s(t)),512+t.length*n);return d(o.concat(a),640)},m={hexdigest:function(e){return u(d(s(e),e.length*n))},b64digest:function(e){return a(d(s(e),e.length*n))},hash:function(e){return o(d(s(e),e.length*n))},hmac_hexdigest:function(e,t){return u(v(e,t))},hmac_b64digest:function(e,t){return a(v(e,t))},hmac_hash:function(e,t){return o(v(e,t))},test:function(){return MD5.hexdigest("abc")==="900150983cd24fb0d6963f7d28e17f72"}};return m}()}),define("modules/cache",["jquery","require/md5"],function(e,t){return{getOrFetch:function(n){n=n||{};var r=this,i=_.isUndefined(n.cache)?!0:n.cache,s=n.cacheKey||this.cacheKey||t.hexdigest(n),o=r.dataSet.read(s),u=e.Deferred(),a=n.expire_after||5;return r.forCache=!1,delete n.cacheKey,i?_.isEmpty(o)?this.fetch(n).done(function(e){r.dataSet.write(s,e,a),u.resolve(e)}).fail(function(e){u.reject(e)}):(r.forCache=!0,this._set(o,n),u.resolve(o)):this.fetch(n).done(function(e){u.resolve(e)}).fail(function(e){u.reject(e)}),u.promise()}}}),define("require/moment",[],function(){return function(e,t){function M(e,t,n,r){var i=n.lang();return i[e].call?i[e](n,r):i[e][t]}function _(e,t){return function(n){return j(e.call(this,n),t)}}function D(e){return function(t){var n=e.call(this,t);return n+this.lang().ordinal(n)}}function P(e,t,n){this._d=e,this._isUTC=!!t,this._a=e._a||null,this._lang=n||!1}function H(e){var t=this._data={},n=e.years||e.y||0,r=e.months||e.M||0,i=e.weeks||e.w||0,s=e.days||e.d||0,o=e.hours||e.h||0,u=e.minutes||e.m||0,a=e.seconds||e.s||0,f=e.milliseconds||e.ms||0;this._milliseconds=f+a*1e3+u*6e4+o*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=f%1e3,a+=B(f/1e3),t.seconds=a%60,u+=B(a/60),t.minutes=u%60,o+=B(u/60),t.hours=o%24,s+=B(o/24),s+=i*7,t.days=s%30,r+=B(s/30),t.months=r%12,n+=B(r/12),t.years=n,this._lang=!1}function B(e){return e<0?Math.ceil(e):Math.floor(e)}function j(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function F(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function I(e){return Object.prototype.toString.call(e)==="[object Array]"}function q(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function R(t,n,r,i){var s,o,u=[];for(s=0;s<7;s++)u[s]=t[s]=t[s]==null?s===2?1:0:t[s];return t[7]=u[7]=n,t[8]!=null&&(u[8]=t[8]),t[3]+=r||0,t[4]+=i||0,o=new e(0),n?(o.setUTCFullYear(t[0],t[1],t[2]),o.setUTCHours(t[3],t[4],t[5],t[6])):(o.setFullYear(t[0],t[1],t[2]),o.setHours(t[3],t[4],t[5],t[6])),o._a=u,o}function U(e,t){var r,i,s=[];!t&&a&&(t=require("./lang/"+e));for(r=0;r<f.length;r++)t[f[r]]=t[f[r]]||o.en[f[r]];for(r=0;r<12;r++)i=n([2e3,r]),s[r]=new RegExp("^"+(t.months[r]||t.months(i,""))+"|^"+(t.monthsShort[r]||t.monthsShort(i,"")).replace(".",""),"i");return t.monthsParse=t.monthsParse||s,o[e]=t,t}function z(e){var t=typeof e=="string"&&e||e&&e._lang||null;return t?o[t]||U(t):n}function W(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function X(e){var t=e.match(c),n,r;for(n=0,r=t.length;n<r;n++)O[t[n]]?t[n]=O[t[n]]:t[n]=W(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function V(e,t){function r(t){return e.lang().longDateFormat[t]||t}var n=5;while(n--&&h.test(t))t=t.replace(h,r);return k[t]||(k[t]=X(t)),k[t](e)}function $(e){switch(e){case"DDDD":return m;case"YYYY":return g;case"S":case"SS":case"SSS":case"DDD":return v;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return y;case"Z":case"ZZ":return b;case"T":return w;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return d;default:return new RegExp(e.replace("\\",""))}}function J(e,t,n,r){var i,s;switch(e){case"M":case"MM":n[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":for(i=0;i<12;i++)if(z().monthsParse[i].test(t)){n[1]=i,s=!0;break}s||(n[8]=!1);break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(n[2]=~~t);break;case"YY":n[0]=~~t+(~~t>70?1900:2e3);break;case"YYYY":n[0]=~~Math.abs(t);break;case"a":case"A":r.isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":n[3]=~~t;break;case"m":case"mm":n[4]=~~t;break;case"s":case"ss":n[5]=~~t;break;case"S":case"SS":case"SSS":n[6]=~~(("0."+t)*1e3);break;case"Z":case"ZZ":r.isUTC=!0,i=(t+"").match(T),i&&i[1]&&(r.tzh=~~i[1]),i&&i[2]&&(r.tzm=~~i[2]),i&&i[0]==="+"&&(r.tzh=-r.tzh,r.tzm=-r.tzm)}t==null&&(n[8]=!1)}function K(e,t){var n=[0,0,1,0,0,0,0],r={tzh:0,tzm:0},i=t.match(c),s,o;for(s=0;s<i.length;s++)o=($(i[s]).exec(e)||[])[0],o&&(e=e.slice(e.indexOf(o)+o.length)),O[i[s]]&&J(i[s],o,n,r);return r.isPm&&n[3]<12&&(n[3]+=12),r.isPm===!1&&n[3]===12&&(n[3]=0),R(n,r.isUTC,r.tzh,r.tzm)}function Q(e,t){var n,r=e.match(p)||[],i,s=99,o,u,a;for(o=0;o<t.length;o++)u=K(e,t[o]),i=V(new P(u),t[o]).match(p)||[],a=q(r,i),a<s&&(s=a,n=u);return n}function G(t){var n="YYYY-MM-DDT",r;if(E.exec(t)){for(r=0;r<4;r++)if(x[r][1].exec(t)){n+=x[r][0];break}return b.exec(t)?K(t,n+" Z"):K(t,n)}return new e(t)}function Y(e,t,n,r,i){var s=i.relativeTime[e];return typeof s=="function"?s(t||1,!!n,e,r):s.replace(/%d/i,t||1)}function Z(e,t,n){var r=i(Math.abs(e)/1e3),s=i(r/60),o=i(s/60),u=i(o/24),a=i(u/365),f=r<45&&["s",r]||s===1&&["m"]||s<45&&["mm",s]||o===1&&["h"]||o<22&&["hh",o]||u===1&&["d"]||u<=25&&["dd",u]||u<=45&&["M"]||u<345&&["MM",i(u/30)]||a===1&&["y"]||["yy",a];return f[2]=t,f[3]=e>0,f[4]=n,Y.apply({},f)}function tt(e,t){n.fn[e]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}function nt(e){n.duration.fn[e]=function(){return this._data[e]}}function rt(e,t){n.duration.fn["as"+e]=function(){return+this/t}}var n,r="1.7.2",i=Math.round,s,o={},u="en",a=typeof module!="undefined",f="months|monthsShort|weekdays|weekdaysShort|weekdaysMini|longDateFormat|calendar|relativeTime|ordinal|meridiem".split("|"),l=/^\/?Date\((\-?\d+)/i,c=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|zz?|ZZ?|.)/g,h=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?)/g,p=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,d=/\d\d?/,v=/\d{1,3}/,m=/\d{3}/,g=/\d{1,4}/,y=/[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+/i,b=/Z|[\+\-]\d\d:?\d\d/i,w=/T/i,E=/^\s*\d{4}-\d\d-\d\d(T(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,S="YYYY-MM-DDTHH:mm:ssZ",x=[["HH:mm:ss.S",/T\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/T\d\d:\d\d:\d\d/],["HH:mm",/T\d\d:\d\d/],["HH",/T\d\d/]],T=/([\+\-]|\d\d)/gi,N="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),C={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},k={},L="DDD w M D d".split(" "),A="M D H h m s w".split(" "),O={M:function(){return this.month()+1},MMM:function(e){return M("monthsShort",this.month(),this,e)},MMMM:function(e){return M("months",this.month(),this,e)},D:function(){return this.date()},DDD:function(){var t=new e(this.year(),this.month(),this.date()),n=new e(this.year(),0,1);return~~((t-n)/864e5+1.5)},d:function(){return this.day()},dd:function(e){return M("weekdaysMini",this.day(),this,e)},ddd:function(e){return M("weekdaysShort",this.day(),this,e)},dddd:function(e){return M("weekdays",this.day(),this,e)},w:function(){var t=new e(this.year(),this.month(),this.date()-this.day()+5),n=new e(t.getFullYear(),0,4);return~~((t-n)/864e5/7+1.5)},YY:function(){return j(this.year()%100,2)},YYYY:function(){return j(this.year(),4)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return j(~~(this.milliseconds()/10),2)},SSS:function(){return j(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(e/60),2)+":"+j(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+j(~~(10*e/6),4)}};while(L.length)s=L.pop(),O[s+"o"]=D(O[s]);while(A.length)s=A.pop(),O[s+s]=_(O[s],2);O.DDDD=_(O.DDD,3),n=function(r,i){if(r===null||r==="")return null;var s,o;return n.isMoment(r)?new P(new e(+r._d),r._isUTC,r._lang):(i?I(i)?s=Q(r,i):s=K(r,i):(o=l.exec(r),s=r===t?new e:o?new e(+o[1]):r instanceof e?r:I(r)?R(r):typeof r=="string"?G(r):new e(r)),new P(s))},n.utc=function(e,t){return I(e)?new P(R(e,!0),!0):(typeof e=="string"&&!b.exec(e)&&(e+=" +0000",t&&(t+=" Z")),n(e,t).utc())},n.unix=function(e){return n(e*1e3)},n.duration=function(e,t){var r=n.isDuration(e),i=typeof e=="number",s=r?e._data:i?{}:e,o;return i&&(t?s[t]=e:s.milliseconds=e),o=new H(s),r&&(o._lang=e._lang),o},n.humanizeDuration=function(e,t,r){return n.duration(e,t===!0?null:t).humanize(t===!0?!0:r)},n.version=r,n.defaultFormat=S,n.lang=function(e,t){var r;if(!e)return u;(t||!o[e])&&U(e,t);if(o[e]){for(r=0;r<f.length;r++)n[f[r]]=o[e][f[r]];n.monthsParse=o[e].monthsParse,u=e}},n.langData=z,n.isMoment=function(e){return e instanceof P},n.isDuration=function(e){return e instanceof H};var et=I18n.translations[I18n.locale]||{defaults:{date:{months:"January_February_March_April_May_June_July_August_September_October_November_December",monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday",weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat",weekdaysMini:"Su_Mo_Tu_We_Th_Fr_Sa",longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"MMMM D, YYYY [at] LT",LLLLLLL:"MMMM D, YYYY [at] H:mm",LLLLL:"YYYY-MM-DD",LLLLLL:"MMMM D, YYYY LT",MMMDD:"MMM DD",D:"MMMM Do YYYY",DD:"MMMM Do YYYY, LT",T:"[Today at] LT",TTT:"[Today at] H:mm",DDD:"D m/d/yy",DDDD:"ddd M/DD/YYYY",TT:"g:ia",TTTT:"H:i",hhh:"h:mma",hhhh:"H:mm",WW:"HH:mm",MMMM:"Week of M/DD/YY",YYYY:"MMM",WWWW:"ddd",DDDDD:"dddd, MMMM D"},calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},timeFormat:{H:"h:mm A"},am_pm:{AM:"AM",am:"am",PM:"PM",pm:"pm"},relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years",today:"Today at h:mm"}},time:{m:"%{number} mins",h:"1 hr",hh:"%{number} hrs"},calendar:{closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,showMonthAfterYear:!1,yearSuffix:""}}};et.defaults.date.months=et.defaults.date.months.split("_"),et.defaults.date.monthsShort=et.defaults.date.monthsShort.split("_"),et.defaults.date.weekdays=et.defaults.date.weekdays.split("_"),et.defaults.date.weekdaysShort=et.defaults.date.weekdaysShort.split("_"),et.defaults.date.weekdaysMini=et.defaults.date.weekdaysMini.split("_"),et.defaults.date.ordinal=function(e){var t=e%10;return~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th"},et.defaults.date.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},n.lang("en",et.defaults.date),n.fn=P.prototype={clone:function(){return n(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this._d.toString()},toDate:function(){return this._d},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds(),!!this._isUTC]},isValid:function(){return this._a?this._a[8]!=null?!!this._a[8]:!q(this._a,(this._a[7]?n.utc(this._a):n(this._a)).toArray()):!isNaN(this._d.getTime())},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){return V(this,e?e:n.defaultFormat)},add:function(e,t){var r=t?n.duration(+t,e):n.duration(e);return F(this,r,1),this},subtract:function(e,t){var r=t?n.duration(+t,e):n.duration(e);return F(this,r,-1),this},diff:function(e,t,r){var s=this._isUTC?n(e).utc():n(e).local(),o=(this.zone()-s.zone())*6e4,u=this._d-s._d-o,a=this.year()-s.year(),f=this.month()-s.month(),l=this.date()-s.date(),c;return t==="months"?c=a*12+f+l/30:t==="years"?c=a+(f+l/30)/12:c=t==="seconds"?u/1e3:t==="minutes"?u/6e4:t==="hours"?u/36e5:t==="days"?u/864e5:t==="weeks"?u/6048e5:u,r?c:i(c)},from:function(e,t){return n.duration(this.diff(e)).lang(this._lang).humanize(!t)},fromNow:function(e){return this.from(n(),e)},calendar:function(){var e=this.diff(n().sod(),"days",!0),t=this.lang().calendar,r=t.sameElse,i=e<-6?r:e<-1?t.lastWeek:e<0?t.lastDay:e<1?t.sameDay:e<2?t.nextDay:e<7?t.nextWeek:r;return this.format(typeof i=="function"?i.apply(this):i)},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<n([this.year()]).zone()||this.zone()<n([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){switch(e.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},sod:function(){return this.clone().startOf("day")},eod:function(){return this.clone().endOf("day")},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return n.utc([this.year(),this.month()+1,0]).date()},lang:function(e){return e===t?z(this):(this._lang=e,this)}};for(s=0;s<N.length;s++)tt(N[s].toLowerCase(),N[s]);tt("year","FullYear"),n.duration.fn=H.prototype={weeks:function(){return B(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=this.lang().relativeTime,r=Z(t,!e,this.lang()),i=t<=0?n.past:n.future;return e&&(typeof i=="function"?r=i(r):r=i.replace(/%s/i,r)),r},lang:n.fn.lang};for(s in C)C.hasOwnProperty(s)&&(rt(s,C[s]),nt(s.toLowerCase()));return rt("Weeks",6048e5),e.prototype.toArray=function(){return n(this).format("YYYY-MM-DD-HH-mm-ss").split("-")},e.prototype.toDateOnlyArray=function(){return n(this).format("YYYY-MM-DD").split("-")},n}(Date)}),define("modules/store",["underscore","require/moment"],function(e,t){var n=function(){this.storage=!1,this._data={}};return n.prototype={storeInMemory:["server:features","current_user:user","current_user:preferences"],useStorage:function(t){return this.storage&&!e.include(this.storeInMemory,t)},localStorage:function(){return window.localStorage},reset:function(){return this._data={}},key:function(e,t){return t+":"+e},find:function(e,t){return this.read(this.key(e,t))},set:function(e){return this.write(this.key(e.id,e.scope),e)},read:function(e){if(this.useStorage(e))return this.toJSON(this.localStorage().getItem(e));var t=this._data[e]||{};return t._expires_at?new Date<=t._expires_at?t:(this.clear(e),{}):t},write:function(t,n,r){return n=e.isObject(n)?n:{data:n},r&&this.setExpire(n,r),this.useStorage(t)?this.localStorage().setItem(t,JSON.stringify(n)):this._data[t]=n},setExpire:function(n,r){if(e.isNumber(r))n._expires_at=t().add("minutes",r).toDate();else{var i=r.split(".");n._expires_at=t().add(i[1],parseInt(i[0])).toDate(),console.log(t().toDate(),n._expires_at,i[1])}},clear:function(e){this.useStorage(e)?this.localStorage().removeItem(e):(this._data[e]=null,delete this._data[e])},get:function(e,t){return this.find(e,t).data},toJSON:function(e){return e=e||"{}",JSON.parse(e)}},n}),define("config/app_config",[],function(){var e=[{name:"tibcast",enable:!0,url:"https://tibco.vivu.tv",type:["video","webinar","audio","conference"],"public":!1},{name:"branding",enable:!1,logo_url:null,icon_url:null},{name:"groups",enable:!0,interactive_groups:!0},{name:"sharepoint",enable:!0},{name:"subject_maps",enable:!0},{name:"site",config:{site_root:"http://dev.tibbr.com/",prod_name:"Tibbr Dev",company_name:"TIBCO Software Inc.",version:"__build_version__"}},{name:"poll",config:{max_expiry_days:365,default_expiry_days:3}},{name:"manage_pages_by_owners",config:!1},{name:"authentication",type:"default"},{name:"users",hierarchy:{enable:!0}},{geo_location:{enabled:!0,default_location:{latitude:"37.40641979999999",longitude:"-122.1453866"}},visibility:{enabled:!1},manage_pages_by_owners:{enabled:!0},name:"subjects"},{name:"maps",enabled:!0,api_key:null},{name:"locales",locales:[{key:"en",name:"English"},{key:"de",name:"Deutsch"},{key:"es",name:"Español"},{key:"fr-CA",name:"Français(Canada)"},{key:"fr",name:"Français"},{key:"ja",name:"日本語"},{key:"nl",name:"Engels"},{key:"pt-BR",name:"Português (Brasil)"},{key:"sv",name:"Engelska"},{key:"zh-CN",name:"中文"}]},{name:"client_stream",config:{rss:{100:{description_chars:240}},linked_in:{100:{client_config:{app_id:"qkwwkfnxos49"},type:"client"}},facebook:{100:{client_config:{app_id:0xa46c450d70ca,channel_url:"http://127.0.0.1:3000/fb.html"},type:"client"}},twitter:{100:{client_config:{app_id:"mwFrIur5BhBVFvrbZOZ0A"},type:"client"}},rss_client:{100:{client_config:{app_id:null,host_url:"/web/"},type:"client"}},"voice memo":{100:{title:"Play memo"}},"oracle expenses":{100:{system_user:"tibbradmin"}},"oracle order management":{100:{db_credential:{server:"115.248.179.171",port:1521,sid:"VIS",username:"apps",password:"apps"}}},"oracle timesheet":{100:{system_user:"timesheet"}}}},{name:"chat",enable:!0,url:"/http-bind",domain:"tibbr"},{name:"webui",config:{url_prefix:null,enable_lync:!1,subject_analytics:!1,wall_cache:{enabled:!1},secret_key:"321312#@!sds123123adasd7657657587asdaskmklmkldsmskcmdskslmcdkls",about_path:"http://silver.tibco.com/tibbr/",privacy_path:"http://www.tibco.com/company/privacy.jsp",theme:"tibbr",auto_complete:{post:{followers_only:!1}},menu:{apps:"enabled",logout:"enabled",invite_colleague:"enabled",video_conference:"disabled",orcale_stream:"disabled"},check_terms:!1,hide_landing:!0,onboarding:{enabled:!1,url:""},signature:!0,password_control:"master",slave_password_text:"Authentication is done against your corporate LDAP server. Please change the password in LDAP system.",join_tibbr:!0,wall_polling_interval:300,featured_user:"tibbradmin",minimum_subjects_required:5,minimum_people_required:5,max_attachment:10,google_tracking:{enabled:!1,tracking_code:"AB-12345678-1"},stream_name_maxlength:50,keyword_textbox_maxlength:50,right_nav:"enabled",welcome_panel:{title:"New to tibbr?",links:[{name:"got_iphone",link:"/static_pages/iphone",image:"iphone.jpg",big_image:"iphone.png",show_inline:!0,append_root:!0,login:!0},{name:"got_android",link:"/static_pages/android",image:"android.jpg",big_image:"android.png",show_inline:!0,append_root:!0,login:!0},{name:"got_blackberry",link:"/static_pages/blackberry",image:"blackberry.jpg",big_image:"blackberry.png",show_inline:!0,append_root:!0,login:!0},{name:"tibbr_desktop",link:"/static_pages/desktop",download_links:{windows:"/downloads/tibbrDesktop.exe",mac:"/downloads/tibbrDesktop.dmg"},image:"desktop.png",big_image:"desktop-icon.png",show_inline:!0},{name:"developer",link:"http://developer.tibbr.com",image:"learn tibbr.jpg",big_image:"learn_tibbr.png"},{name:"documentation",link:"/doc/index.htm",image:"docs.png",big_image:"document-icon.png",append_root:!0,login:!0}]}}},{name:"evaluation",config:{enabled:!1}},{name:"ui_config",config:{top_menu_bar:!1,admin_url:"/web/sessions/go_to_admin",disable_file_upload:!0,per_page:{subject_directory:20,user_directory:20},rich_text:{enable:!0,tool_bar:["bold","italic","underline","unorderedlist","orderedlist"],allowed_tags:["span","br","p","b","i","del","strike","u","blockquote","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","strong","em","h1","h2","h3","h4","h5","h6"]},features:{apps:{enable:!0,users:!0},meetings:{enable:!0,users:!0},marketplace:{enable:!0,users:!0},influence:{enable:!0},skills:{enable:!0,read_only:!1},linked_in:{enable:!0},showcase:{enable:!0},upload_to_tibbr:{enable:!0}},search_on:["messages","subjects","users","groups"],menu_bar:[{key:"home",link:"#",display:!0},{key:"subjects",link:"/subjects/",display:!0},{key:"people",link:"/explore/",display:!0},{key:"groups",link:"/groups/",display:!0},{key:"profile",link:"/users/profile",display:!0},{key:"apps",link:"/apps/",display:!0}],right_nav:{order_by:"items",render_in:"tabs",items:[{key:"timeline",handler:"timeLine",show_on:"subjects:show",enable:!1,is_customizable:!0},{key:"new_to_tibbr",handler:"newToTibbr",show_on:"home:index, messages:filters",enable:!0,is_customizable:!0},{key:"new_to_tibbr",handler:"newToTibbrProgress",show_on:"home:index, messages:filters",enable:!1,is_customizable:!0},{key:"my_home",handler:"buildNav",url:"http://www.tibbr.com/page_{{I18n.locale}}.html",show_on:"home:index",style:"border:1px",enable:!1},{key:"what_happening",handler:"whatHappening",show_on:"home:index, messages:filters",enable:!0},{key:"announcement",handler:"announcement",show_on:"home:index, subjects:show, messages:filters",enable:!0,can_remove:!1},{key:"popular_conversations",handler:"popularConversations",show_on:"home:index, messages:filters",enable:!0},{key:"followers",handler:"followers",show_on:"resources:show",enable:!0,can_remove:!1},{key:"resource_likes",handler:"ResourceLikes",show_on:"resources:show",enable:!0,can_remove:!1},{key:"resource_shares",handler:"ResourceShares",show_on:"resources:show",enable:!0,can_remove:!1},{key:"resource_insights",handler:"ResourceInsights",show_on:"apps:resources",enable:!0,can_remove:!1},{key:"owners",handler:"owners",show_on:"resources:show",enable:!0,can_remove:!1},{key:"upcoming_events",handler:"upcomingEvents",show_on:"home:index, subjects:show",enable:!0},{key:"subject_links",handler:"subjectLinks",show_on:"subjects:show, resources:show",enable:!0},{key:"subject_assets",handler:"subjectAssets",show_on:"subjects:show, resources:show",enable:!0},{key:"stat_meter",handler:"evalStatistics",show_on:"home:index, messages:filters",enable:"config('evaluation','config','enabled')",can_remove:!1},{key:"contact_sales",handler:"contactSales",show_on:"home:index, messages:filters",enable:"config('evaluation','config','enabled')",can_remove:!1},{key:"share_on_tibbr",handler:"shareOnTibbr",show_on:"home:index, messages:filters",enable:!0},{key:"recent_subjects",handler:"recentSubjects",show_on:"home:index,messages:filters",enable:!0},{key:"popular_subjects",handler:"popularSubjects",show_on:"home:index, messages:filters",enable:!0},{key:"invite_to_tibbr",handler:"inviteToTibbr",show_on:"home:index, messages:filters",enable:!1},{key:"social_widgets",handler:"followUsOn",show_on:"home:index",enable:!1},{key:"subjects_with_most_activity",handler:"subjectsMostActivity",show_on:"subjects:index, subjects:directory, subjects:my_subjects",enable:!0,can_remove:!1},{key:"subjects_with_most_followers",handler:"subjectsMostFollowers",show_on:"subjects:index, subjects:directory, subjects:my_subjects",enable:!0,can_remove:!1},{key:"users_with_most_activity",handler:"usersMostActivity",show_on:"explore:index, explore:people_directory, explore:my_people",enable:!0,can_remove:!1},{key:"users_with_most_followers",handler:"usersMostFollowers",show_on:"explore:index, explore:people_directory, explore:my_people",enable:!0,can_remove:!1}]},home:{left_nav:[{my_wall:{enable:!0}},{all_post:{enable:!0}},{"private":{enable:!0}},{star:{enable:!0}},{question:{enable:!0}},{chat:{enable:!0}}],menu:[{key:"main_wall",enable:!0,open:"down",url:"messages/ID/filters",sections:[{key:"my_wall",enable:!0},{key:"all_post",enable:!0},{key:"private",enable:!0},{key:"star",enable:!0},{key:"chat",enable:"config('chat','enable')"},{key:"mention",enable:!0},{key:"mylink",type:"custom",enable:!1,handler:"customeLeftMenu",url:"http://www.tibco.com"}]},{key:"subjects",enable:!0,link:"/subjects/",open:"next"},{key:"people",enable:!0,link:"/explore/",open:"next"},{key:"groups",link:"/groups/",enable:"config('groups', 'interactive_groups')",open:"inline"},{key:"apps",enable:"config('ui_config','config', 'features', 'apps', 'enable')",link:"/apps/",open:"next",img_paths:[{image_path:"voice-memos-banner.png"},{image_path:"email-banner.png"},{image_path:"ideation-banner.png"}]},{key:"meetings",enable:"config('ui_config','config', 'features', 'meetings', 'enable')",link:"/meetings/",open:"next"},{key:"files",link:"/files/",enable:!0,open:"next"},{key:"filters",enable:!0,open:"next"},{key:"insight",enable:!0,open:"down",url:"insight/ID",sections:[{key:"what_happening",enable:!0},{key:"leader_board",enable:!0}]},{key:"communities",enable:!0,open:"next"}]},message:{more_actions:[{key:"show_name",handler:"showName",enable:!1}]},user_profile:{tabs:[{key:"tibbr_web_site",url:"http://www.tibbr.com",enable:!1}]},file:{image_path:"images/icons/",types:{"application/msaccess":"dtb","application/accdb":"dtb","application/db":"dtb","application/dbf":"dtb","application/mdb":"dtb","application/pdb":"dtb","application/sql":"dtb","application/x-dtb":"dtb","application/x-mdb":"dtb","application/vnd":"dxp","application/spotfire":"dxp","application/dxp":"dxp","application/octet-stream":"dxp","text/plain":"txt","text/log":"txt","text/odt":"txt","text/rtf":"txt","application/x-rtf":"txt","text/x-txt":"txt","text/x-log":"txt","text/x-odt":"txt","text/x-rtf":"txt","application/x-c":"txt","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"doc","application/msword":"doc","application/x-docx":"doc","application/x-doc":"doc","application/x-excel":"xls","application/x-xlsx":"xls","application/x-xls":"xls","application/x-xlr":"xls","application/x-xlsm":"xls","application/x-xlsb":"xls","application/x-ppt":"ppt","application/x-pptx":"ppt","application/x-pps":"ppt","application/x-ppsx":"ppt","application/vnd.ms-word.document.macroEnabled.12":"doc","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"xls","application/vnd.ms-excel":"xls","application/vnd.ms-excel.sheet.macroEnabled.12":"xls","application/vnd.openxmlformats-officedocument.presentationml.presentation":"ppt","application/vnd.ms-powerpoint":"ppt","application/vnd.ms-powerpoint.presentation.12":"ppt","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"ppt","application/vnd.ms-project":"mpp","application/msproj":"mpp","application/msproject":"mpp","application/x-msproject":"mpp","application/x-ms-project":"mpp","application/x-dos_ms_project":"mpp","application/mpp":"mpp","zz-application/zz-winassoc-mpp":"mpp","application/vnd.ms-outlook":"msg","application/x-msg":"msg","application/visio":"vsd","application/x-visio":"vsd","application/vnd.visio":"vsd","application/visio.drawing":"vsd","application/vsd":"vsd","application/x-vsd":"vsd","image/x-vsd":"vsd","zz-application/zz-winassoc-vsd":"vsd","application/pdf":"pdf","application/x-pdf":"pdf","application/zip":"zip","application/x-zip":"zip","application/x-rar":"zip","application/x-zip-compressed":"zip","application/x-zipx":"zip","application/x-7z":"zip","application/x-cbr":"zip","application/x-deb":"zip","application/x-gz":"zip","application/x-pkg":"zip","application/x-rpm":"zip","application/x-sit":"zip","application/x-sitx":"zip","application/x-tar.gz":"zip","image/svg+xml":"img","application/x-svg":"img","image/tif":"img","image/tiff":"img","image/psd":"img","image/x-psd":"img","application/x-psd":"img","application/x-ai":"img","application/postscript":"img","image/eps":"img","image/svg":"img","image/dds":"img","image/dng":"img","image/thm":"img","image/ps":"img","image/png":"png","image/jpeg":"jpg","image/jpg":"jpg","image/bmp":"bmp","image/pjpeg":"jpg","image/gif":"gif","application/x-mp4":"vid","application/x-avi":"vid","application/x-mpeg":"vid","application/x-quicktime":"vid","application/x-shockwave-flash":"vid","application/annodex":"vid","application/mp4":"vid","application/ogg":"vid","application/vnd.rn-realmedia":"vid","application/x-matroska":"vid","video/3gpp":"vid","video/3gpp2":"vid","video/annodex":"vid","video/divx":"vid","video/flv":"vid","video/h264":"vid","video/mp4":"vid","video/mp4v-es":"vid","video/mpeg":"vid","video/mpeg-2":"vid","video/mpeg4":"vid","video/ogg":"vid","video/ogm":"vid","video/quicktime":"vid","video/ty":"vid","video/vdo":"vid","‘video/vivo’":"vid","video/vnd.rn-realvideo":"vid","video/vnd.vivo":"vid","video/webm":"vid","video/x-bin":"vid","video/x-cdg":"vid","video/x-divx":"vid","video/x-dv":"vid","video/x-flv":"vid","video/x-la-asf":"vid","video/x-m4v":"vid","video/x-matroska":"vid","video/x-motion-jpeg":"vid","video/x-ms-asf":"vid","video/x-ms-dvr":"vid","video/x-ms-wm":"vid","video/x-ms-wmv":"vid","video/x-msvideo":"vid","video/x-sgi-movie":"vid","video/x-tivo":"vid","video/avi":"vid","video/x-ms-asx":"vid","video/x-ms-wvx":"vid","video/x-ms-wmx":"vid","video/animaflex":"vid","audio/basic":"aud","audio/mid":"aud","audio/mpeg":"aud","audio/x-aiff":"aud","audio/x-mpegurl":"aud","audio/x-pn-realaudio":"aud","audio/wav":"aud","audio/x-wav":"aud","audio/x-mp3":"aud","application/x-mp3":"aud","application/x-wav":"aud","audio/mp4a-latm":"aud","audio/midi":"aud","audio/x-ms-wma":"aud","application/x-wma":"aud","application/x-ms-wmv":"vid","application/x-wmv":"vid","application/x-ics":"ics","text/calendar":"ics"}}}},{name:"user",config:{private_profile:!0,display_email:!0,display_company:!1}},{name:"menu",config:[{key:"home",link:"#",display:!0},{key:"subjects",link:"/subjects/",display:!0},{key:"people",link:"/explore/",display:!0},{key:"groups",link:"/groups/",display:!0},{key:"profile",link:"/users/profile",display:!0},{key:"apps",link:"/apps/",display:!0}]}];return e}),define("modules/app_config",["jquery","underscore","config/app_config"],function($,_,devConfig){var Config=function(e){this.dataSet=e||[],_.bindAll(this,"get","execute")};return Config.prototype={setUp:function(e){e=e||[];var t=this;_.each(e,function(e){(e.id==="features"&&window.__overrideFeatures||window.isTest)&&_.each(e.data,function(e){_.extend(e,_.where(devConfig,{name:e.name})[0]||{})}),t.dataSet.set(e)}),e.length=0},get:function(){var e=this.dataSet.get("features","server")||[],t={},n=[].slice.call(arguments);$.each(e,function(e,n){t[n.name]=n});if(n.length==0)return t;var r=typeof _.last(n)=="object"?n.pop()["default"]:undefined;return $.each(n,function(e,n){return t=t[n],!!t}),t===undefined?r:t},set:function(){window.isTest},execute:function(val){val=val||!1;if(typeof val=="boolean")return val;var that=this;return val.match(/^config/)?eval(val.replace(/^config/,"that.get")):val}},Config}),define("modules/cookie",["jquery"],function(e){return function(t,n){function o(){var n=e.cookie(t)||"{}";s=JSON.parse(n)}function u(){var r=JSON.stringify(s);e.cookie(t,r,n)}n=n||{};var r=n.path||"/",i=n.expires,s={};return n={path:r,expires:i,secure:n.secure},{get:function(e){return o(),s[e]},set:function(e,t){s[e]=t,u()},empty:function(){s={},e.cookie(t,"",n)}}}}),define("require/tmpl",["jquery"],function(e){return function(e,t){function h(t,n,r,i){var u={data:i||i===0||i===!1?i:n?n.data:{},_wrap:n?n._wrap:null,tmpl:null,parent:n||null,nodes:[],calls:w,nest:E,wrap:S,html:x,update:T};return t&&e.extend(u,t,{nodes:[],parent:n}),r&&(u.tmpl=r,u._ctnt=u._ctnt||u.tmpl(e,u),u.key=++f,(c.length?o:s)[f]=u),u}function p(t,n,i){var s,o=i?e.map(i,function(e){return typeof e=="string"?t.key?e.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+r+'="'+t.key+'" $2'):e:p(e,t,e._ctnt)}):t;return n?o:(o=o.join(""),o.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(t,n,r,i){s=e(r).get(),b(s),n&&(s=d(n).concat(s)),i&&(s=s.concat(d(i)))}),s?s:d(o))}function d(t){var n=document.createElement("div");return n.innerHTML=t,e.makeArray(n.childNodes)}function v(t){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+e.trim(t).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(t,n,r,i,s,o,u){var a=e.tmpl.tag[r],f,l,c;if(!a)throw"Unknown template tag: "+r;return f=a._default||[],o&&!/\w$/.test(s)&&(s+=o,o=""),s?(s=g(s),u=u?","+g(u)+")":o?")":"",l=o?s.indexOf(".")>-1?s+g(o):"("+s+").call($item"+u:s,c=o?l:"(typeof("+s+")==='function'?("+s+").call($item):("+s+"))"):c=l=f.$1||"null",i=g(i),"');"+a[n?"close":"open"].split("$notnull_1").join(s?"typeof("+s+")!=='undefined' && ("+s+")!=null":"true").split("$1a").join(c).split("$1").join(l).split("$2").join(i||f.$2||"")+"__.push('"})+"');}return __;")}function m(t,n){t._wrap=p(t,!0,e.isArray(n)?n:[i.test(n)?n:e(n).html()]).join("")}function g(e){return e?e.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function y(e){var t=document.createElement("div");return t.appendChild(e.cloneNode(!0)),t.innerHTML}function b(t){function v(t){function v(e){e+=n,p=a[e]=a[e]||h(p,s[p.parent.key+n]||p.parent)}var i,u=t,c,p,d;if(d=t.getAttribute(r)){while(u.parentNode&&(u=u.parentNode).nodeType===1&&!(i=u.getAttribute(r)));i!==d&&(u=u.parentNode?u.nodeType===11?0:u.getAttribute(r)||0:0,(p=s[d])||(p=o[d],p=h(p,s[u]||o[u]),p.key=++f,s[f]=p),l&&v(d)),t.removeAttribute(r)}else l&&(p=e.data(t,"tmplItem"))&&(v(p.key),s[p.key]=p,u=e.data(t.parentNode,"tmplItem"),u=u?u.key:0);if(p){c=p;while(c&&c.key!=u)c.nodes.push(t),c=c.parent;delete p._ctnt,delete p._wrap,e.data(t,"tmplItem",p)}}var n="_"+l,i,u,a={},c,p,d;for(c=0,p=t.length;c<p;c++){if((i=t[c]).nodeType!==1)continue;u=i.getElementsByTagName("*");for(d=u.length-1;d>=0;d--)v(u[d]);v(i)}}function w(e,t,n,r){if(!e)return c.pop();c.push({_:e,tmpl:t,item:this,data:n,options:r})}function E(t,n,r){return e.tmpl(e.template(t),n,r,this)}function S(t,n){var r=t.options||{};return r.wrapped=n,e.tmpl(e.template(t.tmpl),t.data,r,t.item)}function x(t,n){var r=this._wrap;return e.map(e(e.isArray(r)?r.join(""):r).filter(t||"*"),function(e){return n?e.innerText||e.textContent:e.outerHTML||y(e)})}function T(){var t=this.nodes;e.tmpl(null,null,null,this).insertBefore(t[0]),e(t).remove()}var n=e.fn.domManip,r="_tmplitem",i=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,s={},o={},u,a={key:0,data:{}},f=0,l=0,c=[];e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,n){e.fn[t]=function(r){var i=[],o=e(r),a,f,c,h,p=this.length===1&&this[0].parentNode;u=s||{};if(p&&p.nodeType===11&&p.childNodes.length===1&&o.length===1)o[n](this[0]),i=this;else{for(f=0,c=o.length;f<c;f++)l=f,a=(f>0?this.clone(!0):this).get(),e(o[f])[n](a),i=i.concat(a);l=0,i=this.pushStack(i,t,o.selector)}return h=u,u=null,e.tmpl.complete(h),i}}),e.fn.extend({tmpl:function(t,n,r){return e.tmpl(this[0],t,n,r)},tmplItem:function(){return e.tmplItem(this[0])},template:function(t){return e.template(t,this[0])},domManip:function(t,r,i,o){if(t[0]&&e.isArray(t[0])){var a=e.makeArray(arguments),f=t[0],c=f.length,h=0,p;while(h<c&&!(p=e.data(f[h++],"tmplItem")));p&&l&&(a[2]=function(t){e.tmpl.afterManip(this,t,i)}),n.apply(this,a)}else n.apply(this,arguments);return l=0,u||e.tmpl.complete(s),this}}),e.extend({tmpl:function(t,n,r,i){var u,f=!i;if(f)i=a,t=e.template[t]||e.template(null,t),o={};else if(!t)return t=i.tmpl,s[i.key]=i,i.nodes=[],i.wrapped&&m(i,i.wrapped),e(p(i,null,i.tmpl(e,i)));return t?(typeof n=="function"&&(n=n.call(i||{})),r&&r.wrapped&&m(r,r.wrapped),u=e.isArray(n)?e.map(n,function(e){return e?h(r,i,t,e):null}):[h(r,i,t,n)],f?e(p(i,null,u)):u):[]},tmplItem:function(t){var n;t instanceof e&&(t=t[0]);while(t&&t.nodeType===1&&!(n=e.data(t,"tmplItem"))&&(t=t.parentNode));return n||a},template:function(t,n){return n?(typeof n=="string"?n=v(n):n instanceof e&&(n=n[0]||{}),n.nodeType&&(n=e.data(n,"tmpl")||e.data(n,"tmpl",v(n.innerHTML))),typeof t=="string"?e.template[t]=n:n):t?typeof t!="string"?e.template(null,t):e.template[t]||e.template(null,i.test(t)?t:e(t)):null},encode:function(e){return(""+e).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}}),e.extend(e.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(e){s={}},afterManip:function(n,r,i){var s=r.nodeType===11?e.makeArray(r.childNodes):r.nodeType===1?[r]:[];i.call(n,r),b(s),l++}})}(e)}),define("require/underscore-string",["underscore"],function(e){var t=String.prototype.trim,n=String.prototype.trimRight,r=String.prototype.trimLeft,i=function(e){return e*1||0},s=function(e,t,n){e+="",t=~~t;for(var r=[];t>0;r[--t]=e);return r.join(n==null?"":n)},o=function(e){return Array.prototype.slice.call(e)},u=function(e){return e!=null?"["+h.escapeRegExp(""+e)+"]":"\\s"},a={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"},f={};for(var l in a)f[a[l]]=l;var c=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var t=s,n=function(){return n.cache.hasOwnProperty(arguments[0])||(n.cache[arguments[0]]=n.parse(arguments[0])),n.format.call(null,n.cache[arguments[0]],arguments)};return n.format=function(n,r){var i=1,s=n.length,o="",u,a=[],f,l,h,p,d,v;for(f=0;f<s;f++){o=e(n[f]);if(o==="string")a.push(n[f]);else if(o==="array"){h=n[f];if(h[2]){u=r[i];for(l=0;l<h[2].length;l++){if(!u.hasOwnProperty(h[2][l]))throw new Error(c('[_.sprintf] property "%s" does not exist',h[2][l]));u=u[h[2][l]]}}else h[1]?u=r[h[1]]:u=r[i++];if(/[^s]/.test(h[8])&&e(u)!="number")throw new Error(c("[_.sprintf] expecting number but found %s",e(u)));switch(h[8]){case"b":u=u.toString(2);break;case"c":u=String.fromCharCode(u);break;case"d":u=parseInt(u,10);break;case"e":u=h[7]?u.toExponential(h[7]):u.toExponential();break;case"f":u=h[7]?parseFloat(u).toFixed(h[7]):parseFloat(u);break;case"o":u=u.toString(8);break;case"s":u=(u=String(u))&&h[7]?u.substring(0,h[7]):u;break;case"u":u=Math.abs(u);break;case"x":u=u.toString(16);break;case"X":u=u.toString(16).toUpperCase()}u=/[def]/.test(h[8])&&h[3]&&u>=0?"+"+u:u,d=h[4]?h[4]=="0"?"0":h[4].charAt(1):" ",v=h[6]-String(u).length,p=h[6]?t(d,v):"",a.push(h[5]?u+p:p+u)}}return a.join("")},n.cache={},n.parse=function(e){var t=e,n=[],r=[],i=0;while(t){if((n=/^[^\x25]+/.exec(t))!==null)r.push(n[0]);else if((n=/^\x25{2}/.exec(t))!==null)r.push("%");else{if((n=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t))===null)throw new Error("[_.sprintf] huh?");if(n[2]){i|=1;var s=[],o=n[2],u=[];if((u=/^([a-z_][a-z_\d]*)/i.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1]);while((o=o.substring(u[0].length))!=="")if((u=/^\.([a-z_][a-z_\d]*)/i.exec(o))!==null)s.push(u[1]);else{if((u=/^\[(\d+)\]/.exec(o))===null)throw new Error("[_.sprintf] huh?");s.push(u[1])}n[2]=s}else i|=2;if(i===3)throw new Error("[_.sprintf] mixing positional and named placeholders is not (yet) supported");r.push(n)}t=t.substring(n[0].length)}return r},n}(),h={VERSION:"2.1.1",isBlank:function(e){return/^\s*$/.test(e)},stripTags:function(e){return(""+e).replace(/<\/?[^>]+>/ig,"")},capitalize:function(e){return e+="",e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()},chop:function(e,t){e+="",t=~~t||e.length;var n=[];for(var r=0;r<e.length;)n.push(e.slice(r,r+t)),r+=t;return n},clean:function(e){return h.strip((""+e).replace(/\s+/g," "))},count:function(e,t){return e+="",t+="",e.split(t).length-1},chars:function(e){return(""+e).split("")},escapeHTML:function(e){return(""+e).replace(/[&<>"']/g,function(e){return"&"+f[e]+";"})},unescapeHTML:function(e){return(""+e).replace(/\&([^;]+);/g,function(e,t){var n;return t in a?a[t]:(n=t.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(n[1],16)):(n=t.match(/^#(\d+)$/))?String.fromCharCode(~~n[1]):e})},escapeRegExp:function(e){return e.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},insert:function(e,t,n){var r=(""+e).split("");return r.splice(~~t,0,""+n),r.join("")},include:function(e,t){return(""+e).indexOf(t)!==-1},join:function(e){var t=o(arguments);return t.join(t.shift())},lines:function(e){return(""+e).split("\n")},reverse:function(e){return Array.prototype.reverse.apply(String(e).split("")).join("")},splice:function(e,t,n,r){var i=(""+e).split("");return i.splice(~~t,~~n,r),i.join("")},startsWith:function(e,t){return e+="",t+="",e.length>=t.length&&e.substring(0,t.length)===t},endsWith:function(e,t){return e+="",t+="",e.length>=t.length&&e.substring(e.length-t.length)===t},succ:function(e){e+="";var t=e.split("");return t.splice(e.length-1,1,String.fromCharCode(e.charCodeAt(e.length-1)+1)),t.join("")},titleize:function(e){return(""+e).replace(/\b./g,function(e){return e.toUpperCase()})},camelize:function(e){return h.trim(e).replace(/(\-|_|\s)+(.)?/g,function(e,t,n){return n?n.toUpperCase():""})},underscored:function(e){return h.trim(e).replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase()},dasherize:function(e){return h.trim(e).replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase()},classify:function(e){return h.titleize(e.replace(/_/g," ")).replace(/\s/g,"")},humanize:function(e){return h.capitalize(this.underscored(e).replace(/_id$/,"").replace(/_/g," "))},trim:function(e,n){return e+="",!n&&t?t.call(e):(n=u(n),e.replace(new RegExp("^"+n+"+|"+n+"+$","g"),""))},ltrim:function(e,t){return!t&&r?r.call(e):(t=u(t),(""+e).replace(new RegExp("^"+t+"+","g"),""))},rtrim:function(e,t){return!t&&n?n.call(e):(t=u(t),(""+e).replace(new RegExp(t+"+$","g"),""))},truncate:function(e,t,n){return e+="",n=n||"...",t=~~t,e.length>t?e.slice(0,t)+n:e},prune:function(e,t,n){e+="",t=~~t,n=n!=null?""+n:"...";var r,i,s=e.replace(/\W/g,function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "});return i=s.charAt(t),r=s.slice(0,t),i&&i.match(/\S/)&&(r=r.replace(/\s\S+$/,"")),r=h.rtrim(r),(r+n).length>e.length?e:e.substring(0,r.length)+n},words:function(e,t){return h.trim(e,t).split(t||/\s+/)},pad:function(e,t,n,r){e+="";var i="",o=0;t=~~t,n?n.length>1&&(n=n.charAt(0)):n=" ";switch(r){case"right":o=t-e.length,i=s(n,o),e+=i;break;case"both":o=t-e.length,i={left:s(n,Math.ceil(o/2)),right:s(n,Math.floor(o/2))},e=i.left+e+i.right;break;default:o=t-e.length,i=s(n,o),e=i+e}return e},lpad:function(e,t,n){return h.pad(e,t,n)},rpad:function(e,t,n){return h.pad(e,t,n,"right")},lrpad:function(e,t,n){return h.pad(e,t,n,"both")},sprintf:c,vsprintf:function(e,t){return t.unshift(e),c.apply(null,t)},toNumber:function(e,t){var n=i(i(e).toFixed(~~t));return n===0&&""+e!="0"?Number.NaN:n},strRight:function(e,t){e+="",t=t!=null?""+t:t;var n=t?e.indexOf(t):-1;return n!=-1?e.slice(n+t.length,e.length):e},strRightBack:function(e,t){e+="",t=t!=null?""+t:t;var n=t?e.lastIndexOf(t):-1;return n!=-1?e.slice(n+t.length,e.length):e},strLeft:function(e,t){e+="",t=t!=null?""+t:t;var n=t?e.indexOf(t):-1;return n!=-1?e.slice(0,n):e},strLeftBack:function(e,t){e+="",t=t!=null?""+t:t;var n=e.lastIndexOf(t);return n!=-1?e.slice(0,n):e},toSentence:function(e,t,n){t||(t=", "),n||(n=" and ");var r=e.length,i="";for(var s=0;s<r;s++)i+=e[s],s===r-2?i+=n:s<r-1&&(i+=t);return i},slugify:function(e){var t="ąàáäâãćęèéëêìíïîłńòóöôõùúüûñçżź·/_:;",n="aaaaaaceeeeeiiiilnooooouuuunczz",r=new RegExp(u(t),"g");return e=(""+e).toLowerCase(),e=e.replace(r,function(e){var r=t.indexOf(e);return n.charAt(r)||"-"}),h.trim(e.replace(/[^\w\s-]/g,"").replace(/[-\s]+/g,"-"),"-")},exports:function(){var e={};for(var t in this){if(!this.hasOwnProperty(t)||t=="include"||t=="contains"||t=="reverse")continue;e[t]=this[t]}return e},repeat:s};return h.strip=h.trim,h.lstrip=h.ltrim,h.rstrip=h.rtrim,h.center=h.lrpad,h.rjust=h.lpad,h.ljust=h.rpad,h.contains=h.include,e.string=h,e.str=e.string,h}),define("require/linkify",[],function(){var t="[a-z\\d.-]+://",n="(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])",r="(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+",i="(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)",s="(?:"+r+i+"|"+n+")",o="(?:[;/][^#?<>\\s]*)?",u="(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?",a="\\b"+t+"[^<>\\s]+",f="\\b"+s+o+u+"(?!\\w)",l="mailto:",c="(?:"+l+")?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@"+s+u+"(?!\\w)",h=new RegExp("(?:"+a+"|"+f+"|"+c+")","ig"),p=new RegExp("^"+t,"i"),d={"'":"`",">":"<",")":"(","]":"[","}":"{","»":"«","›":"‹"},v={callback:function(e,t,n){n=n||{};var r=t&&t.match(new RegExp("("+window.location.href+"?[^\\s]+)","g"))?"":n.target||'target="_blank"';return t?'<a class="js-publish-link" href="'+t+'"'+r+">"+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(e,t){t=t||{};var n,r,i,s,o={},u="",a=[],f,c,m,g,y,b,w,E;for(r in v)t[r]===undefined&&(t[r]=v[r]);var S=$("<div>"+e+" </div>");S.find("a").each(function(e,t){var n="tags_"+e;o[n]=t,$(t).replaceWith(n+"&nbsp;")}),e=S.html();while(n=h.exec(e)){i=n[0],c=h.lastIndex,m=c-i.length;if(/[\/:]/.test(e.charAt(m-1)))continue;do g=i,E=i.substr(-1),w=d[E],w&&(y=i.match(new RegExp("\\"+w+"(?!$)","g")),b=i.match(new RegExp("\\"+E,"g")),(y?y.length:0)<(b?b.length:0)&&(i=i.substr(0,i.length-1),c--)),t.punct_regexp&&(i=i.replace(t.punct_regexp,function(e){return c-=e.length,""}));while(i.length&&i!==g);s=i,p.test(s)||(s=(s.indexOf("@")!==-1?s.indexOf(l)?l:"":s.indexOf("irc.")?s.indexOf("ftp.")?"http://":"ftp://":"irc://")+s),f!=m&&(a.push([e.slice(f,m)]),f=c),a.push([i,s])}a.push([e.substr(f)]);for(r=0;r<a.length;r++)u+=t.callback.apply(window,a[r],{target:t.target});if(u){var x=$("<div></div>");_.each(o,function(e,t){u=u.replace(t,x.append(e).html()),x.empty()})}return u||e}}),function(e,t){define("modules/helper",["underscore","require/underscore-string","require/linkify"],function(n,r,i){return t(e,n,r,i)})}(this,function(e,t,n,r){var i=[].slice,s={mention:t.template('<span contenteditable="false" class="js-mention <%=type %>" data-mention="<%= syntax %>"><%= value %></span>'),hashTag:t.template('<span contenteditable="false" class="js-mention <%=type %>" data-mention="<%= syntax %>"><%= value %></span>')},o=function(){return e.tib_action_name==="comments"},u=!1,a=function(e,t){return r(e,t||{})},f=function(){return e.prefix||"/"},l=function(e){var t=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;return t.test(e)},c=function(){var n=i.call(arguments),r="";if(t.isObject(t.last(n))){var s=n.pop();s.host&&(r=s.host.match("/$")?s.host:s.host+"/")}var o=r+(n||[""]).join(""),u;return o.match(/http|ftp|https/)?u="":o.match(new RegExp("^"+e.prefix))?u="":(u=f(),o=o.replace(/^\//,"")),u+o},h=function(e,t){return e===1?t:t+"s"},p=function(e){return e===1?{count:"",is:"is",their:"his"}:{count:"s",is:"were",their:"their"}},d=function(e,n){if(!t.isString(e))return"<span>Image value should be string</span>";var r=c(e),i=$("<img />").attr("src",r);return t.isObject(n)&&i.attr(n),$("<div>").append(i).html()},v=function(){var e=i.call(arguments),n=t.first(e),r=t.isObject(e[1])||t.isUndefined(e[1])?3:e[1],s=t.isObject(t.last(e))?t.last(e).host:undefined;if(n===undefined)return g("/assets/images/users/profile_images/missing_medium.png");var o=["small","medium","large"],u=n.split(",");t(r).isString()&&t(o).include(r)?r=t.indexOf(u,r)+1:r=t(r).isNumber()?r:3;var a=u[r];return a?g(a,s):""},m=function(n){var r=e.theme,s=i.call(arguments);if(t.isObject(t.last(s))){var o=s.pop();o.host&&(r=o.host+"/tenants/tibbr/themes/default/")}return r+"images/"+n},g=function(n,r){var s=i.call(arguments),o=f();return r=t.isObject(t.last(s))?t.last(s).host:r,n?n.match(/http|ftp|https/)?n:(n.match(new RegExp("^"+e.prefix))&&(o=""),r&&(n=n.replace(new RegExp("^"+e.prefix),"/").replace(new RegExp("^/tibbr/"),"/")),(r||y()||o).replace(/\/$/,"")+n||""):""},y=function(){var t=e.assetURL;return t&&t.match(/http|ftp|https/)?t:null},b=function(){var t=e.location;return t.protocol+"//"+t.host+"/"},w=function(){return b().replace(/\/$/,"")+f().replace(/^\/a/,"/tibbr")},E=function(){var e="Unknown OS";return navigator.appVersion.indexOf("Win")!==-1&&(e="windows"),navigator.appVersion.indexOf("Mac")!==-1&&(e="mac"),e},S=function(){return this.get("url").match(new RegExp("("+e.location.host+"?[^\\s]+)","g"))!==null},x=function(){var n=i.call(arguments),r,s={gadget:e.gadget};t.isObject(t.last(n))&&(t.extend(s,t.last(n)),n.pop()),r=s.host;if(s.gadget){if(!o())return"#";r=!0}delete s.gadget,delete s.host,n.push(s);var a=N.apply(this,n);return a=u?a:"#!"+a,r?(r===!0&&(r=w()),(r.match(/\/$/)?r:r+"/")+a):a},T=function(){var e=i.call(arguments),n,r={};t.isObject(t.last(e))&&(t.extend(r,t.last(e)),e.pop()),n=r.host,delete r.host,e.push(r);var s=N.apply(this,e).replace(/^\//,"");return n?(n===!0&&(n=w()),s=(n.match(/\/$/)?n:n+"/")+s):s=f()+s,s},N=function(){var e=i.call(arguments),n,r;return e.length===0?"#":(t.isObject(t.last(e))&&(n=t.clone(t.last(e)),e.pop()),r=t.compact(e).join("/"),r=(r.charAt(0)==="/"?"":"/")+r,t.isEmpty(n)||(r=r+"?"+$.param(n)),r)},C=function(){return t.chain(e.theme.split("/")).compact().last().value()},k=function(e,n){var r=$("<div>"+e+" </div>"),i={};r.find("a").each(function(e,t){var n="_LINK_"+e;i[n]=t,$(t).replaceWith(n)}),e=r.html();var s=/\B#(((?![\u200b])[a-z0-9_\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u024f\u0253-\u0254\u0256-\u0257\u0300-\u036f\u1e00-\u1eff\u0400-\u04ff\u0500-\u0527\u2de0-\u2dff\ua640-\ua69f\u0591-\u05bf\u05c1-\u05c2\u05c4-\u05c5\u05d0-\u05ea\u05f0-\u05f4\ufb12-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4f\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06de-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u0750-\u077f\u08a2-\u08ac\u08e4-\u08fe\ufb50-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\u200c-\u200c\u0e01-\u0e3a\u0e40-\u0e4e\u1100-\u11ff\u3130-\u3185\ua960-\ua97f\uac00-\ud7af\ud7b0-\ud7ff\uffa1-\uffdc\u30a1-\u30fa\u30fc-\u30fe\uff66-\uff9f\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\u3041-\u3096\u3099-\u309e\u3400-\u4dbf\u4e00-\u9fff\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2f800-\u2fa1f])*((?![\u200b])[a-z_\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0100-\u024f\u0253-\u0254\u0256-\u0257\u0300-\u036f\u1e00-\u1eff\u0400-\u04ff\u0500-\u0527\u2de0-\u2dff\ua640-\ua69f\u0591-\u05bf\u05c1-\u05c2\u05c4-\u05c5\u05d0-\u05ea\u05f0-\u05f4\ufb12-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4f\u0610-\u061a\u0620-\u065f\u066e-\u06d3\u06d5-\u06dc\u06de-\u06e8\u06ea-\u06ef\u06fa-\u06fc\u0750-\u077f\u08a2-\u08ac\u08e4-\u08fe\ufb50-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\u200c-\u200c\u0e01-\u0e3a\u0e40-\u0e4e\u1100-\u11ff\u3130-\u3185\ua960-\ua97f\uac00-\ud7af\ud7b0-\ud7ff\uffa1-\uffdc\u30a1-\u30fa\u30fc-\u30fe\uff66-\uff9f\uff10-\uff19\uff21-\uff3a\uff41-\uff5a\u3041-\u3096\u3099-\u309e\u3400-\u4dbf\u4e00-\u9fff\u20000-\u2a6df\u2a700-\u2b73f\u2b740-\u2b81f\u2f800-\u2fa1f])*)/gi;e=e.replace(s,function(e){return n?'<a style="pointer-events:none" class="js-hash-tag hash-tag">'+e+"</a>":'<a class="js-hash-tag hash-tag">'+e+"</a>"});var o=$("<div></div>");return t.each(i,function(t,n){e=e.replace(n,o.append(t).html()),o.empty()}),t.str.rtrim(e)},L={scrollTo:function(e,n){if(!e)return this;t.defer(function(){e.animate({scrollTop:n+"px"},0)})},getHTML5Location:function(e){var t=requirejs("tibbr");return e=e||t.currentUser||{},e.geoPosition={latitude:0,longitude:0,hasGeo:!1},navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){e.geoPosition={latitude:t.coords.latitude,longitude:t.coords.longitude,hasGeo:!0}}):e&&e.get("geo_location")&&(e.geoPosition={latitude:e.get("geo_location").latitude,longitude:e.get("geo_location").longitude,hasGeo:!0}),e},getBrowser:function(){var e=requirejs("tibbr"),t="html5",n=e.mobile.config;return n.browser.ios?t="ios":n.browser.android?t="android":n.browser.blackberry?t="blackberry":n.browser.windowsPhone&&(t="windowsphone"),t},canImageFit:function(e,t,n,r){return e>n||t>r?!0:!1},isFileUploadSupported:function(){var n=requirejs("tibbr");$("body").append('<input type="file" id="dummyInputFileInput" style="position:fixed;" class="hidden">');var r=document.getElementById("dummyInputFileInput"),i=!1;return r&&(r.disabled===!1&&e.FormData!==undefined&&(i=!0),t.isFunction(r.remove)&&r.remove()),this.native.isNative()&&n.mobile.config.appMode.device=="android"&&(i=!1),n.mobile.config.post.settings.file=i,n.mobile.config.isFileUploadSupported=i,i},checkMyWallPage:function(e){return e=e||params||{},e.action==="index"||e.action==="filters"&&e.id==="my_wall"},goBack:function(){var t=requirejs("tibbr");t.Helper.mobile.native.isDesktop()?e.DSKT.goBack():e.history.back()},href:function(t){if(!t)return;e.location.href=t},makeGridClass:function(e,t){var n="";switch(t){case 1:n="duo";break;case 2:n="duo";break;case 3:n="tri";break;case 4:n="quad";break;case 5:n="penta"}return e+"-"+n},addAppClass:function(){$("html").addClass("css-"+this.getBrowser())},getModelType:function(e,n){var r=["system","g","u"],i=["custom","s"],s=["Group","g"];if(t.include(r,e))return t.include(s,n)?"group":"user";if(t.include(i,e))return"subject"},profileClick:function(){var e=this;$(document).on("click",".js-profile-router",function(t){var n=$(t.currentTarget).attr("href")||$(t.currentTarget).data("href");return console.log(n),e.openProfileLink(n)?!0:!1})},linkClick:function(){var e=this;$(document).on("click",".js-link-router",function(t){var n=$(t.currentTarget).attr("href")||$(t.currentTarget).data("href");return console.log(n),e.openLink(n)?!0:!1})},openProfileLink:function(e){return this.native.isNative()?(this.native.openInternalLink({url:e}),!1):!0},openLink:function(e){return console.log("Desktop: ",this.native.isDesktop()),console.log("Native: ",this.native.isNative()),this.native.isNative()||this.native.isDesktop()||this.native.isPackaged()?(this.native.openExternalLink({url:e}),!1):!0},bindLiveClicks:function(){this.profileClick(),this.linkClick(),this.bindEvents()},bindEvents:function(){var n=requirejs("tibbr"),r=this,i=t.debounce(function(){$(".sidebar-left").length&&r.adjustHeaderWidth("sidebar-left"),$(".sidebar-right").length&&r.adjustHeaderWidth("sidebar-right"),n.mobile.config.layout.fixedMode&&r.resizeDesktopView("sidebar-left"),console.log("window resized")},this.native.isDesktop()?0:100);$(e).on("resize",function(e){i(),console.log("resize")}),n.Event.bind("sidebar:left_sidebar_toggled",this.leftSidebarToggled,this),n.Event.bind("sidebar:right_sidebar_toggled",this.rightSidebarToggled,this)},leftSidebarToggled:function(e){this.adjustHeaderWidth("sidebar-left"),this.adjustSidebarPosition("sidebar-left",e),this.resizeDesktopView("sidebar-left")},rightSidebarToggled:function(e){this.adjustHeaderWidth("sidebar-right"),this.ifRightSidebarCanFit()},adjustHeaderWidth:function(t){var n=requirejs("tibbr");if(!n.mobile.config.layout.fixedHeaderMode&&!n.mobile.config.layout.fixedMode)return;var r=$(e).width(),i=$("."+t),s=$("#main-header");if($("body").hasClass(t+"-open")){if(r<320)return!1;s.css({width:r-i.width()+"px"}),console.log("sidebar-opened")}else s.css({width:r+"px"}),console.log("sidebar-closed")},adjustSidebarPosition:function(n,r){var i=requirejs("tibbr");if(!i.mobile.config.layout.fixedHeaderMode)return;var s=$(e),o=s.height(),u=$("."+n),a=u.height()>o?u.height():o;$("body").hasClass(n+"-open")?(i.mobile.config.layout.baseEl.css({height:a-44+"px"}),console.log("sidebar-inview")):(i.mobile.config.layout.baseEl.css({height:"auto"}),console.log(r.scrollTop),t.isUndefined(r.scrollTop)||i.Helper.mobile.scrollTo(i.mobile.config.layout.scrollContainer,r.scrollTop),console.log("sidebar out of view"))},ifRightSidebarCanFit:function(){var e=requirejs("tibbr");if(!e.mobile.config.layout.fixedHeaderMode)return;if(!$("body").hasClass("right-sidebar-open"))return;$(".content-wrap, #main-header").css({left:"auto"}),$(".sidebar.sidebar-right").removeClass("abs"),$(".content-wrap").width()<315&&($(".sidebar.sidebar-right").addClass("abs"),$(".content-wrap, #main-header").css({left:"-268px"}))},resizeDesktopView:function(t){var n=requirejs("tibbr"),r=e.innerHeight,i=e.innerWidth,s=$("."+t).width(),o=44,u=$("body").hasClass("mobile-modal-open")?r:r-o;if(!n.mobile.config.layout.fixedMode)return;$(".viewport, aside").css({height:r+"px"}),$("body").hasClass(t+"-open")?$(".content-wrap").css({width:i-s+"px",height:u+"px"}):$(".content-wrap").css({width:i+"px",height:u+"px"})},setAppMode:function(e,t,n){var r=requirejs("tibbr");this.setDeviceAndClientKey(e,t);if(n=="true"){r.mobile.config.appMode.isPackaged=!0;return}return r.mobile.config.appMode.isPackaged=!1,this.native.setIsNative()},enableFixedHeaderMode:function(){var e=requirejs("tibbr");e.mobile.config.layout.fixedHeaderMode=!0,$("body").addClass("fixed-header-mode")},enableFixedMode:function(){var e=requirejs("tibbr");e.mobile.config.layout.fixedMode=!0,e.mobile.config.layout.scrollContainer=$(".content-wrap"),$("body").addClass("fixed-mode"),this.resizeDesktopView()},setDeviceAndClientKey:function(n,r,i){var s=requirejs("tibbr");nativeConfig=s.mobile.config.appMode,nativeConfig.device=n||"html5",nativeConfig.client_key=t.isEmpty(e.client_key)?r||"html5":e.client_key},getClientKey:function(){var e=requirejs("tibbr");return e.mobile.config.appMode.client_key},addDeviceAndClientKey:function(e){if(t.isEmpty(e))return e;var n={device:this.native.getDevice(),app_client_key:this.getClientKey()};return t.str.contains(e,"?")?e+="&":e+="?",e+=$.param(n),e},queryDecoder:function(e){var t=e!=undefined?e.substr(e.indexOf("?")+1):window.location.search.substr(window.location.search.indexOf("?")+1),n=new Object,r=t,i=/([^&=]+)=([^&]*)/g,s;while(s=i.exec(r))n[decodeURIComponent(s[1])]=decodeURIComponent(s[2]);return n},convertToMiles:function(e){var t=5280;return Math.round(e)<1?Math.round(e*t)+" feet":Math.round(e)+" miles"},"native":function(){var n,r=function(){if(f()===!1&&v()===!1&&m()===!1)return console.log("Not native and certainly not desktop!"),!0;var e=i.call(arguments),t=e[0],n=e[1];if(n){var r=decodeURIComponent($.param(n))||"";v()?u(n.url):u("inapp://"+t+"?"+r)}else t&&u("inapp://"+t);return!1},s=function(e,t,n){var r={delegateTo:e,taskArgument:t,callbackArgument:n};return window.device=="desktop"?r:escape(JSON.stringify(r))},o=function(e,t,n){if(window.device=="desktop")desktopCallNative(e,t,n);else{var r=new JSBridgeObj;r.addObject("task",e),r.addObject("argument",t),r.addObject("callback",n),r.sendBridgeObject()}return!1},u=function(t){e.open(t)},a=function(){var e=requirejs("tibbr");n=e.mobile.config.appMode;var r=["android","ios"],i=(n.device||"").toLowerCase();return n.native=t.include(r,i),n.native},f=function(){var e=requirejs("tibbr");return e.mobile.config.appMode.native},l=function(){return r("toggleMenu")},c=function(e){var t=requirejs("tibbr");return console.log("openExternalLink"),e=e||{},e.url&&!t.Helper.checkUrl(e.url)&&(e.url=t.host()+e.url),e.scope="external",r("capture",e)},h=function(e){return e=e||{},e.scope="internal",r("capture",e)},p=function(){return r("auth_token="+window.authToken)},d=function(){var e=requirejs("tibbr");return e.mobile.config.appMode.device},v=function(){var e=requirejs("tibbr");return this.getDevice()=="desktop"||e.isDesktop?!0:!1},m=function(){var e=requirejs("tibbr");return e.mobile.config.appMode.isPackaged?!0:!1};return e.getDevice=d,{exitApp:l,openExternalLink:c,openInternalLink:h,isNative:f,getDevice:d,setIsNative:a,isDesktop:v,isPackaged:m,prepareArguments:s,callNative:o}}()};return contextToHtml=function(e){var n=require("tibbr"),r=t.compact(t.map(e.match(n.wikiRegex),function(e){try{var t={},n=e.replace(/[@\[]|[\]$]/g,"");return t.rawString=e,t.text=s.mention({syntax:e,value:n.split("|")[1],type:"mention"}),t}catch(r){return null}}));t.each(r,function(t){e=e.replace(t.rawString,t.text)});var i=/\B#\w*[a-zA-Z_\u00BF-\u1FFF\u2C00-\uD7FF\w]+\w*/g;return e=e.replace(i,function(e){return s.hashTag({syntax:e,value:e,type:"hash"})}),e},{isTibbrLink:S,autoLink:a,imageTag:d,imagePath:c,context:f,asset:g,OSName:E,themeImagePath:m,themeName:C,assetImage:v,str:t.str,url:x,buildURL:N,domain:b,domainWithPrefix:w,checkUrl:l,getFormattedData:h,getFormattedText:p,path:T,hashToUrl:k,contextToHtml:contextToHtml,pushState:function(e){u=e},mobile:L}}),define("modules/template",["jquery","underscore","backbone","require/tmpl","require/md5","modules/helper"],function(e,t,n,r,i,s){var o={},u=function(e){t.bindAll(this,"setData"),this.tibbr=e.tibbr||{},this.store=o,this.view=e};return u.prototype={key:function(e){return i.hexdigest(e)},setData:function(e){return this.tibbr.gadget?JSON.stringify(e):""},compile:function(t,n){var r=n||this.key(t),i=this.store[r];return i?i:this.store[r]=e.template(t)},render:function(r,i){var o=this.view.model||new n.Model,u=this.tibbr.currentUser||new n.Model,a=(i||{}).storeKey,f=function(e){return'[missing attribute: "'+e+'"]'},l={t:this.tibbr.translate,helper:s,params:window._params_,view:this.view,model:o,currentUser:u,appConfig:this.tibbr.appConfig,setData:this.setData,ph:f},c=t.extend(i||{},l);return window._debug_&&console.warn("WE ARE NOT SUPPOSE TO USE jQuery Template",a,r),e.tmpl(this.compile(r,a),c)}},window._imageTag=s.imageTag,e.extend(e.tmpl.tag,{imageTag:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat(_imageTag($1,$2));}"}}),e.extend(e.tmpl.tag,{"var":{open:"var $1;"}}),u}),define("modules/ajax",["jquery","underscore"],function(e,t){var n=[];return{xhrPool:{init:function(){return e.ajaxSetup({beforeSend:function(e){n.push(e)},complete:function(e){var r=t.indexOf(n,e);r>-1&&n.splice(r,1)}})},abortAll:function(){t.each(n,function(e){try{e.abort()}catch(t){console.log(t)}}),n.length=0}}}}),define("modules/topics",[],function(){return{hub:"tibco.hub.connected",login:"tibco.tibbr.auth",logout:"tibco.tibbr.logout",signIn:"tibco.tibbr.signin",loaded:"tibco.tibbr.loaded",resize:"tibco.tibbr.resize",Message:{created:"tibco.tibbr.message.created",search:"tibco.tibbr.message.search",post:"tibco.tibbr.message.post",fill:"tibco.tibbr.message.fill",target:"tibco.tibbr.message.target"},Calendar:{rsvp:"tibco.tibbr.calendar.rsvp"},Wall:{changed:"tibco.tibbr.wall.changed"},Subject:{selected:"tibco.tibbr.subject.selected",actions:"tibco.tibbr.subject.actions.**",followed:"tibco.tibbr.subject.actions.followed",unfollowed:"tibco.tibbr.subject.actions.unfollowed",paused:"tibco.tibbr.subject.paused"},User:{selected:"tibco.tibbr.user.selected",actions:"tibco.tibbr.user.actions.**",followed:"tibco.tibbr.user.actions.followed",unfollowed:"tibco.tibbr.user.actions.unfollowed"}}}),define("jqueryui/core",["jquery"],function(e){(function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return typeof n=="number"?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})})(e)}),define("jqueryui/widget",["jquery"],function(e){(function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(arguments.length===1)return o[n]===t?null:o[n];o[n]=r}else{if(arguments.length===1)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})})(e)}),define("jqueryui/button",["jquery","./core","./widget"],function(e){(function(e,t){var n,r="ui-button ui-widget ui-state-default ui-corner-all",i="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",s=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},o=function(t){var n=t.name,r=t.form,i=e([]);return n&&(n=n.replace(/'/g,"\\'"),r?i=e(r).find("[name='"+n+"']"):i=e("[name='"+n+"']",t.ownerDocument).filter(function(){return!this.form})),i};e.widget("ui.button",{version:"1.10.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,s),typeof this.options.disabled!="boolean"?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,u=this.type==="checkbox"||this.type==="radio",a=u?"":"ui-state-active";i.label===null&&(i.label=this.type==="input"?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(r).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){if(i.disabled)return;this===n&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){if(i.disabled)return;e(this).removeClass(a)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),u&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),this.type==="checkbox"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1}):this.type==="radio"?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var n=t.element[0];o(n).not(n).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),n=this,t.document.one("mouseup",function(){n=null})}).bind("mouseup"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){if(i.disabled)return!1;(t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active")}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,n;this.element.is("[type=checkbox]")?this.type="checkbox":this.element.is("[type=radio]")?this.type="radio":this.element.is("input")?this.type="input":this.type="button",this.type==="checkbox"||this.type==="radio"?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),n=this.element.is(":checked"),n&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",n)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(r+" ui-state-active "+i).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){this._super(e,t);if(e==="disabled"){this.element.prop("disabled",!!t),t&&this.buttonElement.removeClass("ui-state-focus");return}this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),this.type==="radio"?o(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):this.type==="checkbox"&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if(this.type==="input"){this.options.label&&this.element.val(this.options.label);return}var t=this.buttonElement.removeClass(i),n=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,s=r.primary&&r.secondary,o=[];r.primary||r.secondary?(this.options.text&&o.push("ui-button-text-icon"+(s?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(o.push(s?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(n)))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){e==="disabled"&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t=this.element.css("direction")==="rtl";this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})})(e)}),define("jqueryui/mouse",["jquery","./widget"],function(e){(function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"1.10.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(e)}),define("jqueryui/draggable",["jquery","./core","./mouse","./widget"],function(e){(function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.offsetParentCssPosition==="fixed"&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),this.options.helper==="original"&&!e.contains(this.element[0].ownerDocument,this.element[0])?!1:(this.options.revert==="invalid"&&!r||this.options.revert==="valid"&&r||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo==="parent"?this.element[0].parentNode:n.appendTo),r[0]!==this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;if(!i.containment){this.containment=null;return}if(i.containment==="window"){this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment==="document"){this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment.constructor===Array){this.containment=i.containment;return}i.containment==="parent"&&(i.containment=this.helper[0].parentNode),n=e(i.containment),r=n[0];if(!r)return;t=n.css("overflow")!=="hidden",this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:i.scrollTop(),left:i.scrollLeft()}),{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=t.pageX,f=t.pageY;return this.offset.scroll||(this.offset.scroll={top:u.scrollTop(),left:u.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(f=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(f=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((f-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,f=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,a=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:f-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t==="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper==="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var s=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s})),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&t.scrollParent[0].tagName!=="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;if(n.scrollParent[0]!==document&&n.scrollParent[0].tagName!=="HTML"){if(!r.axis||r.axis!=="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!=="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!=="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!=="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--){u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height;if(g<u-v||m>a+v||b<f-v||y>l+v||!e.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)){p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1;continue}d.snapMode!=="inner"&&(r=Math.abs(f-b)<=v,i=Math.abs(l-y)<=v,s=Math.abs(u-g)<=v,o=Math.abs(a-m)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,d.snapMode!=="outer"&&(r=Math.abs(f-y)<=v,i=Math.abs(l-b)<=v,s=Math.abs(u-m)<=v,o=Math.abs(a-g)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!r.length)return;t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length)}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})})(e)}),define("jqueryui/position",["jquery"],function(e){(function(e,t){function h(e,t,n){return[parseFloat(e[0])*(l.test(e[0])?t/100:1),parseFloat(e[1])*(l.test(e[1])?n/100:1)]}function p(t,n){return parseInt(e.css(t,n),10)||0}function d(t){var n=t[0];return n.nodeType===9?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,r=Math.max,i=Math.abs,s=Math.round,o=/left|center|right/,u=/top|center|bottom/,a=/[\+\-]\d+(\.[\d]+)?%?/,f=/^\w+/,l=/%$/,c=e.fn.position;e.position={scrollbarWidth:function(){if(n!==t)return n;var r,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=s.children()[0];return e("body").append(s),r=o.offsetWidth,s.css("overflow","scroll"),i=o.offsetWidth,r===i&&(i=s[0].clientWidth),s.remove(),n=r-i},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),i=n==="scroll"||n==="auto"&&t.width<t.element[0].scrollWidth,s=r==="scroll"||r==="auto"&&t.height<t.element[0].scrollHeight;return{width:s?e.position.scrollbarWidth():0,height:i?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),r=e.isWindow(n[0]),i=!!n[0]&&n[0].nodeType===9;return{element:n,isWindow:r,isDocument:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:r?n.width():n.outerWidth(),height:r?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return c.apply(this,arguments);t=e.extend({},t);var n,l,v,m,g,y,b=e(t.of),w=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(w),S=(t.collision||"flip").split(" "),x={};return y=d(b),b[0].preventDefault&&(t.at="left top"),l=y.width,v=y.height,m=y.offset,g=e.extend({},m),e.each(["my","at"],function(){var e=(t[this]||"").split(" "),n,r;e.length===1&&(e=o.test(e[0])?e.concat(["center"]):u.test(e[0])?["center"].concat(e):["center","center"]),e[0]=o.test(e[0])?e[0]:"center",e[1]=u.test(e[1])?e[1]:"center",n=a.exec(e[0]),r=a.exec(e[1]),x[this]=[n?n[0]:0,r?r[0]:0],t[this]=[f.exec(e[0])[0],f.exec(e[1])[0]]}),S.length===1&&(S[1]=S[0]),t.at[0]==="right"?g.left+=l:t.at[0]==="center"&&(g.left+=l/2),t.at[1]==="bottom"?g.top+=v:t.at[1]==="center"&&(g.top+=v/2),n=h(x.at,l,v),g.left+=n[0],g.top+=n[1],this.each(function(){var o,u,a=e(this),f=a.outerWidth(),c=a.outerHeight(),d=p(this,"marginLeft"),y=p(this,"marginTop"),T=f+d+p(this,"marginRight")+E.width,N=c+y+p(this,"marginBottom")+E.height,C=e.extend({},g),k=h(x.my,a.outerWidth(),a.outerHeight());t.my[0]==="right"?C.left-=f:t.my[0]==="center"&&(C.left-=f/2),t.my[1]==="bottom"?C.top-=c:t.my[1]==="center"&&(C.top-=c/2),C.left+=k[0],C.top+=k[1],e.support.offsetFractions||(C.left=s(C.left),C.top=s(C.top)),o={marginLeft:d,marginTop:y},e.each(["left","top"],function(r,i){e.ui.position[S[r]]&&e.ui.position[S[r]][i](C,{targetWidth:l,targetHeight:v,elemWidth:f,elemHeight:c,collisionPosition:o,collisionWidth:T,collisionHeight:N,offset:[n[0]+k[0],n[1]+k[1]],my:t.my,at:t.at,within:w,elem:a})}),t.using&&(u=function(e){var n=m.left-C.left,s=n+l-f,o=m.top-C.top,u=o+v-c,h={target:{element:b,left:m.left,top:m.top,width:l,height:v},element:{element:a,left:C.left,top:C.top,width:f,height:c},horizontal:s<0?"left":n>0?"right":"center",vertical:u<0?"top":o>0?"bottom":"middle"};l<f&&i(n+s)<l&&(h.horizontal="center"),v<c&&i(o+u)<v&&(h.vertical="middle"),r(i(n),i(s))>r(i(o),i(u))?h.important="horizontal":h.important="vertical",t.using.call(this,e,h)}),a.offset(e.extend(C,{using:u}))})},e.ui.position={fit:{left:function(e,t){var n=t.within,i=n.isWindow?n.scrollLeft:n.offset.left,s=n.width,o=e.left-t.collisionPosition.marginLeft,u=i-o,a=o+t.collisionWidth-s-i,f;t.collisionWidth>s?u>0&&a<=0?(f=e.left+u+t.collisionWidth-s-i,e.left+=u-f):a>0&&u<=0?e.left=i:u>a?e.left=i+s-t.collisionWidth:e.left=i:u>0?e.left+=u:a>0?e.left-=a:e.left=r(e.left-o,e.left)},top:function(e,t){var n=t.within,i=n.isWindow?n.scrollTop:n.offset.top,s=t.within.height,o=e.top-t.collisionPosition.marginTop,u=i-o,a=o+t.collisionHeight-s-i,f;t.collisionHeight>s?u>0&&a<=0?(f=e.top+u+t.collisionHeight-s-i,e.top+=u-f):a>0&&u<=0?e.top=i:u>a?e.top=i+s-t.collisionHeight:e.top=i:u>0?e.top+=u:a>0?e.top-=a:e.top=r(e.top-o,e.top)}},flip:{left:function(e,t){var n=t.within,r=n.offset.left+n.scrollLeft,s=n.width,o=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,a=u-o,f=u+t.collisionWidth-s-o,l=t.my[0]==="left"?-t.elemWidth:t.my[0]==="right"?t.elemWidth:0,c=t.at[0]==="left"?t.targetWidth:t.at[0]==="right"?-t.targetWidth:0,h=-2*t.offset[0],p,d;if(a<0){p=e.left+l+c+h+t.collisionWidth-s-r;if(p<0||p<i(a))e.left+=l+c+h}else if(f>0){d=e.left-t.collisionPosition.marginLeft+l+c+h-o;if(d>0||i(d)<f)e.left+=l+c+h}},top:function(e,t){var n=t.within,r=n.offset.top+n.scrollTop,s=n.height,o=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,a=u-o,f=u+t.collisionHeight-s-o,l=t.my[1]==="top",c=l?-t.elemHeight:t.my[1]==="bottom"?t.elemHeight:0,h=t.at[1]==="top"?t.targetHeight:t.at[1]==="bottom"?-t.targetHeight:0,p=-2*t.offset[1],d,v;a<0?(v=e.top+c+h+p+t.collisionHeight-s-r,e.top+c+h+p>a&&(v<0||v<i(a))&&(e.top+=c+h+p)):f>0&&(d=e.top-t.collisionPosition.marginTop+c+h+p-o,e.top+c+h+p>f&&(d>0||i(d)<f)&&(e.top+=c+h+p))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,r,i,s,o=document.getElementsByTagName("body")[0],u=document.createElement("div");t=document.createElement(o?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},o&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"});for(s in r)t.style[s]=r[s];t.appendChild(u),n=o||document.documentElement,n.insertBefore(t,n.firstChild),u.style.cssText="position: absolute; left: 10.7432222px;",i=e(u).offset().left,e.support.offsetFractions=i>10&&i<11,t.innerHTML="",n.removeChild(t)}()})(e)}),define("jqueryui/resizable",["jquery","./core","./mouse","./widget"],function(e){(function(e,t){function n(e){return parseInt(e,10)||0}function r(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,n,r,i,s,o=this,u=this.options;this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!u.aspectRatio,aspectRatio:u.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:u.helper||u.ghost||u.animate?u.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=u.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor===String){this.handles==="all"&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={};for(n=0;n<t.length;n++)r=e.trim(t[n]),s="ui-resizable-"+r,i=e("<div class='ui-resizable-handle "+s+"'></div>"),i.css({zIndex:u.zIndex}),"se"===r&&i.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(i)}this._renderAxis=function(t){var n,r,i,s;t=t||this.element;for(n in this.handles){this.handles[n].constructor===String&&(this.handles[n]=e(this.handles[n],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(r=e(this.handles[n],this.element),s=/sw|ne|nw|se|n|s/.test(n)?r.outerHeight():r.outerWidth(),i=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(i,s),this._proportionallyResize());if(!e(this.handles[n]).length)continue}},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(i=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=i&&i[1]?i[1]:"se")}),u.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){if(u.disabled)return;e(this).removeClass("ui-resizable-autohide"),o._handles.show()}).mouseleave(function(){if(u.disabled)return;o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_mouseCapture:function(t){var n,r,i=!1;for(n in this.handles){r=e(this.handles[n])[0];if(r===t.target||e.contains(r,t.target))i=!0}return!this.options.disabled&&i},_mouseStart:function(t){var r,i,s,o=this.options,u=this.element.position(),a=this.element;return this.resizing=!0,/absolute/.test(a.css("position"))?a.css({position:"absolute",top:a.css("top"),left:a.css("left")}):a.is(".ui-draggable")&&a.css({position:"absolute",top:u.top,left:u.left}),this._renderProxy(),r=n(this.helper.css("left")),i=n(this.helper.css("top")),o.containment&&(r+=e(o.containment).scrollLeft()||0,i+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:r,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:a.width(),height:a.height()},this.originalSize=this._helper?{width:a.outerWidth(),height:a.outerHeight()}:{width:a.width(),height:a.height()},this.originalPosition={left:r,top:i},this.sizeDiff={width:a.outerWidth()-a.width(),height:a.outerHeight()-a.height()},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=typeof o.aspectRatio=="number"?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,s=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor",s==="auto"?this.axis+"-resize":s),a.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,r=this.helper,i={},s=this.originalMousePosition,o=this.axis,u=this.position.top,a=this.position.left,f=this.size.width,l=this.size.height,c=t.pageX-s.left||0,h=t.pageY-s.top||0,p=this._change[o];if(!p)return!1;n=p.apply(this,[t,c,h]),this._updateVirtualBoundaries(t.shiftKey);if(this._aspectRatio||t.shiftKey)n=this._updateRatio(n,t);return n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),this.position.top!==u&&(i.top=this.position.top+"px"),this.position.left!==a&&(i.left=this.position.left+"px"),this.size.width!==f&&(i.width=this.size.width+"px"),this.size.height!==l&&(i.height=this.size.height+"px"),r.css(i),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||this._trigger("resize",t,this.ui()),!1},_mouseStop:function(t){this.resizing=!1;var n,r,i,s,o,u,a,f=this.options,l=this;return this._helper&&(n=this._proportionallyResizeElements,r=n.length&&/textarea/i.test(n[0].nodeName),i=r&&e.ui.hasScroll(n[0],"left")?0:l.sizeDiff.height,s=r?0:l.sizeDiff.width,o={width:l.helper.width()-s,height:l.helper.height()-i},u=parseInt(l.element.css("left"),10)+(l.position.left-l.originalPosition.left)||null,a=parseInt(l.element.css("top"),10)+(l.position.top-l.originalPosition.top)||null,f.animate||this.element.css(e.extend(o,{top:a,left:u})),l.helper.height(l.size.height),l.helper.width(l.size.width),this._helper&&!f.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,i,s,o,u=this.options;o={minWidth:r(u.minWidth)?u.minWidth:0,maxWidth:r(u.maxWidth)?u.maxWidth:Infinity,minHeight:r(u.minHeight)?u.minHeight:0,maxHeight:r(u.maxHeight)?u.maxHeight:Infinity};if(this._aspectRatio||e)t=o.minHeight*this.aspectRatio,i=o.minWidth/this.aspectRatio,n=o.maxHeight*this.aspectRatio,s=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),i>o.minHeight&&(o.minHeight=i),n<o.maxWidth&&(o.maxWidth=n),s<o.maxHeight&&(o.maxHeight=s);this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),r(e.left)&&(this.position.left=e.left),r(e.top)&&(this.position.top=e.top),r(e.height)&&(this.size.height=e.height),r(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return r(e.height)?e.width=e.height*this.aspectRatio:r(e.width)&&(e.height=e.width/this.aspectRatio),i==="sw"&&(e.left=t.left+(n.width-e.width),e.top=null),i==="nw"&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=r(e.width)&&t.maxWidth&&t.maxWidth<e.width,s=r(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=r(e.width)&&t.minWidth&&t.minWidth>e.width,u=r(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,f=this.position.top+this.size.height,l=/sw|nw|w/.test(n),c=/nw|ne|n/.test(n);return o&&(e.width=t.minWidth),u&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),s&&(e.height=t.maxHeight),o&&l&&(e.left=a-t.minWidth),i&&l&&(e.left=a-t.maxWidth),u&&c&&(e.top=f-t.minHeight),s&&c&&(e.top=f-t.maxHeight),!e.width&&!e.height&&!e.left&&e.top?e.top=null:!e.width&&!e.height&&!e.top&&e.left&&(e.left=null),e},_proportionallyResize:function(){if(!this._proportionallyResizeElements.length)return;var e,t,n,r,i,s=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){i=this._proportionallyResizeElements[e];if(!this.borderDif){this.borderDif=[],n=[i.css("borderTopWidth"),i.css("borderRightWidth"),i.css("borderBottomWidth"),i.css("borderLeftWidth")],r=[i.css("paddingTop"),i.css("paddingRight"),i.css("paddingBottom"),i.css("paddingLeft")];for(t=0;t<n.length;t++)this.borderDif[t]=(parseInt(n[t],10)||0)+(parseInt(r[t],10)||0)}i.css({height:s.height()-this.borderDif[0]-this.borderDif[2]||0,width:s.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize,r=this.originalPosition;return{left:r.left+t,width:n.width-t}},n:function(e,t,n){var r=this.originalSize,i=this.originalPosition;return{top:i.top+n,height:r.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},sw:function(t,n,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,r]))},ne:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,r]))},nw:function(t,n,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,r]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),t!=="resize"&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).data("ui-resizable"),r=n.options,i=n._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),o=s&&e.ui.hasScroll(i[0],"left")?0:n.sizeDiff.height,u=s?0:n.sizeDiff.width,a={width:n.size.width-u,height:n.size.height-o},f=parseInt(n.element.css("left"),10)+(n.position.left-n.originalPosition.left)||null,l=parseInt(n.element.css("top"),10)+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,l&&f?{top:l,left:f}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(n.element.css("width"),10),height:parseInt(n.element.css("height"),10),top:parseInt(n.element.css("top"),10),left:parseInt(n.element.css("left"),10)};i&&i.length&&e(i[0]).css({width:r.width,height:r.height}),n._updateCache(r),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,r,i,s,o,u,a,f=e(this).data("ui-resizable"),l=f.options,c=f.element,h=l.containment,p=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;if(!p)return;f.containerElement=e(p),/document/.test(h)||h===document?(f.containerOffset={left:0,top:0},f.containerPosition={left:0,top:0},f.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(p),r=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){r[e]=n(t.css("padding"+i))}),f.containerOffset=t.offset(),f.containerPosition=t.position(),f.containerSize={height:t.innerHeight()-r[3],width:t.innerWidth()-r[1]},i=f.containerOffset,s=f.containerSize.height,o=f.containerSize.width,u=e.ui.hasScroll(p,"left")?p.scrollWidth:o,a=e.ui.hasScroll(p)?p.scrollHeight:s,f.parentData={element:p,left:i.left,top:i.top,width:u,height:a})},resize:function(t){var n,r,i,s,o=e(this).data("ui-resizable"),u=o.options,a=o.containerOffset,f=o.position,l=o._aspectRatio||t.shiftKey,c={top:0,left:0},h=o.containerElement;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),f.left<(o._helper?a.left:0)&&(o.size.width=o.size.width+(o._helper?o.position.left-a.left:o.position.left-c.left),l&&(o.size.height=o.size.width/o.aspectRatio),o.position.left=u.helper?a.left:0),f.top<(o._helper?a.top:0)&&(o.size.height=o.size.height+(o._helper?o.position.top-a.top:o.position.top),l&&(o.size.width=o.size.height*o.aspectRatio),o.position.top=o._helper?a.top:0),o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top,n=Math.abs((o._helper?o.offset.left-c.left:o.offset.left-c.left)+o.sizeDiff.width),r=Math.abs((o._helper?o.offset.top-c.top:o.offset.top-a.top)+o.sizeDiff.height),i=o.containerElement.get(0)===o.element.parent().get(0),s=/relative|absolute/.test(o.containerElement.css("position")),i&&s&&(n-=Math.abs(o.parentData.left)),n+o.size.width>=o.parentData.width&&(o.size.width=o.parentData.width-n,l&&(o.size.height=o.size.width/o.aspectRatio)),r+o.size.height>=o.parentData.height&&(o.size.height=o.parentData.height-r,l&&(o.size.width=o.size.height*o.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.containerOffset,i=t.containerPosition,s=t.containerElement,o=e(t.helper),u=o.offset(),a=o.outerWidth()-t.sizeDiff.width,f=o.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f}),t._helper&&!n.animate&&/static/.test(s.css("position"))&&e(this).css({left:u.left-i.left-r.left,width:a,height:f})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};typeof n.alsoResize=="object"&&!n.alsoResize.parentNode?n.alsoResize.length?(n.alsoResize=n.alsoResize[0],r(n.alsoResize)):e.each(n.alsoResize,function(e){r(e)}):r(n.alsoResize)},resize:function(t,n){var r=e(this).data("ui-resizable"),i=r.options,s=r.originalSize,o=r.originalPosition,u={height:r.size.height-s.height||0,width:r.size.width-s.width||0,top:r.position.top-o.top||0,left:r.position.left-o.left||0},a=function(t,r){e(t).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),s={},o=r&&r.length?r:t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var n=(i[t]||0)+(u[t]||0);n&&n>=0&&(s[t]=n||null)}),t.css(s)})};typeof i.alsoResize=="object"&&!i.alsoResize.nodeType?e.each(i.alsoResize,function(e,t){a(e,t)}):a(i.alsoResize)},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass(typeof n.ghost=="string"?n.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),n=t.options,r=t.size,i=t.originalSize,s=t.originalPosition,o=t.axis,u=typeof n.grid=="number"?[n.grid,n.grid]:n.grid,a=u[0]||1,f=u[1]||1,l=Math.round((r.width-i.width)/a)*a,c=Math.round((r.height-i.height)/f)*f,h=i.width+l,p=i.height+c,d=n.maxWidth&&n.maxWidth<h,v=n.maxHeight&&n.maxHeight<p,m=n.minWidth&&n.minWidth>h,g=n.minHeight&&n.minHeight>p;n.grid=u,m&&(h+=a),g&&(p+=f),d&&(h-=a),v&&(p-=f),/^(se|s|e)$/.test(o)?(t.size.width=h,t.size.height=p):/^(ne)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.top=s.top-c):/^(sw)$/.test(o)?(t.size.width=h,t.size.height=p,t.position.left=s.left-l):(p-f>0?(t.size.height=p,t.position.top=s.top-c):(t.size.height=f,t.position.top=s.top+i.height-f),h-a>0?(t.size.width=h,t.position.left=s.left-l):(t.size.width=a,t.position.left=s.left+i.width-a))}})})(e)}),define("jqueryui/dialog",["jquery","./core","./widget","./button","./draggable","./mouse","./position","./resizable"],function(e){(function(e,t){var n={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},r={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:I18n.t("common.close"),dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var n=e(this).css(t).offset().top;n<0&&e(this).css("top",t.top-n)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element),this._trigger("destroy",self)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var n,r=this;if(!this._isOpen||this._trigger("beforeClose",t)===!1)return;this._isOpen=!1,this._destroyOverlay();if(!this.opener.filter(":focusable").focus().length)try{n=this.document[0].activeElement,n&&n.nodeName.toLowerCase()!=="body"&&e(n).blur()}catch(i){}this._hide(this.uiDialog,this.options.hide,function(){r._trigger("close",t)})},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var n=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return n&&!t&&this._trigger("focus",e),n},open:function(){var t=this;if(this._isOpen){this._moveToTop()&&this._focusTabbable();return}this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._trigger("open")},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function n(){var t=this.document[0].activeElement,n=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);n||this._focusTabbable()}t.preventDefault(),n.call(this),this._delay(n)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE){t.preventDefault(),this.close(t);return}if(t.keyCode!==e.ui.keyCode.TAB)return;var n=this.uiDialog.find(":tabbable"),r=n.filter(":first"),i=n.filter(":last");t.target!==i[0]&&t.target!==this.uiDialog[0]||!!t.shiftKey?(t.target===r[0]||t.target===this.uiDialog[0])&&t.shiftKey&&(i.focus(1),t.preventDefault()):(r.focus(1),t.preventDefault())},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.html(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,n=this.options.buttons;this.uiDialogButtonPane.remove(),this.uiButtonSet.empty();if(e.isEmptyObject(n)||e.isArray(n)&&!n.length){this.uiDialog.removeClass("ui-dialog-buttons");return}e.each(n,function(n,r){var i,s;r=e.isFunction(r)?{click:r,text:n}:r,r=e.extend({type:"button"},r),i=r.click,r.click=function(){i.apply(t.element[0],arguments)},s={icons:r.icons,text:r.showText},delete r.icons,delete r.showText,e("<button></button>",r).button(s).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog)},_makeDraggable:function(){function r(e){return{position:e.position,offset:e.offset}}var t=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,i){e(this).addClass("ui-dialog-dragging"),t._blockFrames(),t._trigger("dragStart",n,r(i))},drag:function(e,n){t._trigger("drag",e,r(n))},stop:function(i,s){n.position=[s.position.left-t.document.scrollLeft(),s.position.top-t.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),t._unblockFrames(),t._trigger("dragStop",i,r(s))}})},_makeResizable:function(){function o(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var t=this,n=this.options,r=n.resizable,i=this.uiDialog.css("position"),s=typeof r=="string"?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){e(this).addClass("ui-dialog-resizing"),t._blockFrames(),t._trigger("resizeStart",n,o(r))},resize:function(e,n){t._trigger("resize",e,o(n))},stop:function(r,i){n.height=e(this).height(),n.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),t._unblockFrames(),t._trigger("resizeStop",r,o(i))}}).css("position",i)},_minHeight:function(){var e=this.options;return e.height==="auto"?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,o={};e.each(t,function(e,t){i._setOption(e,t),e in n&&(s=!0),e in r&&(o[e]=t)}),s&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",o)},_setOption:function(e,t){var n,r,i=this.uiDialog;e==="dialogClass"&&i.removeClass(this.options.dialogClass).addClass(t);if(e==="disabled")return;this._super(e,t),e==="appendTo"&&this.uiDialog.appendTo(this._appendTo()),e==="buttons"&&this._createButtons(),e==="closeText"&&this.uiDialogTitlebarClose.button({label:""+t}),e==="draggable"&&(n=i.is(":data(ui-draggable)"),n&&!t&&i.draggable("destroy"),!n&&t&&this._makeDraggable()),e==="position"&&this._position(),e==="resizable"&&(r=i.is(":data(ui-resizable)"),r&&!t&&i.resizable("destroy"),r&&typeof t=="string"&&i.resizable("option","handles",t),!r&&t!==!1&&this._makeResizable()),e==="title"&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title"))},_size:function(){var e,t,n,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),n=typeof r.maxHeight=="number"?Math.max(0,r.maxHeight-e):"none",r.height==="auto"?this.element.css({minHeight:t,maxHeight:n,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(!this.options.modal)return;var t=this,n=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(r){t._allowInteraction(r)||(r.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(n)._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++},_destroyOverlay:function(){if(!this.options.modal)return;this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t=this.options.position,n=[],r=[0,0],i;if(t){if(typeof t=="string"||typeof t=="object"&&"0"in t)n=t.split?t.split(" "):[t[0],t[1]],n.length===1&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),t={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")};t=e.extend({},e.ui.dialog.prototype.options.position,t)}else t=e.ui.dialog.prototype.options.position;i=this.uiDialog.is(":visible"),i||this.uiDialog.show(),this.uiDialog.position(t),i||this.uiDialog.hide()}})})(e)}),define("modules/dialog",["jquery","jqueryui/dialog","require/underscore-string"],function(t,n,r){var i=(I18n.translations[I18n.locale]||{}).dialog||{common:{},remove:{ok:"OK",cancel:"Cancel"}},s=t.browser.msie&&parseInt(t.browser.version,10)==7,o=i.title,u=t('<div id="tibbr-ui-dialog" />'),a='<span style="float: left; margin-left: -18px;" />',f=i.common.cancel,l=i.common.ok,c=function(e,n){var r=t('<p id="dialog-message" style=" margin: 0px 0 10px 10px; line-height: 1.3;"/>');r.append(h(n)).append(e),u.html(r)},h=function(e){return e=e||"info",t(a).addClass("ui-icon ui-icon-"+e)},p=function(e,n,r){n=n||{};var i="tibbr-ui-dialog",o=requirejs("tibbr"),u=(n.className||"")+" "+i,a=function(){if(window.gadget){var e=t(window).width()-50,r=n.width;return r?e<r?e:r:"auto"}return n.width||700},f=n.height||"auto",l=n.resizable||!1,c=n.modal===undefined?!0:n.modal,h=window.gadget&&n.target?{my:"center top",at:"center top",of:t(n.target)}:n.position||"center",p=n.max_height||t(window).height()-100,d={},v=t("<div />",{"class":"tibbr-ui-dialog-box",id:"dialog-"+(r||{cid:"unique"}).cid}).data("view",r),m=n.position_on_create===undefined?!1:n.position_on_create;return v.html(t('<div class="ui-dialog-message"/>').append(e)).dialog({modal:c,title:n.title||"",zIndex:14e3,width:a(),height:f,closeOnEscape:!1,resizable:l,buttons:d,dialogClass:u,create:function(){m&&t(this).dialog("option","position",h)},open:function(){try{t(".qtip").qtip("hide")}catch(e){}t(document).trigger("scroll:stop");var r=t(this),i=r.data("view");r.on("click",".js-cancel",function(e){e.preventDefault(),r.dialog("destroy").remove()});if(n.title){var u=r.dialog("option","dialogClass");r.dialog("option","dialogClass",u+" with-title")}n.canClose===!1&&r.data("uiDialog").uiDialogTitlebarClose.remove(),s&&_.delay(function(){v.parent().find(".ui-dialog-titlebar").width(v.width())},15),p&&r.css({"max-height":p,"overflow-y":"auto"}),typeof n.open=="function"&&n.open(r),window.gadget?(o.publish("dialog.open",window.tib_client_id),_.delay(function(){r.dialog("option","position",h)},80)):_.delay(function(){r.dialog("option","position",h)},10)},destroy:function(){t(document).trigger("scroll:resume");var e=t(this),n=e.data("view");n&&(n.leave(),n=null),window.gadget&&o.publish("dialog.close",window.tib_client_id),v=null},close:function(){var e=t(this);s&&t(this).parent().css("width","auto"),typeof n.close=="function"&&n.close(r),e.dialog("destroy").remove()}}),v},d=function(e,n){n=n||{};var r=this,i,o=n.fetch,u=n.data,a=n.dialog||{},f=n.complete,l=n.render||"render",c=function(e){if(e.dialogTitle){var n=e.dialogTitle,r=i.dialog("option","dialogClass");n=n instanceof t?n.html():n,i.dialog("option","title",n),i.dialog("option","dialogClass",r+" with-title"),s&&i.parent().find(".ui-dialog-titlebar").width(i.width())}};a.close=a.close||n.close,delete n.fetch,delete n.dialog,delete n.data,delete n.complete,delete n.close,delete n.render;var h=typeof e=="function"?new e(n):e;h.dialog=r,i=r.view("",a,h),h.$dialog=i,h.closeDialog=function(){this.$dialog.dialog("close")},h.dialog.close=t.proxy(function(){this.$dialog.dialog("close")},h),!o||o.fetched?(i.find(".ui-dialog-message").html(h[l]().el),typeof h.bind=="function"&&h.bind(),typeof f=="function"&&f(h),c(h)):o.fetch({data:u||o.dataParams||{},success:function(){o.fetched=!0,i.find(".ui-dialog-message").html(h[l]().el),typeof h.bind=="function"&&h.bind(),typeof f=="function"&&f(h),c(h),i.trigger("dialogopen")},beforeSend:function(){i.find(".ui-dialog-message").html(window.loader)}})},v=function(e){var n=e.title||"",r=e.text||"",i=e.type,s=e.okFunction||e.ok_function,o=e.dialogClass,a=e.width,f=window.gadget&&e.target?{my:"right",at:"left",of:t(e.target)}:e.position||[];c(r,i);var h={};h[l]=function(){typeof s=="function"&&s(),g()},u.dialog({modal:!0,title:n,closeOnEscape:!1,resizable:!1,zIndex:99999,position:f,buttons:h,open:function(e){var n=t(e.target).parent();n.find(".ui-button-text").each(function(e){t(this).html(t(this).parent().attr("text"))}),n.find("button.ui-dialog-titlebar-close").remove(),o!==undefined&&u.dialog("option","dialogClass",o),a!==undefined&&u.dialog("option","width",a)}})},m=function(e){var n=e.okFunction,r=e.cancelFunction,i=e.cancelLabel||f,s=e.saveLabel||l,o=e.dialogClass,a=e.title||"",h=e.text,p=e.width||300,d=window.gadget&&e.target?{my:"right",at:"left",of:t(e.target)}:e.position||[],v=[{text:s,click:function(){var e=t("p#dialog_message");t("div.ui-dialog-buttonpane").hide(),e.html(spinner),typeof n=="function"&&n(),g()}},{text:i,click:function(){typeof r=="function"&&r(),g()}}];c(h,"alert"),u.dialog({bgiframe:!0,title:a,resizable:!1,closeOnEscape:!1,zIndex:99999,minHeight:100,minWidth:p,modal:!0,buttons:v,position:d,open:function(e){var n=t(e.target).parent();n.find(".ui-button-text").each(function(e){t(this).html(t(this).parent().attr("text"))}),n.find("button.ui-dialog-titlebar-close").remove(),o!==undefined&&u.dialog("option","dialogClass",o),p!==undefined&&u.dialog("option","width",p)}})},g=function(){u.dialog("destroy").remove()},y={confirm:function(e){var t=e.okFunction,n=e.cancelFunction;window.confirm(e.text)?typeof t=="function"&&t():typeof n=="function"&&n()}};return t.ui.dialog.prototype._focusTabbable=function(){},{isOpen:function(){return t("div#tibbr-ui-dialog").length>0},close:function(){u.dialog("close")},closeAll:function(){t(".ui-dialog").empty().remove()},alert:function(e){e=e||{};var t=r.trim(e.text);if(t.length===0||t==="0:abort")return!0;this.isOpen()?alert(e.text):(e.type="alert",v(e))},message:function(e){e.type=e.type||"check",v(e)},view:p,render:d,remove:function(e){e.saveLabel=i.remove.ok,e.cancelLabel=i.remove.cancel,this.confirm(e)},resize:function(){},confirm:function(e){this.isOpen()?y.confirm(e):m(e)}}}),define("require/colorbox",["jquery"],function(e){(function(e,t,n){function Y(n,r,i){var o=t.createElement(n);return r&&(o.id=s+r),i&&(o.style.cssText=i),e(o)}function Z(){return n.innerHeight?n.innerHeight:e(n).height()}function et(e){var t=E.length,n=(q+e)%t;return n<0?t+n:n}function tt(e,t){return Math.round((/%/.test(e)?(t==="x"?S.width():Z())/100:1)*parseInt(e,10))}function nt(e,t){return e.photo||e.photoRegex.test(t)}function rt(e,t){return e.retinaUrl&&n.devicePixelRatio>1?t.replace(e.photoRegex,e.retinaSuffix):t}function it(e){"contains"in d[0]&&!d[0].contains(e.target)&&(e.stopPropagation(),d.focus())}function st(){var t,n=e.data(I,i);n===null?(P=e.extend({},r),console&&console.log&&console.log("Error: cboxElement missing settings object")):P=e.extend({},n);for(t in P)e.isFunction(P[t])&&t.slice(0,2)!=="on"&&(P[t]=P[t].call(I));P.rel=e(I).attr("oldtitle")||P.rel||I.rel||e(I).data("rel")||"nofollow",P.href=P.href||e(I).attr("href"),P.title=P.title||I.title,P.info=P.info?e(I).html()||e(P.target).html():"",P.title=e(I).attr("title")||e(P.target).attr("title"),typeof P.href=="string"&&(P.href=e.trim(P.href))}function ot(n,r){e(t).trigger(n),D.triggerHandler(n),e.isFunction(r)&&r.call(I)}function at(n){W||(I=n,st(),E=e(I),q=0,P.multiPhotos?(E=e("[rel='"+P.rel+"']").data(i,P),P.target?(q=E.index(P.target),P.target=null):q=E.index(I),P.href=e(I).attr("href"),P.title=e(I).attr("title")):P.rel!=="nofollow"&&(E=e("."+o).filter(function(){var t=e.data(this,i),n;return t&&(n=e(this).data("rel")||t.rel||this.rel),n===P.rel}),q=E.index(I),q===-1&&(E=E.add(I),q=E.length-1)),p.css({opacity:parseFloat(P.opacity),cursor:P.overlayClose?"pointer":"auto",visibility:"visible"}).show(),J&&d.add(p).removeClass(J),P.className&&d.add(p).addClass(P.className),J=P.className,P.closeButton?M.html(P.close).appendTo(m):M.appendTo("<div/>"),U||(U=z=!0,d.css({visibility:"hidden",display:"block"}),x=Y($,"LoadedContent","width:0; height:0; overflow:hidden"),m.css({width:"",height:""}).append(x),H=g.height()+w.height()+m.outerHeight(!0)-m.height(),B=y.width()+b.width()+m.outerWidth(!0)-m.width(),j=x.outerHeight(!0),F=x.outerWidth(!0),P.multiPhotos&&p.addClass("slideshow"),P.w=tt(P.initialWidth,"x"),P.h=tt(P.initialHeight,"y"),x.css({width:"",height:P.h}),V.position(),ot(u,P.onOpen),_.add(C).hide(),d.focus(),P.trapFocus&&t.addEventListener&&(t.addEventListener("focus",it,!0),D.one(c,function(){t.removeEventListener("focus",it,!0)})),P.returnFocus&&D.one(c,function(){e(I).focus()})),ct())}function ft(){!d&&t.body&&(G=!1,S=e(n),d=Y($).attr({id:i,"class":e.support.opacity===!1?s+"IE":"",role:"dialog",tabindex:"-1"}).hide(),p=Y($,"Overlay").hide(),N=e([Y($,"LoadingOverlay")[0],Y($,"LoadingGraphic")[0]]),v=Y($,"Wrapper"),m=Y($,"Content").append(C=Y($,"Title"),k=Y($,"Current"),O=e('<button type="button"/>').attr({id:s+"Previous"}),A=e('<button type="button"/>').attr({id:s+"Next"}),L=Y("button","Slideshow"),N),M=e('<button type="button"/>').attr({id:s+"Close"}),v.append(Y($).append(Y($,"TopLeft"),g=Y($,"TopCenter"),Y($,"TopRight")),Y($,!1,"clear:left").append(y=Y($,"MiddleLeft"),m,b=Y($,"MiddleRight")),Y($,!1,"clear:left").append(Y($,"BottomLeft"),w=Y($,"BottomCenter"),Y($,"BottomRight"))).find("div div").css({"float":"left"}),T=Y($,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),_=A.add(O).add(k).add(L),e(t.body).append(p,d.append(v,T)))}function lt(){function n(e){e.which>1||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey||(e.preventDefault(),at(this))}return d?(G||(G=!0,A.click(function(){V.next()}),O.click(function(){V.prev()}),M.click(function(){V.close()}),p.click(function(){P.overlayClose&&V.close()}),e(t).bind("keydown."+s,function(e){var t=e.keyCode;U&&P.escKey&&t===27&&(e.preventDefault(),V.close()),U&&P.arrowKey&&E[1]&&!e.altKey&&(t===37?(e.preventDefault(),O.click()):t===39&&(e.preventDefault(),A.click()))}),e.isFunction(e.fn.on)?e(t).on("click."+s,"."+o,n):e("."+o).live("click."+s,n)),!0):!1}function ct(){var r,i,o=V.prep,u,f=++K;z=!0,R=!1,I=E[q],st(),ot(h),ot(a,P.onLoad),P.h=P.height?tt(P.height,"y")-j-H:P.innerHeight&&tt(P.innerHeight,"y"),P.w=P.width?tt(P.width,"x")-F-B:P.innerWidth&&tt(P.innerWidth,"x"),P.mw=P.w,P.mh=P.h,P.maxWidth&&(P.mw=tt(P.maxWidth,"x")-F-B,P.mw=P.w&&P.w<P.mw?P.w:P.mw),P.maxHeight&&(P.mh=tt(P.maxHeight,"y")-j-H,P.mh=P.h&&P.h<P.mh?P.h:P.mh),r=P.href||e(I).attr("href"),X=setTimeout(function(){N.show()},100),P.inline?(u=Y($).hide().insertBefore(e(r)[0]),D.one(h,function(){u.replaceWith(x.children())}),o(e(r))):P.iframe?o(" "):P.html?o(P.html):nt(P,r)?(r=rt(P,r),R=t.createElement("img"),e(R).addClass(s+"Photo").bind("error",function(){P.title=!1,o(Y($,"Error").html(P.imgError))}).one("load",function(){var t;if(f!==K)return;e.each(["alt","longdesc","aria-describedby"],function(t,n){var r=e(I).attr(n)||e(I).attr("data-"+n);r&&R.setAttribute(n,r)}),P.retinaImage&&n.devicePixelRatio>1&&(R.height=R.height/n.devicePixelRatio,R.width=R.width/n.devicePixelRatio),P.scalePhotos&&(i=function(){R.height-=R.height*t,R.width-=R.width*t},P.mw&&R.width>P.mw&&(t=(R.width-P.mw)/R.width,i()),P.mh&&R.height>P.mh&&(t=(R.height-P.mh)/R.height,i())),P.h&&(R.style.marginTop=Math.max(P.mh-R.height,0)/2+"px"),E[1]&&(P.loop||E[q+1])&&(R.style.cursor="pointer",R.onclick=function(){V.next()}),R.style.width=R.width+"px",R.style.height=R.height+"px",setTimeout(function(){o(R)},1)}),setTimeout(function(){R.src=r},1)):r&&T.load(r,P.data,function(t,n){f===K&&o(n==="error"?Y($,"Error").html(P.xhrError):e(this).contents())})}var r={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!1,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:undefined,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:I18n.t("common.errors.content_error"),imgError:I18n.t("common.errors.image_error"),returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},i="colorbox",s="cbox",o=s+"Element",u=s+"_open",a=s+"_load",f=s+"_complete",l=s+"_cleanup",c=s+"_closed",h=s+"_purge",p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D=e("<a/>"),P,H,B,j,F,I,q,R,U,z,W,X,V,$="div",J,K=0,Q={},G,ut=function(){function i(){clearTimeout(r)}function o(){if(P.loop||E[q+1])i(),r=setTimeout(V.next,P.slideshowSpeed)}function u(){L.html(P.slideshowStop).unbind(n).one(n,c),D.bind(f,o).bind(a,i),d.removeClass(t+"off").addClass(t+"on")}function c(){i(),D.unbind(f,o).unbind(a,i),L.html(P.slideshowStart).unbind(n).one(n,function(){V.next(),u()}),d.removeClass(t+"on").addClass(t+"off")}function h(){e=!1,L.hide(),i(),D.unbind(f,o).unbind(a,i),d.removeClass(t+"off "+t+"on")}var e,t=s+"Slideshow_",n="click."+s,r;return function(){e?P.slideshow||(D.unbind(l,h),h()):P.slideshow&&E[1]&&(e=!0,D.one(l,h),P.slideshowAuto?u():c(),L.show())}}();if(e.colorbox)return;e(ft),V=e.fn[i]=e[i]=function(t,n){var s=this,u=e(t.target);t=t||{},ft();if(lt()){if(u)s=e("<a/>",{title:u.attr("oldtitle")}),t.multiPhotos||s.attr("href",u.attr("href")),t.open=!0;else if(e.isFunction(s))s=e("<a/>"),t.open=!0;else if(!s[0])return s;n&&(t.onComplete=n),s.each(function(){e.data(this,i,e.extend({},e.data(this,i)||r,t))}).addClass(o),(e.isFunction(t.open)&&t.open.call(s)||t.open)&&at(s[0])}return s},V.position=function(t,n){function l(){g[0].style.width=w[0].style.width=m[0].style.width=parseInt(d[0].style.width,10)-B+"px",m[0].style.height=y[0].style.height=b[0].style.height=parseInt(d[0].style.height,10)-H+"px"}var r,i=0,o=0,u=d.offset(),a,f;S.unbind("resize."+s),d.css({top:-9e4,left:-9e4}),a=S.scrollTop(),f=S.scrollLeft(),P.fixed?(u.top-=a,u.left-=f,d.css({position:"fixed"})):(i=a,o=f,d.css({position:"absolute"})),P.right!==!1?o+=Math.max(S.width()-P.w-F-B-tt(P.right,"x"),0):P.left!==!1?o+=tt(P.left,"x"):o+=Math.round(Math.max(S.width()-P.w-F-B,0)/2),P.bottom!==!1?i+=Math.max(Z()-P.h-j-H-tt(P.bottom,"y"),0):P.top!==!1?i+=tt(P.top,"y"):i+=Math.round(Math.max(Z()-P.h-j-H,0)/2),d.css({top:u.top,left:u.left,visibility:"visible"}),v[0].style.width=v[0].style.height="9999px",r={width:P.w+F+B,height:P.h+j+H,top:i,left:o};if(t){var c=0;e.each(r,function(e){if(r[e]!==Q[e]){c=t;return}}),t=c}Q=r,t||d.css(r),d.dequeue().animate(r,{duration:t||0,complete:function(){l(),z=!1,v[0].style.width=P.w+F+B+"px",v[0].style.height=P.h+j+H+"px",P.reposition&&setTimeout(function(){S.bind("resize."+s,V.position)},1),n&&n()},step:l})},V.resize=function(e){var t;U&&(e=e||{},e.width&&(P.w=tt(e.width,"x")-F-B),e.innerWidth&&(P.w=tt(e.innerWidth,"x")),x.css({width:P.w}),e.height&&(P.h=tt(e.height,"y")-j-H),e.innerHeight&&(P.h=tt(e.innerHeight,"y")),!e.innerHeight&&!e.height&&(t=x.scrollTop(),x.css({height:"auto"}),P.h=x.height()),x.css({height:P.h}),t&&x.scrollTop(t),V.position(P.transition==="none"?0:P.speed))},V.prep=function(n){function u(){return P.w=P.w||x.width(),P.w=P.mw&&P.mw<P.w?P.mw:P.w,P.w}function a(){return P.h=P.h||x.height(),P.h=P.mh&&P.mh<P.h?P.mh:P.h,P.h}if(!U)return;var r,o=P.transition==="none"?0:P.speed;x.empty().remove(),x=Y($,"LoadedContent").append(n),x.hide().appendTo(T.show()).css({width:u(),overflow:P.scrolling?"auto":"hidden"}).css({height:a()}).prependTo(m),T.hide(),e(R).css({"float":"none"}),r=function(){function c(){e.support.opacity===!1&&d[0].style.removeAttribute("filter")}var n=E.length,r,u="frameBorder",a="allowTransparency",l;if(!U)return;l=function(){clearTimeout(X),N.hide(),ot(f,P.onComplete)},P.info?C.html(P.info).add(x).show():C.html(P.title).add(x).show();if(n>1){typeof P.current=="string"&&k.html(P.current.replace("{current}",q+1).replace("{total}",n)).show();if(typeof P.title=="string"){var p=e("#cboxText");p.length?p.html(P.title):k.before("<div id='cboxText' class='ellipsis' title='"+P.title+"' style='margin-top: -15px; text-align: center'>"+P.title+"</div>")}A[P.loop||q<n-1?"show":"hide"]().html("<div>"+P.next+"</div>"),O[P.loop||q?"show":"hide"]().html("<div>"+P.previous+"</div>"),ut(),P.preloading&&e.each([et(-1),et(1)],function(){var n,r,s=E[this],o=e.data(s,i);o&&o.href?(n=o.href,e.isFunction(n)&&(n=n.call(s))):n=e(s).attr("href"),n&&nt(o,n)&&(n=rt(o,n),r=t.createElement("img"),r.src=n)})}else _.hide();P.iframe?(r=Y("iframe")[0],u in r&&(r[u]=0),a in r&&(r[a]="true"),P.scrolling||(r.scrolling="no"),e(r).attr({src:P.href,name:(new Date).getTime(),"class":s+"Iframe",allowFullScreen:!0,webkitAllowFullScreen:!0,mozallowfullscreen:!0}).one("load",l).appendTo(x),D.one(h,function(){r.src="//about:blank"}),P.fastIframe&&e(r).trigger("load")):l(),P.transition==="fade"?d.fadeTo(o,1,c):c()},P.transition==="fade"?d.fadeTo(o,0,function(){V.position(0,r)}):V.position(o,r)},V.next=function(){!z&&E[1]&&(P.loop||E[q+1])&&(q=et(1),at(E[q]))},V.prev=function(){!z&&E[1]&&(P.loop||q)&&(q=et(-1),at(E[q]))},V.close=function(){e("#cboxText").remove(),U&&!W&&(W=!0,U=!1,ot(l,P.onCleanup),S.unbind("."+s),p.fadeTo(P.fadeOut||0,0),d.stop().fadeTo(P.fadeOut||0,0,function(){d.add(p).css({opacity:1,cursor:"auto"}).hide(),ot(h),x.empty().remove(),setTimeout(function(){W=!1,ot(c,P.onClosed)},1)}))},V.remove=function(){if(!d)return;d.stop(),e.colorbox.close(),d.stop().remove(),p.remove(),W=!1,d=null,e("."+o).removeData(i).removeClass(o),e(t).unbind("click."+s)},V.element=function(){return e(I)},V.settings=r})(e,document,window)}),define("modules/overlay",["jquery","underscore","require/colorbox"],function(e,t,n){var r={href:"href",html:"html",closeOnOverlayClick:"overlayClose",opacity:"opacity",initialWidth:"initialWidth",initialHeight:"initialHeight",maxWidth:"maxWidth",maxHeight:"maxHeight",onOpen:"onOpen",onComplete:"onComplete",onClosed:"onClosed",ajax:"ajax",image:"image",enableEscapeButton:"escKey",inline:"inline",iframe:"iframe",data:"data",minWidth:"minWidth",width:"width"},i=function(t){var n={};return e.each(t,function(e,t){r[e]&&(n[r[e]]=t)}),n};return{html:function(t){e.colorbox(t)},imagePreview:function(){e("a.overlay").colorbox({photo:!0,overlayClose:!1,opacity:.7})},inline:function(t){e.colorbox(t)},view:function(t,n){n=n||{},e.colorbox({html:t||"PLEASE PROVIDE BACKBONE.JS",overlayClose:!1,opacity:.7,escKey:!0,initialWidth:120,initialHeight:60,width:n.width||"auto",height:n.height||"auto",maxWidth:1e3,maxHeight:900,onCompleted:function(){var t=e("#cboxLoadedContent");t.scroll(e.colorbox.resize),t.find("a").on("click",e.colorbox.resize),t.find("a.cancel-btn").on("click",function(){return e.colorbox.close(),!1}),n.onComplete&&typeof n.onComplete=="function"&&n.onComplete()},onClosed:function(){e(this).hasClass("refresh")&&location.reload(!0),n.onClose&&typeof n.onClose=="function"&&n.onClose()}}),this.cleanUp()},_render:function(e){var t=this,n=e.view,r=e.fetch;r.fetched?t.view(n.render().el):r.fetch({data:e.data||{},success:function(){r.fetched=!0,r.hasOwnProperty("build")&&r.build(),t.view(n.render().el),t.cleanUp()},beforeSend:function(){t.view(loader),t.cleanUp()}})},render:function(e,t){arguments.length===1&&this._render.apply(this,arguments),t=t||{};var n=this,r=t.fetch,i=t.data,s=t.dialog||{},o=t.complete,u=t.render||"render",a=new e(t),f=t.close;delete t.close,s.onClose=function(){a.leave(),a=null,typeof f=="function"&&f()},delete t.fetch,delete t.dialog,delete t.data,delete t.complete,delete t.render,a.dialog=n,!r||r.fetched?(n.view(a[u]().el,s,a),typeof a.bind=="function"&&a.bind(),typeof o=="function"&&o(a)):r.fetch({data:i||{},success:function(){r.fetched=!0,r.hasOwnProperty("build")&&r.build(),n.view(a[u]().el,s,a),typeof o=="function"&&o(a),typeof a.bind=="function"&&a.bind(),n.cleanUp()},beforeSend:function(){n.view(window.loader),n.cleanUp()}})},resize:function(){e.colorbox.resize()},close:function(){e.colorbox.close()},open:function(t){var n=t||{html:"Not configured"};e.colorbox(i(n))},cleanUp:function(){e.browser.msie&&parseInt(e.browser.version,10)==7&&t.delay(function(){e("#cboxLoadingGraphic, #cboxLoadingGraphic,#cboxLoadingOverlay").hide()},1e3)}}}),define("modules/qtips",["jquery","underscore","require/underscore-string"],function(e,t){return{popup:function(t){return{content:{text:e(".qtip-content",t)},position:{my:"left top",at:"right center",adjust:{y:-10},viewport:e(window)},show:{solo:!0},hide:"unfocus",style:{classes:"subject-user-snap ui-tibbr-tip qtip-light qtip-shadow",tip:{corner:!0,mimic:"center",method:!0,width:10,height:10,border:!0,offset:15}}}},pollUsers:function(t,n){return{content:{text:"<div style='height: 60px'>"+spinner+"</div>"},position:{my:"left top",at:"right center",adjust:{y:-10},viewport:e(window)},events:{show:function(r,i){i._currentView=new t(n),e(i.elements.content).html(i._currentView.render().el),n.collection.length===0&&i._currentView.fetch()},hide:function(e,t){t._currentView.leave()}},show:{solo:!0},hide:{event:"unfocus mouseleave",fixed:!0,delay:250},style:{classes:"subject-user-snap menu-tip ui-tibbr-tip qtip-light qtip-shadow",tip:{corner:!0,mimic:"center",method:!0,width:10,height:10,border:!0,offset:15}}}},profile:function(t,n){return{content:{text:"..."},events:{show:function(r,i){i._currentView=new t(n),e(i.elements.content).html(i._currentView.render().el)},hide:function(e,t){t._currentView.leave()}},position:{my:n.my||"left top",at:n.at||"right top",adjust:{y:n.y||30},viewport:e(window)},show:{delay:500,solo:!0},hide:{event:"unfocus mouseleave",fixed:!0,delay:250},style:{classes:"profile-snap ui-tibbr-tip qtip-light qtip-shadow",tip:{corner:!0,mimic:"center",method:!0,width:10,height:10,border:!0,offset:30}}}},hovercard:function(n,r){r=r||{};var i;r.model?i=r.model.get("display_name")||r.model.get("name"):i=r.object.name||r.object.display_name;var s=t.str.truncate(i,28),o={x:3,y:3};return t.isObject(r.adjust)&&(o.x=r.adjust.x===0?0:r.adjust.x,o.y=r.adjust.y===0?0:r.adjust.y),{content:{text:"...",title:{text:"<span title='"+i+"'> "+s+" </span> "}},events:{show:function(t,i){r.qtip=i,i._currentView=new n(r),e(i.elements.content).html(i._currentView.render().el)},hide:function(e,t){t._currentView.leave()}},position:{at:"right top",my:"left top",adjust:o,effect:!1,viewport:e(".container")},show:{delay:500,solo:!0},hide:{event:"unfocus mouseleave",fixed:!0,delay:250,inactive:!1},style:{classes:"ui-my-hovercard qtip-light qtip-shadow",tip:{border:!0,width:9,height:8,offset:25,method:!0,corner:!0,mimic:"center"},width:360}}},menu:function(t,n,r){n=n||".qtip-content",r=r||{};var i=e(n,t),s;return r.tip===!1?s=!1:s=r.tip||{corner:!0,mimic:!1,method:!0,width:10,height:10,border:!0,offset:0},{content:{text:i},position:{my:r.my||"top center",at:r.at||"bottom center",viewport:e(window)},show:{event:r.showEvent||"click",solo:!0},hide:{event:r.hideEvent||"click unfocus",fixed:r.fixed||!1,delay:r.fixed?250:0},style:{classes:"menu-tip ui-tibbr-tip qtip-light qtip-shadow",tip:s}}},gSearch:function(t){var n=e("#global-search-results");return{content:{text:n},position:{my:"left top",at:"left bottom",container:e("#header"),viewport:e(window)},show:{ready:!1,solo:!0},hide:{event:"unfocus"},events:{render:function(t,n){e(document).on("click","#global-search-results a",function(e){n.hide(e)})},hide:function(){t._cleanUp()}},style:{classes:"global-search-results",tip:!1}}},qSearch:function(t){var n=t;return{content:{text:n},position:{my:"top left",at:"bottom left",adjust:{x:7,y:-11},viewport:e(window)},show:{ready:!0,delay:700,solo:!0},hide:{event:"mouseleave",fixed:!0,delay:700},events:{render:function(t,n){e(document).on("click",".quick-search a",function(e){n.hide(e)})},hide:function(){e(".quick-search .default-list").removeClass("hidden"),e(".quick-search .search-results-list").addClass("hidden"),e(".quick-search .q-search").val(""),n.find(".search-string").val("")}},style:{classes:"quick-search-tip menu-tip ui-tibbr-tip qtip-light qtip-shadow",tip:{corner:!0,mimic:"center",method:!0,width:10,height:9,border:!0,offset:17}}}},tipsy:function(n){return n=n||{},t.extend({content:{attr:"title"},position:{at:"top center",my:"bottom center",viewport:e(window)},style:{classes:"ui-tooltip-tipsy qtip-shadow"}},n)},dropDown:function(n,r){r=r||{};var i;return r.tip===!1?i=!1:i=r.tip||{corner:!0,mimic:!1,method:!0,width:10,height:10,border:!0,offset:0},{content:{text:" "},position:{my:r.my||"top center",at:r.at||"bottom center",viewport:e(window)},show:{event:r.showEvent||"click",solo:!0},hide:{event:r.hideEvent||"click unfocus",fixed:r.fixed||!1,delay:r.fixed?250:0},style:{classes:"menu-tip ui-tibbr-tip qtip-light qtip-shadow",tip:i},events:{render:function(r,i){var s,o=e("<ul class='js-more-people-list more-actions-menu hidden'></ul>").attr("style","max-width:230px; min-width:130px;"),u;t.each(n,function(t){t.model&&t.model.isVip()?u="<span class='vip-icon-wrap'><i class='ui-inline-icon vip-icon'></i></span><span style ='overflow:hidden;display:block;padding-top:6px;word-wrap:break-word;'>"+t.name+" </span>":u="<span style='overflow:hidden;display:block;padding-top:6px;word-wrap:break-word;'>"+t.name+"</span>";try{s=t.model.toJSON()}catch(n){s={}}o.append(e("<li />").append(e("<a/>",{data:{model:t.model,event_key:(t.isUser?"user":"subject")+".selected",event_data:window.gadget?s:""},title:t.url?I18n.t("message.go_to_link",{name:t.name}):null,href:t.url?t.url:"javascript:void(0)",html:u,"class":t.url?"js-publish js-vipable":"no-url js-vipable","data-id":(t.model||{}).id,"data-type":t.isUser?"user":"subject"}).addClass("clearfix").prepend(t.image?e("<img>",{src:t.image,style:"vertical-align: middle; padding-right: 2px; width:25px; height:25px;float:left;margin-right:5px;line-height:1.4;"}):"")))},this),i.set("content.text",o)},hide:function(e,t){}}}}}}),define("modules/utils",["jquery","underscore","backbone","./helper"],function(t,n,r,i){return{_try:function(e,t,r){t=t||[],n.isFunction(t)&&(r=t,t=[]);var i=n.isString(e)?this[e]:e;if(window._debug_){if(!n.isFunction(i)){console.warn("method is not a function",i);return}return i.apply(this,t)}try{return i.apply(this,t)}catch(s){return n.isFunction(r)?r(s):r}},_XMLDoc:function(){var e;return window.ActiveXObject?(e=new ActiveXObject("Microsoft.XMLDOM"),e.appendChild(e.createElement("tibbr"))):e=document.implementation.createDocument("tibbr","tibbr",null),e},log:function(){window._debug_&&window.console&&console.log.call(console,arguments)},serverUrl:function(e,t,r,s){var o="",u=s?"/":i.context();return function(){return o=u+e,n.isNumber(r)&&(o=o+"/"+r),t&&(o=o+"/"+t),o}(),o},path:function(e,t){return t=n.isUndefined(t)?!0:!1,e=e.replace(/^\//,""),t?i.context()+e:"/"+e},redirectTo:function(e){var t=e.match(/^#!/)?!1:!0;e=t?this.url(e):e;var n=r.history.getFragment(e);return r.history.fragment===n&&(r.history.fragment=null),this.app.navigate(e,!0)},redirectToHome:function(){return this.app.navigate("#",!0)},reloadTo:function(e){e&&t.cookie("hash_url",this.url(e),{expires:5,path:"/"}),window.location=this.host()+"/"},host:function(){return this.appConfig("site","config","site_root",{"default":"/"}).replace(/\/$/,"")},marketPlaceRoot:function(){return this.context()+"marketplace/apps"},withAuthParams:function(e){if(window.device==="desktop"||window.packaged){var t=e.indexOf("?")>0?"&":"?";return e+t+"auth_token="+window.authToken+"&client_key="+window.client_key}return e},simpleTemplate:function(e,t){t=t||{};var r=n.templateSettings.interpolate;n.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var i=n.template(e)(t);return n.templateSettings.interpolate=r,i},windowTitle:function(e){return{handle:null,animateFlag:!1,setTitle:function(t,n){document.title=n?t:t+e},resetTitle:function(t){document.title=e,this.handle&&t&&clearInterval(this.handle)},animateTitle:function(e){this.handle&&clearInterval(this.handle),this.handle=setInterval(function(){this.animateFlag?this.resetTitle():this.setTitle(e,!0),this.animateFlag=!this.animateFlag},2e3)}}}}}),define("modules/tour",["jquery","./helper"],function(e,t){var n='<p class="action-links"><a href="#" class="btn btn-primary " id="next">'+I18n.t("tours.next")+' <span class="arrow next"></span></a></p>',r='<p class="action-links"><a href="#" class="btn" id="prev"><span class="arrow prev"></span> '+I18n.t("tours.back")+'</a><a href="#" class="btn btn-primary" id="next">'+I18n.t("tours.next")+' <span class="arrow next"></span></a>',i='<p class="action-links"><a href="#" class="btn btn-primary" id="end">'+I18n.t("tours.close")+"</a></p>",s=function(e,t){e.set("content.text",t.content),e.set("content.title",t.title),e.set("position.target",t.target),e.set("position.my",t.my),e.set("position.at",t.at),e.set("position.adjust.x",t.adjustX),e.set("position.adjust.y",t.adjustY),e.set("style.tip.width",t.tipWidth),e.set("style.tip.height",t.tipHeight)};return{index:function(t){function u(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("next"),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search"),(e("body").find(".selected-target").hasClass("search-box")||e("body").find(".selected-target").hasClass("eval-help"))&&e("body").addClass("highlight-search"),t.preventDefault()}function a(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("prev"),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search"),(e("body").find(".selected-target").hasClass("search-box")||e("body").find(".selected-target").hasClass("eval-help"))&&e("body").addClass("highlight-search"),t.preventDefault()}function f(t){e("body").find(".selected-target").removeClass("selected-target"),e(".tour-tips").qtip("hide"),t.preventDefault()}e(".ui-dialog-titlebar-close").click();var o=[{target:e("#wall-tabs li:eq(0)"),title:I18n.t("tours.home_index.step1.title"),my:"left top",at:"right top",tipWidth:250,tipHeight:70,adjustTipHeight:10,adjustX:0,adjustY:0,content:I18n.t("tours.home_index.step1.text")+n},{target:e(".updated-posts"),title:I18n.t("tours.home_index.step2.title"),my:"right top",at:"left top",tipWidth:210,tipHeight:70,adjustX:-30,adjustY:0,content:I18n.t("tours.home_index.step2.text")+r+'<span class="stepsCount"><span class="step">1</span>/<span class="total">7</span></span></p>'},{target:e(".post-section"),overlay:!0,title:I18n.t("tours.home_index.step3.title"),my:"left top",at:"right top",tipWidth:238,tipHeight:70,adjustX:-480,adjustY:50,content:I18n.t("tours.home_index.step3.text")+r+'<span class="stepsCount"><span class="step">2</span>/<span class="total">7</span></span></p>'},{target:e(".js-main-textarea"),overlay:!0,title:I18n.t("tours.home_index.step4.title"),my:"left top",at:"right top",tipWidth:230,tipHeight:70,adjustX:-580,adjustY:5,content:I18n.t("tours.home_index.step4.text")+r+'<span class="stepsCount"><span class="step">3</span>/<span class="total">7</span></span></p>'},{target:e(".primary-nav li:eq(0)"),overlay:!0,title:I18n.t("tours.home_index.step5.title"),my:"left top",at:"right top",tipWidth:245,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.home_index.step5.text")+r+'<span class="stepsCount"><span class="step">4</span>/<span class="total">7</span></span></p>'},{target:e("#global-search"),overlay:!0,title:I18n.t("tours.home_index.step6.title"),my:"right top",at:"left top",tipWidth:250,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.home_index.step6.text")+r+'<span class="stepsCount"><span class="step">5</span>/<span class="total">7</span></span></p>'},{target:e(".js-right-nav"),overlay:!0,title:I18n.t("tours.home_index.step7.title"),my:"right top",at:"left top",tipWidth:250,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.home_index.step7.text")+r+'<span class="stepsCount"><span class="step">6</span>/<span class="total">7</span></span></p>'},{target:e(".eval-help"),overlay:!0,title:I18n.t("tours.home_index.step8.title"),my:"right top",at:"left top",tipWidth:230,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.home_index.step8.text")+i}];o=_.reject(o,function(e){return!e.target.length}),e("#wall-tabs li:eq(0)").addClass("selected-target"),e(document.body).qtip({id:"step",content:{text:o[0].content,title:{text:o[0].title,button:I18n.t("tours.close_tooltip")}},position:{my:o[0].my,at:o[0].at,target:o[0].target,adjust:{x:o[0].adjustX,y:o[0].adjustY}},show:{event:!1,ready:!0,modal:{on:!0,blur:!1,escape:!1}},style:{classes:"tour-tips home-tour stepCount0",tip:{corner:!0,mimic:!1,method:!0,width:o[0].tipWidth,height:o[0].tipHeight,border:1,offset:0}},hide:!1,events:{render:function(t,n){var r=n.elements.tooltip;n.step=0,r.bind("next prev",function(t){n.step+=t.type==="next"?1:-1,n.step=Math.min(o.length-1,Math.max(0,n.step));var r=o[n.step],i=n.step;i==1&&(e(".updated-posts").click(),setTimeout(function(){e(".filter-posts-tooltip").append('<div class="hidden-overlay"></div>')},700)),e(r.target).addClass("selected-target"),r.overlay&&e(".selected-target").append('<div class="hidden-overlay"></div>'),r&&(s(n,r),n.set("style.classes","tour-tips home-tour stepCount"+i),e(".stepsCount").length&&(e(".stepsCount .step").text(n.step+1),e(".stepsCount .total").text(o.length)))})},hide:function(n,r){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(document).off("click","#next",u).off("click","#prev",a).off("click","#end",f),o[r.step]=0,e("#qtip-step").off("click","#next, #prev",function(e){}),r.destroy(),t.trackSend("Skip Tour","On boarding"),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search")}}}),e(document).on("click","#next",u).on("click","#prev",a).on("click","#end",f)},subject:function(){function o(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("next"),t.preventDefault()}function u(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("prev"),t.preventDefault()}function a(t){e("body").find(".selected-target").removeClass("selected-target"),e(".tour-tips").qtip("hide"),t.preventDefault()}var t=[{target:e(".primary-nav > li.current"),overlay:!0,title:I18n.t("tours.subject_show.step1.title"),my:"left top",at:"right top",tipWidth:254,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step1.text")+n},{target:e(".owners-n-followers"),overlay:!0,title:I18n.t("tours.subject_show.step2.title"),my:"right top",at:"left top",tipWidth:220,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step2.text")+r+'<span class="stepsCount"><span class="step">1</span>/<span class="total">6</span></span></p>'},{target:e(".notification-action-link").is(":visible")&&e(".notification-action-link"),title:I18n.t("tours.subject_show.step3.title"),actionMenu:!0,my:"left top",at:"right top",tipWidth:220,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step3.text")+r+'<span class="stepsCount"><span class="step">2</span>/<span class="total">6</span></span></p>'},{target:e(".subject-action-link"),title:I18n.t("tours.subject_show.step4.title"),actionMenu:!0,my:"left top",at:"right top",tipWidth:200,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step4.text")+r+'<span class="stepsCount"><span class="step">3</span>/<span class="total">6</span></span></p>'},{target:e(".post-section"),overlay:!0,title:I18n.t("tours.subject_show.step5.title"),my:"left top",at:"right top",tipWidth:270,tipHeight:70,adjustX:-480,adjustY:50,content:I18n.t("tours.subject_show.step5.text")+r+'<span class="stepsCount"><span class="step">4</span>/<span class="total">6</span></span></p>'},{target:e(".entry:eq(0) .profile-name"),overlay:!0,title:I18n.t("tours.subject_show.step6.title"),my:"left top",at:"right top",tipWidth:220,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step6.text")+r+'<span class="stepsCount"><span class="step">5</span>/<span class="total">6</span></span></p>'},{target:e(".timeline-nav"),overlay:!0,title:I18n.t("tours.subject_show.step7.title"),my:"right top",at:"left top",tipWidth:240,tipHeight:68,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step7.text")+r+'<span class="stepsCount"><span class="step">6</span>/<span class="total">6</span></span></p>'},{target:e(".eval-help"),overlay:!0,title:I18n.t("tours.subject_show.step8.title"),my:"right top",at:"left top",tipWidth:230,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_show.step8.text")+i}];t=_.reject(t,function(e){return!e.target.length}),e(".primary-nav > li.current").addClass("selected-target"),e(".selected-target").append('<div class="hidden-overlay"></div>'),e(document.body).qtip({id:"step",content:{text:t[0].content,title:{text:t[0].title,button:I18n.t("tours.close_tooltip")}},position:{my:t[0].my,at:t[0].at,target:t[0].target,adjust:{x:t[0].adjustX,y:t[0].adjustY}},show:{event:!1,ready:!0,modal:{on:!0,blur:!1,escape:!1}},style:{classes:"tour-tips subject-profile-tour stepCount0",tip:{corner:!0,mimic:!1,method:!0,width:t[0].tipWidth,height:t[0].tipHeight,border:1,offset:0}},hide:!1,events:{render:function(n,r){var i=r.elements.tooltip;r.step=0,i.bind("next prev",function(n){r.step+=n.type==="next"?1:-1,r.step=Math.min(t.length-1,Math.max(0,r.step));var i=t[r.step],o=r.step;e(i.target).addClass("selected-target"),i.overlay&&(e(".selected-target").is("a")?e(".selected-target").parent().css("position","relative").append('<div class="hidden-overlay"></div>'):e(".selected-target").append('<div class="hidden-overlay"></div>')),i.actionMenu&&(e(".selected-target").click(),setTimeout(function(){e(".action-menu-tip").append('<div class="hidden-overlay"></div>')},700)),i&&(s(r,i),r.set("style.classes","tour-tips subject-profile-tour stepCount"+o),e(".stepsCount").length&&(e(".stepsCount .step").text(r.step+1),e(".stepsCount .total").text(t.length)))})},hide:function(n,r){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(document).off("click","#next",o).off("click","#prev",u).off("click","#end",a),t[r.step]=0,r.destroy()}}}),e(document).on("click","#next",o).on("click","#prev",u).on("click","#end",a),e(".hidden-overlay").on("mouseenter",function(e){e.stopPropagation()})},people:function(){function t(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("next"),t.preventDefault()}function o(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".filter-posts-tooltip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("prev"),t.preventDefault()}function u(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".tour-tips").qtip("hide"),t.preventDefault()}steps=[{target:e("#wall-tabs li:eq(0)"),title:I18n.t("tours.user_profile.step1.title"),my:"left top",at:"right top",tipWidth:259,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step1.text")+n},{target:e(".jcarousel-item").length&&e(".profile-carousel"),overlay:!0,title:I18n.t("tours.user_profile.step2.title"),my:"left top",at:"right top",tipWidth:259,tipHeight:70,adjustX:-700,adjustY:0,content:I18n.t("tours.user_profile.step2.text")+r+'<span class="stepsCount"><span class="step">1</span>/<span class="total">6</span></span></p>'},{target:e("#wall-tabs li:eq(0)"),tabs:!0,title:I18n.t("tours.user_profile.step3.title"),my:"left top",at:"right top",tipWidth:280,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step3.text")+r+'<span class="stepsCount"><span class="step">2</span>/<span class="total">5</span></span></p>'},{target:e("#wall-tabs .user-influence").closest("li"),tabs:!0,title:I18n.t("tours.user_profile.step4.title"),my:"left top",at:"right top",tipWidth:280,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step4.text")+r+'<span class="stepsCount"><span class="step">3</span>/<span class="total">5</span></span></p>'},{target:e("#wall-tabs .user-following_tab").closest("li"),tabs:!0,title:I18n.t("tours.user_profile.step5.title"),my:"left top",at:"right top",tipWidth:238,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step5.text")+r+'<span class="stepsCount"><span class="step">4</span>/<span class="total">5</span></span></p>'},{target:e("#wall-tabs .user-apps").closest("li"),tabs:!0,title:I18n.t("tours.user_profile.step6.title"),my:"left top",at:"right top",tipWidth:259,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step6.text")+r+'<span class="stepsCount"><span class="step">4</span>/<span class="total">5</span></span></p>'},{target:e(".eval-help"),overlay:!0,title:I18n.t("tours.user_profile.step7.title"),my:"right top",at:"left top",tipWidth:238,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.user_profile.step7.text")+i}],steps=_.reject(steps,function(e){return!e.target.length}),e("#wall-tabs li:eq(0)").addClass("selected-target"),e(document.body).qtip({id:"step",content:{text:steps[0].content,title:{text:steps[0].title,button:I18n.t("tours.close_tooltip")}},position:{my:steps[0].my,at:steps[0].at,target:steps[0].target,effect:!1,adjust:{x:steps[0].adjustX,y:steps[0].adjustY}},show:{event:!1,ready:!0,modal:{on:!0,blur:!1,escape:!1}},style:{classes:"tour-tips profile-tour stepCount0",tip:{corner:!0,mimic:!1,method:!0,width:steps[0].tipWidth,height:steps[0].tipHeight,border:0,offset:0}},hide:!1,events:{render:function(t,n){var r=n.elements.tooltip;n.step=0,r.bind("next prev",function(t){n.step+=t.type==="next"?1:-1,n.step=Math.min(steps.length-1,Math.max(0,n.step));var r=steps[n.step],i=n.step;e(r.target).addClass("selected-target"),r.tabs&&(e(".profile-tabs .selected-target").find("a").click(),e(".profile-tabs .selected-target").append('<div class="hidden-overlay"></div>')),r.overlay&&e(".selected-target").append('<div class="hidden-overlay"></div>'),r&&(s(n,r),n.set("style.classes","tour-tips profile-tour stepCount"+i),e(".stepsCount").length&&(e(".stepsCount .step").text(n.step+1),e(".stepsCount .total").text(steps.length)))})},hide:function(n,r){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(document).off("click","#next",t).off("click","#prev",o).off("click","#end",u),steps[r.step]=0,r.destroy()}}}),e(document).on("click","#next",t).on("click","#prev",o).on("click","#end",u)},files:function(){var n='<p class="action-links"><a href="#" id="prev"></a>',r='<a href="#" id="next"></a>',i='<a href="#" class="disabled"  id="next"></a>',o='<p class="action-links"><a href="#" class="disabled" id="prev"></a> <span class="stepsCount">'+I18n.t("tours.files.count")+'</span> <a href="#" id="next"></a>',u='<p class="action-links"><a href="#" id="prev"></a><a href="#" class="btn" id="end">'+I18n.t("tours.files.final_text")+"</a>",a='<div class="stepsCount"><span class="step">1</span> of <span class="total">n</span></div>',f=t.themeImagePath("tour/tour-head-marker.png"),l=[{my:"left top",at:"right top",target:".files-listing-wrap",title:'<img src="'+f+'" /> '+I18n.t("tours.files.step1.title"),overlay:!0,tipWidth:255,tipHeight:50,adjustX:-680,adjustY:150,content:I18n.t("tours.files.step1.text")+o},{my:"right top",at:"right top",target:".files-listing-wrap",title:'<img src="'+f+'" /> '+I18n.t("tours.files.step2.title"),overlayRight:!0,tipWidth:190,tipHeight:50,adjustX:-400,adjustY:90,content:I18n.t("tours.files.step2.text")+n+'<span class="stepsCount">'+I18n.t("tours.files.count")+"</span>"+r+"</p>"},{my:"left top",at:"right top",target:".share-on-tibbr-header",title:'<img src="'+f+'" /> '+I18n.t("tours.files.step3.title"),overlay:!0,tipWidth:212,tipHeight:50,adjustX:-1100,adjustY:120,content:I18n.t("tours.files.step3.text")+u+'<span class="stepsCount">'+I18n.t("tours.files.count")+"</span>"+i+"</p>"}];l=_.reject(l,function(e){return!e.target.length}),e(document).ready(function(){function i(t){e(".files-hidden-overlay").remove(),e("body").find(".files-selected-target").removeClass("files-selected-target"),e("#qtip-step").triggerHandler("next"),t.preventDefault()}function o(t){e(".files-hidden-overlay").remove(),e("body").find(".files-selected-target").removeClass("files-selected-target"),e("#qtip-step").triggerHandler("prev"),t.preventDefault()}function u(t){e(".files-hidden-overlay").remove(),e("body").find(".files-selected-target").removeClass("files-selected-target"),e(".tour-tips").qtip("hide"),t.preventDefault()}var t=l.length,n=1,r=e(".files-listing-wrap").outerWidth()-200;e(document.body).qtip({id:"step",content:{text:l[0].content,title:{text:l[0].title,button:I18n.t("tours.close_tooltip")}},position:{my:l[0].my,at:l[0].at,target:e(l[0].target),adjust:{x:-r,y:150}},show:{event:!1,ready:!0,modal:{on:!0,blur:!1,escape:!1},effect:function(){e(this).slideDown(100)}},style:{classes:"files-tour tour-tips stepCount0",tip:{corner:!0,mimic:!1,method:!0,width:l[0].tipWidth,height:l[0].tipHeight,border:1,offset:0}},hide:!1,events:{render:function(n,r){e(".files-listing-wrap").addClass("files-selected-target"),e("body").append('<div class="files-hidden-overlay step-0"></div>');var i=e(".files-selected-target").offset();e(".files-hidden-overlay").css({left:i.left-60});var o=r.elements.tooltip;r.step=0,o.bind("next prev",function(n){r.step+=n.type==="next"?1:-1,r.step=Math.min(t-1,Math.max(0,r.step));var i=l[r.step];e(i.target).addClass("files-selected-target");var o=e(".files-selected-target").offset(),u=r.step;if(u==0){var a=e(".files-selected-target").outerWidth()-20;i.adjustX=-a,i.adjustY+=10}i.overlay&&(e("body").append('<div class="files-hidden-overlay step-'+u+'"></div>'),e(".files-hidden-overlay").css({left:o.left-60})),i.overlayRight&&(e("body").append('<div class="files-hidden-overlay step-'+u+'"></div>'),e(".files-hidden-overlay").css({left:o.left+450})),i&&(s(r,i),r.set("style.classes","tour-tips files-tour stepCount"+u),e(".stepsCount").length&&(e(".stepsCount .step").text(r.step+1),e(".stepsCount .total").text(l.length)))})},hide:function(t,n){e(".files-hidden-overlay").remove(),e("body").find(".files-selected-target").removeClass("files-selected-target"),n.destroy(),e(document).off("click","#next",i).off("click","#prev",o).off("click","#end",u)}}}),e(document).on("click","#next",i).on("click","#prev",o).on("click","#end",u)})},subject_workspace:function(){function t(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".people-info-qtip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("next"),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search"),e("body").find(".selected-target").hasClass("home")&&e("body").addClass("highlight-search"),t.preventDefault()}function o(t){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(".people-info-qtip",window.parent.document).qtip("hide"),e("#qtip-step").triggerHandler("prev"),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search"),e("body").find(".selected-target").hasClass("home")&&e("body").addClass("highlight-search"),t.preventDefault()}function u(t){e("body").find(".selected-target").removeClass("selected-target"),e(".tour-tips").qtip("hide"),t.preventDefault()}steps=[{target:e(".subject-workspace"),title:I18n.t("tours.subject_workspace.step1.title"),my:"top center",at:"top center",adjustX:0,adjustY:100,content:I18n.t("tours.subject_workspace.step1.text")+n},{target:e("#js-subject-tab .people"),title:I18n.t("tours.subject_workspace.step2.title"),my:"left top",at:"right top",tipWidth:210,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_workspace.step2.text")+r+'<span class="stepsCount"><span class="step">2</span>/<span class="total">6</span></span></p>'},{target:e(".js-alert-action-link"),overlay:!0,title:I18n.t("tours.subject_workspace.step3.title"),my:"right top",at:"left top",tipWidth:212,tipHeight:74,adjustX:0,adjustY:0,content:I18n.t("tours.subject_workspace.step3.text")+r+'<span class="stepsCount"><span class="step">3</span>/<span class="total">6</span></span></p>'},{target:e("#tabs-carousel .jcarousel-control-next"),title:I18n.t("tours.subject_workspace.step4.title"),my:"right top",at:"left top",tipWidth:230,tipHeight:68,adjustX:0,adjustY:50,content:I18n.t("tours.subject_workspace.step4.text")+r+'<span class="stepsCount"><span class="step">4</span>/<span class="total">6</span></span></p>'},{target:e(".subject-workspace #sidebar"),overlay:!0,title:I18n.t("tours.subject_workspace.step5.title"),my:"right top",at:"left top",tipWidth:210,tipHeight:64,adjustX:0,adjustY:150,content:I18n.t("tours.subject_workspace.step5.text")+r+'<span class="stepsCount"><span class="step">5</span>/<span class="total">6</span></span></p>'},{target:e(".welcome-greet .tblock .home").first(),overlay:!0,title:I18n.t("tours.subject_workspace.step6.title"),my:"left top",at:"right top",tipWidth:210,tipHeight:70,adjustX:0,adjustY:0,content:I18n.t("tours.subject_workspace.step6.text")+i}],steps=_.reject(steps,function(e){return!e.target.length}),e(".subject-workspace").addClass("selected-target"),e(".selected-target").append('<div class="hidden-overlay"></div>'),e(document.body).qtip({id:"step",content:{text:steps[0].content,title:{text:steps[0].title,button:I18n.t("tours.close_tooltip")}},position:{my:steps[0].my,at:steps[0].at,target:steps[0].target,adjust:{x:steps[0].adjustX,y:steps[0].adjustY}},show:{event:!1,ready:!0,modal:{on:!0,blur:!1,escape:!1}},style:{classes:"tour-tips stepCount0 subject-workspace-tour",tip:{corner:!0,mimic:!1,method:!0,width:steps[0].tipWidth,height:steps[0].tipHeight,border:1,offset:0}},hide:!1,events:{render:function(t,n){var r=n.elements.tooltip;n.step=0,r.bind("next prev",function(t){n.step+=t.type==="next"?1:-1,n.step=Math.min(steps.length-1,Math.max(0,n.step));var r=steps[n.step],i=n.step;i==1&&(e("#js-subject-tab .people").mouseenter(),setTimeout(function(){e(".people-info-qtip").append('<div class="hidden-overlay"></div>')},1e3)),e(r.target).addClass("selected-target"),r.overlay&&e(".selected-target").append('<div class="hidden-overlay"></div>'),r&&(e(".selected-target").hasClass("jcarousel-control-next")&&e(".selected-target").addClass("absolute-position-for-carousel"),e(".selected-target").hasClass("js-alert-action-link")&&e(".js-alert-action-link").off("click",function(e){}),s(n,r),n.set("style.classes","tour-tips subject-workspace-tour stepCount"+i),e(".stepsCount").length&&(e(".stepsCount .step").text(n.step+1),e(".stepsCount .total").text(steps.length))),e("body").find(".selected-target").hasClass("home")&&e("body").addClass("highlight-search")})},hide:function(n,r){e(".hidden-overlay").remove(),e("body").find(".selected-target").removeClass("selected-target"),e(document).off("click","#next",t).off("click","#prev",o).off("click","#end",u),steps[r.step]=0,r.destroy(),e("body").hasClass("highlight-search")&&e("body").removeClass("highlight-search")}}}),e(document).on("click","#next",t).on("click","#prev",o).on("click","#end",u),e(".hidden-overlay").on("mouseenter",function(e){e.stopPropagation()}).on("click",function(e){e.stopPropagation()})}}}),define("modules/modules",["jquery","underscore","./cache","./store","./app_config","./cookie","./template","./ajax","./topics","./dialog","./overlay","./qtips","./utils","./helper","./tour","require/moment"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m={Cache:n,Ajax:u,Topics:a,qTips:c,Store:r,appConfig:i,Cookie:s,Template:o,Helper:p,Tour:d,Error:{parse:function(n){if(n===undefined)return"";n.responseText&&(n=e.parseJSON(n.responseText)),n.error&&n.error.json_class&&n.error.json_class.match(/JavaxMail|JavaMail/)&&(n.error=[n.error.json_class+I18n.t("common.errors.mail_server_error")]);if(t.isFunction(n.error))return[n.status+":"+n.statusText];var r=n.error||(n.errors||{}).error;return t.isArray(r)?r:[r]}},Date:{todayStartTime:function(e){return v().utc().add("minutes",e).format("YYYY-MM-DD 00:00:00")}},Util:h,Gadget:{publish:function(e,t){window.gadget&&this.PageBus.publish("tibco.tibbr."+e,t)},subscribe:function(e,n){if(window.gadget){var r=this,i=t.unique((this.gadgetConfig||{}).unsubscribes||[]),s="tibco.tibbr."+e;t.include(i,s)||r.PageBus.subscribe(s,n)}},unsubscribe:function(e){if(window.gadget)try{this.PageBus.unsubscribe(e)}catch(t){}},subscribedOnce:function(e){}},Event:{isExist:function(e){return!t.isEmpty(this._events[e])},uniqueBind:function(e,t){return this.isExist(e)||this.on(e,t),this},bindTo:function(e,n,r){if(e.cid===undefined){console.error("Tibbr.Event's bindTo is used without any  object so "+n+" is ignored");return}this.bindings||(this.bindings={});var i=this.bindings[e.cid]||[],s={eventName:n,callback:r};return t.indexOf(i,s)===-1&&(this.on(n,r,e),i.push(s)),this.bindings[e.cid]=i,this},unbindFor:function(e){if(!this.bindings)return;if(!this.bindings[e.cid])return;var n=this;t.each(this.bindings[e.cid]||[],function(e){n.off(e.eventName,e.callback)}),this.bindings[e.cid]=null,delete this.bindings[e.cid]}},Events:{stopPropagation:function(e){return e&&e.stopPropagation?this.stopPropagation=function(e){e.stopPropagation()}:this.stopPropagation=function(e){e.cancelBubble=!0},this.stopPropagation(e)},preventDefault:function(e){return e.preventDefault?this.preventDefault=function(e){return e.preventDefault(),!1}:this.preventDefault=function(e){return e.returnValue=!1,!1},this.preventDefault(e)}},Model:{RichContent:{getRichContent:function(n,r,i,s){var o=this,u=r?this._url("messages/"+this.get("id")):"#";i=i||this.get("rich_content");if(i.length===0)return this.getContent(r);var a=200,f=" &nbsp;  <a class='continued' href='"+u+"'>"+this.t("message.continued")+"</a>",l=t.compact(t.map(i.match(this.tibbr.wikiRegex),function(e){try{var t={},n=e.replace(/[@\[]|[\]$]/g,"");return t.rawString=e,t.modelId=/:\d+\|/.exec(n)[0].replace(/:|\|/g,""),t.context=n.split(/:\d+\|/.exec(n)[0])[0],t.title=n.split("|")[1],t.url=o.getMentionUrl(t.context,t.modelId),t.pruneHack=t.title+t.modelId,t}catch(r){return null}}));t.each(l,function(e){i=i.replace(e.rawString,e.pruneHack)});var c=i.replace(/<\/?[^>]+>/ig," ");if(!n&&c.length>a){a-=10;var h=t.str.prune(c,a,f);h===f&&(h=t.str.truncate(c,a,f)),h===c&&(h=i),i=h.replace(/\n/g,"<br>")}else{var d=i.match(/^\u0020+/gm);d&&e.each(d,function(e,t){var n="";for(var r=0;r<t.length;r++)n+="&nbsp;";i=i.replace(new RegExp(t),n)}),i.match(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi)||(i=i.replace(/\n/g,"<br>"))}return i=p.autoLink(i),t.each(l,function(t){var n={context:t.context,id:t.modelId,name:t.title.replace(/'/g," ")},r=e("<a/>",{"data-event_key":(t.context==="User"?"user":"subject")+".selected","data-event_data":JSON.stringify(n),"data-obj":JSON.stringify(n),href:t.url,html:t.title,"class":"mention-hover js-publish  mention-"+t.context});t.context==="Group"&&r.addClass("inactive-links"),s&&(r.css({"pointer-events":"none",cursor:"default"}),r.removeAttr("href")),i=i.replace(t.pruneHack,e("<div/>").append(r).html())}),i=i.replace(/<p><br><\/p>$/," "),i=i.replace(/<p><br \/><\/p>$/," "),i=i.replace(/<br\/>$/,""),i=p.hashToUrl(i,s),i},getMentionUrl:function(e,t){var n=this;switch(e){case"User":return n._url("users/"+t+"/profile");case"Subject":return n._url("subjects/"+t);case"Message":return n._url("messages/"+t);case"Resource":return n._url("resources/"+t);default:return"#"}}}},View:{preview:function(n){var r=e(n.currentTarget),i=r.data("id"),s=this.model||r.data("model"),o=function(e){window.open(e,"_blank")};if(s.get("modelType")==="Asset")s.isImage()?e.fn.colorbox({photo:!0,maxWidth:"80%",maxHeight:"80%",target:n.currentTarget}):o(s.downloadUrl());else{var u=s.markup();t.isEmpty(u)?o(s.downloadUrl()):l.view(u,{maxWidth:"80%",maxHeight:"80%"})}return!1},ActionLink:{hashTags:function(n){n.preventDefault(),this.$dialog&&f.close();var r=e(n.currentTarget),i=this,s=t.str.trim(r.text().replace("#",""));if(e("#wall-tabs").length>0){var o=requirejs("collections/message_search"),u=new o([],{scopeId:this.tibbr.currentUser.id,hashTags:s});i.tibbr.application.wallTabView.add({title:r.text(),view:{View:require("modules/common/views/messages/list"),options:{collection:u,bindCreate:!1,load:!0,id:"hash-tag-"+s}},zoomView:!0,"switch":!0,id:s})}else if(params.controller==="explore"&&params.action==="search")e("input#js-search-str").val(r.text()),e("button.js-advanced-search-submit").click();else{if(window.gadget){i.tibbr.publish("hashtag:selected",s),i.tibbr.publish("hashtag.selected",s);return}i.tibbr.redirectTo("explore/search?q=#"+s)}try{window.scrollTo(0,0)}catch(a){}},actionTargetLink:function(n){var r=this.tibbr,i,s,o,u,a,l,c={},h=!1,d=!1,v=n instanceof e.Event;v?(n.stopPropagation(),i=e(n.currentTarget),s=i.data()||{},o=s.target,u=i.parents(".js-eog-resource"),a=s.native,c=s.action_link||{},l=i.attr("href")):(s=n,i=e(s.target),o=s.display_target,u=i.parents(".js-eog-resource"),a=s.isNative,l=s.link,c=s.action_link||{},h=s.modal===!0),e(".qtip").hide();if(l==="javascript:void(0)")return!1;if(window.gadget)return window.initWithPageBus?(c.native=a,c.link=p.asset(c.link,r.host()),r.publish("action-link.clicked",c)):window.parent.location=l,!1;switch(o){case"dialog":if(e("#tibbr-ui-dialog").length>0)return i.css("cursor","default"),!1;if(r.connect)return i.css("cursor","default"),!1;a?e.colorbox({photo:!0,href:l,scalePhotos:!0,opacity:"0.45",width:"850px",height:"600px"}):f.view(r.$iFrame().attr({src:l,height:600,width:700,"class":"client-stream"}),{className:"no-title-no-padding",modal:h});break;case"tibbr_tab":var m="link_tibbr_tab"+this.model.id;e("#wall-tabs").length>0?r.application.wallTabView.addWithIframe({title:i.text(),src:l,zoomView:!0,"switch":!0,id:m,model:this.model}):window.open(l);break;case"app":if(r.currentSubject&&r.currentSubject.tabs&&this.model&&this.model.eog_action){var g=this.model.eog_action.resource.application.get("guid"),y=t(r.currentSubject.tabs.apps()).detect(function(e){return e.application.get("guid")===g});l=y.application.urlsType("subject_tab").url()+"&action_link="+encodeURIComponent(c.url)+"&subject_id="+r.currentSubject.id,e("ul#js-subject-tab").find("li."+g).attr("src",l).click();try{window.scrollTo(0,0)}catch(b){}}else{if(!s.wiki||!s.wiki.app_id)return r.application.navigateToAppWithURL(l);v&&n.preventDefault(),d=!1,r.redirectTo("apps/"+s.wiki.app_id+"/launch?url="+encodeURIComponent(l))}break;case"zoom":r.application.navigateToAppWithURL(l);break;case"embed":var w=u.find("iframe");w.length>0?w.remove():u.append(e("<iframe/>").attr({src:l,height:300,width:600}));break;case"replace":d=!0;break;default:i.length>0?i.attr("target","_blank"):window.open(l),d=!0}return d}},Resource:{renderResource:function(){var e=this;require(["modules/common/views/common/hover_profile","modules/common/views/messages/resources/eog_item"],function(t,n){var r=e.model.eog_action,i=e.options.from;if(r){var s=r.resource;e.resource=s;if(i!=="resource"){var o=r.type();if(o!="comment"||o!="share")o="action";var u=e.model.user,a=e.t("message.eog_action.actions."+o,{link:u.showUrl(),name:u.get("display_name"),type:s.get("title")||s.get("name"),time:e.model.postedAt(),image:s.application.image(1),singular_past_tense:r.singular_past_tense,determiner:s.get("title")?"":r.resource.determiner});e.$("h6").html(a).addClass("eog-header-share"),s.application.isDefaultApp()&&e.$("h6").find("img").remove(),e.model.get("private_message")&&e.$("h6").prepend('<i class="ui-inline-icon stream-icon private"></i>');if(window.gadget){var f=e.$("h6").find("a.profile-name");f.addClass("js-publish").data({event_key:"user.selected",event_data:e.model.user.attributes})}e.$("#eog-holder-"+e.model.id).append(e.initChild(n,{model:s,message:e.model}).render().el).show()}e.$("h6").find(".msg-datetime").length===0&&e.$("h6").append('<i class="small time-stamp msg-datetime">'+e.model.postedAt()+"</i>"),e.$(".posted-to > .time-stamp").remove(),e.tibbr.hoverCard&&e.$("h6.eog-header-share .profile-name").qtip(e.tibbr.qtipConfigs.hovercard(t,{model:e.model.user}))}})}},Like:{showLikes:function(){var e=this.tibbr.Helper,n=parseInt(this.model.get("likes_count")),r=this;this.options.readOnly&&n>0&&this.$("#comment-count").html(this.t("analytics.leader_board.likeCount",{count:n}));var i,s=this.model.get("like_to"),o=[r.tibbr.currentUser.id],u;i=this.model.get("is_liked_by_current_user"),s=t.reject(s,function(e){return e.id===r.tibbr.currentUser.id});try{var a=s[0]||{id:"",display_name:""};switch(i){case!0:switch(n){case 0:u="";break;case 1:u=this.t("message.like_to.you");break;case 2:e.themeName()==="compact"?u=this.t("message.like_to.you_more_only",{count:n-1}):u=this.t("message.like_to.you_and_one",{url:p.url("users",a.id),name:a.display_name});break;default:e.themeName()==="compact"?u=this.t("message.like_to.you_more_only",{count:n-1}):(u=this.t("message.like_to.you_and_more",{url:p.url("users",a.id),name:a.display_name,count:n-2}),o.push(a.id))}break;default:var f=s[1]||{id:"",display_name:""};switch(n){case 0:u="";break;case 1:u=this.t("message.like_to.one",{url:p.url("users",a.id),name:a.display_name});break;case 2:e.themeName()==="compact"?u=this.t("message.like_to.more_only",{count:n}):u=this.t("message.like_to.two",{firstUrl:p.url("users",a.id),firstName:a.display_name,secondUrl:p.url("users",f.id),secondName:f.display_name});break;default:e.themeName()==="compact"?u=this.t("message.like_to.more_only",{count:n}):(u=this.t("message.like_to.more",{firstUrl:p.url("users",a.id),firstName:a.display_name,secondUrl:p.url("users",f.id),secondName:f.display_name,count:n-2}),o.push(a.id,f.id))}}}catch(l){console.error(l,s,"error on like_to message"),u=""}return{text:this.t("message.like_to."+(i?"unlike":"like")),html:u,liked:i,excludes:o.join(",")}},renderLike:function(){var e=this.model.get("is_liked_by_current_user")?"liked":" ";if(this.from===undefined){var t=requirejs("modules/common/views/messages/show_users_poll_list"),n=requirejs("modules/common/collections/users"),r=this.showLikes(),i=this.$(".js-like-"+this.likeType);this.$(".js-like-action-"+this.likeType).html(r.text).removeClass("liked").addClass(e).attr("title",r.text),r.html.length>3?i.html(r.html).show():i.html(r.html).hide(),i.find("a.user-menu-popup").qtip("destroy"),i.find("a.user-menu-popup").length>0&&(this.likeCollection=this.likeCollection||new n([],{scopeId:this.model.id,tibbrURL:{controller:"messages",action:"like_users"},dataParams:{page:1,per_page:10,post_id:this.model.get("post_id"),set_actions:!0,exclude_users:r.excludes}}),i.find("a.user-menu-popup").qtip(c.pollUsers(t,{model:this.model,title:I18n.t("message.people_who_like_this"),parent:this,collection:this.likeCollection})))}else this.$(".js-like-action-message").removeClass("liked").addClass(e)},like:function(){var e=this,t=this.model.get("is_liked_by_current_user")?"like":"unlike",n={};return n[this.model.get("modelType")]=this.model.id,this.model.like().done(e.renderLike).done(function(){e.tibbr.pub(t,n)}),!1}}},UI:{loader:'<img src="'+p.context()+'images/tibbr-loader.gif" width="145" height="25" class="line-loader" >',barLoading:'<img src="'+p.context()+'images/loading_mask.gif" width="23" height="18" class="bar-loading" style="height: 14px; position: absolute; margin-left: 124px;">',pageLoader:'<img src="'+p.context()+'images/page-loader.gif"  width="600" height="500" style="margin: auto; display: block;"  class="page-loader" >',spinner:'<img src="'+p.context()+'images/tibbr-spinner.gif" width="20" height="20" class="spinner" >',spinnerSquare:'<img src="'+p.context()+'images/loading_sm.gif" class="spinner-square" >'}};return t.each(m.UI,function(e,t){window[t]=e}),e.fn.afterRenderToDom=function(){var n=this,r=n.attr("id"),i=e.Deferred(),s=0,o=100,u=n.get(0).tagName.toLowerCase(),a=e("body"),f=function(){l&&(window.clearInterval(l),l=null)};t.isUndefined(r)&&n.attr("id",t.uniqueId(u));var l=window.setInterval(function(){s+=1,s>60&&(f(),i.reject(" timeout: Not able to find Element on dom tibr")),a.find(u+"#"+n.attr("id").length>0)&&(f(),n.trigger("dom:rendered"),i.resolve())},o);return i.promise()},m}),define("modules/backbone/router",["jquery","underscore","backbone","./super","routes","../modules","../../require/underscore-string"],function(t,n,r,i,s,o,u){return r.Router.extend=i,r.Router.extend({initialize:function(){this._super(),this.routesHit=0,this.on("route",function(){this.routesHit++},this)},route:function(e,i,s){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(s=i,i=""),s||(s=this[i]);var o=this;return r.history.route(e,function(a){var f;f=t.Deferred(),f.promise().then(function(){o._previousFragment=a;var t=o._extractParameters(e,a);s&&s.apply(o,t),o.trigger.apply(o,["route:"+i].concat(t)),o.trigger("route",i,t),r.history.trigger("route",o,i,t)});var l=n.compact(t("textarea.redactor").map(function(){return u.stripTags(t(this).val())}).toArray()).length>0;return l&&t.fn.PageLost?(t.fn.PageLost({leave:function(){return f.resolve()},stay:function(){o.navigate(o._previousFragment,{replace:!0})}}),f.promise()):f.resolve()}),this},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})},routes:s,name:"base",_try:o.Util._try,_redirectTo:function(e){return"NEED TO IMPLEMENT ..._redirectTo For ulr"+e},tibbrParams:function(e){var t={};if((e||[]).length===0||e[0]===null)t.action="index";else{var r=e[0].split("?"),i=n.compact((r[0]||"/index").split("/")),s=(e[0].replace(r[0]+"?","")||"").split("&");i.length>1?(t.action=i[1],i[0]&&(t.id=i[0])):i.length===1&&!n.isNaN(parseInt(i[0]))?(t.action="show",t.id=i[0]):t.action=i[0],i.length>2&&n.each(i,function(e,n){n>1&&(t["param"+(n-1)]=e)}),n.extend(t,this.serializeObject(s))}t.controller=this.name,this.params=window._params_=window.params=t},redirectTo:function(e){var r=e.action,i=n.isUndefined(e.redirect)?!0:e.redirect,s=e.id,o=e.params,u="/"+(e.controller||window._params_.controller);r&&s&&o?u+="/"+r+"/"+s+"?"+t.param(o):r&&s?u+="/"+r+"/"+s:u+="/"+r,this.tibbr.redirectTo(u,i)},serializeObject:function(e){var r=n.compact(n.map(e,function(e){if(e){var t=e.replace(/\+/g,"%20"),n=t.split("=")[0],r=t.replace(n+"=","");return{name:decodeURIComponent(n),value:decodeURIComponent(r)}}return null})),i,s,o,u=this;return i={},o={},s={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/},r.length===0?i:(this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return o[e]===void 0&&(o[e]=0),o[e]++},t.each(r,function(e,n){var r,o,a,f,l;if(!s.validate.test(n.name))return{};o=n.name.match(s.key),a=n.value,l=n.name;while((r=o.pop())!==void 0)s.push.test(r)?(f=new RegExp("\\["+r+"\\]$"),l=l.replace(f,""),a=u.build([],u.push_counter(l),a)):s.fixed.test(r)?a=u.build([],r,a):s.named.test(r)&&(a=u.build({},r,a));return i=t.extend(!0,i,a),i}),i)}})}),define("require/handlebars",[],function(){var e=function(){var e=function(){function t(e){this.string=e}var e;return t.prototype.toString=function(){return""+this.string},e=t,e}(),t=function(e){function o(e){return r[e]||"&amp;"}function u(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}function c(e){return e instanceof n?e.toString():!e&&e!==0?"":(e=""+e,s.test(e)?e.replace(i,o):e)}function h(e){return!e&&e!==0?!0:l(e)&&e.length===0?!0:!1}var t={},n=e,r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,s=/[&<>"'`]/;t.extend=u;var a=Object.prototype.toString;t.toString=a;var f=function(e){return typeof e=="function"};f(/x/)&&(f=function(e){return typeof e=="function"&&a.call(e)==="[object Function]"});var f;t.isFunction=f;var l=Array.isArray||function(e){return e&&typeof e=="object"?a.call(e)==="[object Array]":!1};return t.isArray=l,t.escapeExpression=c,t.isEmpty=h,t}(e),n=function(){function n(){var e=Error.prototype.constructor.apply(this,arguments);for(var n=0;n<t.length;n++)this[t[n]]=e[t[n]]}var e,t=["description","fileName","lineNumber","message","name","number","stack"];return n.prototype=new Error,e=n,e}(),r=function(e,t){function h(e,t){this.helpers=e||{},this.partials=t||{},p(this)}function p(e){e.registerHelper("helperMissing",function(e){if(arguments.length===2)return undefined;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,n){var r=n.inverse||function(){},i=n.fn;return f(t)&&(t=t.call(this)),t===!0?i(this):t===!1||t==null?r(this):a(t)?t.length>0?e.helpers.each(t,n):r(this):i(t)}),e.registerHelper("each",function(e,t){var n=t.fn,r=t.inverse,i=0,s="",o;f(e)&&(e=e.call(this)),t.data&&(o=m(t.data));if(e&&typeof e=="object")if(a(e))for(var u=e.length;i<u;i++)o&&(o.index=i,o.first=i===0,o.last=i===e.length-1),s+=n(e[i],{data:o});else for(var l in e)e.hasOwnProperty(l)&&(o&&(o.key=l),s+=n(e[l],{data:o}),i++);return i===0&&(s=r(this)),s}),e.registerHelper("if",function(e,t){return f(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||r.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers["if"].call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){f(e)&&(e=e.call(this));if(!r.isEmpty(e))return t.fn(e)}),e.registerHelper("log",function(t,n){var r=n.data&&n.data.level!=null?parseInt(n.data.level,10):1;e.log(r,t)})}function v(e,t){d.log(e,t)}var n={},r=e,i=t,s="1.1.2";n.VERSION=s;var o=4;n.COMPILER_REVISION=o;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"};n.REVISION_CHANGES=u;var a=r.isArray,f=r.isFunction,l=r.toString,c="[object Object]";n.HandlebarsEnvironment=h,h.prototype={constructor:h,logger:d,log:v,registerHelper:function(e,t,n){if(l.call(e)===c){if(n||t)throw new i("Arg not supported with multiple helpers");r.extend(this.helpers,e)}else n&&(t.not=n),this.helpers[e]=t},registerPartial:function(e,t){l.call(e)===c?r.extend(this.partials,e):this.partials[e]=t}};var d={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(e,t){if(d.level<=e){var n=d.methodMap[e];typeof console!="undefined"&&console[n]&&console[n].call(console,t)}}};n.logger=d,n.log=v;var m=function(e){var t={};return r.extend(t,e),t};return n.createFrame=m,n}(t,n),i=function(e,t,n){function a(e){var t=e&&e[0]||1,n=o;if(t!==n){if(t<n){var r=u[n],i=u[t];throw new Error("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+r+") or downgrade your runtime to an older version ("+i+").")}throw new Error("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function f(e,t){if(!t)throw new Error("No environment passed to template");var n;t.compile?n=function(e,n,r,i,s,o){var u=h.apply(this,arguments);if(u)return u;var a={helpers:i,partials:s,data:o};return s[n]=t.compile(e,{data:o!==undefined},t),s[n](r,a)}:n=function(e,t){var n=h.apply(this,arguments);if(n)return n;throw new s("The partial "+t+" could not be compiled when running in runtime-only mode")};var r={escapeExpression:i.escapeExpression,invokePartial:n,programs:[],program:function(e,t,n){var r=this.programs[e];return n?r=c(e,t,n):r||(r=this.programs[e]=c(e,t)),r},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n={},i.extend(n,t),i.extend(n,e)),n},programWithDepth:l,noop:p,compilerInfo:null};return function(n,i){i=i||{};var s=i.partial?i:t,o,u;i.partial||(o=i.helpers,u=i.partials);var f=e.call(r,s,n,o,u,i.data);return i.partial||a(r.compilerInfo),f}}function l(e,t,n){var r=Array.prototype.slice.call(arguments,3),i=function(e,i){return i=i||{},t.apply(this,[e,i.data||n].concat(r))};return i.program=e,i.depth=r.length,i}function c(e,t,n){var r=function(e,r){return r=r||{},t(e,r.data||n)};return r.program=e,r.depth=0,r}function h(e,t,n,r,i,o){var u={partial:!0,helpers:r,partials:i,data:o};if(e===undefined)throw new s("The partial "+t+" could not be found");if(e instanceof Function)return e(n,u)}function p(){return""}var r={},i=e,s=t,o=n.COMPILER_REVISION,u=n.REVISION_CHANGES;return r.template=f,r.programWithDepth=l,r.program=c,r.invokePartial=h,r.noop=p,r}(t,n,r),s=function(e,t,n,r,i){var s,o=e,u=t,a=n,f=r,l=i,c=function(){var e=new o.HandlebarsEnvironment;return f.extend(e,o),e.SafeString=u,e.Exception=a,e.Utils=f,e.VM=l,e.template=function(t){return l.template(t,e)},e},h=c();return h.create=c,s=h,s}(r,e,n,t,i),o=function(e){function r(e,t,n){this.type="program",this.statements=e,this.strip={},n?(this.inverse=new r(n,t),this.strip.right=t.left):t&&(this.strip.left=t.right)}function i(e,t,n,r){this.type="mustache",this.hash=t,this.strip=r;var i=n[3]||n[2];this.escaped=i!=="{"&&i!=="&";var s=this.id=e[0],o=this.params=e.slice(1),u=this.eligibleHelper=s.isSimple;this.isHelper=u&&(o.length||t)}function s(e,t,n){this.type="partial",this.partialName=e,this.context=t,this.strip=n}function o(e,t,r,i){if(e.id.original!==i.path.original)throw new n(e.id.original+" doesn't match "+i.path.original);this.type="block",this.mustache=e,this.program=t,this.inverse=r,this.strip={left:e.strip.left,right:i.strip.right},(t||r).strip.left=e.strip.right,(r||t).strip.right=i.strip.left,r&&!t&&(this.isInverse=!0)}function u(e){this.type="content",this.string=e}function a(e){this.type="hash",this.pairs=e}function f(e){this.type="ID";var t="",r=[],i=0;for(var s=0,o=e.length;s<o;s++){var u=e[s].part;t+=(e[s].separator||"")+u;if(u===".."||u==="."||u==="this"){if(r.length>0)throw new n("Invalid path: "+t);u===".."?i++:this.isScoped=!0}else r.push(u)}this.original=t,this.parts=r,this.string=r.join("."),this.depth=i,this.isSimple=e.length===1&&!this.isScoped&&i===0,this.stringModeValue=this.string}function l(e){this.type="PARTIAL_NAME",this.name=e.original}function c(e){this.type="DATA",this.id=e}function h(e){this.type="STRING",this.original=this.string=this.stringModeValue=e}function p(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)}function d(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue=e==="true"}function v(e){this.type="comment",this.comment=e}var t={},n=e;return t.ProgramNode=r,t.MustacheNode=i,t.PartialNode=s,t.BlockNode=o,t.ContentNode=u,t.HashNode=a,t.IdNode=f,t.PartialNameNode=l,t.DataNode=c,t.StringNode=h,t.IntegerNode=p,t.BooleanNode=d,t.CommentNode=v,t}(n),u=function(){var e,t=function(){function t(e,t){return{left:e[2]==="~",right:t[0]==="~"||t[1]==="~"}}function r(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,root:3,statements:4,EOF:5,program:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,partial_option0:27,inMustache_repetition0:28,inMustache_option0:29,dataName:30,param:31,STRING:32,INTEGER:33,BOOLEAN:34,hash:35,hash_repetition_plus0:36,hashSegment:37,ID:38,EQUALS:39,DATA:40,pathSegments:41,SEP:42,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",32:"STRING",33:"INTEGER",34:"BOOLEAN",38:"ID",39:"EQUALS",40:"DATA",42:"SEP"},productions_:[0,[3,2],[3,1],[6,2],[6,3],[6,2],[6,1],[6,1],[6,0],[4,1],[4,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,4],[7,2],[17,3],[17,1],[31,1],[31,1],[31,1],[31,1],[31,1],[35,1],[37,3],[26,1],[26,1],[26,1],[30,2],[21,1],[41,3],[41,1],[27,0],[27,1],[28,0],[28,2],[29,0],[29,1],[36,1],[36,2]],performAction:function(n,r,i,s,o,u,a){var f=u.length-1;switch(o){case 1:return new s.ProgramNode(u[f-1]);case 2:return new s.ProgramNode([]);case 3:this.$=new s.ProgramNode([],u[f-1],u[f]);break;case 4:this.$=new s.ProgramNode(u[f-2],u[f-1],u[f]);break;case 5:this.$=new s.ProgramNode(u[f-1],u[f],[]);break;case 6:this.$=new s.ProgramNode(u[f]);break;case 7:this.$=new s.ProgramNode([]);break;case 8:this.$=new s.ProgramNode([]);break;case 9:this.$=[u[f]];break;case 10:u[f-1].push(u[f]),this.$=u[f-1];break;case 11:this.$=new s.BlockNode(u[f-2],u[f-1].inverse,u[f-1],u[f]);break;case 12:this.$=new s.BlockNode(u[f-2],u[f-1],u[f-1].inverse,u[f]);break;case 13:this.$=u[f];break;case 14:this.$=u[f];break;case 15:this.$=new s.ContentNode(u[f]);break;case 16:this.$=new s.CommentNode(u[f]);break;case 17:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 18:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 19:this.$={path:u[f-1],strip:t(u[f-2],u[f])};break;case 20:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 21:this.$=new s.MustacheNode(u[f-1][0],u[f-1][1],u[f-2],t(u[f-2],u[f]));break;case 22:this.$=new s.PartialNode(u[f-2],u[f-1],t(u[f-3],u[f]));break;case 23:this.$=t(u[f-1],u[f]);break;case 24:this.$=[[u[f-2]].concat(u[f-1]),u[f]];break;case 25:this.$=[[u[f]],null];break;case 26:this.$=u[f];break;case 27:this.$=new s.StringNode(u[f]);break;case 28:this.$=new s.IntegerNode(u[f]);break;case 29:this.$=new s.BooleanNode(u[f]);break;case 30:this.$=u[f];break;case 31:this.$=new s.HashNode(u[f]);break;case 32:this.$=[u[f-2],u[f]];break;case 33:this.$=new s.PartialNameNode(u[f]);break;case 34:this.$=new s.PartialNameNode(new s.StringNode(u[f]));break;case 35:this.$=new s.PartialNameNode(new s.IntegerNode(u[f]));break;case 36:this.$=new s.DataNode(u[f]);break;case 37:this.$=new s.IdNode(u[f]);break;case 38:u[f-2].push({part:u[f],separator:u[f-1]}),this.$=u[f-2];break;case 39:this.$=[{part:u[f]}];break;case 42:this.$=[];break;case 43:u[f-1].push(u[f]);break;case 46:this.$=[u[f]];break;case 47:u[f-1].push(u[f])}},table:[{3:1,4:2,5:[1,3],8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[3]},{5:[1,16],8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],25:[1,15]},{1:[2,2]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{4:20,6:18,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{4:20,6:22,7:19,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,8],22:[1,13],23:[1,14],25:[1,15]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{17:23,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:29,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:30,21:24,30:25,38:[1,28],40:[1,27],41:26},{17:31,21:24,30:25,38:[1,28],40:[1,27],41:26},{21:33,26:32,32:[1,34],33:[1,35],38:[1,28],41:26},{1:[2,1]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{10:36,20:[1,37]},{4:38,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,7],22:[1,13],23:[1,14],25:[1,15]},{7:39,8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,21],20:[2,6],22:[1,13],23:[1,14],25:[1,15]},{17:23,18:[1,40],21:24,30:25,38:[1,28],40:[1,27],41:26},{10:41,20:[1,37]},{18:[1,42]},{18:[2,42],24:[2,42],28:43,32:[2,42],33:[2,42],34:[2,42],38:[2,42],40:[2,42]},{18:[2,25],24:[2,25]},{18:[2,37],24:[2,37],32:[2,37],33:[2,37],34:[2,37],38:[2,37],40:[2,37],42:[1,44]},{21:45,38:[1,28],41:26},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],40:[2,39],42:[2,39]},{18:[1,46]},{18:[1,47]},{24:[1,48]},{18:[2,40],21:50,27:49,38:[1,28],41:26},{18:[2,33],38:[2,33]},{18:[2,34],38:[2,34]},{18:[2,35],38:[2,35]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{21:51,38:[1,28],41:26},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,3],22:[1,13],23:[1,14],25:[1,15]},{4:52,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,5],22:[1,13],23:[1,14],25:[1,15]},{14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]},{18:[2,44],21:56,24:[2,44],29:53,30:60,31:54,32:[1,57],33:[1,58],34:[1,59],35:55,36:61,37:62,38:[1,63],40:[1,27],41:26},{38:[1,64]},{18:[2,36],24:[2,36],32:[2,36],33:[2,36],34:[2,36],38:[2,36],40:[2,36]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,65]},{18:[2,41]},{18:[1,66]},{8:17,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],25:[1,15]},{18:[2,24],24:[2,24]},{18:[2,43],24:[2,43],32:[2,43],33:[2,43],34:[2,43],38:[2,43],40:[2,43]},{18:[2,45],24:[2,45]},{18:[2,26],24:[2,26],32:[2,26],33:[2,26],34:[2,26],38:[2,26],40:[2,26]},{18:[2,27],24:[2,27],32:[2,27],33:[2,27],34:[2,27],38:[2,27],40:[2,27]},{18:[2,28],24:[2,28],32:[2,28],33:[2,28],34:[2,28],38:[2,28],40:[2,28]},{18:[2,29],24:[2,29],32:[2,29],33:[2,29],34:[2,29],38:[2,29],40:[2,29]},{18:[2,30],24:[2,30],32:[2,30],33:[2,30],34:[2,30],38:[2,30],40:[2,30]},{18:[2,31],24:[2,31],37:67,38:[1,68]},{18:[2,46],24:[2,46],38:[2,46]},{18:[2,39],24:[2,39],32:[2,39],33:[2,39],34:[2,39],38:[2,39],39:[1,69],40:[2,39],42:[2,39]},{18:[2,38],24:[2,38],32:[2,38],33:[2,38],34:[2,38],38:[2,38],40:[2,38],42:[2,38]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{18:[2,47],24:[2,47],38:[2,47]},{39:[1,69]},{21:56,30:60,31:70,32:[1,57],33:[1,58],34:[1,59],38:[1,28],40:[1,27],41:26},{18:[2,32],24:[2,32],38:[2,32]}],defaultActions:{3:[2,2],16:[2,1],50:[2,41]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){function s(e,t){return n.yytext=n.yytext.substr(e,n.yyleng-t)}var o=i;switch(r){case 0:n.yytext.slice(-2)==="\\\\"?(s(0,1),this.begin("mu")):n.yytext.slice(-1)==="\\"?(s(0,1),this.begin("emu")):this.begin("mu");if(n.yytext)return 14;break;case 1:return 14;case 2:return n.yytext.slice(-1)!=="\\"&&this.popState(),n.yytext.slice(-1)==="\\"&&s(0,1),14;case 3:return s(0,4),this.popState(),15;case 4:return 25;case 5:return 16;case 6:return 20;case 7:return 19;case 8:return 19;case 9:return 23;case 10:return 22;case 11:this.popState(),this.begin("com");break;case 12:return s(3,5),this.popState(),15;case 13:return 22;case 14:return 39;case 15:return 38;case 16:return 38;case 17:return 42;case 18:break;case 19:return this.popState(),24;case 20:return this.popState(),18;case 21:return n.yytext=s(1,2).replace(/\\"/g,'"'),32;case 22:return n.yytext=s(1,2).replace(/\\'/g,"'"),32;case 23:return 40;case 24:return 34;case 25:return 34;case 26:return 33;case 27:return 38;case 28:return n.yytext=s(1,2),38;case 29:return"INVALID";case 30:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s])))/,/^(?:false(?=([~}\s])))/,/^(?:-?[0-9]+(?=([~}\s])))/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[3],inclusive:!1},INITIAL:{rules:[0,1,30],inclusive:!0}},e}();return e.lexer=n,r.prototype=e,e.Parser=r,new r}();return e=t,e}(),a=function(e,t){function s(e){return e.constructor===i.ProgramNode?e:(r.yy=i,r.parse(e))}var n={},r=e,i=t;return n.parser=r,n.parse=s,n}(u,o),f=function(e){function s(e){this.value=e}function o(){}var t,n=e.COMPILER_REVISION,r=e.REVISION_CHANGES,i=e.log;o.prototype={nameLookup:function(e,t){var n,r;return e.indexOf("depth")===0&&(n=!0),/^[0-9]+$/.test(t)?r=e+"["+t+"]":o.isValidJavaScriptVariableName(t)?r=e+"."+t:r=e+"['"+t+"']",n?"("+e+" && "+r+")":r},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(e,t,n,r){this.environment=e,this.options=t||{},i("debug",this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(e,t);var s=e.opcodes,o;this.i=0;for(var u=s.length;this.i<u;this.i++)o=s[this.i],o.opcode==="DECLARE"?this[o.name]=o.value:this[o.opcode].apply(this,o.args),o.opcode!==this.stripNext&&(this.stripNext=!1);return this.pushSource(""),this.createFunctionContext(r)},preamble:function(){var e=[];if(!this.isChild){var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}else e.push("");this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(e){var t=this.stackVars.concat(this.registers.list);t.length>0&&(this.source[1]=this.source[1]+", "+t.join(", "));if(!this.isChild)for(var s in this.context.aliases)this.context.aliases.hasOwnProperty(s)&&(this.source[1]=this.source[1]+", "+s+"="+this.context.aliases[s]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.pushSource("return buffer;");var o=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var u=0,a=this.environment.depths.list.length;u<a;u++)o.push("depth"+this.environment.depths.list[u]);var f=this.mergeSource();if(!this.isChild){var l=n,c=r[l];f="this.compilerInfo = ["+l+",'"+c+"'];\n"+f}if(e)return o.push(f),Function.apply(this,o);var h="function "+(this.name||"")+"("+o.join(",")+") {\n  "+f+"}";return i("debug",h+"\n\n"),h},mergeSource:function(){var e="",t;for(var n=0,r=this.source.length;n<r;n++){var i=this.source[n];i.appendToBuffer?t?t=t+"\n    + "+i.content:t=i.content:(t&&(e+="buffer += "+t+";\n  ",t=undefined),e+=i+"\n  ")}return e},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.pushSource("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.pendingContent&&(e=this.pendingContent+e),this.stripNext&&(e=e.replace(/^\s+/,"")),this.pendingContent=e},strip:function(){this.pendingContent&&(this.pendingContent=this.pendingContent.replace(/\s+$/,"")),this.stripNext="strip"},append:function(){this.flushInline();var e=this.popStack();this.pushSource("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.pushSource("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.pushSource(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),typeof e=="string"?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=undefined,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){e!=null?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0),r=this.nameLookup("depth"+this.lastContext,t,"context");this.push(n.name+" || "+r),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") "+": helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),r=this.lastHelper=this.nameLookup("helpers",e,"helper"),i=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.pushSource("if ("+s+" = "+r+") { "+s+" = "+s+".call("+n.callParams+"); }"),this.pushSource("else { "+s+" = "+i+"; "+s+" = typeof "+s+" === functionType ? "+s+".call("+n.callParams+") : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t=this.popStack(),n,r;this.options.stringParams&&(r=this.popStack(),n=this.popStack());var i=this.hash;n&&i.contexts.push("'"+e+"': "+n),r&&i.types.push("'"+e+"': "+r),i.values.push("'"+e+"': ("+t+")")},compiler:o,compileChildren:function(e,t){var n=e.children,r,i;for(var s=0,o=n.length;s<o;s++){r=n[s],i=new this.compiler;var u=this.matchExistingProgram(r);u==null?(this.context.programs.push(""),u=this.context.programs.length,r.index=u,r.name="program"+u,this.context.programs[u]=i.compile(r,t,this.context),this.context.environments[u]=r):(r.index=u,r.name="program"+u)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var r=this.context.environments[t];if(r&&r.equals(e))return t}},programExpression:function(e){this.context.aliases.self="this";if(e==null)return"self.noop";var t=this.environment.children[e],n=t.depths.list,r,i=[t.index,t.name,"data"];for(var s=0,o=n.length;s<o;s++)r=n[s],r===1?i.push("depth0"):i.push("depth"+(r-1));return(n.length===0?"self.program(":"self.programWithDepth(")+i.join(", ")+")"},register:function(e,t){this.useRegister(e),this.pushSource(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new s(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.quotedString(this.pendingContent))),this.pendingContent=undefined),e&&this.source.push(e)},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.pushSource(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t="",n=this.isInline(),r;if(n){var i=this.popStack(!0);if(i instanceof s)r=i.value;else{var o=this.stackSlot?this.topStackName():this.incrStack();t="("+this.push(o)+" = "+i+"),",r=this.topStack()}}else r=this.topStack();var u=e.call(this,r);return n?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+t+u+")")):(/^stack/.test(r)||(r=this.nextStack()),this.pushSource(r+" = ("+t+u+");")),r},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];r instanceof s?this.compileStack.push(r):this.pushStack(r)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();return!e&&n instanceof s?n.value:(t||this.stackSlot--,n)},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof s?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var r=[];this.setupParams(e,r,n);var i=this.nameLookup("helpers",t,"helper");return{params:r,name:i,callParams:["depth0"].concat(r).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(r).join(", ")}},setupParams:function(e,t,n){var r=[],i=[],s=[],o,u,a;r.push("hash:"+this.popStack()),u=this.popStack(),a=this.popStack();if(a||u)a||(this.context.aliases.self="this",a="self.noop"),u||(this.context.aliases.self="this",u="self.noop"),r.push("inverse:"+u),r.push("fn:"+a);for(var f=0;f<e;f++)o=this.popStack(),t.push(o),this.options.stringParams&&(s.push(this.popStack()),i.push(this.popStack()));return this.options.stringParams&&(r.push("contexts:["+i.join(",")+"]"),r.push("types:["+s.join(",")+"]"),r.push("hashContexts:hashContexts"),r.push("hashTypes:hashTypes")),this.options.data&&r.push("data:data"),r="{"+r.join(",")+"}",n?(this.register("options",r),t.push("options")):t.push(r),t.join(", ")}};var u="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),a=o.RESERVED_WORDS={};for(var f=0,l=u.length;f<l;f++)a[u[f]]=!0;return o.isValidJavaScriptVariableName=function(e){return!o.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1},t=o,t}(r),l=function(e,t,n,r){function f(){}function l(e,t){if(e==null||typeof e!="string"&&e.constructor!==a.ProgramNode)throw new s("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var n=o(e),r=(new f).compile(n,t);return(new u).compile(r,t)}function c(e,t,n){function i(){var r=o(e),i=(new f).compile(r,t),s=(new u).compile(i,t,undefined,!0);return n.template(s)}if(e==null||typeof e!="string"&&e.constructor!==a.ProgramNode)throw new s("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);t=t||{},"data"in t||(t.data=!0);var r;return function(e,t){return r||(r=i()),r.call(this,e,t)}}var i={},s=e,o=t.parse,u=n,a=r;return i.Compiler=f,f.prototype={compiler:f,disassemble:function(){var e=this.opcodes,t,n=[],r,i;for(var s=0,o=e.length;s<o;s++){t=e[s];if(t.opcode==="DECLARE")n.push("DECLARE "+t.name+"="+t.value);else{r=[];for(var u=0;u<t.args.length;u++)i=t.args[u],typeof i=="string"&&(i='"'+i.replace("\n","\\n")+'"'),r.push(i);n.push(t.opcode+" "+r.join(" "))}}return n.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var r=this.opcodes[n],i=e.opcodes[n];if(r.opcode!==i.opcode||r.args.length!==i.args.length)return!1;for(var s=0;s<r.args.length;s++)if(r.args[s]!==i.args[s])return!1}t=this.children.length;if(e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.opcodes=[],this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(n)for(var r in n)this.options.knownHelpers[r]=n[r];return this.accept(e)},accept:function(e){var t=e.strip||{},n;return t.left&&this.opcode("strip"),n=this[e.type](e),t.right&&this.opcode("strip"),n},program:function(e){var t=e.statements;for(var n=0,r=t.length;n<r;n++)this.accept(t[n]);return this.isSimple=r===1,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++,r;this.usePartial=this.usePartial||t.usePartial,this.children[n]=t;for(var i=0,s=t.depths.list.length;i<s;i++){r=t.depths.list[i];if(r<2)continue;this.addDepth(r-1)}return n},block:function(e){var t=e.mustache,n=e.program,r=e.inverse;n&&(n=this.compileProgram(n)),r&&(r=this.compileProgram(r));var i=this.classifyMustache(t);i==="helper"?this.helperMustache(t,n,r):i==="simple"?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,r),this.opcode("pushProgram",n),this.opcode("pushProgram",r),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t=e.pairs,n,r;this.opcode("pushHash");for(var i=0,s=t.length;i<s;i++)n=t[i],r=n[1],this.options.stringParams?(r.depth&&this.addDepth(r.depth),this.opcode("getContext",r.depth||0),this.opcode("pushStringParam",r.stringModeValue,r.type)):this.accept(r),this.opcode("assignToHash",n[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);n==="simple"?this.simpleMustache(e):n==="helper"?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var r=e.id,i=r.parts[0],s=t!=null||n!=null;this.opcode("getContext",r.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",i,s)},simpleMustache:function(e){var t=e.id;t.type==="DATA"?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var r=this.setupFullMustacheParams(e,t,n),i=e.id.parts[0];if(this.options.knownHelpers[i])this.opcode("invokeKnownHelper",r.length,i);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+i);this.opcode("invokeHelper",r.length,i)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var n=1,r=e.parts.length;n<r;n++)this.opcode("lookup",e.parts[n])},DATA:function(e){this.options.data=!0;if(e.id.isScoped||e.id.depth)throw new s("Scoped data references are not supported: "+e.original);this.opcode("lookupData");var t=e.id.parts;for(var n=0,r=t.length;n<r;n++)this.opcode("lookup",t[n])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");if(e===0)return;this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,r=this.options;if(n&&!t){var i=e.id.parts[0];r.knownHelpers[i]?t=!0:r.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){var t=e.length,n;while(t--)n=e[t],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this[n.type](n)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),r}},i.precompile=l,i.compile=c,i}(n,a,f,o),c=function(e,t,n,r,i){var s,o=e,u=t,a=n.parser,f=n.parse,l=r.Compiler,c=r.compile,h=r.precompile,p=i,d=o.create,v=function(){var e=d();return e.compile=function(t,n){return c(t,n,e)},e.precompile=h,e.AST=u,e.Compiler=l,e.JavaScriptCompiler=p,e.Parser=a,e.parse=f,e};return o=v(),o.create=v,s=o,s}(s,o,a,l,f);return c}();return e}),define("handlebars",["require/handlebars","underscore","require/underscore-string","require/i18n-js","modules/helper"],function(e,t,n,r,i){var s=[].slice;e.registerHelper("t",function(){var n=s.call(arguments),i=t.first(n),o=t.last(n).hash;arguments.length>2&&(n.pop(),i=n.join("."));var u=r.t(i,o);return new e.SafeString(u)}),t.each(t.str,function(n,r){t.isFunction(n)&&e.registerHelper(r,function(){var e=s.call(arguments);e.pop();var r=n.apply(t.string,e);return r==="null"||r===null?"":r})});var o=["asset","assetImage","imagePath","themeImagePath"];return t.each(i,function(n,r){t.isFunction(n)&&e.registerHelper(r,function(){var e=[].slice.call(arguments),s=e.pop();return this.useAPI&&t.include(o,r)&&(!t.include(["imagePath","themeImagePath"],r)||!window.useLocaleImagePath)&&(s.hash?s.hash.host=(window.TIBR||{}).host:s.hash={host:(window.TIBR||{}).host}),s.hash&&e.push(s.hash),n.apply(i,e)})}),e.registerHelper("setData",function(e){return window.gadget?JSON.stringify(e):""}),e.registerHelper("stringify",function(e){return JSON.stringify(e)}),e.registerHelper("inputs",function(n,r,i){i=(t.isString(i)?i:"").split(",");var s="",o=function(e,n){t.each(e,function(e,r){if(t.isArray(e))u(e,n+"["+r+"]");else if(t.isObject(e))o(e,n+"["+r+"]");else if(!t.include(i,r)){var a=n.indexOf("[")>0?n+r:n+"["+r+"]";e?s+='<input type="hidden" name="'+a+'"  value="'+e+'" />':s+='<input type="hidden" name="'+a+'"  value="" />'}})},u=function(e,n){var r=n+"[]";t.each(e,function(e){o(e,r)})};return o(r,n),new e.SafeString(s)}),e.registerHelper("urlFor",function(e,t){var n=t.id,r=t.baseName||(t.json_class?(t.json_class+"s").toLowerCase():"NO_BASE_NAME");e==="show"?e="":e="/"+e;var s=i.url(r+"/"+n+e);return this.useAPI&&TIBR&&(s=TIBR.host+s),s}),e.registerHelper("linkTo",function(){var n=s.call(arguments),r=t.first(n),i=t.last(n),o=i.hash||{};o.html=i.fn(this);var u;if(t.isObject(r)){var a=i===n[1]?"show":n[1];u=e.helpers.urlFor.call(this,a,r)}else{var f=t.without(n,i);u=e.helpers.url.apply(this,f),this.useAPI&&TIBR&&(u=TIBR.host+"/"+u)}o.href=u,this.useAPI&&(o.target="_blank");var l=$("<a/>",o),c=$("<div/>").append(l).html();return new e.SafeString(c)}),e.registerHelper("moment",function(e,n){var r=requirejs("tibbr"),i=requirejs("require/moment"),s=r.currentUser;if(t.isEmpty(e))return"";var o=i(e).utc().add("minutes",s.get("time_zone_offset")),u=i().utc().add("minutes",s.get("time_zone_offset"));return u.year()===o.year()&&u.month()===o.month()&&u.date()===o.date()?o.format(r.dateFormat[t.isString(n)?n:"T"]):o.format(r.dateFormat[t.isString(n)?n:"LLLL"])}),e.registerHelper("debug",function(e){console.log("Current Context"),console.log("===================="),console.log(this),e&&(console.log("Value"),console.log("===================="),console.log(e))}),e.registerHelper("getSubjectTypeClass",function(e){var t=requirejs("tibbr");if(!e)return"";var n=e.scope||"public";return e.subjectIcon="tib-"+n+"-"+t.Helper.mobile.getModelType(e.stype||e.type,e.owner_type||e.type)+"-icon",e.subjectIcon}),e.registerHelper("compare",function(e,t,n,r){var i,s;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");r===undefined&&(r=n,n=t,t="==="),i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"||":function(e,t){return e||t},"&&":function(e,t){return e&&t},"typeof":function(e,t){return typeof e==t}};if(!i[t])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+t);s=i[t](e,n);if(s&&r.fn)return r.fn(this);if(r.inverse)return r.inverse(this)}),e}),define("modules/backbone/view",["jquery","underscore","backbone","./super","../modules","../dialog","handlebars"],function(t,n,r,i,s,o,u){return r.View.extend=i,r.View.extend({_setUp:function(){this.template=new s.Template(this)},params:function(){return window._params_||{}},_try:s.Util._try,asset:function(){var e=[].slice.call(arguments),t=n.first(e),r=this.useAPI?(TIBR||{}).host:e.length>1?n.last(e):null;return s.Helper.asset.call(s.Helper,t,r)},serverPath:function(e){var t=this.useAPI?(TIBR||{}).host:undefined;return t?(e=e.replace(/^\//,""),t+"/"+e):s.Util.path.call(s.Util,e)},bindTo:function(e,t,n,r){r=r||this,e.on(t,n,r),this.bindings||(this.bindings=[]),this.bindings.push({obj:e,eventName:t,callback:n,context:r})},unbindAll:function(){n.each(this.bindings,function(e){e.obj.off(e.eventName,e.callback)}),this.bindings=[]},toggleDIv:function(e,t){var n=this,r=n.$("."+e).parent(".block");n.$("."+e).css("cursor","pointer").toggle(function(){n.$("."+t).slideUp(),r.addClass("collapsed")},function(){n.$("."+t).slideDown(),r.removeClass("collapsed")})},render:function(){return this},appendTo:function(e){return e.append(this.render().el),this},initChild:function(e,t){return t=t||{},t.controller=this.controller,t.layout=t.layout||this.layout,t.parent=t.parent||this,t.useAPI=t.useAPI||this.useAPI,t.link=n.isUndefined(t.link)?this.link:t.link,this._try(function(){var n;return n=new e(t),this.storeChild(n),n.model&&(n.model.useAPI=t.useAPI),n.collection&&(n.collection.useAPI=t.useAPI),n},function(t){return console.warn("view.js: view instantiation failed",e,t),new r.View})},leave:function(e){this.trigger("before:leave");var t=this;t.off(),t.unbindAll(),t.leaveChild(),t.undelegateEvents(),t.remove(),n.isFunction(t.onLeave)&&t.onLeave();try{var r=require("tibbr");r.Event.unbindFor(t)}catch(i){console.warn("Clean:Application:Event:Error",i)}n.isFunction(e)&&e(),t.layout=null,t.controller=null,t.parent=null,this.trigger("after:leave")},storeChild:function(e){this.children||(this.children={}),this.children[e.cid]=e},leaveChild:function(){var e=this;n.each(this.children,function(t){t.leave(function(){e.children[t.cid]=null,delete e.children[t.cid]})})},renderTemplate:function(e,t){t=t||{};var r=require("tibbr"),i={params:window.params,cid:this.cid,currentUser:r.currentUser.forTemplate(),useAPI:this.useAPI},s=t.model||this.model||{};return n.isFunction(s.forTemplate)&&(t.model=s.forTemplate({include:t.include||[]})),e(n.extend(t||{},i))},renderInLineTemplate:function(e,t){t=t||{};var r=window.__hbsTemplates=window.__hbsTemplates||{},i=t.storeKey,s,o=t.model||this.model||{};return t.useAPI=this.useAPI,n.isFunction(o.forTemplate)&&(t.model=o.forTemplate()),i?r[i]?s=r[i]:r[i]=s=u.compile(e):s=u.compile(e),s(t)},assign:function(e,t){var r;n.isObject(e)?r=e:(r={},r[e]=t);if(!r)return;n.each(r,function(e,t){e.setElement(this.$(t)).render().el},this)},setDialog:function(e,n){var r=this.$dialog;return this.dialog&&(t("#ui-dialog-title-dialog-"+this.cid).html(e),r.find(".ui-dialog-message").html(n)),r},alertError:function(e,t){if(n.isObject(e)&&n.isUndefined(e.responseText))return o.alert(e);var r=s.Error.parse(e);return t=t||this.el,o.alert({text:r,target:t})},renderDialog:function(e,t){return t=t||{},t.useAPI=this.useAPI,t.dialog=t.dialog||{},t.dialog.target=this.el,o.render(e,t)},ajax:function(e){return e=e||{},e.url=e.url.replace(new RegExp("^"+window.prefix),"/"),e.dataType=e.dataType||"json",e.type=e.type||"POST",e.global=e.global||!1,this.useAPI?(e.method=e.type,e.params=n.isString(e.data)?JSON.parse(e.data):e.data,delete e.data,delete e.type,TIBR.api(e)):(e.url=this.tibbr.path(e.url),e.data=n.extend(e.data||{},{authenticity_token:this.tibbr._CSFR_TOEKN}),t.ajax(e))},renderScrollPagination:function(){var e=[].slice.call(arguments),t,r,i,s;e.length===1&&n.isObject(e[0])?(e=e[0],t=e.View,r=e.collection,i=e.$el,s=e.type):(t=e[0],r=e[1],i=e[2],s=e[3]),n.isUndefined(t)&&(t=requirejs("modules/common/views/common/page_scroll")),r=r||this.collection;if(n.isUndefined(r))throw"renderScollPagination require a collection";i=i||this.$el;var o=this,u=function(){o.pageScrollPagination&&(o.pageScrollPagination.leave(),o.pageScrollPagination=null)};r.length>0?(u(),this.pageScrollPagination=this.initChild(t,{collection:r,type:s}),i.append(this.pageScrollPagination.render().el)):u()},fragment:function(){return document.createDocumentFragment()},afterRenderToDom:function(){return this.$el.afterRenderToDom()},appendTemplate:function(e,t){return this.$el.append(this.renderTemplate(e,t||{})),this},appendTemplateTo:function(e,t,n){return n.append(this.renderTemplate(e,t||{})),n},isOnScreen:function(){var e=t(window).scrollTop(),n=e+t(window).height(),r=this.$el.offset().top,i=r+this.$el.height();return i<=n&&r>=e}})}),define("text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("hbs",["handlebars","./text"],function(e,t){var n={},r=".hbs.html",i={load:function(t,i,s,o){if(o.isBuild){var u=nodeRequire("fs"),a=i.toUrl(t)+r;n[t]=u.readFileSync(a).toString(),s()}else i(["text!"+t+r],function(t){if(t===undefined){s();return}s(e.compile(t))})},write:function(t,r,i){if(r in n){var s=e.precompile(n[r]);i("define('hbs!"+r+"', ['handlebars'], function(Handlebars){ \n"+"return Handlebars.template("+s.toString()+");\n"+"});\n")}},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},writeFile:function(e,t,n,s,o){var u=i.parseName(t),a=u.ext?"."+u.ext:"",f=u.moduleName+a,l=n.toUrl(u.moduleName+r)+".js";i.load(f,n,function(t){var n=function(e){return s(l,e)};n.asModule=function(e,t){return s.asModule(e,l,t)},i.write(e,f,n,o)},o)}};return i}),define("hbs!modules/common/templates/layouts/base",["handlebars"],function(e){return e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div id="content" class="content lfloat"></div>\n<div id="sidebar" class="sidebar"></div>\n<!--lib base layout!>'})}),define("modules/backbone/layout",["jquery","underscore","backbone","./view","handlebars","hbs!modules/common/templates/layouts/base"],function(t,n,r,i,s,o){return i.extend({tagName:"section",initialize:function(e){var t=e.template;this.baseTemplate=o,t||(console.warn("layout  template is missing > using base layout"),t=this.baseTemplate),this._template=t},events:{},addEvent:function(e,t,r,i){i=i||this,r=n.bind(i[r],i),e+=".delegateEvents"+this.cid,t===""?this.$el.on(e,r):this.$el.on(e,t,r)},addEvents:function(e){n.each(e,function(e){this.addEvent.apply(this,e)},this),console.log(this._events)},set:function(e,t){n.isFunction(t.render)&&(t=t.render()),this.$("#"+e).replaceWith(t)},get:function(e){var n=this.$("component#"+e);return n&&n.replaceWith(t("<div/>",{id:e,"class":n.attr("class")})),this.$("#"+e)},getTemplate:function(e){return this.renderInLineTemplate(this.$("component#"+e).html(),e)},render:function(e){return this.$el.html(this.renderTemplate(this._template,e||{})),t("#content-wrap").html(this.el),this},renderInLineTemplate:function(e,t){var n=window.__hbsTemplates=window.__hbsTemplates||{},r=this._template+"."+t,i;return n[r]?i=n[r]:n[r]=i=s.compile(e),i},onLeave:function(){t("#content-wrap").html(this.baseTemplate())}})}),define("modules/backbone/controller",["jquery","underscore","backbone","./router","../modules","require/underscore-string","./layout"],function(t,n,r,i,s,o,u){var a=null;return i.extend({routes:{},tibbr:{},initialize:function(e){a&&(a.leave(),a=null),this.tibbrParams(e),s.Ajax.xhrPool.abortAll(),this.actionName=params.action.toLowerCase();if(this._beforeFilter()){if(typeof this[this.actionName]=="function"){this.tibbr.debug?this[this.actionName].apply(this,[]):this._try(this.actionName,[],function(e){console.error("SOME THING WENT WRONG",e)});try{window.scrollTo(0,0)}catch(t){}}else this.renderError(404);this.setPageTitle();if(this.appConfig("webui","config","google_tracking","enabled")&&window._gaq){var n="/#"+r.history.getFragment();window._gaq.push(["_trackPageview",n])}a=this,this.tibbr.currentController=a}else this.renderError(422)},renderError:function(e){var t=new this.tibbr.NoticeView({type:e});t.render(),this.storeView(t)},_beforeFilter:function(){return typeof this.beforeFilter=="function"?this.beforeFilter()!==!1:!0},storeView:function(){this.views||(this.views={});var e=[].slice.call(arguments,0),t=this;n.each(e,function(e){t.views[e.cid]=e})},leaveChild:function(e){var t=this.views[e.cid];t&&(t.leave(),t=null)},leave:function(){var e=this;n.isFunction(this.beforeLeave)&&this.beforeLeave(),n.each(this.views,function(t){t.leave(),e.views[t.cid]=null,delete e.views[t.cid]})},renderAction:function(e,t){return t=t||{},t.controller=this,this.layout=n.isUndefined(t.layout)?this.layout:t.layout,this._setLayout(),t.layout=this._layout,this.renderView(e,t)},_setLayout:function(){if(n.isFunction(this.layout)){this._layout=this.initView(u,{template:this.layout});return}n.isObject(this.layout)&&(this._layout=this.renderView(this.layout.view,this.layout.options||{}))},renderView:function(e,t){var n=this.initView(e,t);return n.render(),n},initView:function(e,t){var n=new e(t);return this.storeView(n),n},setPageTitle:function(e){e=e||this.pageTitle;var t=this.appConfig("site","config","prod_name")||this.tibbr.pageTitle,r=t+" : ";e?r+=e:r+=n.str.humanize(this.params.controller)+" - "+n.str.humanize(this.params.action),document.title=this.tibbr.pageTitle=r},onlyOnAction:function(){var e=[].slice.call(arguments),t=e.pop();n.include(e,this.actionName)&&n.isFunction(t)&&t()}})}),define("modules/backbone/collection",["jquery","backbone","./super","../modules"],function(e,t,n,r){return t.Collection.extend=n,t.Collection.extend({parseError:r.Error.parse,fetchPresence:!1,current_page:0,options:{},initialize:function(){var e=arguments[1];this.per_page=this.appConfig("ui_config","config","per_page","message",{"default":5}),this.scroll_per_page=this.appConfig("ui_config","config","per_page","message_scroll",{"default":3}),_.isObject(e)&&(this.options=e,_.each(e,function(e,t){this[t]=e},this))},buildModels:function(e){return this.set(e.items),this._setPagination(e),this},url:function(){var e=this._getTibbrUrl(),t=this._getUrlId();return this.directUrl?this.directUrl:e?_.isString(e)?e:r.Util.serverUrl(e.controller,e.action,t,this.useAPI):null},_getTibbrUrl:function(){var e=this.options.tibbrURL||this.tibbrURL;return e.id&&(this.scopeId=e.id),_.isString(e)?r.Util.path(e.replace("<scopeId>",this.scopeId),this.useAPI):_.isFunction(e)?e.call(this):e},_getUrlId:function(){var e;return this.scopeId===void 0||this.scopeId===null?e=null:e=parseInt(this.scopeId),e},_fetchPresence:function(t){t=t||this.fetchPresence;if(t&&this.appConfig("chat","enable")){var n=this;e.ajax({type:"POST",url:r.Util.serverUrl("chat","presence"),data:{users:n.pluck("login")},beforeSend:function(){n.fetchingPresence=!0},success:function(e){if(_.isEmpty(e))return!1;n.each(function(t){t.set({presence:e[t.get("login")]}),t.trigger("change:presence")})},error:function(e){},complete:function(){n.fetchingPresence=!1},dataType:"json"})}},_setPagination:function(e){this.current_page=e.current_page,this.per_page=e.per_page,this.total_pages=e.total_pages,this.total_entries=e.total_entries,this.hasMorePages=e.total_pages>this.current_page,this.hasPreviousPage=this.current_page>1,this.nextPage=this.hasMorePages?this.current_page*1+1:null,this.previousPage=this.hasPreviousPage?this.current_page*1-1:null,e.last_read_message_id&&(this.last_read_message_id=e.last_read_message_id),this.__setPagination=!0},parse:function(e){this._setPagination(e),this.fetched=!0,this.writeToCacheKey&&(this.tibbr.cache.write(this.writeToCacheKey,e),this.writeToCacheKey=null);var t=e.items===undefined&&_.isArray(e)?e:e.items;return this.useAPI&&_.each(t,function(e){e.useAPI=this.useAPI},this),t},addOrIgnore:function(e,t){this.get(e.get("id"))===undefined&&this.add(e,t)},fetchFromCache:function(e,t){var n=this.tibbr.cache.read(e),r=this;if(!n.error)return this._addFromRawData(n,t),!0;if(n.error.code===0){if(t.updateCache)return this.writeToCacheKey=e,!1;if(_.include(r.currentUser.cachedKeys,e)){var i=this;return r.currentUser.syncUpCache({success:function(s){n=r.tibbr.cache.read(e),i._addFromRawData(n,t)}}),!0}}},_addFromRawData:function(e,t){this.reset([],{silent:!0});var n=this.parse(e);this.add(n),typeof t.success=="function"&&t.success(this),t.silent||this.trigger("reset")},_set:function(e,t){_.isUndefined(e)&&(e=[]),t=t||{},this.__setPagination=!1;var n=this.parse(e)||[];return t.scopeId&&(this.scopeId=t.scopeId,delete t.scopeId),t.dataParams&&(this.dataParams=t.dataParams,delete t.dataParams),t.tibbrURL&&(this.tibbrURL=t.tibbrURL,delete t.tibbrURL),this.each(this._removeReference),this.__setPagination||this._setPagination(e),this._reset(),this.add(n,{silent:!0}),t.silent||this.trigger("reset",this,t),this._fetchPresence(),this},_update:function(e,t){_.each(this.parse(e)||[],function(e){if(!this.get(e.id)){var n=this._prepareModel(e,t);this.add(n,{silent:!0}),this.trigger("update",n)}},this)},setParams:function(e,t){if(t||!this.dataParams)this.dataParams={params:{page:1,per_page:10}};this.dataParams=_.extend(this.dataParams,e)},page:function(e){if(!this.dataParams)return console.warn("collection does not have data params"),this;e=e||this.current_page+1;var t=this.dataParams;return t.hasOwnProperty("params")&&(t.params.page=e),t.hasOwnProperty("page")&&(t.page=e),this.dataParams=t,this},getParams:function(e){return e?(this.dataParams||{})[e]:this.dataParams||{}},paginate:function(e,t){e&&this.setParams(e,!0),t=t||{};var n=!0;t.cacheKey&&this.dataParams.params.page==1&&(n=!this.fetchFromCache(t.cacheKey,t||{}));if(n)return this._paginateFetch(t)},_oldFetch:function(e){return e.data=e.data||this.dataParams||{},e.reset=_.isUndefined(e.reset)?!0:e.reset,e.globalLoading=_.isUndefined(this.globalLoading)?!0:this.globalLoading,t.Collection.prototype.fetch.call(this,e)},fetch:function(e){e=e||{};var t=!0;e.cacheKey&&!e.data&&(t=!this.fetchFromCache(e.cacheKey,e));if(t)return this._oldFetch(e)},_paginateFetch:function(e){return e.data=this.dataParams,e.append?this.fetchMore(e):this._oldFetch(e)},fetchMore:function(e){e=e?_.clone(e):{};var n=this,r=e.success;return e.success=function(t){var i=e.reset?"reset":"set";n[i](t,e),r&&r(n,t,e),n.trigger("sync",n,t,e)},(this.sync||t.sync).call(this,"read",this,e)},forTemplate:function(e){return e=e||{},this.map(function(t){return t.forTemplate({attributes:e})})},_try:r.Util._try})}),define("modules/backbone/model",["underscore","backbone","./super","../modules","require/moment"],function(e,t,n,r,i){return t.Model.extend=n,t.Model.extend({_constructor:function(){e.bindAll(this,"urlFor")},parseError:r.Error.parse,_url:r.Helper.url,_path:function(e){var t=this.useAPI!==!0?undefined:!0;return r.Util.path(e,t)},url:function(){if(!this.baseName)throw"Please provide a baseName  to the model";return this.id?this._path(this.baseName+(this.baseName.charAt(this.baseName.length-1)=="/"?"":"/")+this.id):this._path(this.baseName)},assetImage:function(){var t=[].slice.call(arguments),n=e.first(t),i=e.isUndefined(t[1])?3:t[1],s=this.useAPI?{host:(TIBR||{}).host}:{};return r.Helper.assetImage.call(r.Helper,n,i,s)},asset:function(){var t=[].slice.call(arguments),n=e.first(t),i=this.useAPI?(TIBR||{}).host:undefined;return r.Helper.asset.call(r.Helper,n,i)},urlFor:function(e,t){return t=t||this.id,e==="show"?e="":e="/"+e,this._url(this.baseName+"/"+t+e)},pathFor:function(e,t){return t=t||this.id,e==="show"?e="":e="/"+e,this._path(this.baseName+"/"+t+e)},action:function(e,n,r){arguments.length==1&&(r=arguments[0]),r||(r={});var i=r.success,s="",o=r.setModel!==!1;delete r.setModel,r.processData=!0,this.id&&r.id!==!1&&(s=this.id+"/"),r.url||(r.url=this._path(this.baseName+(this.baseName.charAt(this.baseName.length-1)=="/"?"":"/")+s+e));var u=this;return r.success=function(e){if(o){if(!u.set(u.parse(e,r),r))return!1;typeof u.build=="function"&&u.build()}i&&i(u,e,r),u.trigger("sync",u,e,r)},(this.sync||t.sync).call(this,n||"read",this,r)},callForAction:function(e,n,r){var i="";return this.id&&(i=this.id+"/"),r.url=this._path(this.baseName+(this.baseName.charAt(this.baseName.length-1)=="/"?"":"/")+i+e),r.processData=!0,(this.sync||t.sync).call(this,n,this,r)},_params:function(){return window._params_||{}},get:function(t,n){e.isUndefined(n)&&(n="");var r=this._super(t);return e.isNull(r)||e.isUndefined(r)?n:r},formattedDate:function(e,t){return this.displayDate(i,e,t)},displayDate:function(t,n,r){n=n||"created_at";var i=this.get(n),s=this.tibbr.currentUser;if(e.isEmpty(i))return"";var o=t(i).utc().add("minutes",s.get("time_zone_offset")),u=t().utc().add("minutes",s.get("time_zone_offset"));return u.year()===o.year()&&u.month()===o.month()&&u.date()===o.date()?o.format(this.tibbr.dateFormat[r||"T"]):o.format(this.tibbr.dateFormat[r||"LLLL"])},forTemplate:function(t){t=t||{};var n=this,r=n.toJSON(),i=t.attributes||{};return r.baseName=n.baseName,e.isArray(t.include)&&e.each(t.include,function(t){try{e.isUndefined(n[t])||(r[t]=n[t].forTemplate())}catch(i){console.warn(i,"forTemplate",t)}}),e.each(this.for_template||{},function(t,i){if(e.isFunction(t))try{r[i]=t.call(n)}catch(s){r[i]=null}else if(e.isFunction(n[t]))try{r[i]=n[t]()}catch(s){r[i]=null}else r[i]=n[t]}),e.extend(r,i)},setAction:function(t,n){var r=this.get("actions").split(",");r=e.without(r,t),r.push(n),this.set("actions",r.join(","))},fetch:function(t){var n=this;t=t||{};var r=t.success;return r&&(t.success=function(t,n,i){e.isFunction(t.build)&&t.build(),r(t,n,i)}),this._super(t).done(function(){e.isFunction(n.build)&&n.build()})},_try:r.Util._try})}),define("modules/backbone/list_view",["underscore","backbone","./view"],function(t,n,r){return r.extend({initialize:function(e){this.item=e.item||{};if(!this.item.View)throw"item View is not given";this.trigger("initialized")},render:function(e){e=e||{};var n=this,r=e.collection||this.collection;return this.collection=r,r.each(function(e){n.$el.append(n.initChild(n.item.View,t.extend(n.item.options||{},{model:e})).render().el)}),this.trigger("rendered"),this}})}),define("modules/tibbr_cache",["jquery","underscore"],function(e,t){return function(e,t,n){var r={},i=function(e,t){r[e]&&r[e].expireHandle&&n.clearTimeout(r[e].expireHandle),r[e].expireHandle=n.setTimeout(function(){r[e]&&r[e].expireHandle&&s(e)},t*1e3)},s=function(e){e&&r[e]&&(r[e].expireHandle&&n.clearTimeout(r[e].expireHandle),r[e]=null)},o;return window._debug_&&(window.__tibbrCacheStore=r),{setEventManager:function(e){o=e},write:function(e,n,s){var u=t.extend({expire_after:5},s||{});r[e]={data:n,updated:!0},u.expire_after&&i(e,u.expire_after),o&&o.trigger("cache:"+e+":updated")},clear:function(e){e&&r[e]?s(e):t.each(r,function(e,t){s(t)})},read:function(e,t){var n=r[e];return n?n.data||{}:{error:{code:0,message:"data is not updated"}}}}}(e,t,window)}),function(e){typeof module=="function"?module.exports=e(this.jQuery||require("jquery")):typeof define=="function"&&define.amd?define("require/nprogress",["jquery"],function(t){return e(t)}):this.NProgress=e(this.jQuery)}(function(e){function r(e,t,n){return e<t?t:e>n?n:e}function i(e){return(-1+e)*100}function s(e,t,r){var s;return n.positionUsing==="translate3d"?s={transform:"translate3d("+i(e)+"%,0,0)"}:n.positionUsing==="translate"?s={transform:"translate("+i(e)+"%,0)"}:s={"margin-left":i(e)+"%"},s.transition="all "+t+"ms "+r,s}var t={};t.version="0.1.2";var n=t.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};return t.configure=function(t){return e.extend(n,t),this},t.status=null,t.set=function(e){var i=t.isStarted();e=r(e,n.minimum,1),t.status=e===1?null:e;var o=t.render(!i),u=o.find('[role="bar"]'),a=n.speed,f=n.easing;return o[0].offsetWidth,o.queue(function(r){n.positionUsing===""&&(n.positionUsing=t.getPositioningCSS()),u.css(s(e,a,f)),e===1?(o.css({transition:"none",opacity:1}),o[0].offsetWidth,setTimeout(function(){o.css({transition:"all "+a+"ms linear",opacity:0}),setTimeout(function(){t.remove(),r()},a)},a)):setTimeout(r,a)}),this},t.isStarted=function(){return typeof t.status=="number"},t.start=function(){t.status||t.set(0);var e=function(){setTimeout(function(){if(!t.status)return;t.trickle(),e()},n.trickleSpeed)};return n.trickle&&e(),this},t.done=function(e){return!e&&!t.status?this:t.inc(.3+.5*Math.random()).set(1)},t.inc=function(e){var n=t.status;return n?(typeof e!="number"&&(e=(1-n)*r(Math.random()*n,.1,.95)),n=r(n+e,0,.994),t.set(n)):t.start()},t.trickle=function(){return t.inc(Math.random()*n.trickleRate)},function(){var e=0,n=0;t.promise=function(r){return!r||r.state()=="resolved"?this:(n==0&&t.start(),e++,n++,r.always(function(){n--,n==0?(e=0,t.done()):t.set((e-n)/e)}),this)}}(),t.render=function(r){if(t.isRendered())return e("#nprogress");e("html").addClass("nprogress-busy");var s=e("<div id='nprogress'>").html(n.template),o=r?"-100":i(t.status||0);return s.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+o+"%,0,0)"}),n.showSpinner||s.find('[role="spinner"]').remove(),s.appendTo(document.body),s},t.remove=function(){e("html").removeClass("nprogress-busy"),e("#nprogress").remove()},t.isRendered=function(){return e("#nprogress").length>0},t.getPositioningCSS=function(){var e=document.body.style,t="WebkitTransform"in e?"Webkit":"MozTransform"in e?"Moz":"msTransform"in e?"ms":"OTransform"in e?"O":"";return t+"Perspective"in e?"translate3d":t+"Transform"in e?"translate":"margin"},t}),define("tibbr",["jquery","underscore","backbone","require/i18n-js","modules/backbone/router","modules/backbone/controller","modules/backbone/collection","modules/backbone/model","modules/backbone/view","modules/backbone/list_view","modules/modules","modules/tibbr_cache","require/nprogress"],function(t,n,r,i,s,o,u,a,f,l,c,h,p){var d=d||{};d.pushState=function(){return!1},d.IE11=!!navigator.userAgent.match(/Trident\/7\./),d.IE=t.browser.msie||d.IE11,d.IE7=d.IE&&parseInt(t.browser.version,10)==7,d.dragNDropSupport=!d.IE||d.IE&&parseInt(t.browser.version,10)>9,d.debug=window._debug_||!1,p.configure({showSpinner:!1}),d.Progress=p,d.tracker={},d.Modules=c,d.Helper=c.Helper,d.Helper.pushState(d.pushState()),d.UI=c.UI,d._synchCurrentUser=!0,d.abortXHR=!0,d.$=t,d._=n,d.dateRegExp=new RegExp("([0-9]*)-([0-9]*)-([0-9]*)T(.*)[+|-](.*)"),d.serverDateFormat="YYYY-MM-DD",d.serverDateFormatLong="YYYY-MM-DD h:mma",d.serverDateTimeFormatLong="YYYY-MM-DD HH:mm",d.serverDateTimeTimeZoneFormat="YYYY-MM-DDTHH:mm",d.serverDatePickerFormat="yy-mm-dd",d.dateSeparator="-",d.PageAppGuid="marketplace_pages2",d.wikiRegex=/@\[(User|Message|Subject|Resource|Group|APP|EogResource|ApplicationDefinition|LdapGroup|Link)([^\]]+)\]/g,d._CSFR_TOEKN=t("meta[name='csrf-token']").attr("content"),d.i18n=I18n.translations[I18n.locale]||I18n.translations[I18n.defaultLocale],d.dateFormat=window.I18n.t("defaults.date.longDateFormat"),d.cache===undefined&&(d.cache=h,d.cache.setEventManager(d.Event)),c.Ajax.xhrPool.init(),d.gadget=!1,d.connect=!1,d.gadgetConfig={},d.publish=c.Gadget.publish,d.subscribe=c.Gadget.subscribe,d.unsubscribe=c.Gadget.unsubscribe,d.subscribedOnce=c.Gadget.subscribedOnce,d.pub=function(e,t){var r=this;n.defer(function(){r.Event.trigger("activity:done",e,r.currentUser.id,t||{})})},d.publishToClient=function(e,t){d.Event.trigger("to.tibr.client",e,t)},d.pageTitle=document.title,d.host=function(e){return e&&TIBR?TIBR.host:c.Util.host.call(d)},d.url=c.Helper.url,d.path=function(e,t){return n.isBoolean(t)&&t&&TIBR&&(t=TIBR.host),c.Util.path(e,t)},d.context=d.rootUrl=c.Helper.context,d.asset=function(){return c.Helper.asset.apply(c.Helper,arguments)},d.serverUrl=c.Util.serverUrl,d.qtipConfigs=c.qTips,d.translate=i.translate,d.util=new c.Util.windowTitle(d.pageTitle),d.data=new c.Store,d.configuration=new c.appConfig(d.data),d.appConfig=d.configuration.get,d.cookie=c.Cookie,d.pCookie=new d.cookie("_p",{path:"/",expires:360,secure:d.appConfig("ssl","enable")}),d.separator="__%__",d.stopPropagation=c.Events.stopPropagation,d.preventDefault=c.Events.preventDefault,d.redirectTo=c.Util.redirectTo,d.redirectToHome=c.Util.redirectToHome,d.reloadTo=c.Util.reloadTo,d.marketPlaceRoot=c.Util.marketPlaceRoot,d.$iFrame=function(){var e=d.appConfig("ui_config","config","common","iframe","attributes");return t("<iframe "+e+" ></iframe>")},d.Event=c.Event,n.extend(d.Event,r.Events,{cid:"tibbr_event"});var v={tibbr:d,currentUser:d.currentUser,t:d.translate,appConfig:d.appConfig,helper:d.Helper,modules:d.Modules,dataSet:d.data,event:d.Event};return d.Model=a.extend(c.Cache),n.extend(d.Model.prototype,v),d.View=f.extend({_path:c.Util.path}),n.extend(d.View.prototype,v),d.ListView=l.extend({}),d.Collection=u.extend(c.Cache),n.extend(d.Collection.prototype,v),d.Router=s.extend(),n.extend(d.Router.prototype,v),d.Controller=o.extend({}),n.extend(d.Controller.prototype,v),d.debug&&(window.Tibbr=d),window.selenium&&(window.TIBBR=d),window.$=d.$,window._=d._,String.prototype.toDateArray=function(){var e=d.dateRegExp.exec(this),t=e[4].split(":");return[e[1],e[2],e[3]].concat(t)},String.prototype.onlyDateArray=function(){var e=d.dateRegExp.exec(this);return[e[1],e[2],e[3]]},String.prototype.toInt=function(){return parseInt(this)},String.prototype.toDate=function(){var e=this.split("-");try{return new Date(e[0],e[1]-1,e[2])}catch(t){return new Date}},d}),define("modules/common/models/user",["underscore","tibbr","modules/dialog","require/moment"],function(e,t,n,r){return t.Model.extend({baseName:"users",defaults:{logged_in:!1,modelType:"User",presence:"offline",profile_image_url:"small,/assets/images/users/profile_images/missing_small.png,medium,/assets/images/users/profile_images/missing_medium.png,large,/assets/images/users/profile_images/missing_large.png"},initialize:function(){this._initialize()},_initialize:function(){e.bindAll(this,"isLoggedIn","image","showUrl","editUrl","createdAt","msgDeliveryUrl","followers","followingUrl","followersUrl","subjectsUrl","invitePeople","hierarchyUrl","follow","unfollow","messageDeliveryUrl","followUnFollowSubject","isProfileRead","approve","subscribe","signature");if(typeof this.get("profile_image_url")!==undefined){var t=this.get("profile_image_url");this.set({profileImage:this.assetImage(t,1)}),this.set({profileImageLarge:this.assetImage(t,5)}),this.set({profileImageMedium:this.assetImage(t,3)}),this.profileImage=this.get("profileImage"),this.profileImageLarge=this.get("profileImageLarge"),this.profileImageMedium=this.get("profileImageMedium")}},image:function(e){var t=this.get("profile_image_url");return this.assetImage(t,e)},isImageSet:function(){return!e.str.include(this.image(5),"missing")},jid:function(){return this.get("login")+"@"+t.appConfig("chat","domain")},jid_id:function(){return this.get("login").replace(/\./g,"-")+"-"+t.appConfig("chat","domain")},followers:function(){return this.get("followers")},createdAt:function(){return r(this.get("created_at")).format("MMMM Do YYYY, h:mm a")},following:function(){return this.get("idols")},isLoggedIn:function(){return this.get("logged_in")},displayName:function(){return this.get("display_name")},showUrl:function(){return t.currentUser&&this.id===t.currentUser.id?this.urlFor("show"):this.urlFor("profile")},invitePeople:function(e,t,n,r,i,s){return this.action("recommend_a_subject","create",{data:{params:{user_ids:t,group_ids:n,emails:r,recommendation_text:i,subject_id:s}},complete:function(t){e.trigger("people:invited",{response:t})}})},editUrl:function(){return this.urlFor("edit")},msgDeliveryUrl:function(){return this.urlFor("msg_delivery")},signature:function(){return e.isObject(this.get("signature"))?this.get("signature").line:""},changePassword:function(e,r,i,s,o,u){var a=this;return this.action("change_password","update",{data:{params:{password:e,new_password:r,new_password_confirmation:i,id:s}},complete:function(e){if(e.status===200)return n.alert({text:t.translate("change_password.password_updated")}),u(),!1;if(e.status!==200){var r=t.$.parseJSON(e.responseText);n.alert({text:r.error||a.all_errors(r.errors.error)})}o()}})},all_errors:function(t){return t=e.isArray(t)?t.join("\n"):t,t},isProfileRead:function(){return e.include(this.actions(),"profile_read")},inviteToJoin:function(e){return this.action("invite_to_join","create",{data:{params:{emails:e,format:"json"}}})},followersUrl:function(){return this.urlFor("followers")},hierarchyUrl:function(){return this._url("explore/people_directory?type=hierarchy&user_id="+this.id,arguments[0])},follow:function(e,n){n=n||"follow";var r=this,i=n==="follow"?1:-1;return this.action(n,"update",{data:{params:{id:e.id}}}).done(function(){r.actionsForTarget(e).done(function(n,r,s){e.set("actions",n.actions_array[0].actions),t.currentUser.idols.trigger("change:follow",i,e),t.currentUser.needResetCache(e,t.currentUser.idols,!1)&&(t.cache.clear("idols"),t.currentUser.idols.needReset=!0,t.currentUser.syncUpCacheThrottled()),t.currentUser.needResetCache(e,t.currentUser.followers,!1)&&(t.cache.clear("followers"),t.currentUser.followers.needReset=!0,t.currentUser.syncUpCacheThrottled())})})},unfollow:function(e){return this.follow(e,"unfollow")},followingUrl:function(){return this.urlFor("following")},metaDetailURL:function(){return this.pathFor("meta_details")},playPause:function(e,n){var r=n.get("actions"),i=e==="play"?"pause":"play";return this.action(e,"update",{data:{params:{subject_id:n.id}},complete:function(s){s.status===200&&(t.cache.clear("subscriptions"),t.currentUser.syncUpCache({success:function(){t.currentUser.subjects.trigger("reset")}}),n.set("actions",r.replace(e,i),{silent:!0}),n.trigger("actions:change"))}})},unsubscribe:function(e){return this.subscribe(e,"unsubscribe")},subscribe:function(e,n){n=n||"subscribe";var r=this,i=n==="subscribe"?1:-1;return this.action(n,"update",{data:{params:{subject_id:e.id}}}).done(function(){r.actionsForTarget(e).done(function(r,s,o){var u=r.actions_array[0].actions;e.get("scope")==="protected"&&n==="subscribe"&&(u+=",pending"),e.set("actions",u),e.trigger("subject:"+n),t.Event.trigger("subject:"+n,e),t.currentUser.subjects.trigger("change:count",i,e),t.cache.clear("subscriptions"),t.currentUser.syncUpCache(),t.tracker.trackSend("follow subject","User engagement")})})},addFollowers:function(t,n,r,i){return i=i||{},this.action("subscribe","update",{data:{params:{login_names:n,recommendation_text:r,subject_id:t.id}}}).done(function(n){t.trigger("subscribed"),e.isFunction(i.success)&&i.success()})},approve:function(e,t,n,r){return r=r||{},this.action(e,"update",{data:{params:{subject_id:t,user_id:n}},complete:function(e){e.status==200&&typeof r.success=="function"&&r.success()}})},followUnFollowSubject:function(e,t){this.subscribe(t,e)},subjectsUrl:function(){return this.urlFor("subjects")},actions:function(){return e.unique(this.get("actions").split(","))},features:function(e){var n=t.appConfig("ui_config","config","features")||{};return e===void 0?n:n[e]||{}},hasApps:function(){var e=this.features().apps||{};return e.enable===!1?!1:this.isAdmin()?!0:e.users},hasMarketPlace:function(){if(this.hasApps()===!1)return!1;var e=this.features().marketplace||{};return e.enable===!1?!1:this.isAdmin()?!0:e.users},isAdmin:function(){return this.get("is_admin")},search_users:function(e,t,n,r){return this.action("search_users","read",{data:{params:{page:e,per_page:t,search_str:n,set_actions:r}},complete:function(e){return e}})},subject_links:function(e){return this.action("subject_links","read",{data:{params:{subject_id:e}}})},search_messages:function(e,t,n,r){return this.action("message_search","read",{data:{params:{page:e,per_page:t,search_str:n,set_actions:r}}})},search_eog_resources:function(e,t,n,r){return this.action("eog_resources_search","read",{data:{params:{page:e,per_page:t,search_str:n,set_actions:r}}})},metaDetails:function(e){this.action("meta_details","read",{success:function(t,n){e(n)}})},messageDeliveryUrl:function(){return this.urlFor("message_delivery")},shareMessage:function(e,t,n,r){return this.action("share_message","create",{data:{params:{message_id:e.id,recommendation_text:t,user_ids:n,group_ids:r}}})},channelAction:function(e,t){var n=this;t=t||"channel_pause";var r=this.action(t,"update",{data:{params:{id:n.id,channel_id:e.id}}}).always(function(n){r.status===200&&(e.set("paused",!e.get("paused")),e.trigger(t,this))});return r},channelActivate:function(e,t){return this.action("channel_activate","update",{data:{params:{activation_code:t,channel_id:e.id}}})},scheduleChannel:function(e){return this.action("templated_channel_schedules","read",{data:{params:{channel_id:e.id}},success:function(t,n){e.trigger("schedule:reset",n)}})},createChannel:function(e,t){var n=JSON.stringify({params:{channel_id:e.id,subject_schedules:t.toArray()}});return this.action("build_templated_channel_schedules","update",{data:n,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")}})},set_last_read_message:function(n,r,i){if(!e.isNumber(n)&&n<=this.get("last_read_message_id"))return!1;var s=this;return t.serverProxy&&t.serverProxy.stopPolling(),this.action("set_last_read_message","update",{data:{params:{message_id:n}}}).done(function(){s.lastReadMessageID=n,s.set({last_read_message_id:n,last_msg_sort_id:r},{silent:!0}),i&&typeof i=="function"&&i(n)}).always(function(e){try{t.serverProxy.initPolling()}catch(n){console.log("ErrorOnInitPolling",n)}}),!0},unreadMessageCount:function(){return this.get("badges")?this.get("badges").unread||0:0},action_on_follower_request:function(e,t,n){var r=e=="approve"?"accept_follower_request":"reject_follower_request";n=n||{},this.action(r,"update",{data:{params:{follower_id:t}},complete:function(e){e.status===200&&typeof n.success=="function"&&n.success()}})},needResetCache:function(e,t){if(t!==undefined)if(t.total_entries<t.per_page||t.detect(function(t){return t.get("id")==e.get("id")}))return!0;return!1},create_preference:function(e,t,n){var r={group_key:e,name:t,value:n};this.action("create_preference","create",{setModel:!1,data:{user_preference:r},success:function(e,t){e.preferences.add(t)}})},update_preference:function(e,t,n,r){var i={group_key:e,name:t,value:n};this.action("update_preference","update",{setModel:!1,data:{user_preference:i},success:function(e,t){r&&r.set("value",n.toString())}})},actionsForMessages:function(t,n,r,i){var s=e.collect(t,function(e){var t={target_class:"Message",target_id:e};return r&&(t.only=r),n&&(t.subject=n),t}),o=e.collect(i,function(e){return{target_class:"QuestionOption",target_id:e}});return this.batchActionOn(s.concat(o))},actionsForTarget:function(e){return this.batchActionOn([{target_class:e.get("modelType"),target_id:e.id}])},batchActionOn:function(e){var t={params:{target_objects:e}};return this.useAPI||(t=JSON.stringify(t)),this.action("batch_actions_on","create",{setModel:!1,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")},data:t})},createOrUpdatePref:function(e,n,r){var i=this.preferences,s=this;t.$.when(i.all()).then(function(){var t=i.exist(e,n);t?s.update_preference(e,n,r,t):s.create_preference(e,n,r)})},createPrefForTour:function(e,n,r){var i=this.preferences,s=this,o;return t.$.when(i.all()).then(function(){var t=i.exist(e,n);t?o=!1:(s.create_preference(e,n,r),o=!0)}),o},gmtValue:function(){var e=this.get("time_zone_offset"),t=Math.floor(e/60)+":"+Math.abs(e%60);return t.match(/^-/)||(t="+"+t),t},findByLogin:function(e){return this.action("find_by_login","read",{data:{params:{login:e}},id:!1})},findByEmail:function(e){return this.action("find_by_email","read",{data:{params:{email:e}},id:!1})},isVip:function(){var n=t.currentUser.vips||{},r=this.actions(),i=n["user_"+this.id];return e.include(r,"add_vip")&&i?delete n["user_"+this.id]:e.include(r,"remove_vip")&&e.isUndefined(i)&&(n["user_"+this.id]=this.attributes),!e.isUndefined(n["user_"+this.id])},hasVipWall:function(){return this.get("wall_message_type")==="vip_messages"},for_template:{hierarchyUrl:"hierarchyUrl",followersUrl:"followersUrl",followingUrl:"followingUrl",subjectsUrl:"subjectsUrl",editUrl:"editUrl",isVip:"isVip",mediumImage:function(){return this.image(3)}}})}),define("modules/common/collections/users",["tibbr","../models/user"],function(e,t){return e.Collection.extend({className:"users",model:t})}),define("collections/users",["tibbr","modules/common/collections/users"],function(e,t){return t.extend({})}),define("collections/users_search",["jquery","tibbr","collections/users"],function(e,t,n){return n.extend({tibbrURL:{controller:"users",action:"search_users"},perPage:5,load:function(e){this.fetch({data:{params:{search_str:e,page:1,per_page:this.perPage,set_actions:!0}}})}})}),define("modules/common/models/geo_location",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{modelType:"GeoLocation"},for_template:{place:function(){return this.get("place")===null?"":this.get("place")}}})}),define("modules/common/models/resource_action_link",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"resource_action",className:"ResourceAction",defaults:{modelType:"ResourceAction"},link:function(e){var n;return this.get("acted")===!0||this.isNew()?n="javascript:void(0)":this.get("authorize")===!1?n=this.asset(this.get("url")):(n=this._path("/oauth/authorizations/authorize?resource_action_id="+this.id),e&&(n+="&"+e)),t.Modules.Util.withAuthParams(n)},target:function(){return"blank"},for_template:{link:"link"}})}),define("modules/common/collections/resource_action_links",["jquery","tibbr","../models/resource_action_link"],function(e,t,n){return t.Collection.extend({className:"resource_actions",model:n,getDefault:function(){return this.detect(function(e){return e.get("default")===!0})||new n},getActions:function(){return this.reject(function(e){return e.get("default")===!0&&e.get("visible")!==!0})},findByKey:function(e){return this.detect(function(t){return t.get("locale_key")===e})||new n}})}),define("modules/common/models/og_file",["underscore","tibbr","../collections/resource_action_links","require/moment"],function(t,n,r,i){return n.Model.extend({defaults:{modelType:"OgFile"},initialize:function(){t.bindAll(this,"isImage","fileSize","icon","downloadUrl","previewUrl","originalUrl"),this.config=n.appConfig("ui_config","config","file")||{images:["jpeg","gif","bmp","png","jpg","ico"],files:["txt","ppt","pptx","doc","docx","xls","xlsx","pdf","zip","rar","dtb","dxp","ics","mpp","msg","jpeg","gif","bmp","png","jpg","ico","mp3"]},this.path=this._path(),this.useAPI=this.useAPI||this.get("useAPI")===!0,this.parse(this.attributes)},_path:function(){return this.useAPI&&(this.host=(TIBR||{}).host),n.Helper.imagePath(this.config.path_path||"/images/icons/",{host:this.host})},parse:function(e){return e?(this.actionLinks=new r,this.actionLinks.useAPI=this.useAPI,this.actionLinks._set(e.action_links),this.defaultLink=this.actionLinks.getDefault(),this.previewLink=this.actionLinks.findByKey("preview"),this.downloadLink=this.actionLinks.findByKey("download"),e.has_default=!this.defaultLink.isNew(),e.has_download_link=!this.downloadLink.isNew(),e.has_preview_link=!this.previewLink.isNew(),this.setCreatedAt(e),e):e},icon:function(){return this.isImage()?this.thumbnailUrl():this._contentType()},_contentType:function(){var e=this.getProperty("file_content_type").value,t=this.config.types;return t[e]||"unknown"},isImage:function(){var e=this.previewLink.link();return(this.__isImage||(this.__isImage=this.getProperty("file_content_type").value.match(/^image/)!==null))&&e!=="javascript:void(0)"},fileSize:function(){var e=parseInt(this.getProperty("file_size").value/1024);return e===0?"":e+"KB"},downloadUrl:function(){var e=this.downloadLink.link();return e!=="javascript:void(0)"?this.asset(e):null},thumbnailUrl:function(){var e=this.getProperty("file_thumbnail_url").value||" ";return e.length>5?this.asset(e):this.imageIcon()},previewUrl:function(e){e=e||this.folder;var t=this.previewLink.link();return this.isImage()&&t!=="javascript:void(0)"?this.asset(t):this.imageIcon(e)},originalUrl:function(){return this.downloadLink.link()},createdAt:function(){return this.displayDate(i)},imageIcon:function(e){e=e||"";var t=e=="showcase/"?".jpg":".png";return this.path+e+this._contentType()+t},contentType:function(){var e=this.getProperty("file_content_type").value,t=this.get("title"),n="clip";if(e.indexOf("image")!=-1)for(var r=0;r<this.config.images.length;r++){if(t.lastIndexOf("."+this.config.images[r])!=-1){n="img";break}n="clip"}else if(e.indexOf("application")!=-1)for(var r=0;r<this.config.files.length;r++){if(t.lastIndexOf("."+this.config.files[r])!=-1){n=this.config.files[r],this.config.files[r]=="mp3"&&(n="audio");break}n="clip"}else e.indexOf("audio")!=-1?n="audio":e.indexOf("video")!=-1?n="video":e.indexOf("text/plain")!=-1?n="txt":n="clip";return n},getProperty:function(e){return t.detect(this.get("custom_properties"),function(t){return t.name===e})||{value:""}},isTibbrFile:function(){return this.get("application_definition").guid==="tibbr_native_files"},getConversationId:function(){var e=this.get("recent_actions").og_share||{message:{}},t=e.message.parent_id,n=e.message.id;return t!==null&&t!==undefined?t:n},shareUserName:function(){var e=this.get("recent_actions").og_share;return e&&e!==null?e.user.display_name||"":n.currentUser.get("display_name")},setCreatedAt:function(e){e.recent_actions&&t.isObject(e.recent_actions.og_share)?this.set("og_share_created_at",e.recent_actions.og_share.created_at):this.set("og_share_created_at",e.created_at)},postedAt:function(){return this.displayDate(i,"og_share_created_at","LL")},for_template:{downloadUrl:"downloadUrl",isImage:"isImage",icon:"icon",getConversationId:"getConversationId",imageIcon:"imageIcon",previewUrl:"previewUrl",postedAt:"postedAt",createdAt:"createdAt",fileSize:"fileSize",isTibbrFile:"isTibbrFile",thumbnailUrl:"thumbnailUrl",share_user_name:"shareUserName",image:function(){return this.thumbnailUrl()},contentType:"contentType",action_links:function(){return t.collect(this.actionLinks.getActions(),function(e){return e.forTemplate()})},default_link:function(){var e=this.defaultLink;return e?e.forTemplate():{}},download_link:function(){var e=this.downloadLink;return e?e.forTemplate():{}},isNative:function(){return this.isTibbrFile()},appIcon:function(){return this.isTibbrFile()?"":"<img src='"+this.asset(n.Helper.assetImage(this.get("application_definition").icon_url,1))+"' width='20' height='20px' class='app-icon'>"}}})}),define("modules/common/collections/og_files",["jquery","tibbr","../models/og_file"],function(e,t,n){return t.Collection.extend({className:"OgFiles",model:n,checkForMessage:function(e,t){var n=this;t.parseResources();if(t.assets.length>0)if(e==="add")this.total_entries=this.total_entries+t.assets.length,t.assets.each(function(e){n.unshift(e,{silent:!0})}),this.trigger("add");else{this.total_entries=this.total_entries-t.assets.length;var r=this.total_entries<5&&this.total_pages>1;r?this.fetch().done(function(){n.trigger("remove")}):(t.assets.each(function(e){n.remove(e.id,{silent:!0})}),this.trigger("remove"))}},images:function(){return _.compact(this.map(function(e){if(e.isImage())return e}))},assets:function(){return _.compact(this.map(function(e){if(!e.isImage())return e}))}})}),define("modules/common/models/link",["underscore","tibbr","require/moment"],function(e,t,n){return t.Model.extend({baseName:"links",defaults:{modelType:"Link",description:""},initialize:function(){e.bindAll(this,"isVideo","getPreview","markup","createdAt","hasMarkup","hasImage","title")},getPreview:function(e,t){this.action("fetch_details","read",{data:{params:{type:"public",url:e}},success:t})},isVideo:function(){return this.get("link_type").match(/_video$/)},hasMarkup:function(){return!this.isVideo()&&!e.isEmpty(this.get("markup"))},hasPreview:function(){return this.get("preview_image")!==null&&this.get("preview_image")!==undefined&&this.get("preview_image")!==""},hasImage:function(){return!e.isEmpty(this.get("preview_image"))},createdAt:function(){return this.displayDate(n)},update:function(){return this.action("","update",{data:{link:{title:this.get("title")}}})},isTibbrLink:function(){return this.get("url").match(new RegExp("("+window.location.host+"[^\\s]+)","g"))!==null},title:function(){return this.get("title")==="link"?e.str.prune(this.get("url"),50):this.get("title")},markup:function(){return e.str.unescapeHTML(this.get("markup"))},isTibCast:function(){return this.get("url").match(/\/tibcast/)},downloadUrl:function(){return this.get("url")},previewUrl:function(){return this.hasImage()?this.get("preview_image"):t.Helper.imagePath("images/icons/link.png")},for_template:{isVideo:"isVideo",markup:"markup",title:"title",previewUrl:"previewUrl",downloadUrl:"downloadUrl",hasPreview:"hasPreview",hasMarkup:"hasMarkup",createdAt:"createdAt",shortUrl:function(){return this.get("url").match(/:\/\/[^\/]+/)[0].replace("://","")}}})}),define("modules/common/collections/links",["tibbr","../models/link"],function(e,t){return e.Collection.extend({className:"links",model:t,checkForMessage:function(e,t){var n=this;if(t.links.length>0)if(e==="add")this.total_entries=this.total_entries+t.links.length,t.links.each(function(e){n.unshift(e,{silent:!0})}),this.trigger("add");else{this.total_entries=this.total_entries-t.links.length;var r=this.total_entries<5&&this.total_pages>1;r?this.fetch().done(function(){n.trigger("remove")}):(t.links.each(function(e){n.remove(e.id,{silent:!0})}),this.trigger("remove"))}}})}),define("models/user",["underscore","tibbr","modules/common/models/user"],function(e,t,n){return n.extend({})}),define("modules/common/models/application_url",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{modelType:"ApplicationUrl"},urlType:function(e){return this.get("url_type")===e},url:function(e){return e=e||"",t.path("oauth/authorizations/authorize?client_id="+this.get("application_definition_id")+"&url_type="+this.get("url_type")+"&"+e)}})}),define("modules/common/collections/application_urls",["tibbr","../models/application_url"],function(e,t){return e.Collection.extend({className:"application_urls",model:t,parse:function(e){return e},urlType:function(e){var t=[];return this.each(function(n){n.urlType(e)&&t.push(n)}),t}})}),define("modules/common/models/application_definition",["underscore","tibbr","require/moment","../collections/application_urls"],function(e,t,n,r){return t.Model.extend({baseName:"application_definitions",defaults:{modelType:"application_definition",config_decrypt_key:"",client_secret:""},actions:function(){return(this.get("actions")||"").split(",")},actionsForAdmin:function(){if(!t.currentUser.privileges.on("ApplicationDefinition").can("manage"))return[];if(this._adminActions)return this._adminActions;var n=["manage","remove_app"];return this.urlsType("setup")&&n.unshift("setup"),e.include(this.actions(),"edit")&&n.unshift("edit"),e.include(this.actions(),"globally_subscribe")&&n.unshift("globally_subscribe"),e.include(this.actions(),"globally_unsubscribe")&&n.unshift("globally_unsubscribe"),e.include(this.actions(),"upgrade")&&n.unshift("upgrade"),this._adminActions=n},actionsForDeveloper:function(){if(this._developerActions)return this._developerActions;var n={development:["export"],production:["export"]}[this.get("state")]||[];return t.currentUser.features("marketplace").publish&&n.unshift("publish_to_marketplace"),e.include(this.actions(),"edit")&&n.unshift("edit"),this._developerActions=n},initialize:function(){e.bindAll(this,"icon","configUrl","releasedAt","button","canCreate","actions","canEnable","isSubscribe","updatedAt","detailsUrl","backUrl","details","summary","fetchResources","mediaLink","phone","email","website","mediaObject","release_note","browsers","category","mediaXLS","mediaPPT")},fetchResources:function(){return this.action("resources_profile","read")},updatedAt:function(){return n(this.get("updated_at")).format(t.i18n.application_definition.updated_at_format)},backUrl:function(e){return this.get("appType")==="marketplace"?this._url("apps/marketplace"):this._url("apps/")},image:function(e){var n=this.get("icon_url");return n.length<10?t.Helper.imagePath("images/apps/icons/"+this.icon()):t.Helper.assetImage(n,e||3)},large_image:function(){var e=this.get("large_icon_url");return e.length<10?t.Helper.imagePath("images/apps/icons/"+this.icon()):t.Helper.assetImage(e,1)},marketPlaceImage:function(e,n){return t.marketPlaceRoot()+e.split(",")[n]},isDefaultApp:function(){return this.get("guid")==="tibbr_social_plugins"||this.get("guid")==="tibbr_native_files"},isNativeFile:function(){return this.get("guid")==="tibbr_native_files"},icon:function(){return this.get("name").replace(/\s/g,"_").replace("®","").toLowerCase()+".png"},releasedAt:function(){return n(this.get("created_at")).format(t.dateFormat.LLLLLL)},configUrl:function(){return this._url("apps/"+this.id+"/configuration")},detailsUrl:function(){var e=this._url("apps/"+this.id+"/details");return this.get("appType")==="marketplace"&&(e+="/?type=marketplace"),e},details:function(){var e=this.get("description");return e.length>1?e:this.get("short_description")},summary:function(){var t=this.get("short_description");return t.length>1?e.str.truncate(t,100):e.str.truncate(this.get("description"),100)},mediaLink:function(){return e.compact(e.collect(this.get("media"),function(t){return e.isObject(t.link)?t:null}))},phone:function(){return this.metaDetails("phone")||""},email:function(){return this.metaDetails("email")||""},release_note:function(){return this.metaDetails("release_note")||""},browsers:function(){return this.metaDetails("browsers")||""},category:function(){var e=this.get("application_definition_categories")[0]||{};return e.name=(this.get("categories")[0]||{}).name,e},mediaObject:function(){var t="",n,r;if(!e.isUndefined(this.get("media")[1])&&!e.isUndefined(this.get("media")[2]))return n=this.get("media")[1],r=this.get("media")[2],t="both",[t,n,r];if(this.get("media")[1]){var i,s,o;i=this.get("media")[1],s=i.asset.data_file_name,o=s.substring(s.lastIndexOf(".")+1);if(o.match("xls")||o.match("xlsx"))return n=this.get("media")[1],t="sheet",[t,n,""];if(o.match("ppt")||o.match("pptx"))return r=this.get("media")[1],t="ppt",[t,r,""]}return["","",""]},website:function(){return this.metaDetails("website")||""},button:function(){var n=this.get("app_type"),r,i=t.i18n.application_definition;return n==="server"&&e.str.contains(this.get("actions"),"configure")?r={url:this.configUrl(),text:i.configure}:r={url:"#",text:this.isSubscribe()?i.disable:i.enable,status:this.isSubscribe()?"disable":"enable"},r},canCreate:function(){var e=this.get("max_instance")===0||this.get("max_instance")>=1&&this.get("instances_count")<this.get("max_instance"),t=this.get("max_instance_per_user")===0||this.get("max_instance_per_user")>=1&&this.get("instances_count")<this.get("max_instance_per_user");return e&&t},canEnable:function(){return e.include(this.actions(),"subscribe")||e.include(this.actions(),"unsubscribe")},canEdit:function(){return e.include(this.actions(),"edit")},isSubscribe:function(){return e.include(this.actions(),"unsubscribe")},setupUrl:function(e){return this._path("oauth/apps/setup?client_id="+(e||this.id))},editUrl:function(){return this._url("apps/"+this.id+"/edit")},metaDetails:function(t){return e.find(this.get("app_meta_details"),function(e){return e.data_type===t})||[0]},mediaAssets:function(){return e.compact(e.collect(this.get("media"),function(t){return e.isObject(t.asset)?t:null}))},supportType:function(e,n){var r=t.appConfig("ui_config","config","file","developer_center",n);for(var i=0;i<r.length;i++)if(e.asset.data_content_type===r[i])return e;return null},mediaXLS:function(){var t=this;return e.compact(e.collect(this.mediaAssets(),function(e){return t.supportType(e,"supportedXls")}))},mediaPPT:function(){var t=this;return e.compact(e.collect(this.mediaAssets(),function(e){return t.supportType(e,"supportedPpt")}))},screenShots:function(){return this.get("assets")},contactUs:function(){return this.get("contact_us")||e.include(this.actions(),"contact_us")},value_for:function(e){return(this[e]()||{}).value},urls:function(){return new r(this.get("application_urls"))},urlsType:function(e){return this.urls().detect(function(t){return t.get("url_type")===e})},urlType:function(e){return[this.urlsType(e)]},showClientUrl:function(){return t.path("oauth/authorizations/authorize?client_id=")+this.get("id")+"&user_id="+t.currentUser.get("id")},for_template:{editUrl:"editUrl",backUrl:"backUrl",button:"button",details:"details",image:"image",updatedAt:"updatedAt",largeImage:function(){return this.get("is_marketplace")?this.get("icon_remote_url"):this.image(5)},mediumImage:function(){return this.image(3)},preViewImage:"large_image",mediaLink:"mediaLink",phone:"phone",email:"email",website:"website",browsers:"browsers",release_note:"release_note",developer_actions:"actionsForDeveloper",category:"category"}})}),define("modules/common/collections/subscribers",["tibbr","../models/user"],function(e,t){return e.Collection.extend({className:"Subscribers",tibbrURL:{controller:"users",action:"subscribers"},model:t,data:function(){return{params:{set_actions:!0,page:(this.current_page||0)+1,per_page:10,subject_id:this.subject_id}}}})}),define("modules/common/models/resource",["underscore","tibbr","../models/application_definition","../collections/og_files","../collections/links","../collections/subscribers","../collections/users","../collections/resource_action_links","require/moment"],function(t,n,r,i,s,o,u,a,f){var l=n.Model.extend({baseName:"resources",className:"EogResource",defaults:{modelType:"Resource",displayName:"Resource"},initialize:function(){t.bindAll(this,"sourceUrl","showUrl","displayName"),this.parse(this.attributes),this.path=n.Helper.imagePath("images/icons/")},parse:function(e){return e?(this.application=new r(e.application_definition),this.assets=new i([],{tibbrURL:{controller:"resources",action:"assets"},dataParams:{resource:{id:e.id},page:1,per_page:5}}),this.assets._set(e.assets),this.links=new s([],{tibbrURL:{controller:"resources",action:"links"},dataParams:{resource:{id:e.id},page:1,per_page:5}}),this.links._set(e.links),this.actionLinks=(new a)._set(e.action_links),this.followers=(new o)._set(e.followers,{scopeId:e.id,tibbrURL:{controller:"resources",action:"followers"},dataParams:{page:1,resource:this.forApi()}}),this.owners=(new u)._set(e.owners,{scopeId:e.id,tibbrURL:{controller:"resources",action:"owners"}}),this.likers=(new u)._set(e["og:like:users"],{tibbrURL:{controller:"actions",action:"users"},dataParams:{resource:{id:e.id},action_type:"og:like"}}),this.sharers=(new u)._set(e["og:share:users"],{tibbrURL:{controller:"actions",action:"find_by_type"},dataParams:{action_type:"og:share",resource:{id:e.id}}}),this.determiner=e.determiner,e):e},actions:function(){return this.get("actions").split(",")},follow:function(e){e=e||"follow";var t=this,r=e==="follow"?"create":"delete",i={resource:this.forApi(),client_id:this.application.id};return this.action(e,r,{data:i,setModel:!1}).done(function(e){t.set("actions",e.actions,{silent:!0}),t.trigger("change"),t.trigger("change:actions"),(t.get("context_properties")||{}).subscription_request_state!=="pending"&&(t.trigger("resource:followers"),n.publish("resource:followers"))})},unfollow:function(){return this.follow("unfollow")},isOwner:function(){return(this.get("context_properties")||{}).owner},sourceUrl:function(){return this.get("url")},add_users:function(e,t,n,r){return this.add_owners(e,t,n,r)},add_owners:function(e,t,n,r){r=r||{};var i=this,s=r.success,o="add_owners";return delete r.success,this.action(o,"create",{setModel:!1,data:{users:t,groups:n?[n]:null},complete:function(t){t.status===200?s&&"function"==typeof s&&s(i):e.trigger("role:error",JSON.parse(t.responseText))}})},remove_users:function(e,t,n,r){return this.remove_owners(e,t,n,r)},remove_owners:function(e,t,n,r){r=r||{};var i=this,s=r.success,o="remove_owners";return delete r.success,this.action(o,"delete",{setModel:!1,data:{groups:n?[n]:null,users:t?[t]:null},complete:function(t){t.status===200?(s||e.trigger("role:memberModifed"),s&&"function"==typeof s&&s(i)):e.trigger("role:error",JSON.parse(t.responseText))}})},get_or_create_by_url:function(e,n){n=n||{},n.data=t.extend(n.data||{},{resource_url:e}),this.action("get_or_create_by_url","create",n)},_contentType:function(e){var t=e,r=n.appConfig("ui_config","config","file","types");return r[t]||"unknown"},get_or_create_by_resource_key:function(e,n){n=n||{},n.data=t.extend(n.data||{},{key:e}),this.action("get_or_create_by_resource_key","create",n)},create_resource:function(e,t){this.save({external_connect_resource:{url:e.url,title:e.title,unique_key:e.unique_key,app_id:e.app_id}},t||{})},showUrl:function(){return this._url("resources/"+this.id)},appIcon:function(e){return this.application.image(e)},addFollowers:function(e,t,n,r){var e=this,r=r||{};return this.action("add_members","create",{setModel:!1,data:{users:t,recommendation_text:n,play:!0}}).done(function(){e.trigger("subscribed")})},unsubscribe:function(e,t){t=t||{};var n=this,r=t.success;return delete t.success,this.action("remove_members","delete",{setModel:!1,data:{users:[e],include:"followers"},complete:function(e){e.status===200?r&&"function"==typeof r&&n.trigger("follower:removed","followers"):n.trigger("role:error",JSON.parse(e.responseText))}})},subscribeGroup:function(e,t,n,r){var e=this,r=r||{};return this.action("add_followers","create",{data:{groups:[t],recommendation_text:n}}).done(function(){e.trigger("subscribed")})},unsubscribeGroup:function(e,t){t=t||{};var n=this,r=t.success;return delete t.success,this.action("remove_followers","delete",{data:{groups:[e]},complete:function(e){e.status===200?r&&"function"==typeof r&&n.trigger("group_follower:removed","follower_groups"):n.trigger("role:error",JSON.parse(e.responseText))}})},playPause:function(e){var n=t.clone(this.get("actions")),r=this,i=e==="play_alerts"?"play":"pause",s=e==="play_alerts"?"pause":"play";return this.action(e,"update").done(function(e,t,o){r.set("actions",n.replace(i,s))})},getIcon:function(e){var t=e=="showcase/"?".jpg":".png";return this.path+this._contentType(this.getProperty("file_content_type").value)+t},createdAt:function(){return this.displayDate(f)},getPreview:function(){var e=this.getProperty("file_preview_url").value||null;return e!==null?'<img src="'+n.host()+e+'" width="400px" height="400px"></img>':this.get("application_definition").guid==="tibbr_native_files"?"native_files":'<iframe width="500px" height="500px" src="'+this.get("url")+'" </iframe>'},getDownLoadUrl:function(){return this.getProperty("file_download_url").value},getProperty:function(e){return t.detect(this.get("custom_properties"),function(t){return t.name===e})||{}},displayName:function(){var e=this.get("name"),t=this.get("title");return t},getConversationId:function(){var e=this.get("recent_actions").og_share.message.parent_id,t=this.get("recent_actions").og_share.message.id;return e!==null&&e!==undefined?e:t},getName:function(){return this.get("recent_actions").og_share!==null?this.get("recent_actions").og_share.user.display_name:""},postedAt:function(){return this.get("recent_actions").og_share!==null?this.set("og_share_created_at",this.get("recent_actions").og_share.created_at):this.set("og_share_created_at",this.get("created_at")),this.displayDate(f,"og_share_created_at","LL")},buildActionObject:function(e){var t=e.forTemplate();return t},meetingUrl:function(){return n.path("oauth/authorizations/authorize?client_id="+this.application.id+"&url_type=launch_meeting&meeting_id="+this.getProperty("meeting_id").value)},forApi:function(e){var n={type:this.get("type"),url:this.get("url"),key:this.get("key"),title:this.get("title"),scope:this.get("scope")||"public",app_id:e||this.application.id};return t.isEmpty(this.get("hmac"))||(n.hmac=this.get("hmac")),n},for_template:{getDownLoadUrl:"getDownLoadUrl",postedAt:"postedAt",getName:"getName",getPreview:"getPreview",resourceIcon:"getIcon",createdAt:"createdAt",meetingUrl:"meetingUrl",description:function(){var e=this.get("description")||"";return this.getRichContent(!0,null,e)},image:function(){return this.get("type")==="og:link"&&t.isEmpty(this.get("image"))?n.Helper.themeImagePath("link-icon_60x60.png"):t.isEmpty(this.get("image"))?this.appIcon("medium"):this.get("image")},getConversationId:"getConversationId",link:!1,appLink:function(){return this.application.id?n.url("apps/"+this.application.id+"/resources"):null},displayImage:function(){return this.appIcon(5)},appIcon:function(){return this.appIcon(1)},isNative:function(){return this.application.isNativeFile()},action_links:function(){var e=t.collect(this.actionLinks.getActions(),function(e){return this.buildActionObject(e)},this);return e},default_link:function(){var e=this.actionLinks.getDefault();return e?this.buildActionObject(e):{}}}});return t.extend(l.prototype,n.Modules.Model.RichContent),l}),define("modules/common/models/resource_action",["underscore","tibbr","./resource"],function(e,t,n){return t.Model.extend({baseName:"actions",className:"EogAction",initialize:function(){this.parse()},parse:function(e){return e=e||this.attributes,this.resource=new n(e.eog_resource),this.singular_past_tense=e.singular_past_tense,e},type:function(){return this.get("action_type").replace("og:","")}})}),define("modules/common/models/reply",["jquery","underscore","tibbr","models/user","./geo_location","./resource_action","../collections/og_files","../collections/links","../collections/users","require/moment"],function(t,n,r,i,s,o,u,a,f,l){var c=r.Model.extend({baseName:"messages",excludeActions:["like","star","unlike","unstar","mute","unmute","msg_reply","remove_subject"],defaults:{user:null,links:[],assets:[],like_to:[],modelType:"MessageReply"},initialize:function(){n.bindAll(this,"build","postedAt","hasLikes","like","hasGeoMap","getContent","isUnread","getRichContent"),this.mainMenu=["share","manage"],this.shareActions=["share","email","copy_link"],this.appsActions=[];try{this.messageApps=r.currentUser.subscribedFilters.messages()}catch(e){this.messageApps=[]}var t=r.currentUser.meetings||[];(this.messageApps.length>0||t.length>0)&&this.mainMenu.push("apps"),t.length>0&&this.appsActions.push("create_meeting"),this.build()},actions:function(){return n.compact(n.difference(this.get("actions").split(","),this.excludeActions))},customActions:function(){return n.select(r.appConfig("ui_config","config","reply","more_actions"),function(e){return e.enable===!0})},postedAt:function(){return this.displayDate(l)},copyUrl:function(){return r.url("messages/"+this.id,{host:r.host(),gadget:!1})},like:function(){var e=this,t=this.get("likes_count");return this.get("is_liked_by_current_user")?this.action("unlike","delete",{setModel:!1}).done(function(){e.set({likes_count:t-1,is_liked_by_current_user:!1})}):this.action("like","update",{setModel:!1}).done(function(){e.set({likes_count:t+1,is_liked_by_current_user:!0})})},hasLikes:function(){return this.get("like_to").length>0},states:function(){return n.unique((this.get("states")||"").split(","))},isUnread:function(){var e=r.currentUser.recentReadMessageID;return this.get("user_id")!==r.currentUser.id&&this.id>e},hasGeoMap:function(){return this.geo_location!==undefined},getContent:function(){var e="",t=this.get("content"),i=200,s="&nbsp;<a class='continued'>"+r.translate("message.continued")+"</a>";return t.length<i?r.Helper.autoLink(t.replace(/\n/g,"<br/>")):(e=n.str.prune(t,i,s),e===s&&(e=n.str.truncate(t,i,s)),e)},build:function(){this.get("user")&&(this.user=new i(this.get("user"))),this.get("reply_of_reply")&&(this.replyUser=new i(this.get("reply_of_reply").user)),this.links=new a(this.get("links")),this.get("geo_location")&&r.maps.enabled&&(this.geo_location=new s(this.get("geo_location"))),this.get("eog_action")&&(this.eog_action=new o(this.get("eog_action"))),this.get("private_message")&&(this.shareActions=n.without(this.shareActions,"share"))},parseResources:function(){var e=this.get("resources"),t=n.where(e,{type:"og:file"})||[];this.assets=(new u)._set(t)},for_template:{getRichContent:"getRichContent",hasGeoMap:"hasGeoMap",postedAt:"postedAt"}});return n.extend(c.prototype,r.Modules.Model.RichContent),c}),define("modules/common/collections/replies",["jquery","tibbr","../models/reply"],function(e,t,n){return t.Collection.extend({className:"replies",tibbrURL:{action:"messages"},model:n})}),define("modules/common/models/subject",["backbone","underscore","tibbr","../models/user","../models/geo_location","../collections/users","../collections/og_files","../collections/links","../collections/replies","../collections/subscribers"],function(e,t,n,r,i,s,o,u,a,f){return n.Model.extend({baseName:"subjects",excludeActions:["msg_create","msg_reply","add_child","invite","add_vip","remove_vip","add_favorite","remove_favorite"],defaults:{user:null,modelType:"Subject",description:"",scope:"public",display_name:"",name:"",assets:[],like_to:[],links:[],allow_children:!0,subjects:[],messages:[],owners:[],user_image:[],pages:[],parent_name:null},profileImageMedium:"/assets/images/subjects/subject_images/missing_large.png",initialize:function(){t.bindAll(this,"displayName","createdAt","showUrl","getRecentSubjectUrl","description","analyticsNodes","subjectOwnerImage","subjectMessageCount","isSubjectOwner","scope","createdDate","createdSubjectDate","getUserUrl","userProfileUrl","ownerProfileUrl","actions","isSubjectFollower","moreTrendsUrl","flatName","parentName","isOwner","seeMoreURL","followButton","unFollowSubject","followSubject","isPrivate","mySubjectActions","showGoupUrl","subscribers"),typeof this.get("subject_image_url")!="undefined"&&this.set({profileImageMedium:this.assetImage(this.get("subject_image_url"))}),this._display_name=this.get("display_name"),this.set("display_name",this.get("render_name")||this.get("name").replace(/\./g," "))},image:function(e){var t=this.get("subject_image_url");return n.Helper.assetImage(t,e)},actions:function(){var e=t.difference(this.get("actions").split(","),this.excludeActions);return n.gadget&&(e=t.without(e,"edit")),t.include(e,"edit")&&e.push("move"),e},mySubjectActions:function(){var e=this.excludeActions;e.push("subject_announcement");var r=t.difference(this.get("actions").split(","),e);return n.gadget&&(r=t.without(r,"edit")),t.include(r,"edit")&&r.push("move"),r},followButton:function(){var e=this.get("actions").split(",");return t.include(e,"unsubscribe")?"unfollow":t.include(e,"subscribe")?"follow":""},createdSubjectDate:function(){return this.formattedDate("created_at","DDDDDD")},userProfileUrl:function(){return this._url("users/"+this.get("user").id+"/profile")},userShowProfileUrl:function(e){return this._url("users/"+e)},ownerProfileUrl:function(e){return this._url("users/"+e+"/profile")},subjectFollower:function(){},analyticsNodes:function(){return this.get("analytics-f-nodes")||[]},subjectOwnerImage:function(e){var t=e.split(","),n=t[3];return t[3]},subjectMessageCount:function(){var e=0;return this.dataSet!==undefined&&(e=this.get("messages_count"),e===""&&(e=0)),e},imageUrl:function(e){var t=e.split(","),n=t[3];return t[3]},displayName:function(){return this._display_name.replace(/\./g," ")},createdAt:function(){return this.formattedDate()},description:function(){return n.Helper.autoLink(this.get("description"))},showUrl:function(){return this.get("owner_type").toLowerCase()==="group"?this.showGoupUrl():this._url("subjects/"+this.id)},showGoupUrl:function(){return this._url("groups/"+this.id+"/group_by_subject")},editUrl:function(){return this._url("subjects/"+this.id+"/edit")},createSubSubjectUlr:function(){return this.isNew()?"#":"subjects/new?ptype="+this.get("scope")+"&pname="+encodeURIComponent(this.get("name"))},flatName:function(){return t.last(this.get("name").split("."))},parentName:function(){if(this.get("parent_name",null))return this.get("parent_name");var e=new RegExp("."+this.flatName()+"$","g");return this.get("name").match(e)?this.get("name").replace(e,""):null},getUrl:function(e){return this._url("subjects/"+e)},getRecentSubjectUrl:function(){return this._url("subjects/recent_subjects")},scope:function(){return this.get("scope")},isSubjectOwner:function(){return this.get("user").login==n.currentUser.get("login")},isPrivate:function(){return this.get("scope")==="private"},isSubjectFollower:function(){var e=!1,r=this.get("subscribers").user;return t.isArray(r)&&t.each(r,function(t){t.id==n.currentUser.id&&(e=!0)}),e},createdDate:function(){return this.formattedDate()},destroy:function(){var e=this,t=this.get("id");return this.action("delete","update",{data:{params:{subject_id:this.get("id")}},complete:function(r){r.status===200&&(n.currentUser.subjects.find(function(e){return e.get("id").toString()==t.toString()})&&(n.cache.clear("subscriptions"),n.currentUser.syncUpCache({success:function(){n.currentUser.subjects.trigger("reset")}})),e.trigger("delete"))}})},play:function(){return n.currentUser.playPause("play",this)},pause:function(){return n.currentUser.playPause("pause",this)},unsubscribe:function(){return n.currentUser.unsubscribe(this)},unFollowSubject:function(){n.currentUser.followUnFollowSubject("unsubscribe",this)},followSubject:function(){n.currentUser.followUnFollowSubject("subscribe",this)},build:function(){this._display_name=this.get("display_name"),n.appConfig("manage_pages_by_owners","config")&&this.isOwner()&&this.set("manage_pages",!0),this.set("display_name",this.get("render_name")||this.get("name").replace(/\./g," ")),this.get("user")&&(this.user=new r(this.get("user")));if(this.get("owners")){var e=new s;e.tibbrURL={controller:"subjects",action:"owners"},e.scopeId=this.id,e._set(this.get("owners")),e.setParams({params:{set_actions:!0,per_page:10,order_by:"alphabetically"}}),this.owners=e}this.get("subscribers")&&this.subscribers(),this.assets=new o([],{tibbrURL:"users/<scopeId>/search_resources",scopeId:n.currentUser.id,dataParams:{params:{type:"og:file",sort_by:"og_share_date",sort_order:"desc",subject_filters:{og_share_on_id:this.id},page:1,per_page:5}}}),this.assets._set(this.get("shared_resources")||{}),this.links=new u([],{tibbrURL:{controller:"users",action:"subject_links"},scopeId:n.currentUser.id,dataParams:{params:{subject_id:this.id,page:1,per_page:5}}}),this.links._set(this.get("links"))},getUserUrl:function(){if(this.get("user"))return this._url("users/"+this.get("user").id)},getSubjectOwner:function(){var e=!1,n=[],r=this.get("owners");return t.isArray(r)&&t.each(r,function(e){n.push(e.id)}),n},moreTrendsUrl:function(){return this._url("subjects/"+this.id+"/analytics")},seeMoreURL:function(){return this._url("subjects/"+this.id+"/more")},isMapEnabled:function(){return n.maps.enabled&&n.appConfig("subjects","geo_location","enabled",{"default":!1})},addFollowers:function(e,t,r){return n.currentUser.addFollowers(e,t,r)},isUser:function(){return this.get("stype")==="system"&&this.get("owner_type").toLowerCase()!=="group"},isGroup:function(){return this.get("stype")==="system"&&this.get("owner_type").toLowerCase()==="group"},isOwner:function(){return(this.get("context_properties")||{}).owner},sharePointContext:function(){return this._sharePointContext=this._sharePointContext||t.detect(this.get("preferences"),function(e){return e.group_key==="share_point"&&e.name==="folder_path"}),this._sharePointContext},hasSharePointContext:function(){var e=(this.sharePointContext()||{}).value;return e=(e+"").split("@|@")[3]||"",e.toString()==="1"},sharePointSite:function(){return(this.sharePointContext().value+"").split("@|@")[1]||""},sharePointFolder:function(){return(this.sharePointContext().value+"").split("@|@")[0]||""},sharePointID:function(){return(this.sharePointContext().value+"").split("@|@")[2]||""},buildSharePointContext:function(e,n){return t.isObject(e)?(n=n||0,e.path+"@|@"+e.site+"@|@"+e.id+"@|@"+n):this.sharePointFolder()+"@|@"+e.sharePointSite()+"@|@"+e.sharePointID()+"@|@"+n},subscribers:function(){return this.followers=new f,this.followers.scopeId=n.currentUser.id,this.followers.subject_id=this.id,this.followers.setParams({params:{subject_id:this.id,set_actions:!0,per_page:5,order_by:"alphabetically"}}),this.followers._set(this.get("subscribers")),this.followers},hasPrivilegeToView:function(){return this.get("scope")!=="protected"||this.isOwner()?!0:this.get("scope")==="protected"&&!t.include(this.actions(),"subscribe")&&this.get("context_properties",{}).subscription_request_state!=="pending"},canHavePostBox:function(){var e=this;return this.isClosed()?!1:this.hasPrivilegeToView()?e.get("scope")!=="broadcast"||!!e.isOwner()||!!e.get("broadcast_postable"):!1},canHaveMeetings:function(){return this.canHavePostBox()},isClosed:function(){return this.get("closed")},canEdit:function(){return this.isOwner()&&!this.isClosed()},isVip:function(){var e=n.currentUser.vips||{},r=this.actions(),i=e["subject_"+this.id];return t.include(r,"add_vip")&&i?delete e["subject_"+this.id]:t.include(r,"remove_vip")&&t.isUndefined(i)&&(e["subject_"+this.id]=this.attributes),!t.isUndefined(e["subject_"+this.id])},isFavorite:function(){return t.str.include(this.get("actions"),"remove_favorite")},for_template:{displayName:"displayName",description:"description",isNew:"isNew",parentName:"parentName",flatName:"flatName",createdAt:"createdAt",isVip:"isVip",smallImage:function(){return this.image(1)},mediumImage:function(){return this.image(3)}}})}),define("models/page_translation",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"translations",defaults:{modelType:"PageTranslation"}})}),define("collections/page_translations",["tibbr","models/page_translation"],function(e,t){return e.Collection.extend({className:"PageTranslation",model:t})}),define("models/page",["underscore","tibbr","collections/page_translations"],function(e,t,n){return t.Model.extend({baseName:"pages",initialize:function(){e.bindAll(this,"getLocaleName","getName","destroy")},defaults:{modelType:"Page",preview_image:"",translations:[]},destroy:function(){var e=this;this.action("","delete",{data:{params:{id:this.get("id"),format:"json"}},complete:function(t){t.status===200&&e.trigger("delete")}})},build:function(){this.get("translations")&&(this.translations=new n(this.get("translations")))},getName:function(){var e;return this.get("name")?e=this.get("name"):e=this.get("translations")[0].name,e},getLocaleName:function(n){var r="",i=t.appConfig("locales",{"default":{}}).locales||[];return e.isArray(i)&&e.each(i,function(e){e.key===n&&(r=e.name)}),r},hasPreview:function(){return this.get("preview_image")!==null&&this.get("preview_image")!==undefined&&this.get("preview_image")!==""},previewUrl:function(){return this.hasPreview()?this.get("preview_image"):t.Helper.themeImagePath("icons/bookmarks.png")},openSeparate:function(){var t=this.get("locale");return e.each(this.get("translations"),function(e){if(e.locale===t)return e.open_separate}),this.get("translations")[0].open_separate},for_template:{previewUrl:"previewUrl",hasPreview:"hasPreview",openSeparate:"openSeparate",title:"getName",shortUrl:function(){return this.get("url").match(/:\/\/[^\/]+/)[0].replace("://","")}}})}),define("collections/pages",["tibbr","models/page"],function(e,t){return e.Collection.extend({className:"pages",tibbrURL:{controller:"pages"},model:t,load:function(e){return this.fetch({data:{subject_id:e,params:{page:(this.current_page||0)+1,set_actions:!0,per_page:999}}})}})}),define("modules/common/models/group",["backbone","jquery","underscore","tibbr","../models/user","../collections/users"],function(e,t,n,r,i,s){return r.Model.extend({baseName:"groups",defaults:{user:null,modelType:"Group"},excludeActions:["create","follow","unfollow"],profileImageMedium:"/assets/images/groups/profile_images/missing_large.png",initialize:function(){n.bindAll(this,"createdDate","image","actions","showUrl","showName","showViewMembersUrl","membersCnt","ownerActions","createdAgo","createdAt","isCurrentUserOwner","isCurrentUserMember");if(typeof this.get("profile_image_url")!="undefined"){var e=[];e=this.get("profile_image_url").split(",");var t=e[3]||"";t.toLowerCase().indexOf("http://")==-1&&t.toLowerCase().indexOf("https://")==-1?this.set({profileImageMedium:t}):this.set({profileImageMedium:this.asset(t)})}this.build()},image:function(e){e=e||3;var t=this.get("profile_image_url").split(",")[e];return t.match(/https?:\/\//)?t:this.asset(t)},displayName:function(){return this.get("display_name")},actions:function(){var e=this.get("actions").split(",");return e},follow:function(e){e=e||"follow";var t=this;e.toString()=="follow"?this.action("follow","update",{complete:function(e){e.status==200&&(t.set("actions",t.get("actions").replace("follow","unfollow")),r.Event.trigger("change:follow",t))},data:{params:{id:this.get("id")}}}):e.toString()=="unfollow"&&this.action("unfollow","update",{complete:function(e){e.status==200&&(t.set("actions",t.get("actions").replace("unfollow","follow")),r.Event.trigger("change:follow",t))},data:{params:{id:this.get("id")}}})},unfollow:function(e){},ownerActions:function(){var e=n.difference(this.get("actions").split(","),this.excludeActions);return e},showUrl:function(){return this._url("groups/"+this.id)},showViewMembersUrl:function(){return this._url("groups/"+this.id+"/view_members")},createdDate:function(){return this.formattedDate("created_at","L")},createdAt:function(){return this.formattedDate()},createdAgo:function(){return this.createdAt()},isCurrentUserOwner:function(){return(this.get("context_properties")||{}).owner},isCurrentUserMember:function(){return(this.get("context_properties")||{}).member},showName:function(){return this.get("name")},build:function(){this.get("user")&&(this.user=new i(this.get("user"))),this.get("owners")&&(this.owners=new s(this.get("owners"))),this.get("members")&&(this.members=new s(this.get("members"))),this.get("followers")&&(this.followers=new s(this.get("followers")))},getUserUrl:function(e){return e===r.currentUser.id?this._url("users/"+e):this._url("users/"+e+"/profile")},getGroupOwner:function(){var e=[],t=this.get("owners");return n.isArray(t)&&n.each(t,function(t){e.push(t.id)}),e},metaDetailURL:function(){return this._path("groups/meta_details")},membersCnt:function(){return this.get("members").total_entries},imageUrl:function(e){var t=e.split(","),n=t[3];return t[3]},showMembers:function(){return this._url("groups/"+this.id+"/members")},showFollowers:function(){return this._url("groups/"+this.id+"/followers")},showNOwners:function(e){var t=[],r=this.get("owners");if(n.isArray(r)){var i=0;n.each(r,function(n){i<e&&(t.push(n),i+=1)})}return t},destroy:function(){var e=this,n=this.get("id");this.action("","delete",{data:{params:{}},complete:function(i){i.status===200&&(t("#group_li_"+n).remove(),r.Event.trigger("group:deleted",e))}})},for_template:{mediumImage:function(){return this.image(3)}}})}),define("models/group",["underscore","tibbr","modules/common/models/group"],function(e,t,n){return n.extend({})}),define("collections/subject_group_subscribers",["tibbr","models/group"],function(e,t){return e.Collection.extend({className:"groups",tibbrURL:{controller:"users",action:"subscriber_groups"},model:t})}),define("collections/subject_group_owners",["tibbr","models/group"],function(e,t){return e.Collection.extend({className:"groups",tibbrURL:{controller:"subjects",action:"owner_groups"},model:t})}),define("models/subject",["backbone","underscore","tibbr","modules/common/models/subject","collections/pages","collections/subject_group_subscribers","collections/subject_group_owners"],function(e,t,n,r,i,s,o){return r.extend({build:function(){this._super(),t.isEmpty(this.get("pages"))||(this.pages=[],this.pages=new i(this.get("pages").items)),t.isEmpty(this.get("subscriber_groups"))||(this.subscriber_groups=(new s)._set(this.get("subscriber_groups")),this.subscriber_groups.scopeId=n.currentUser.get("id"),this.subscriber_groups.setParams({params:{subject_id:this.id,set_actions:!0,per_page:10,order_by:"alphabetically"}})),t.isEmpty(this.get("owner_groups"))||(this.owner_groups=(new o)._set(this.get("owner_groups")),this.owner_groups.scopeId=this.id,this.owner_groups.setParams({params:{subject_id:this.id,set_actions:!0,per_page:10,order_by:"alphabetically"}}))},fetchGroupSubscribers:function(e){e=e||{};var t=this;this.subscriber_groups.fetch({silent:!0,data:{params:{subject_id:t.get("id")}},success:function(n,r){t.trigger("subscriber:group:updated"),typeof e.success=="function"&&e.success(n,r)}})}})}),define("collections/subjects",["tibbr","models/subject"],function(e,t){return e.Collection.extend({className:"subjects",tibbrURL:{controller:"subjects",action:"parents"},model:t,load:function(e){var t=this.fetch({data:{params:{page:"1",per_page:"10"}},success:function(){e()}});return t}})}),define("collections/subjects_search",["jquery","tibbr","collections/subjects"],function(e,t,n){return n.extend({tibbrURL:{controller:"users",action:"search_subjects"},perPage:5,load:function(e){this.fetch({data:{params:{search_str:e,page:1,per_page:this.perPage,set_actions:!0,subscribers:t.currentUser.get("id")}}})}})}),define("text!templates/common/quick_search.html",[],function(){return'<div>\r\n    <div class="search-box lfloat">\r\n  <form method="get" action="">\r\n    <fieldset>\r\n      <input type="text" class="search-string" placeholder="${t(\'common.search\')}" />\r\n      <button type="submit" title="${t(\'common.search\')}" class="search-btn"></button>\r\n    </fieldset>\r\n  </form>\r\n</div>\r\n<span style="margin:5px 5px 0px 15px;" class="search-status lfloat"> </span>\r\n<br/><br/>\r\n</div>\r\n<h4>${title}</h4>\r\n<ul class="search-results-list hidden"></ul>\r\n<ul class="default-list"></ul>\r\n<p><span class="default-status"> </span></p>'}),define("views/common/quick_search",["jquery","underscore","tibbr","collections/users_search","collections/subjects_search","text!templates/common/quick_search.html"],function(e,t,n,r,i,s){return n.View.extend({className:"quick-search hidden",events:{"keyup .search-string":"keyup","keypress .search-string":"keypress"},initialize:function(s){t.bindAll(this,"render","search"),this.timeout=null,this.lastSearchStr=" ";var o;this.id==="quick-search-subjects"?(this.defaultCollection=new i,o={params:{page:(this.current_page||0)+1,include_self:!0,search_str:"",subscribers:n.currentUser.id,per_page:30,order_by:"messages_count"}},this.collection=new i):(this.defaultCollection=new r,o={params:{page:(this.current_page||0)+1,per_page:30,connections_of:n.currentUser.id}},this.collection=new r),this.defaultCollection.scopeId=n.currentUser.id,this.collection.scopeId=n.currentUser.id,this.bindTo(this.defaultCollection,"reset",this.populateDefaultList,this),this.bindTo(this.collection,"reset",this.populateSearchList,this);var u=this;this.defaultCollection.fetch({data:o,error:function(){e("span.default-status").html(""),u.id==="quick-search-subjects"?e("#quick-search-subjects").addClass("error"):e("#quick-search-people").addClass("error")},success:function(){u.id==="quick-search-subjects"?e("#quick-search-subjects").removeClass("error"):e("#quick-search-people").removeClass("error")}})},render:function(){var e=this.id==="quick-search-subjects"?n.translate("user.my_subjects_tab"):n.translate("user.my_people");return this.$el.html(this.template.render(s,{title:e})),this.$("span.default-status").html(n.UI.loader),this},keyup:function(t){switch(t.keyCode){case 40:case 38:break;case 9:case 13:this.submit();break;case 27:e(".search-string").html(""),e(".qtip").qtip("hide");break;default:this.search()}t.stopPropagation(),t.preventDefault()},keypress:function(e){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},search:function(e){var r=this.$("span.search-status"),i=t.str.trim(this.$("input.search-string").val()),s=t.str.trim(this.lastSearchStr),o=this.collection,u=this.$el,a={params:{per_page:30,search_str:i}},f=this.timeout;if(i!=s&&i.length!==0)s=i,f&&clearTimeout(f),this.timeout=setTimeout(function(){r.html(n.UI.spinner),o.fetch({data:a})},1e3);else{if(i.length!=0)return;this.populateDefaultList()}},submit:function(){console.log("search page will be shown")},populateDefaultList:function(){this.$("span.default-status").html(""),this.$("span.search-status").first().html("");var e=this,t=this.$(".default-list").empty();this.$(".search-results-list").empty().addClass("hidden"),e.appendItems(this.defaultCollection,t)},populateSearchList:function(){this.$("span.default-status").html("");var e=t.str.trim(this.$("input.search-string").first().val());this.$("span.search-status").first().html("");var n=this,r=this.$(".search-results-list").empty();this.$(".default-list").addClass("hidden"),e.length==0?n.appendItems(this.collection,r):n.appendItems(this.collection,r)},appendItems:function(t,n){t.each(function(t,r){var i=e('<li class="ellipsis"/>'),s=e("<a/>");s.attr("href",t.showUrl()).attr("title",t.get("display_name")).text(t.get("display_name")),n.append(i.append(s)).removeClass("hidden")})}})}),define("views/common/menu",["jquery","underscore","tibbr","views/common/quick_search"],function(e,t,n,r){return n.Menu=n.View.extend({tagName:"ul",className:"nav",id:"global-nav",_template:'<li id="gn-KEY" class="gn-KEY"><a href="HREF"><span></span>TEXT</a></li>',initialize:function(e){t.bindAll(this,"render"),n.currentUser.on("synchedUp",this.render)},events:{"mouseenter li#gn-subjects":"initSubjectQuickSearch","mouseenter li#gn-people":"initPeopleQuickSearch"},render:function(){var e=this;return e.$el.empty(),t.each(n.appConfig("menu","config"),function(t){var r=t.link;t.display&&t.key!=="administrator"&&(r!=="#"&&(r=n.url(t.link)),e.$el.append(e._template.replace(/KEY/g,t.key).replace("TEXT",e.t("main_tabs."+t.key)).replace("HREF",r))),t.key=="administrator"&&n.currentUser.hasAdminPrivilege()&&e.$el.append(e._template.replace(/KEY/g,t.key).replace("TEXT",e.t("main_tabs."+t.key)).replace("HREF",r))}),this.$("li").removeClass("active"),this.$("#gn-"+n.currentNav).addClass("active"),this},initSubjectQuickSearch:function(t){var i=this;e("#gn-subjects").each(function(){if(e("#quick-search-subjects").length===0||e("#quick-search-subjects").hasClass("error")){var t=i.initChild(r,{id:"quick-search-subjects"});e("body").append(t.render().el),e(this).qtip(n.qtipConfigs.qSearch(e(t.el)))}})},initPeopleQuickSearch:function(){var t=this;e("#gn-people").each(function(){if(e("#quick-search-people").length===0||e("#quick-search-people").hasClass("error")){var i=t.initChild(r,{id:"quick-search-people"});e("body").append(i.render().el),e(this).qtip(n.qtipConfigs.qSearch(e(i.el)))}})}})}),define("require/menu_aim",["jquery"],function(e){(function(e){function t(t){var n=e(this),r=null,i=[],s=null,o=null,u=undefined,a=e.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:e.noop,exit:e.noop,activate:e.noop,deactivate:e.noop,exitMenu:e.noop,activationDelay:150},t),f=3,l=300,c=function(e){i.push({x:e.pageX,y:e.pageY}),i.length>f&&i.shift()},h=function(){o&&clearTimeout(o),a.exitMenu(this)&&(r&&a.deactivate(r),r=null)},p=function(){o&&clearTimeout(o),a.enter(this),m(this)},d=function(){u&&(clearTimeout(u),u=undefined),a.exit(this),r=null},v=function(e){function t(){r&&a.deactivate(r),a.activate(e),r=e}if(e==r)return;a.activationDelay>0?(u&&clearTimeout(u),u=setTimeout(t,a.activationDelay)):t()},m=function(e){var t=g();t?o=setTimeout(function(){m(e)},t):v(e)},g=function(){function d(e,t){return(t.y-e.y)/(t.x-e.x)}if(!r||!e(r).is(a.submenuSelector))return 0;var t=n.offset(),o={x:t.left,y:t.top-a.tolerance},u={x:t.left+n.outerWidth(),y:o.y},f={x:t.left,y:t.top+n.outerHeight()+a.tolerance},c={x:t.left+n.outerWidth(),y:f.y},h=i[i.length-1],p=i[0];if(!h)return 0;p||(p=h);if(p.x<t.left||p.x>c.x||p.y<t.top||p.y>c.y)return 0;if(s&&h.x==s.x&&h.y==s.y)return 0;var v=u,m=c;a.submenuDirection=="left"?(v=f,m=o):a.submenuDirection=="below"?(v=c,m=f):a.submenuDirection=="above"&&(v=o,m=u);var g=d(h,v),y=d(h,m),b=d(p,v),w=d(p,m);return g<b&&y>w?(s=h,l):(s=null,0)};n.mouseleave(h).find(a.rowSelector).mouseenter(p).mouseleave(d),e(document).mousemove(c)}e.fn.menuAim=function(e){return this.each(function(){t.call(this,e)}),this}})(e)}),define("require/jcrop",["jquery"],function(e){return function(e){e.Jcrop=function(t,n){function a(e){return Math.round(e)+"px"}function f(e){return r.baseClass+"-"+e}function l(){return e.fx.step.hasOwnProperty("backgroundColor")}function c(t){var n=e(t).offset();return[n.left,n.top]}function h(e){return[e.pageX-i[0],e.pageY-i[1]]}function p(t){typeof t!="object"&&(t={}),r=e.extend(r,t),e.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){typeof r[t]!="function"&&(r[t]=function(){})})}function d(e,t,n){i=c(A),nt.setCursor(e==="move"?e:e+"-resize");if(e==="move")return nt.activateHandlers(m(t),E,n);var r=Z.getFixed(),s=g(e),o=Z.getCorner(g(s));Z.setPressed(Z.getCorner(s)),Z.setCurrent(o),nt.activateHandlers(v(e,r),E,n)}function v(e,t){return function(n){if(!r.aspectRatio)switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}else switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}Z.setCurrent(n),tt.update()}}function m(e){var t=e;return rt.watchKeys(),function(e){Z.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,tt.update()}}function g(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function y(e){return function(t){return r.disabled?!1:e==="move"&&!r.allowMove?!1:(i=c(A),K=!0,d(e,h(t)),t.stopPropagation(),t.preventDefault(),!1)}}function b(e,t,n){var r=e.width(),i=e.height();r>t&&t>0&&(r=t,i=t/e.width()*e.height()),i>n&&n>0&&(i=n,r=n/e.height()*e.width()),X=e.width()/r,V=e.height()/i,e.width(r).height(i)}function w(e){return{x:e.x*X,y:e.y*V,x2:e.x2*X,y2:e.y2*V,w:e.w*X,h:e.h*V}}function E(e){var t=Z.getFixed();t.w>r.minSelect[0]&&t.h>r.minSelect[1]?(tt.enableHandles(),tt.done()):tt.release(),nt.setCursor(r.allowSelect?"crosshair":"default")}function S(e){if(r.disabled)return!1;if(!r.allowSelect)return!1;K=!0,i=c(A),tt.disableHandles(),nt.setCursor("crosshair");var t=h(e);return Z.setPressed(t),tt.update(),nt.activateHandlers(x,E,e.type.substring(0,5)==="touch"),rt.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function x(e){Z.setCurrent(e),tt.update()}function T(){var t=e("<div></div>").addClass(f("tracker"));return o&&t.css({opacity:0,backgroundColor:"white"}),t}function it(e){_.removeClass().addClass(f("holder")).addClass(e)}function st(e,t){function b(){window.setTimeout(w,c)}var n=e[0]/X,i=e[1]/V,s=e[2]/X,o=e[3]/V;if(Q)return;var u=Z.flipCoords(n,i,s,o),a=Z.getFixed(),f=[a.x,a.y,a.x2,a.y2],l=f,c=r.animationDelay,h=u[0]-f[0],p=u[1]-f[1],d=u[2]-f[2],v=u[3]-f[3],m=0,g=r.swingSpeed;n=l[0],i=l[1],s=l[2],o=l[3],tt.animMode(!0);var y,w=function(){return function(){m+=(100-m)/g,l[0]=Math.round(n+m/100*h),l[1]=Math.round(i+m/100*p),l[2]=Math.round(s+m/100*d),l[3]=Math.round(o+m/100*v),m>=99.8&&(m=100),m<100?(ut(l),b()):(tt.done(),tt.animMode(!1),typeof t=="function"&&t.call(yt))}}();b()}function ot(e){ut([e[0]/X,e[1]/V,e[2]/X,e[3]/V]),r.onSelect.call(yt,w(Z.getFixed())),tt.enableHandles()}function ut(e){Z.setPressed([e[0],e[1]]),Z.setCurrent([e[2],e[3]]),tt.update()}function at(){return w(Z.getFixed())}function ft(){return Z.getFixed()}function lt(e){p(e),gt()}function ct(){r.disabled=!0,tt.disableHandles(),tt.setCursor("default"),nt.setCursor("default")}function ht(){r.disabled=!1,gt()}function pt(){tt.done(),nt.activateHandlers(null,null)}function dt(){_.remove(),C.show(),C.css("visibility","visible"),e(t).removeData("Jcrop")}function vt(e,t){tt.release(),ct();var n=new Image;n.onload=function(){var i=n.width,s=n.height,o=r.boxWidth,u=r.boxHeight;A.width(i).height(s),A.attr("src",e),D.attr("src",e),b(A,o,u),O=A.width(),M=A.height(),D.width(O).height(M),F.width(O+j*2).height(M+j*2),_.width(O).height(M),et.resize(O,M),ht(),typeof t=="function"&&t.call(yt)},n.src=e}function mt(e,t,n){var i=t||r.bgColor;r.bgFade&&l()&&r.fadeTime&&!n?e.animate({backgroundColor:i},{queue:!1,duration:r.fadeTime}):e.css("backgroundColor",i)}function gt(e){r.allowResize?e?tt.enableOnly():tt.enableHandles():tt.disableHandles(),nt.setCursor(r.allowSelect?"crosshair":"default"),tt.setCursor(r.allowMove?"move":"default"),r.hasOwnProperty("trueSize")&&(X=r.trueSize[0]/O,V=r.trueSize[1]/M),r.hasOwnProperty("setSelect")&&(ot(r.setSelect),tt.done(),delete r.setSelect),et.refresh(),r.bgColor!=I&&(mt(r.shade?et.getShades():_,r.shade?r.shadeColor||r.bgColor:r.bgColor),I=r.bgColor),q!=r.bgOpacity&&(q=r.bgOpacity,r.shade?et.refresh():tt.setBgOpacity(q)),R=r.maxSize[0]||0,U=r.maxSize[1]||0,z=r.minSize[0]||0,W=r.minSize[1]||0,r.hasOwnProperty("outerImage")&&(A.attr("src",r.outerImage),delete r.outerImage),tt.refresh()}var r=e.extend({},e.Jcrop.defaults),i,s=navigator.userAgent.toLowerCase(),o=/msie/.test(s),u=/msie [1-6]\./.test(s);typeof t!="object"&&(t=e(t)[0]),typeof n!="object"&&(n={}),p(n);var N={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},C=e(t),k=!0;if(t.tagName=="IMG"){if(C[0].width!=0&&C[0].height!=0)C.width(C[0].width),C.height(C[0].height);else{var L=new Image;L.src=C[0].src,C.width(L.width),C.height(L.height)}var A=C.clone().removeAttr("id").css(N).show();A.width(C.width()),A.height(C.height()),C.after(A).hide()}else A=C.css(N).show(),k=!1,r.shade===null&&(r.shade=!0);b(A,r.boxWidth,r.boxHeight);var O=A.width(),M=A.height(),_=e("<div />").width(O).height(M).addClass(f("holder")).css({position:"relative",backgroundColor:r.bgColor}).insertAfter(C).append(A);r.addClass&&_.addClass(r.addClass);var D=e("<div />"),P=e("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),H=e("<div />").width("100%").height("100%").css("zIndex",320),B=e("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=Z.getFixed();r.onDblClick.call(yt,e)}).insertBefore(A).append(P,H);k&&(D=e("<img />").attr("src",A.attr("src")).css(N).width(O).height(M),P.append(D)),u&&B.css({overflowY:"hidden"});var j=r.boundary,F=T().width(O+j*2).height(M+j*2).css({position:"absolute",top:a(-j),left:a(-j),zIndex:290}).mousedown(S),I=r.bgColor,q=r.bgOpacity,R,U,z,W,X,V,J=!0,K,Q,G;i=c(A);var Y=function(){function e(){var e={},t=["touchstart","touchmove","touchend"],n=document.createElement("div"),r;try{for(r=0;r<t.length;r++){var i=t[r];i="on"+i;var s=i in n;s||(n.setAttribute(i,"return;"),s=typeof n[i]=="function"),e[t[r]]=s}return e.touchstart&&e.touchend&&e.touchmove}catch(o){return!1}}function t(){return r.touchSupport===!0||r.touchSupport===!1?r.touchSupport:e()}return{createDragger:function(e){return function(t){return r.disabled?!1:e==="move"&&!r.allowMove?!1:(i=c(A),K=!0,d(e,h(Y.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1)}},newSelection:function(e){return S(Y.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),Z=function(){function u(r){r=p(r),n=e=r[0],i=t=r[1]}function a(e){e=p(e),s=e[0]-n,o=e[1]-i,n=e[0],i=e[1]}function f(){return[s,o]}function l(r){var s=r[0],o=r[1];0>e+s&&(s-=s+e),0>t+o&&(o-=o+t),M<i+o&&(o+=M-(i+o)),O<n+s&&(s+=O-(n+s)),e+=s,n+=s,t+=o,i+=o}function c(e){var t=h();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function h(){if(!r.aspectRatio)return v();var s=r.aspectRatio,o=r.minSize[0]/X,u=r.maxSize[0]/X,a=r.maxSize[1]/V,f=n-e,l=i-t,c=Math.abs(f),h=Math.abs(l),p=c/h,g,y,b,w;return u===0&&(u=O*10),a===0&&(a=M*10),p<s?(y=i,b=h*s,g=f<0?e-b:b+e,g<0?(g=0,w=Math.abs((g-e)/s),y=l<0?t-w:w+t):g>O&&(g=O,w=Math.abs((g-e)/s),y=l<0?t-w:w+t)):(g=n,w=c/s,y=l<0?t-w:t+w,y<0?(y=0,b=Math.abs((y-t)*s),g=f<0?e-b:b+e):y>M&&(y=M,b=Math.abs(y-t)*s,g=f<0?e-b:b+e)),g>e?(g-e<o?g=e+o:g-e>u&&(g=e+u),y>t?y=t+(g-e)/s:y=t-(g-e)/s):g<e&&(e-g<o?g=e-o:e-g>u&&(g=e-u),y>t?y=t+(e-g)/s:y=t-(e-g)/s),g<0?(e-=g,g=0):g>O&&(e-=g-O,g=O),y<0?(t-=y,y=0):y>M&&(t-=y-M,y=M),m(d(e,t,g,y))}function p(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>O&&(e[0]=O),e[1]>M&&(e[1]=M),[Math.round(e[0]),Math.round(e[1])]}function d(e,t,n,r){var i=e,s=n,o=t,u=r;return n<e&&(i=n,s=e),r<t&&(o=r,u=t),[i,o,s,u]}function v(){var r=n-e,s=i-t,o;return R&&Math.abs(r)>R&&(n=r>0?e+R:e-R),U&&Math.abs(s)>U&&(i=s>0?t+U:t-U),W/V&&Math.abs(s)<W/V&&(i=s>0?t+W/V:t-W/V),z/X&&Math.abs(r)<z/X&&(n=r>0?e+z/X:e-z/X),e<0&&(n-=e,e-=e),t<0&&(i-=t,t-=t),n<0&&(e-=n,n-=n),i<0&&(t-=i,i-=i),n>O&&(o=n-O,e-=o,n-=o),i>M&&(o=i-M,t-=o,i-=o),e>O&&(o=e-M,i-=o,t-=o),t>M&&(o=t-M,i-=o,t-=o),m(d(e,t,n,i))}function m(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var e=0,t=0,n=0,i=0,s,o;return{flipCoords:d,setPressed:u,setCurrent:a,getOffset:f,moveOffset:l,getCorner:c,getFixed:h}}(),et=function(){function s(e,t){i.left.css({height:a(t)}),i.right.css({height:a(t)})}function o(){return u(Z.getFixed())}function u(e){i.top.css({left:a(e.x),width:a(e.w),height:a(e.y)}),i.bottom.css({top:a(e.y2),left:a(e.x),width:a(e.w),height:a(M-e.y2)}),i.right.css({left:a(e.x2),width:a(O-e.x2)}),i.left.css({width:a(e.x)})}function f(){return e("<div />").css({position:"absolute",backgroundColor:r.shadeColor||r.bgColor}).appendTo(n)}function l(){t||(t=!0,n.insertBefore(A),o(),tt.setBgOpacity(1,0,1),D.hide(),c(r.shadeColor||r.bgColor,1),tt.isAwake()?p(r.bgOpacity,1):p(1,1))}function c(e,t){mt(v(),e,t)}function h(){t&&(n.remove(),D.show(),t=!1,tt.isAwake()?tt.setBgOpacity(r.bgOpacity,1,1):(tt.setBgOpacity(1,1,1),tt.disableHandles()),mt(_,0,1))}function p(e,i){t&&(r.bgFade&&!i?n.animate({opacity:1-e},{queue:!1,duration:r.fadeTime}):n.css({opacity:1-e}))}function d(){r.shade?l():h(),tt.isAwake()&&p(r.bgOpacity)}function v(){return n.children()}var t=!1,n=e("<div />").css({position:"absolute",zIndex:240,opacity:0}),i={top:f(),left:f().height(M),right:f().height(M),bottom:f()};return{update:o,updateRaw:u,getShades:v,setBgColor:c,enable:l,disable:h,resize:s,refresh:d,opacity:p}}(),tt=function(){function l(t){var n=e("<div />").css({position:"absolute",opacity:r.borderOpacity}).addClass(f(t));return P.append(n),n}function c(t,n){var r=e("<div />").mousedown(y(t)).css({cursor:t+"-resize",position:"absolute",zIndex:n}).addClass("ord-"+t);return Y.support&&r.bind("touchstart.jcrop",Y.createDragger(t)),H.append(r),r}function h(e){var t=r.handleSize,i=c(e,n++).css({opacity:r.handleOpacity}).addClass(f("handle"));return t&&i.width(t).height(t),i}function p(e){return c(e,n++).addClass("jcrop-dragbar")}function d(e){var t;for(t=0;t<e.length;t++)o[e[t]]=p(e[t])}function v(e){var t,n;for(n=0;n<e.length;n++){switch(e[n]){case"n":t="hline";break;case"s":t="hline bottom";break;case"e":t="vline right";break;case"w":t="vline"}i[e[n]]=l(t)}}function m(e){var t;for(t=0;t<e.length;t++)s[e[t]]=h(e[t])}function g(e,t){r.shade||D.css({top:a(-t),left:a(-e)}),B.css({top:a(t),left:a(e)})}function b(e,t){B.width(Math.round(e)).height(Math.round(t))}function E(){var e=Z.getFixed();Z.setPressed([e.x,e.y]),Z.setCurrent([e.x2,e.y2]),S()}function S(e){if(t)return x(e)}function x(e){var n=Z.getFixed();b(n.w,n.h),g(n.x,n.y),r.shade&&et.updateRaw(n),t||C(),e?r.onSelect.call(yt,w(n)):r.onChange.call(yt,w(n))}function N(e,n,i){if(!t&&!n)return;r.bgFade&&!i?A.animate({opacity:e},{queue:!1,duration:r.fadeTime}):A.css("opacity",e)}function C(){B.show(),r.shade?et.opacity(q):N(q,!0),t=!0}function k(){M(),B.hide(),r.shade?et.opacity(1):N(1),t=!1,r.onRelease.call(yt)}function L(){u&&H.show()}function O(){u=!0;if(r.allowResize)return H.show(),!0}function M(){u=!1,H.hide()}function _(e){e?(Q=!0,M()):(Q=!1,O())}function j(){_(!1),E()}var t,n=370,i={},s={},o={},u=!1;r.dragEdges&&e.isArray(r.createDragbars)&&d(r.createDragbars),e.isArray(r.createHandles)&&m(r.createHandles),r.drawBorders&&e.isArray(r.createBorders)&&v(r.createBorders),e(document).bind("touchstart.jcrop-ios",function(t){e(t.currentTarget).hasClass("jcrop-tracker")&&t.stopPropagation()});var F=T().mousedown(y("move")).css({cursor:"move",position:"absolute",zIndex:360});return Y.support&&F.bind("touchstart.jcrop",Y.createDragger("move")),P.append(F),M(),{updateVisible:S,update:x,release:k,refresh:E,isAwake:function(){return t},setCursor:function(e){F.css("cursor",e)},enableHandles:O,enableOnly:function(){u=!0},showHandles:L,disableHandles:M,animMode:_,setBgOpacity:N,done:j}}(),nt=function(){function s(t){F.css({zIndex:450}),t?e(document).bind("touchmove.jcrop",l).bind("touchend.jcrop",c):i&&e(document).bind("mousemove.jcrop",u).bind("mouseup.jcrop",a)}function o(){F.css({zIndex:290}),e(document).unbind(".jcrop")}function u(e){return t(h(e)),!1}function a(e){return e.preventDefault(),e.stopPropagation(),K&&(K=!1,n(h(e)),tt.isAwake()&&r.onSelect.call(yt,w(Z.getFixed())),o(),t=function(){},n=function(){}),!1}function f(e,r,i){return K=!0,t=e,n=r,s(i),!1}function l(e){return t(h(Y.cfilter(e))),!1}function c(e){return a(Y.cfilter(e))}function p(e){F.css("cursor",e)}var t=function(){},n=function(){},i=r.trackDocument;return i||F.mousemove(u).mouseup(a).mouseout(a),A.before(F),{activateHandlers:f,setCursor:p}}(),rt=function(){function i(){r.keySupport&&(t.show(),t.focus())}function s(e){t.hide()}function o(e,t,n){r.allowMove&&(Z.moveOffset([t,n]),tt.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function a(e){if(e.ctrlKey||e.metaKey)return!0;G=e.shiftKey?!0:!1;var t=G?10:1;switch(e.keyCode){case 37:o(e,-t,0);break;case 39:o(e,t,0);break;case 38:o(e,0,-t);break;case 40:o(e,0,t);break;case 27:r.allowSelect&&tt.release();break;case 9:return!0}return!1}var t=e('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),n=e("<div />").css({position:"absolute",overflow:"hidden"}).append(t);return r.keySupport&&(t.keydown(a).blur(s),u||!r.fixedSupport?(t.css({position:"absolute",left:"-20px"}),n.append(t).insertBefore(A)):t.insertBefore(A)),{watchKeys:i}}();Y.support&&F.bind("touchstart.jcrop",Y.newSelection),H.hide(),gt(!0);var yt={setImage:vt,animateTo:st,setSelect:ot,setOptions:lt,tellSelect:at,tellScaled:ft,setClass:it,disable:ct,enable:ht,cancel:pt,release:tt.release,destroy:dt,focus:rt.watchKeys,getBounds:function(){return[O*X,M*V]},getWidgetSize:function(){return[O,M]},getScaleFactor:function(){return[X,V]},getOptions:function(){return r},ui:{holder:_,selection:B}};return o&&_.bind("selectstart",function(){return!1}),C.data("Jcrop",yt),yt},e.fn.Jcrop=function(t,n){var r;return this.each(function(){if(e(this).data("Jcrop")){if(t==="api")return e(this).data("Jcrop");e(this).data("Jcrop").setOptions(t)}else this.tagName=="IMG"?e.Jcrop.Loader(this,function(){e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r)}):(e(this).css({display:"block",visibility:"hidden"}),r=e.Jcrop(this,t),e.isFunction(n)&&n.call(r))}),this},e.Jcrop.Loader=function(t,n,r){function o(){s.complete?(i.unbind(".jcloader"),e.isFunction(n)&&n.call(s)):window.setTimeout(o,50)}var i=e(t),s=i[0];i.bind("load.jcloader",o).bind("error.jcloader",function(t){i.unbind(".jcloader"),e.isFunction(r)&&r.call(s)}),s.complete&&e.isFunction(n)&&(i.unbind(".jcloader"),n.call(s))},e.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(e)}),function(e){typeof define=="function"&&define.amd?define("require/jquery-fileupload",["jquery","jqueryui/widget"],e):e(window.jQuery)}(function(e){e.support.xhrFileUpload=!!window.XMLHttpRequestUpload&&!!window.FileReader,e.support.xhrFormDataFileUpload=!!window.FormData,e.widget("blueimp.fileupload",{options:{namespace:undefined,dropZone:e(document),pasteZone:e(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,formData:function(e){return e.serializeArray()},add:function(e,t){t.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_BitrateTimer:function(){this.timestamp=+(new Date),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n)this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e;return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return typeof t.formData=="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:t.formData?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_onProgress:function(e,t){if(e.lengthComputable){var n=+(new Date),r,i;if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,r=t.total||this._getTotal(t.files),i=parseInt(e.loaded/e.total*(t.chunkSize||r),10)+(t.uploadedBytes||0),this._loaded+=i-(t.loaded||t.uploadedBytes||0),t.lengthComputable=!0,t.loaded=i,t.total=r,t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total,bitrate:this._bitrateTimer.getBitrate(n,this._loaded,t.bitrateInterval)})}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,n._onProgress(e,t)}),t.xhr=function(){return r})},_initXHRData:function(t){var n,r=t.files[0],i=t.multipart||!e.support.xhrFileUpload,s=t.paramName[0];t.headers=t.headers||{},t.contentRange&&(t.headers["Content-Range"]=t.contentRange),i?e.support.xhrFormDataFileUpload&&(t.postMessage?(n=this._getFormData(t),t.blob?n.push({name:s,value:t.blob}):e.each(t.files,function(e,r){n.push({name:t.paramName[e]||s,value:r})})):(t.formData instanceof FormData?n=t.formData:(n=new FormData,e.each(this._getFormData(t),function(e,t){n.append(t.name,t.value)})),t.blob?(t.headers["X-File-Name"]=r.name,t.headers["X-File-Type"]=r.type,n.append(s,t.blob,r.name)):e.each(t.files,function(e,r){r instanceof Blob&&n.append(t.paramName[e]||s,r,r.name)})),t.data=n):(t.headers["X-File-Name"]=r.name,t.contentType=r.type,t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&e("<a></a>").prop("href",t.url).prop("host")!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e,"iframe")},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i)r.push(n),i-=1}),r.length||(r=[n.prop("name")||"files[]"])),r},_initFormSettings:function(t){if(!t.form||!t.form.length)t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")));t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();return n=n||this.options.context||s,t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r),s.abort=i.promise,this._enhancePromise(s)},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes=t.uploadedBytes||0,u=t.maxChunkSize||s,a=i.slice||i.webkitSlice||i.mozSlice,f=e.Deferred(),l=f.promise(),c,h;return!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data?!1:n?!0:o>=s?(i.error="Uploaded bytes exceed file size",this._getXHRPromise(!1,t.context,[null,"error",i.error])):(h=function(n){var l=e.extend({},t);l.blob=a.call(i,o,o+u),l.chunkSize=l.blob.size,l.contentRange="bytes "+o+"-"+(o+l.chunkSize-1)+"/"+s,r._initXHRData(l),r._initProgressListener(l),c=(e.ajax(l)||r._getXHRPromise(!1,l.context)).done(function(n,i,u){o=r._getUploadedBytes(u)||o+l.chunkSize,l.loaded||r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-l.uploadedBytes,total:o-l.uploadedBytes}),l),t.uploadedBytes=l.uploadedBytes=o,o<s?h():f.resolveWith(l.context,[n,i,u])}).fail(function(e,t,n){f.rejectWith(l.context,[e,t,n])})},this._enhancePromise(l),l.abort=function(){return c.abort()},h(),l)},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer),this._active+=1,this._loaded+=t.uploadedBytes||0,this._total+=this._getTotal(t.files)},_onDone:function(t,n,r,i){this._isXHRUpload(i)||this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:1,total:1}),i),i.result=t,i.textStatus=n,i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,n,r){r.jqXHR=e,r.textStatus=t,r.errorThrown=n,this._trigger("fail",null,r),r.recalculateProgress&&(this._loaded-=r.loaded||r.uploadedBytes||0,this._total-=r.total||this._getTotal(r.files))},_onAlways:function(e,t,n,r){this._active-=1,r.textStatus=t,n&&n.always?(r.jqXHR=n,r.result=e):(r.jqXHR=e,r.errorThrown=n),this._trigger("always",null,r),this._active===0&&(this._trigger("stop"),this._loaded=this._total=0,this._bitrateTimer=null)},_onSend:function(t,n){var r=this,i,s,o,u=r._getAJAXSettings(n),a=function(n,s){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,i=i||(n!==!1&&r._trigger("send",t,u)!==!1&&(r._chunkedUpload(u)||e.ajax(u))||r._getXHRPromise(!1,u.context,s)).done(function(e,t,n){r._onDone(e,t,n,u)}).fail(function(e,t,n){r._onFail(e,t,n,u)}).always(function(e,t,n){r._sending-=1,r._onAlways(e,t,n,u);if(u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending){var i=r._slots.shift(),s;while(i){s=i.state?i.state()==="pending":!i.isRejected();if(s){i.resolve();break}i=r._slots.shift()}}}),i};return this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(s=e.Deferred(),this._slots.push(s),o=s.pipe(a)):o=this._sequence=this._sequence.pipe(a,a),o.abort=function(){var e=[undefined,"abort","abort"];return i?i.abort():(s&&s.rejectWith(o,e),a(!1,e))},this._enhancePromise(o)):a()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=s.limitMultiFileUploads,u=this._getParamName(s),a,f,l,c;if(!s.singleFileUploads&&!o||!this._isXHRUpload(s))l=[n.files],a=[u];else if(!s.singleFileUploads&&o){l=[],a=[];for(c=0;c<n.files.length;c+=o)l.push(n.files.slice(c,c+o)),f=u.slice(c,c+o),f.length||(f=u),a.push(f)}else a=u;return n.originalFiles=n.files,e.each(l||n.files,function(s,o){var u=e.extend({},n);return u.files=l?o:[o],u.paramName=a[s],u.submit=function(){return u.jqXHR=this.jqXHR=r._trigger("submit",t,this)!==!1&&r._onSend(t,this),this.jqXHR},i=r._trigger("add",t,u)}),i},_replaceFileInput:function(t){var n=t.clone(!0);e("<form></form>").append(n)[0].reset(),t.after(n).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,r){return r===t[0]?n[0]:r}),t[0]===this.element[0]&&(this.element=n)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),i.resolve([e])},o;return n=n||"",t.isFile?t._file?(t._file.relativePath=n,i.resolve(t._file)):t.file(function(e){e.relativePath=n,i.resolve(e)},s):t.isDirectory?(o=t.createReader(),o.readEntries(function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},s)):i.resolve([]),i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=t.data.fileupload,r={fileInput:e(t.target),form:e(t.target.form)};n._getFileInputFiles(r.fileInput).always(function(e){r.files=e,n.options.replaceFileInput&&n._replaceFileInput(r.fileInput),n._trigger("change",t,r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.data.fileupload,r=t.originalEvent.clipboardData,i=r&&r.items||[],s={files:[]};e.each(i,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&s.files.push(n)});if(n._trigger("paste",t,s)===!1||n._onAdd(t,s)===!1)return!1},_onDrop:function(e){e.preventDefault();var t=e.data.fileupload,n=e.dataTransfer=e.originalEvent.dataTransfer,r={};t._getDroppedFiles(n).always(function(n){r.files=n,t._trigger("drop",e,r)!==!1&&t._onAdd(e,r)})},_onDragOver:function(e){var t=e.data.fileupload,n=e.dataTransfer=e.originalEvent.dataTransfer;if(t._trigger("dragover",e)===!1)return!1;n&&(n.dropEffect="copy"),e.preventDefault()},_initEventHandlers:function(){var e=this.options.namespace;this._isXHRUpload(this.options)&&(this.options.dropZone.bind("dragover."+e,{fileupload:this},this._onDragOver).bind("drop."+e,{fileupload:this},this._onDrop),this.options.pasteZone.bind("paste."+e,{fileupload:this},this._onPaste)),this.options.fileInput.bind("change."+e,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var e=this.options.namespace;this.options.dropZone.unbind("dragover."+e,this._onDragOver).unbind("drop."+e,this._onDrop),this.options.pasteZone.unbind("paste."+e,this._onPaste),this.options.fileInput.unbind("change."+e,this._onChange)},_setOption:function(t,n){var r=e.inArray(t,this._refreshOptionsList)!==-1;r&&this._destroyEventHandlers(),e.Widget.prototype._setOption.call(this,t,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_create:function(){var t=this.options;e.extend(t,e(this.element[0].cloneNode(!1)).data()),t.namespace=t.namespace||this.widgetName,this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),e.Widget.prototype.destroy.call(this)},enable:function(){var t=!1;this.options.disabled&&(t=!0),e.Widget.prototype.enable.call(this),t&&this._initEventHandlers()},disable:function(){this.options.disabled||this._destroyEventHandlers(),e.Widget.prototype.disable.call(this)},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;return i.abort=function(){return o=!0,s?s.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;t.files=e,s=n._onSend(null,t).then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}),this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),function(e){typeof define=="function"&&define.amd?define("require/jquery-iframe-transport",["jquery"],e):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(n){if(n.async&&(n.type==="POST"||n.type==="GET")){var r,i;return{send:function(s,o){r=e('<form style="display:none;"></form>'),r.attr("accept-charset",n.formAcceptCharset),i=e('<iframe src="javascript:false;" name="iframe-transport-'+(t+=1)+'"></iframe>').bind("load",function(){var t,s=e.isArray(n.paramName)?n.paramName:[n.paramName];i.unbind("load").bind("load",function(){var t;try{t=i.contents();if(!t.length||!t[0].firstChild)throw new Error}catch(n){t=undefined}o(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(r),r.remove()}),r.prop("target",i.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(r)}),n.fileInput&&n.fileInput.length&&n.type==="POST"&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",s[t]||n.paramName)}),r.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),r.submit(),t&&t.length&&n.fileInput.each(function(n,r){var i=e(t[n]);e(r).prop("name",i.prop("name")),i.replaceWith(r)})}),r.append(i).appendTo(document.body)},abort:function(){i&&i.unbind("load").prop("src","javascript".concat(":false;")),r&&r.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return e(t[0].body).text()},"iframe json":function(t){return e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return e(t[0].body).html()},"iframe script":function(t){return e.globalEval(e(t[0].body).text())}}})}),define("hbs!templates/users/upload_photo",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='<div class="upload-photo-section">\r\n    <form  class="with-top-labels">\r\n        <input type="hidden" value="put" name="_method"/>\r\n        <input type="hidden" value="json" name="format"/>\r\n        <input type="hidden" value="" name="user[profile_image_dimensions][crop_x]" id="crop-x" class="crop-data" />\r\n        <input type="hidden" value="" name="user[profile_image_dimensions][crop_y]" id="crop-y" class="crop-data" />\r\n        <input type="hidden" value="" name="user[profile_image_dimensions][crop_w]" id="crop-w" class="crop-data" />\r\n        <input type="hidden" value="" name="user[profile_image_dimensions][crop_h]" id="crop-h" class="crop-data" />\r\n        <input type="hidden" value="" name="user[temp_file]" id="temp_id"  />\r\n        <input type="hidden" value="" name="user[scale_factor]" id="scale_factor"  />\r\n        <input type="hidden" value="true" name="user[image_scaled]" id="scale"  />\r\n        <div class="media-box">\r\n            <div class="profile-photo">\r\n                <div id="image-container">\r\n                    <p class="dropable-area"><span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.drag_n_drop",u):a.call(t,"t","common.drag_n_drop",u)))+'</span></p>\r\n                    <img alt="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===l?o.apply(t):o))+'" class="profile-img" style="display: none;"/>\r\n                </div>\r\n                <div class="clearfix mtl hidden js-asset-progress">\r\n                    <div class="progress-bar js-progress" id="progress">\r\n                        <div style="width: 0%;" class="bar"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="info-wrap">\r\n                <div class="info">\r\n                    <p class="title mbs">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"upload_photo.select_image",u):a.call(t,"t","upload_photo.select_image",u)))+'</p>\r\n					<span class="browse-title" >\r\n                        <span class="btn file-upload-btn">\r\n                            <span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.browse",u):a.call(t,"t","common.browse",u)))+'</span>\r\n                            <input type="file"  id="profile-picture"  placeholder="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"upload_photo.select_image",u):a.call(t,"t","upload_photo.select_image",u)))+'">\r\n                        </span>\r\n                        <span class="display-file">No File Chosen</span>\r\n					</span>\r\n                    <p class="support-txt clearb mvs">*',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"upload_photo.supported_formats",u):a.call(t,"t","upload_photo.supported_formats",u)))+'</p>\r\n                    <p class="details">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"upload_photo.multiple_images",u):a.call(t,"t","upload_photo.multiple_images",u)))+'</p>\r\n                    <fieldset class="form-actions">\r\n                        <button  name="commit" class="btn btn-submit btn-small js-photo" disabled >',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"upload_photo.save_button",u):a.call(t,"t","upload_photo.save_button",u)))+"</button>\r\n                    </fieldset>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </form>\r\n</div>\r\n",s})}),define("views/users/upload_photo",["jquery","underscore","require/jcrop","require/jquery-fileupload","require/jquery-iframe-transport","tibbr","modules/dialog","hbs!templates/users/upload_photo"],function(e,t,n,r,i,s,o,u){return s.View.extend({className:"profile-wrap",initialize:function(){t.bindAll(this,"updateInfo"),this.dialogTitle=this.t("user.upload_photo")},events:{"click .js-photo":"handleSubmit"},render:function(){return this.$el.html(this.renderTemplate(u)),this.setUpload(),this.$("form").csrfToken(),s.dragNDropSupport||this.$(".dropable-area").remove(),this},setUpload:function(){var e=this.$(".js-asset-progress"),t=this;this.$("#profile-picture").fileupload({dataType:"json",url:s.path("temp_asset_files"),dropZone:this.$(".profile-photo"),singleFileUploads:!0,paramName:"temp_file[data]",done:function(t,n){e.hide()},add:function(n,r){r.submit().done(function(n){n.errors?(o.alert({text:n.errors.error}),t.$(".spinner").remove().end().find(".btn-primary").show(),e.hide()):(t.$(".dropable-area").hide(),t.$("img").attr("src",s.path(n.user_profile_image_location)).show(),t.$("#temp_id").val(n.id),t.$("#scale_factor").val(n.scale_factor),t.displayCrop())}),s.IE&&e.show().find(".js-progress").html(s.UI.loader)},error:function(n){o.alert({text:s.Modules.Error.parse(n).join("<br>")}),t.$(".spinner").remove().end().find(".btn-primary").show(),e.hide()},progressall:function(t,n){e.show();if(s.IE)e.find(".js-progress").html(s.UI.loader);else{var r=parseInt(n.loaded/n.total*100,10);e.find(".js-progress .bar").css("width",r+"%")}}}).bind("fileuploadsubmit",function(e,t){t.formData={format:"json",authenticity_token:s._CSFR_TOEKN,"temp_file[type]":"user"}})},displayCrop:function(){var t=this,n=t.$(".profile-img"),r=1;t.cropRatio=r;var i,s;t.jcrop_api&&(t.jcrop_api.destroy(),n.removeAttr("style")),n.css({"max-height":280,"max-width":280}),e(".profile-img").Jcrop({minSize:[33,33],aspectRatio:1,bgFade:!0,bgOpacity:.3,setSelect:[0,44,174,174],onChange:t.updateInfo,onSelect:t.updateInfo},function(){var e=this.getBounds();i=e[0],s=e[1],t.jcrop_api=this}),this.$(".js-photo").prop("disabled",!1)},updateInfo:function(e){var t=this,n=this.cropRatio,r=e.x*n,i=e.y*n,s=e.w*n,o=e.h*n;t.$("#crop-x").val(r),t.$("#crop-y").val(i),t.$("#crop-w").val(s),t.$("#crop-h").val(o)},handleSubmit:function(){var e=this;return this.$(".js-photo").prop("disabled",!0).after(spinner),this.ajax({url:"users/"+s.currentUser.id,data:this.$("form").serialize()}).done(function(t){e.model.set("profile_image_url",t.profile_image_url),e.dialog.close()}),!1}})}),define("hbs!templates/home/profile_section",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n                    <p class="status-msg" title="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.status_message),typeof i===f?i.apply(e):i))+'">\n                        ',s={hash:{},data:t},r+=l((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.status_message),25,s):c.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.status_message),25,s)))+"\n                    </p>\n                    ",r}function d(e,t){var r="",i,s;return r+='\n                    <p class="status-msg no-status">\n                        ',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"user.no_status_message",s):c.call(e,"t","user.no_status_message",s)))+"\n                    </p>\n                    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="section profile-section">\n    <a href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,a):c.call(t,"urlFor","show",t&&t.model,a)))+'" class="profile-picture">\n        <img src="',a={hash:{},data:i},s+=l((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.profile_image_url),5,a):c.call(t,"assetImage",(o=t&&t.model,o==null||o===!1?o:o.profile_image_url),5,a)))+'" alt="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===f?o.apply(t):o))+'" class="x-large"/>\n    </a>\n    <div class="profile-details">\n        <ul>\n            <li>\n                    ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.status_message),{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;return s+='\n            </li>\n            <li class="update-status-msg">\n                <p><a href="#">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.update_status",a):c.call(t,"t","user.update_status",a)))+' <i class="arrow next"></i></a></p>\n                <div class="update-status-form">\n                    <label>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.status_label",a):c.call(t,"t","user.status_label",a)))+'</label>\n                    <textarea class="status-input" placeholder="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.status_placeholder",a):c.call(t,"t","user.status_placeholder",a)))+'" name="user[status_message]" id="user_status">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.status_message),typeof o===f?o.apply(t):o))+'</textarea>\n                    <a class="update-status rfloat"><span>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.update",a):c.call(t,"t","user.update",a)))+'</span><i class="ui-inline-icon update-icon"></i></a>\n                </div>\n            </li>\n            <li>\n                <p class="upload-photo"><a href="#">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.upload_photo",a):c.call(t,"t","user.upload_photo",a)))+'</a></p>\n            </li>\n        </ul>\n    </div>\n</div>\n<div class="section">\n    <a href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,a):c.call(t,"urlFor","show",t&&t.model,a)))+'" class="profile-name" title="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===f?o.apply(t):o))+'">\n        <span class="first-name js-user-display-name">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===f?o.apply(t):o))+'</span>\n    </a>\n    <a href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,a):c.call(t,"urlFor","show",t&&t.model,a)))+'" class="view-profile">\n        ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.view_my_profile",a):c.call(t,"t","user.view_my_profile",a)))+"\n    </a>\n</div>",s})}),define("hbs!templates/home/profile_follow_unfollow",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<li class="activity-stats">\r\n    <p><a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"explore","followers","my_people",u):a.call(t,"url","explore","followers","my_people",u)))+'" class="follow_text">',u={hash:{count:(o=t&&t.total,o==null||o===!1?o:o.followers)},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"user.followers",u):a.call(t,"t","user.followers",u)))+'</a></p>\r\n    <p class="last"><a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"explore","following","my_people",u):a.call(t,"url","explore","following","my_people",u)))+'" class="idol_text">',u={hash:{count:(o=t&&t.total,o==null||o===!1?o:o.idols)},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"user.following",u):a.call(t,"t","user.following",u)))+"</a></p>\r\n</li>",s})}),define("views/home/profile_section",["jquery","underscore","tibbr","modules/dialog","views/users/upload_photo","hbs!templates/home/profile_section","hbs!templates/home/profile_follow_unfollow"],function(e,t,n,r,i,s,o){return n.View.extend({className:"profile-section",initialize:function(){this.bindTo(this.model.followers,"change",this.render),this.bindTo(n.currentUser.idols,"reset",this.updateStats,this),this.bindTo(n.currentUser.followers,"reset",this.updateStats,this)},render:function(){return this.$el.html(this.renderTemplate(s)),this.updateStats(),this.delegateEvents(),this.$("[placeholder]").simplePlaceholder(),this},events:{"click p.upload-photo":"uploadPhoto","click div.update-status-form a.update-status":"updateStatusMessage"},uploadPhoto:function(){return r.render(i,{model:this.model,dialog:{width:805,height:300}}),!1},updateStats:function(){var e=n.currentUser;this.$el.find(".activity-stats").remove(),this.$el.find(".profile-details ul").prepend(this.renderTemplate(o,{total:{idols:e.idols.total_entries,followers:e.followers.total_entries}}))},updateStatusMessage:function(e){var r=this,i=this.$("#user_status");i.prop("disabled",!0),i.val()===i.attr("placeholder")&&i.val("");var s=i.val();return r.$(".update-status-form label").append(spinner),this.model.action("","update",{data:{user:{status_message:i.val()}}}).done(function(){r.$("p.status-msg").attr("title",s),s===""?(r.$("p.status-msg").addClass("no-status").html(r.t("user.no_status_message")),n.IE&&r.$("#user_status").val(i.attr("placeholder"))):r.$("p.status-msg").removeClass("no-status").html(t.str.truncate(s,25))}).fail(function(e){r.alertError(e)}).always(function(){r.$(".update-status-form .spinner").remove(),i.prop("disabled",!1)}),!1}})}),define("modules/common/models/calendar",["underscore","tibbr","require/moment","./user"],function(e,t,n,r){var i=t.Model.extend({baseName:"calendars",defaults:{modelType:"Calendar"},initialize:function(){e.bindAll(this,"getFormattedDay","getFormattedNumberDate","getFormattedDateTime","postedAt","getFormattedTime","getStatusRsvp","setStatus","parseUsers","exportPath","start_date_month","start_day","start_date","duration","getImageUrl","getProfileUrl","getContent","getRichContent"),this.get("owner")&&(this.user=new r(this.get("owner")))},getFormattedDay:function(){var e=this.get("start_date_time").split("-");return this.t("defaults.date.monthsShort")[e[1]-1]},getFormattedNumberDate:function(){return this.get("start_date_time").split("-")[2].match(/\d{2}/)},getFormattedDateTime:function(){return this.displayDate(n,"start_date_time")},postedAt:function(){return this.displayDate(n,"created_at")},endDate:function(){var e=n(this.get("start_date_time")),r=this.get("duration"),i=parseInt(r.split(":")[0])*60,s=parseInt(r.split(":")[1]),o=i+s;return e.add("minutes",o).utc().add("minutes",t.currentUser.get("time_zone_offset"))},getFormattedTime:function(){var e=this.get("duration").split(":");if(e.length<=1)return this.t("calendar.zero_and_zero_min");var t=e[0].toString()==="00"?this.t("calendar.formatted_min",{min:e[1]}):this.t("calendar.formatted_time",{hr:e[0],min:e[1]});return t},getStatusRsvp:function(){var t=this.id,n=this.get("current_user_status"),r=e.map(["attending","not_attending","may_be_attending"],function(e){var r="";return n===e&&(r="checked='checked'"),{value:e,checked:r,calId:t,status:this.status(e)}},this);return r},setStatus:function(){return this.status(this.get("current_user_status")||"none")},status:function(e){return{may_be_attending:this.t("calendar.may_be_attending"),attending:this.t("calendar.attending"),not_attending:this.t("calendar.not_attending"),none:this.t("calendar.not_responded_yet")}[e]},parseUsers:function(){var t=this.get("calendar_users")||[],n=e.filter(t,function(e){return e.status==="attending"}),r=e.filter(t,function(e){return e.status==="may_be_attending"}),i=e.filter(t,function(e){return e.status==="not_attending"});return[n,r,i]},callRsvp:function(e){return this.action("create_rsvp","update",{data:{params:{id:this.id,status:e}}})},exportPath:function(){return this._path("calendars/"+this.id+"/export.ics")},start_date_month:function(){return n(this.get("start_date_time")).format("MMM")},start_day:function(){return n(this.get("start_date_time")).format("DD")},start_date:function(){return n(this.get("start_date_time")).format("dddd, MMM DD h:mm A")},getImageUrl:function(e){return this._path("users/"+e+"/profile_image")},getProfileUrl:function(e){return this._url("users/"+e+"/profile")},duration:function(){},getContent:function(n){var r=this.get("message_content"),n=n||200;if(r.length<n)return t.Helper.autoLink(r.replace(/\n/g,"<br>"));var i=e.str.stripTags(r);return e.str.prune(t.Helper.autoLink(i),n).replace(/\n/g,"<br>")},for_template:{formattedDay:"getFormattedDay",formattedNumberDate:"getFormattedNumberDate",formattedDateTime:"getFormattedDateTime",formattedTime:"getFormattedTime",setStatus:"setStatus",statusRsvp:"getStatusRsvp",exportPath:"exportPath",start_day:"start_day",start_date_month:"start_date_month",more_info:function(){return this.get("more_info").replace(/\n/g,"<br>")},shortContent:function(){return this.getContent(30)}}});return e.extend(i.prototype,t.Modules.Model.RichContent),t.Calendar=i}),define("modules/common/models/question_option",["underscore","tibbr","../collections/users"],function(e,t,n){return t.Model.extend({defaults:{modelType:"QuestionOption"},initialize:function(){e.bindAll(this)},hasSelected:function(){return e.str.include(this.get("actions"),"unselect")}})}),define("modules/common/collections/question_options",["tibbr","../models/question_option"],function(e,t){return e.Collection.extend({className:"question_options",model:t})}),define("modules/common/models/question",["underscore","tibbr","../collections/question_options","../collections/users","require/moment"],function(e,t,n,r,i){return t.Model.extend({baseName:"questions",initialize:function(){e.bindAll(this,"voteOption","optionsAndVote","getTotalVotes","addMoreOption","checkExpiryDate","getTime","getFormattedDate","update","getOptionUsers","expiryDate"),this.parse(this.attributes)},parse:function(e){return this.question_options=new n(e.question_options),e},optionsAndVote:function(){var e;return this.question_options.length>0&&(e=this.question_options.max(function(e){return parseInt(e.get("option_users_count"))})),[e,this.totalVotes()]},voteOption:function(e,t){var n=this;return this.action(e,"update",{data:{params:{question_option_id:t.id,set_actions:!0}}}).fail(function(e){n.trigger("error",n.parseError(e),e.status)})},addMoreOption:function(e){var t=this;this.action("add_question_option","update",{data:{params:{question_option:{option_label:e},set_actions:!0}},success:function(){},error:function(e){t.trigger("error",t.parseError(e))}})},getOptionUsers:function(e){var t=this;this.action("get_option_users","read",{data:{params:{question_options_id:e,per_page:10,set_actions:!0}},success:function(e,n){t.trigger("question:option:users",n)}})},getTotalVotes:function(e){var t=0;return this.question_options.map(function(n){n.get("question_id")===e&&(t+=parseInt(n.get("option_users_count")))}),t},totalVotes:function(){var e=0;return this.question_options.each(function(t){e+=parseInt(t.get("option_users_count"))}),e},update:function(e){var t=this;this.action("","update",{data:{question:{expires_at:e},params:{set_actions:!0}},success:function(){t.trigger("change:closeOverlay")}})},getTime:function(){var e=this.get("expires_at").toDateArray();return e[3]+":"+e[4]},getFormattedDate:function(){var e=this.get("expires_at").toDateArray();return e[0]+"-"+e[1]+"-"+e[2]},checkExpiryDate:function(){return this.get("is_active")===!1},expiryDate:function(){return this.displayDate(i,"expires_at","DDDDDDD")},for_template:{formattedDate:"getFormattedDate",time:"getTime"}})}),define("modules/common/collections/subjects",["tibbr","modules/common/models/subject"],function(e,t){return e.Collection.extend({className:"subjects",tibbrURL:{controller:"subjects",action:"parents"},model:t,load:function(e){var t=this.fetch({data:{params:{page:"1",per_page:"10"}},success:function(){e()}});return t}})}),define("modules/common/collections/resources",["jquery","tibbr","../models/resource"],function(e,t,n){return t.Collection.extend({className:"resources",tibbrURL:{controller:"resources",action:"search"},model:n})}),define("modules/common/models/message",["jquery","underscore","tibbr","backbone","modules/dialog","./user","./geo_location","./calendar","./question","./resource_action","../collections/users","../collections/subjects","../collections/og_files","../collections/links","../collections/replies","../collections/resources","require/moment"],function Message(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){var Message=n.Model.extend({baseName:"messages",excludeActions:["msg_reply","like","star","unlike","unstar"],defaults:{modelType:"Message",user:null,links:[],assets:[],like_to:[],subjects:[],messages:[],resource:null},initialize:function(){t.bindAll(this,"build","postedTo","postedAt","showUrl","numberOfReplies","hasLikes","like","actions","hasStar","isParent","hasGeoMap","getMessageType","getContent","getMentionUrl","getRichContent","states","isUnread","setAnnouncement","menuActions","displaySubjectActions","setSubjectAction","canDelete","signature"),this.mainMenu=["share","manage"],this.shareActions=["share","email","copy_link"],this.appsActions=[];try{this.messageApps=n.currentUser.subscribedFilters.messages()}catch(e){this.messageApps=[]}n.currentUser.meetings=n.currentUser.meetings||[],(this.messageApps.length>0||n.currentUser.meetings.length>0)&&this.mainMenu.push("apps"),n.currentUser.meetings.length>0&&this.appsActions.push("create_meeting"),this.build()},isBroadCast:function(){return this.subjects.detect(function(e){return e.get("scope")==="broadcast"})},isClosed:function(){return this.get("closed")},canReply:function(){return t.str.include(this.get("actions"),"msg_reply")},canLike:function(){return!this.isClosed()},actions:function(){var e=[];return this.get("mtype")!=="chat"&&!this.isBroadCast()&&e.push("add"),this.get("user_id")==n.currentUser.id&&this.get("msg_type")==="question"&&e.push("extend_poll"),this.get("user_id")==n.currentUser.id&&this.get("msg_type")==="calendar"&&e.push("update_calendar"),t.union(e,t.difference(this.get("actions").split(","),this.excludeActions))},menuActions:function(){return e.grep(this.actions()||[],function(e){return e!="subject_announcement"&&e!="remove_global_announcement"&&e!="remove_subject_announcement"})},displaySubjectActions:function(){var e=this.actions(),n,r;return n=t.difference(e,["global_announcement","subject_announcement","remove_global_announcement","remove_subject_announcement"]),r=t.indexOf(e,"subject_announcement")>-1&&t.indexOf(e,"global_announcement")>-1,r?n.push("subject_announcement"):t.indexOf(e,"subject_announcement")>-1?n.push("subject_announcement"):t.indexOf(e,"global_announcement")>-1&&n.push("global_announcement"),t.compact(n)},setSubjectAction:function(){var e=this.actions();t.include(e,"remove_subject_announcement")||t.include(e,"subject_announcement")||this.set("actions",this.get("actions")+",subject_announcement")},customActions:function(){return t.select(n.appConfig("ui_config","config","message","more_actions"),function(e){return e.enable===!0})},states:function(){return t.unique((this.get("states")||"").split(","))},replies:function(){return this.messages||new d(t.clone(this.get("messages")),{tibbrURL:"messages/<scopeId>/replies",scopeId:this.id,per_page:10,replies_count:this.get("replies_count"),hasMorePages:this.get("replies_count")>this.get("messages").length,dataParams:{per_page:10,page:1}})},canDelete:function(){return t.str.contains(this.get("actions"),"delete")},copyUrl:function(){return n.url("messages/"+this.id,{host:n.host(),gadget:!1})},isUnread:function(e){return e=e||n.currentUser.recentReadMessageID,this.collection&&this.collection.className!="WallMessages"&&this.collection.className!=="PrivateMessages"&&this.collection.className!=="VIPMessages"?!1:this.get("user_id")!==n.currentUser.id&&this.id>e},hasUnreadReply:function(e){return this.replies().detect(function(t){return t.isUnread(e)})!==undefined},markAsRead:function(e){this.identifyLastestMessageId()>n.currentUser.lastReadMessageID&&n.currentUser.set_last_read_message(this.identifyLastestMessageId(),this.get("sort_id"),e)},identifyLastestMessageId:function(){var e=this.replies().pluck("id");return e.unshift(this.id),t.max(e)},hasStar:function(){return this.get("actions").match(/unstar/)},isParent:function(){return!this.get("parent_id",null)},postedTo:function(){return(this.subjects||[]).map(function(e){var t=e.get("stype")==="system"?"people":"subject";return{icon:t,name:e.get("display_name"),url:e.showUrl(),id:e.id}})},postedWith:function(){var e=this.subjects;if(this._postedWith)return this._postedWith;var r=[],i=[],o=function(e){if(e.get("name").match(/^_eog_resources/))return{};var n=e.isUser(),r=n?e.userShowProfileUrl(e.get("user_id")):e.showUrl(),i=n?"people":"subject",o=e._display_name;if(n){var u=t.clone(e.attributes);u.id=e.get("user_id"),u.display_name=e._display_name,u.profile_image_url=u.subject_image_url,delete u.modelType,delete u.subject_image_url,delete u.json_class,e=new s(u)}return e.get("deleted")&&(r="javascript:void(0)"),{name:o,url:r,image:e.image(1),icon:i,login:e.get("name"),model:e,isUser:n}};return e.each(function(e){r.length<2?r.push(e):i.push(e)}),this._postedWith={},r.length===0&&i.length>0&&(r.push(i[0]),i=i.slice(1,i.length)),r=t.map(r,function(e){return o(e)}),i=t.map(i,function(e){return o(e)}),this.get("hidden_subjects_count")>0&&i.push({name:n.translate("message.post_to_hidden_subject",{count:this.get("hidden_subjects_count")}),url:null,image:null,user:!1}),this._postedWith.knowList=t.sortBy(r,function(e){return!e.user}),this._postedWith.unKnownList=t.sortBy(i,function(e){return!e.user}),this._postedWith},postedAt:function(){return this.displayDate(m)},getMessageType:function(){return this.get("msg_type")},numberOfReplies:function(){return this.get("replies_count")},showUrl:function(){return this._url("messages/"+this.id)},like:function(){var e=this,t=this.get("likes_count");return this.get("is_liked_by_current_user")?this.action("unlike","delete",{setModel:!1}).done(function(){e.set({likes_count:t-1,is_liked_by_current_user:!1})}):this.action("like","update",{setModel:!1}).done(function(){e.set({likes_count:t+1,is_liked_by_current_user:!0})})},hasLikes:function(){return this.get("like_to").length>0},mute:function(e){var t=this;e=e||"mute",this.action(e,"update",{complete:function(n){n.status===200&&(e==="unmute"?t.set("actions",t.get("actions").replace("unmute","mute")):t.set("actions",t.get("actions").replace("mute","unmute")),t.trigger("message:"+e,this))},setModel:!1}).done(function(){n.pub(e,{Message:t.id})})},unmute:function(){this.mute("unmute")},hasGeoMap:function(){return this.geo_location!==undefined},signature:function(){if(n.appConfig("webui","config","signature")){var e=this.get("signature");return t.isObject(e)?e.line:""}return""},hasCommunity:function(){return n.currentUser.communities.length>0&&!n.gadget},build:function(){this.get("user")&&(this.user=new s(this.get("user"))),this.subjects=new c(this.get("subjects")),this.links=new p(this.get("links")),this.messages=null,this.messages=this.replies(),this.get("calendar")&&(this.calendar=new u(this.get("calendar"))),this.get("question")&&(this.question=new a(this.get("question"))),this.get("geo_location")&&n.maps.enabled&&(this.geo_location=new o(this.get("geo_location"))),this.get("eog_action")&&(this.eog_action=new f(this.get("eog_action"))),this.get("embedded_message")&&(this.embeddedMessage=new Message(this.get("embedded_message"))),this.get("private_message")&&(this.shareActions=t.without(this.shareActions,"share"))},parseResources:function(){if(this.assets)return;var e=this.get("resources"),n=t.where(e,{type:"og:file"})||[],r=t.reject(e,{type:"og:file"})||[];this.assets=(new h)._set(n),this.resources=(new v)._set(r)},addSubjects:function(e){var t=this;return this.callForAction("add_subjects","update",{silent:!0,data:{params:{subject_ids:e}}}).done(function(e){t.trigger("addSubject:done",e)})},removeSubjects:function(e){var t=this;return this.callForAction("remove_subjects","update",{silent:!0,data:{params:{subject_ids:e}}}).fail(function(e,r,i){t.trigger("removeSubjects:error",n.Modules.Error.parse(e))}).done(function(e){t.trigger("removeSubjects:done",e)})},update:function(e){var n=this,r=t.clone(this.get("actions"));return this.action("","update",{data:e,success:function(e,t){t.actions=r,n.attributes=t,n.build()}})},createConference:function(e,t,n,r,i,s,o){var u=this;return this.action("create_conference","create",{data:{params:{users:e,format:t,agenda:n,emails:i,conf_type:s,subjects:o}},error:function(e){console.log("failed")},success:function(e,t){u.trigger("meeting:created",t)}})},all_errors:function(e){var n="";return t.each(e,function(e){n+="<br/>"+e}),n},getUserUrl:function(){if(this.get("user"))return this._url("users/"+this.get("user").id)},getIconClass:function(e){return e=e||this.get("application_definition_name"),e.replace(/®/g,"").split(" ")[0].toLowerCase()},getContent:function(e){var r=this.get("content"),i=e?this._url("messages/"+this.get("id")):"#",s=200,o=" &nbsp;<a class='continued' href='"+i+"'>"+n.translate("message.continued")+"</a>";if(r.length<s)return n.Helper.autoLink(r.replace(/\n/g,"<br>"));var u=t.str.prune(n.Helper.autoLink(r),s,o);return u===o&&(u=t.str.truncate(n.Helper.autoLink(r),s,o)),u.replace(/\n/g,"<br>")},setAnnouncement:function(e,r,i){var s=this,o=i,u=this.actions();return this.action("set_announcement","update",{setModel:!1,data:{announcement:{subject_id:i,announcement_type:e,days:r}}}).done(function(){s.set("actions",t.without(u,e+"_announcement").join(",")),n.Event.trigger("announcement:change",{subjectId:o})})},meetingResource:function(){return this.resources||this.parseResources(),this.resources.detect(function(e){return e.get("type")==="og:meeting"})},for_template:{numberOfReplies:"numberOfReplies",getIconClass:"getIconClass",getRichContent:"getRichContent",isClosed:"isClosed",signature:"signature",postedWith:"postedWith",hasCommunity:"hasCommunity",hasGeoMap:"hasGeoMap",postedAt:"postedAt",meeting:function(){var e=this.meetingResource();return e?e.forTemplate():!1}}});return t.extend(Message.prototype,n.Modules.Model.RichContent),n.Message=Message}),define("models/message",["underscore","tibbr","modules/common/models/message"],function(e,t,n){return n.extend({})}),define("collections/messages",["jquery","underscore","tibbr","models/message"],function(e,t,n,r){return n.Collection.extend({className:"messages",tibbrURL:{controller:"users",action:"messages"},model:r,type:null,data:function(e){e=e||{},this.msgTypes=this.msgTypes||e.msgTypes;var t={page:(this.current_page||0)+1,set_actions:!0,per_page:this.per_page,user_id:this.userId||this.scopeId,like_by:e.like_by,include_replies:e.include_replies,start_after:this.startAfter,sort_id_less_than:this.startAfter,msg_types:this.msgTypes,subject_id:this.subjectId(),only_actions:"like,msg_reply,reply,star",wall_message_type:this.options.wall_type};return e.user_profile&&(delete e.user_profile,delete t.user_id),this.type&&(t.include_wall_message_types=this.type),t},subjectId:function(){},load:function(e){var n={data:{params:this.data(e)}};return e&&(n=t.extend(n,e)),n.cacheKey="current_user:"+this.className,n.expire_after="30.seconds",this.getOrFetch(n)},getMoreMessages:function(e){var t=this.data(e);t.per_page=this.scroll_per_page,this.fetch({data:{params:t}})},getLatestUnreadMessage:function(e){e=t.isUndefined(e)?!0:e;var n=this.filter(function(e){return e.getMessageType()!="question"||!!e.isUnread()||!!e.hasUnreadReply()});return e?t.first(n):t.last(n)}})}),define("collections/private_messages",["jquery","tibbr","collections/messages"],function(e,t,n){return n.extend({className:"private_messages",tibbrURL:{controller:"users",action:"private_messages"}})}),define("modules/common/collections/cache",["tibbr"],function(e){return e.Collection.extend({initialize:function(t,n){this._super(t,n),this.cid=_.uniqueId("collection-"),e.Event.bindTo(this,"model:change",this.expireCache),e.Event.bindTo(this,"message:created",this.expireCache),e.Event.bindTo(this,"reply:created",this.expireCache),this.refresh=!1,this.self=_.clone(this)},expireCache:function(){this.refresh=!0},updateModel:function(e){var t=this.self.get(e.id);return t&&t.get("modelType")===e.get("modelType")&&(this.self.remove(t,{silent:!0}),this.self.unshift(e,{silent:!0})),this.self},canAdd:function(e){return this.className==="WallMessages"||this.className==="PrivateMessage"&&e.get("private")===!0},addModel:function(e){return this.canAdd(e)&&(this.self.unshift(e,{silent:!0}),this.self.total_entries+=1),this.self},needRefresh:function(){var t=e.currentUser.get("badges");return this.refresh=this.refresh||t.has_messages_since,t.private_unread>0&&this.className==="PrivateMessage"||t.vip_unread>0&&this.className==="VIPMessages"||t.unread>0&&this.className==="WallMessages"?!0:!(this.self.length>0)||this.self.total_entries>this.per_page&&this.self.length<this.per_page},load:function(e){this.self=_.clone(this);var t=$.Deferred(),n=this,r=this.needRefresh();return console.log("need",!r),!r&&this.refresh!==!0?(this.self.each(function(e){e.get("states")==="unread"&&e.set("states","read",{silent:!0})}),t.resolve(this.self)):(console.log("fetching"),e.data.params.page=1,this.fetch(e).done(function(){n.self=_.clone(n),t.resolve(n.self)}).fail(function(e){t.reject(e)})),this.refresh=!1,t.promise()},getMoreMessages:function(e){var t=this.data(e);return t.per_page=this.scroll_per_page,this.globalLoading=!1,this.fetch({data:{params:t}})},cleanEvent:function(){e.Event.unbindFor(this)}})}),define("collections/wall_messages",["jquery","underscore","tibbr","modules/common/collections/cache","models/message"],function(e,t,n,r,i){return r.extend({initialize:function(e,t){this._super(e,t)},className:"WallMessages",tibbrURL:{controller:"users",action:"messages"},model:i,type:null,data:function(e){e=e||{},this.msgTypes=this.msgTypes||e.msgTypes;var t={page:1,per_page:5,set_actions:!0,user_id:this.userId||this.scopeId,like_by:e.like_by,include_replies:e.include_replies,start_after:this.startAfter,sort_id_less_than:this.startAfter,msg_types:this.msgTypes,subject_id:this.subjectId(),only_actions:"like,msg_reply,star",wall_message_type:this.options.wall_type};return e.user_profile&&(delete e.user_profile,delete t.user_id),this.type&&(t.include_wall_message_types=this.type),t},subjectId:function(){},load:function(e){var r={data:{params:this.data(e)}};return e&&(r=t.extend(r,e)),this._super(r).done(function(e){try{n.badgesSince=e.first().get("sort_id")}catch(t){n.badgesSince=0}})},getLatestUnreadMessage:function(e){e=t.isUndefined(e)?!0:e;var n=this.filter(function(e){return e.getMessageType()!="question"||!!e.isUnread()||!!e.hasUnreadReply()});return e?t.first(n):t.last(n)}})}),define("collections/chat_messages",["jquery","tibbr","collections/messages"],function(e,t,n){return n.extend({className:"chat_messages",tibbrURL:{controller:"users",action:"subject_messages"},subjectId:function(){return t.currentUser.get("chat_subject_name")}})}),define("collections/star_messages",["jquery","tibbr","collections/messages"],function(e,t,n){return n.extend({className:"starred_messages",tibbrURL:{controller:"users",action:"starred_messages"}})}),define("collections/question_messages",["jquery","tibbr","collections/messages"],function(e,t,n){return n.extend({className:"question_messages",tibbrURL:{controller:"users",action:"question_messages"},load:function(e){var t={data:{params:{page:(this.current_page||0)+1,set_actions:!0,per_page:this.per_page,start_after:this.startAfter,sort_id_less_than:this.startAfter}}};return e&&(t=_.extend(t,e)),this.fetch(t)}})}),define("collections/all_messages",["jquery","underscore","tibbr","collections/messages"],function(e,t,n,r){return r.extend({className:"all_messages",tibbrURL:{controller:"users",action:"message_search"},data:function(){var e=this.__params||{},t={page:this.startAfter?1:(this.current_page||0)+1,set_actions:!0,per_page:this.per_page,user_id:e.user_id||this.user_id,exclude_mtype:e.exclude_mtype||["chat"],search_str:e.search_str||"",include_replies:e.include_replies,start_after:this.startAfter,sort_id_less_than:this.startAfter,msg_type:e.msgType,only_actions:"like,msg_reply,reply,star",advanced_search_options:{messages_greater_than:e.messages_greater_than,messages_less_than:e.messages_less_than,msg_type:e.msg_type||e.msgTypes,mtypes:e.mtypes,subject_ids:e.subject_ids,user_ids:e.user_ids,messages_timeline:e.messages_timeline}};return this.scope==="public"&&(t.scope="public"),t},load:function(e){this.__params=e||{};var n={data:{params:this.data()}};return n=t.extend(n,e),n.cacheKey=this.className+":message_search",n.expire_after="30.seconds",n.cache=e.cache,delete e.cache,this.getOrFetch(n)},getLatestUnreadMessage:function(e){e=t.isUndefined(e)?!0:e;var n=this.filter(function(e){return e.getMessageType()!="question"||!!e.isUnread()||!!e.hasUnreadReply()});return e?t.first(n):t.last(n)}})}),define("collections/message_search",["jquery","underscore","tibbr","models/message"],function(e,t,n,r){return n.Collection.extend({className:"stream-event",tibbrURL:{controller:"users",action:"message_search"},model:r,load:function(e){e=e||{},this.filterID=e.id,this.msgType=e.msgType||e.msgTypes,this.subjectIds=e.subjectIds||[],this.userIds=e.userIds||[],this.hashTags=this.hashTags||e.hashTags,delete e.id,delete e.msgType,delete e.msgTypes,delete e.subjectIds,delete e.userIds,delete e.hashTags;var n={data:{params:{page:(this.current_page||0)+1,start_after:this.startAfter,sort_id_less_than:this.startAfter,message_filter_id:this.filterID,set_actions:!0,per_page:this.per_page,hash_tags:this.hashTags,include_replies:!t.isUndefined(this.hashTags),advanced_search_options:{msg_type:this.msgType,user_ids:this.user_ids,subject_ids:this.subjectIds}}}};return e&&(n=t.extend(n,e)),this.fetch(n)},getMoreMessages:function(){this.fetch({data:{params:{page:this.startAfter?1:this.current_page+1,per_page:this.per_page,start_after:this.startAfter,sort_id_less_than:this.startAfter,message_filter_id:this.filterID,msg_type:this.msgType,set_actions:!0,hash_tags:this.hashTags,include_replies:!t.isUndefined(this.hashTags),advanced_search_options:{msg_type:this.msgType,user_ids:this.user_ids,subject_ids:this.subjectIds}}}})},fetchResult:function(e,t,n,r,i,s,o){this.fetch({data:{params:{page:(this.current_page||0)+1,set_actions:!0,per_page:10,include_replies:!0,search_str:e,advanced_search_options:{messages_greater_than:t,messages_less_than:n,msg_type:r,mtypes:i,subject_ids:s,user_ids:o}}}})},getLatestUnreadMessage:function(e){e=t.isUndefined(e)?!0:e;var n=this.filter(function(e){return e.getMessageType()!="question"||!!e.isUnread()||!!e.hasUnreadReply()});return e?t.first(n):t.last(n)}})}),define("collections/recent_messages",["jquery","underscore","tibbr","collections/messages"],function(e,t,n,r){return r.extend({className:"recent_messages",tibbrURL:{controller:"users",action:"recent_messages"}})}),define("collections/mentioned_messages",["jquery","underscore","tibbr","collections/messages"],function(e,t,n,r){return r.extend({className:"mentioned_messages",tibbrURL:{controller:"users",action:"mentioned_messages"}})}),define("modules/common/views/common/wall_filters",["jquery","underscore","backbone","tibbr","collections/messages","collections/private_messages","collections/wall_messages","collections/chat_messages","collections/star_messages","collections/question_messages","collections/all_messages","collections/message_search","collections/recent_messages","collections/mentioned_messages"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return r.View.extend({fetchMessageType:function(e){var n,d=e.filter,v="all:post",m=e.id;switch(m){case"private":d?n=new s:n=r.currentUser.privateMessages||(r.currentUser.privateMessages=new o([],{className:"PrivateMessages",scopeId:r.currentUser.id,tibbrURL:"users/<scopeId>/private_messages"})),v="private:post";break;case"chat":n=new u;break;case"star":n=new a;break;case"question":n=new f;break;case"all_post":n=new l([],{scope:"public"});break;case"my_post":n=new l([],{user_id:r.currentUser.id,className:"my_posts"});break;case"my_wall":d?n=new i:n=r.currentUser.messages;break;case"recent":n=new h;break;case"mention":d?n=new p:n=r.currentUser.mentionedMessages||(r.currentUser.mentionedMessages=new o([],{className:"MentionedMessages",scopeId:r.currentUser.id,tibbrURL:"users/<scopeId>/mentioned_messages"}));break;case"vip":d?n=new i([],{wall_type:"vip_messages",className:"VIPMessages"}):n=r.currentUser.vipMessages;break;case"hash":n=new c([],{hashTags:e.param1||""});break;case"global_announcement":n=new l([],{tibbrURL:{controller:"users",action:"global_announcements"}});break;default:if(!t.isNaN(parseInt(e.id)))n=new c;else{n=new i;var g=r.currentUser.subscribedFilters.detect(function(t){return t.appName()===e.id});n.type=g.get("mtypes")}}r.Event.trigger(v),n.scopeId=r.currentUser.id,this.collection=n;var y={};return m!=="hash"&&(y={id:e.id,msgTypes:d,cache:e.cache}),n.load(y).done(function(){r.pub(n.className.toLowerCase())})}})}),define("modules/tags/select",["jquery","underscore","tibbr","require/qtip"],function(e,t,n,r){return n.View.extend({version:1,className:"custom-dropdown-container",attributes:{style:"display:inline"},tmpl:'<p class="js-header">{{header}}</p>             <a href="#" class="{{default_item_class}} js-default-value">            {{#if icon}}<i class="ui-inline-icon {{icon}}"></i>{{/if}}            {{#if default_value}}<span class="link" title="{{title}}">{{{ default_value}}}</span>            <i class="arrow down"></i> {{/if}}            </a><ul class="js-dropdown {{list_class}} hidden"></ul>',itemTmp:'<li class="{{uid}} {{this.className}}">            <a title="{{this.title}}">            {{#if this._icon}}            <i class="ui-inline-icon {{this._icon}} js-icon"></i>            {{/if}}            <span>{{{text}}}</span></a>            </li>',initialize:function(n){this.tmpl=n.tmpl||this.tmpl,this.itemTmp=n.itemTmp||this.itemTmp,this.selectedOptionHide=t.isUndefined(n.selectedOptionHide)?!0:n.selectedOptionHide,this.selectedOptionCheck=t.isUndefined(n.selectedOptionCheck)?!this.selectedOptionHide:n.selectedOptionCheck,this.selectedIcon=n.selectedIcon||'<i class="ui-inline-icon check-icon rfloat"></i>',this.updateDefault=t.isUndefined(n.updateDefault)?!0:n.updateDefault,this.onclickHide=t.isUndefined(n.onclickHide)?!0:n.onclickHide,this.addDefaultToList=t.isUndefined(n.addDefaultToList)?!0:n.addDefaultToList,this.onDefaultValueChange=n.onDefaultValueChange||e.noop,this.onItemChecked=n.onItemChecked||e.noop,this.beforeRender=n.beforeRender||this.deferredFunction,this.onShow=n.onShow||e.noop,this.onHide=n.onHide||e.noop,this.qtipOptions=this.options.qtip||{}},events:{"click a.js-default-value":"hideMe"},deferredFunction:function(){var t=e.Deferred();return t.resolve(this.items),t.promise()},hideMe:function(){this._open&&(this.$(".js-default-value").qtip("hide"),this._open=!1)},render:function(){var e=this.options||[],n=e.options||[],r=this.defaultOption=e.defaultOption||{},i=t.detect(n,function(e){return e.selected===!0}),s=i||e.defaultOption||n[0];return!t.isEmpty(r)&&this.updateDefault&&this.addDefaultToList&&n.unshift(r),t.each(n,function(e){e.uid=e.uid||t.uniqueId("select")}),this.selectedOption=s,this.$el.append(this.renderInLineTemplate(this.tmpl,{default_value:s.text,title:s.title,icon:s.icon,default_item_class:s.className||this.options.defaultOptionClassName||"custom-select-box default-value mtm",storeKey:e.storeKey||"tibbr_tag_combo_box_tmp",list_class:e.listClassName||"custom-dropdown",header:e.header,data:s})),this.items=n,this.bind(),t.isUndefined(e.header)&&this.$(".js-header").remove(),this},reset:function(){this.$(".js-default-value").qtip().rendered=!1},resetItems:function(e,n,r){e=e||[],n=n||!1,t.each(e,function(e){e.uid=t.uniqueId("select")}),this.items=e;var i=this.defaultOption;i&&this.addDefaultToList&&this.items.unshift(i),this.$("ul.js-dropdown").empty(),this.addItem(this.items);var s=t.detect(e,function(e){return e.selected===!0}),o=this.$(".js-default-value").qtip("api"),u=s||i;return o.rendered=!1,o.render(),u&&(this.setDefaultValue(u),n||this.trigger("change",u,this.$("ul.js-dropdown").find("li."+u.uid+" > a"))),t.isFunction(r)&&r(this),this},setDefaultValue:function(e){this.selectedOption=e,this.updateDefault&&(e.icon&&this.$(".js-default-value").find("> .ui-inline-icon").remove().end().append('<i class="ui-inline-icon  '+e.icon+'"></i>'),this.options.tmpl||this.$(".js-default-value > span").html(e.text),this.onDefaultValueChange(e,this.$(".js-default-value")))},addItem:function(e){t.isArray(e)?t.each(e,function(e){this._addItem(e)},this):t.isObject(e)&&this._addItem(e)},_addItem:function(n){n=n||{},n.storeKey=n.storeKey||"tibbr_tag_combo_box_item_tmp",n.title=n.title||n.text,n.value=t.isUndefined(n.value)?n.text:n.value,n._icon=n.checked&&n.checkedIcon?n.checkedIcon:n.icon;var r=e(this.renderInLineTemplate(this.itemTmp,n));r.find("a").data(n).addClass(n.className),this.$("ul.js-dropdown").append(r)},_updateItem:function(e){var n=this,r=n._$ul,i=e.find("a"),s=i.find("i"),o=i.data(),u=r.find("li."+o.uid).find("a"),a=u.find("i"),f=o.checkedIcon,l=s.hasClass(f),c=o.icon;return n.selectedOptionHide&&(r.find("li.hidden").removeClass("hidden"),e.addClass("hidden")),n.selectedOptionCheck&&t.isUndefined(f)&&(r.find("i.check-icon").remove(),i.append(n.selectedIcon),this.onItemChecked(e)),f&&(l?(s.removeClass(f).addClass(c),a.removeClass(f).addClass(c)):(s.removeClass(c).addClass(f),a.removeClass(c).addClass(f))),o.checked=!o.checked,i.data(o),u.data(o),o},_onShow:function(e,t){var n=this;n.onShow(e,t)},bind:function(){var r=this,i=this.qtipOptions,s=i.hide||{},o=i.show||{},u=i.style||{},a={x:0,y:0};t.isObject(i.adjust)&&(a.x=i.adjust.x===0?0:i.adjust.x,a.y=i.adjust.y===0?0:i.adjust.y),this.$(".js-default-value").qtip({position:i.position||{at:"bottom left",my:"top left",adjust:a},show:{event:o.event||"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:{event:s.event||"click unfocus",fixed:s.fixed||!1,delay:s.fixed?250:0},style:{classes:u.classes||r.options.qtipClassName||"custom-dropdown-tooltip qtip-light",tip:u.tip||!1},content:{text:n.UI.loader||spinner},events:{render:function(e,t){r.beforeRender().done(function(e){r.$("ul.js-dropdown > li").length===0&&r.addItem(e);var n=r.$("ul.js-dropdown").clone(!0).show();r._$ul=n,r.selectedOptionHide&&(n.find("li.hidden").removeClass("hidden"),n.find("li."+r.selectedOption.uid).addClass("hidden")),r.selectedOptionCheck&&(n.find("i.check-icon").remove(),n.find("li."+r.selectedOption.uid+" > a").append(r.selectedIcon)),t.set("content.text",n),r.options.setWidth&&t.set("style.width",r.$el.width()),r._onShow(t.elements.content,t)})},show:function(n,i){i.elements.content.on("click","a",function(n){var s=e(this),o=s.data();t.isUndefined(o.setDefault)&&r.setDefaultValue(o),o=r._updateItem(s.parent()),r.onclickHide===!0&&i.hide(),r.selected=o,r.trigger("change",o,r.$("ul.js-dropdown").find("li."+o.uid+" > a"))}),r._open=!0},hide:function(e,t){r.onHide(t.elements.content),t.elements.content.off("click","a"),r._open=!1}}}).click(function(e){e.preventDefault()})}})}),define("hbs!modules/common/templates/dialog/confirm",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n        <div class="media-box custom-input-box">\n            <div class="option-btn checkbox-btn">\n                <input type="checkbox"/>\n            </div>\n            <div class="input-option-label">\n                <label>\n                    ',s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"dialog.common.dont_show_again",s):a.call(e,"t","dialog.common.dont_show_again",s)))+"\n                </label>\n            </div>\n        </div>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function",c=this;s+="\n    <p>",(o=n.message)?o=o.call(t,{hash:{},data:i}):(o=t&&t.message,o=typeof o===l?o.call(t,{hash:{},data:i}):o);if(o||o===0)s+=o;s+='</p>\n    <div class="actions">\n        ',o=n["if"].call(t,t&&t.check,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='\n        <a  class="btn-link js-cancel">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"dialog.common.cancel",u):a.call(t,"t","dialog.common.cancel",u)))+'</a>\n        <a class="btn btn-submit done-btn js-ok">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"dialog.common.ok",u):a.call(t,"t","dialog.common.ok",u)))+"</a>\n    </div>\n",s})}),define("modules/common/views/dialog/confirm",["jquery","underscore","tibbr","modules/dialog","hbs!modules/common/templates/dialog/confirm"],function(e,t,n,r,i){return n.View.extend({className:"add-to-vip-dialog vip-dialog",initialize:function(){this.$el.append(this.renderTemplate(i,this.options)),this.$defered=e.Deferred(),this.options.hideCancel&&this.$(".js-cancel").hide()},ok:function(e){e.preventDefault();var n=this.options.ok;return t.isFunction(n)&&n(),this._close(),this.$defered.resolve()},cancel:function(e){e.preventDefault();var n=this.options.cancel;return t.isFunction(n)&&n(),this.$defered.reject()},_close:function(){this.closeDialog(),this.leave()},events:{"click a.js-cancel":"cancel","click a.js-ok":"ok"},show:function(){return r.render(this,{dialog:{title:this.options.title,width:500,className:"add-to-vip-dialog-wrap"}}),this.$defered.promise()}})}),define("hbs!modules/common/templates/common/follow_button",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n<span class="owner">',(i=n.text)?i=i.call(e,{hash:{},data:t}):(i=e&&e.text,i=typeof i===o?i.call(e,{hash:{},data:t}):i),r+=u(i)+"</span>\n",r}function l(e,t){var r="",i;return r+='\n<a class="follow-button js-action-button ',(i=n.css)?i=i.call(e,{hash:{},data:t}):(i=e&&e.css,i=typeof i===o?i.call(e,{hash:{},data:t}):i),r+=u(i)+'">\n    <span>',(i=n.text)?i=i.call(e,{hash:{},data:t}):(i=e&&e.text,i=typeof i===o?i.call(e,{hash:{},data:t}):i),r+=u(i)+'</span>\n    <i class="ui-inline-icon minus"></i>\n</a>\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.unless.call(t,t&&t.hasAction,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""})}),define("modules/common/views/common/follow_button",["jquery","underscore","tibbr","modules/dialog","modules/common/views/dialog/confirm","hbs!modules/common/templates/common/follow_button"],function(e,t,n,r,i,s){return n.View.extend({className:"button",events:{"click .js-action-button":"takeAction"},initialize:function(e){this.bindTo(this.model,"change",this.render,this)},render:function(){var e,r=this.model.get("modelType"),i=n.currentUser.id;if(r==="User"&&this.model.id===i)e="owner";else if(r==="Subject"&&!t.isEmpty(this.model.get("context_properties"))){var o=this.model.get("context_properties");e=o.owner?"owner":o.subscription_request_state}else if(r==="Subject"&&t.include(this.model.actions(),"subscribe")&&this.model.get("scope")==="protected")e="protected_subscribe";else if(r==="Subject"&&this.model.get("scope")==="broadcast")e="broadcast";else if(r==="Group"&&this.model.isCurrentUserOwner())e="owner";else if(r==="Resource"){var u=this.model.actions();!t.include(u,"unfollow")&&!t.include(u,"follow")?e="":t.include(u,"unfollow")&&t.include(u,"pause")?e="unfollow":e="follow"}else e=t.detect(this.model.actions(),function(e){return e==="subscribe"||e==="unsubscribe"||e==="follow"||e==="unfollow"||e==="pending"})||"";if(e){var a=this.getActionAndText(e);this.$el.html(this.renderTemplate(s,a)),this.options.showTips&&this.$(".js-action-button").attr("title",a.text).qtip(n.qtipConfigs.tipsy())}return this},getActionAndText:function(e){var t=this.model,n="follow",r="follow-btn",i=!0;switch(e){case"owner":t.get("modelType")!=="User"?n=this.t("common.actions."+e):n="  ",i=!1;break;case"pending":n=this.t("common.actions.waiting_for_approval"),i=!1;break;case"broadcast":n=this.t("common.actions.broadcast"),i=!1;break;case"protected_subscribe":n=this.t("common.actions.protected_subscribe"),e="subscribe";break;case"follow":case"subscribe":n=this.t("common.actions.follow");break;case"unfollow":case"unsubscribe":r="unfollow-btn",n=this.t("common.actions.unfollow");break;default:n="",i=!1}return this._currentAction=e,{text:n,hasAction:i,css:r,storeKey:"templates/common/follow_button"}},takeAction:function(e){var i=this,s=this.model.get("modelType"),o="takeActionFor"+s,u=this._currentAction;try{this[o](e);var a={};a[s]=this.model.id,t.delay(function(){n.pub(u,a)},1e3),this.$request&&this.$request.fail(function(e){r.alert({text:i.model.parseError(e)}),i.model.trigger("change")})}catch(f){console.log("FollowButtonView:TakeAction:",s,f)}return!1},takeActionForUser:function(t){var r=this._currentAction,i=this;r=r||"follow";var s=e(t.currentTarget),o=function(){i.$request=n.currentUser[r](i.model).done(function(){i.model.get("private_profile")&&r==="unfollow"&&n.redirectTo(i.model.urlFor("show"))}),n.tracker.trackSend("follow colleagues","Signup")};if(s.find(".spinner").length>0)return;return s.html(spinner),this.model.get("modelType")=="Group"?this.model[r]():this.model.isVip()&&r==="unfollow"?this.removeWithConfirm().always(function(){s.find(".spinner").remove()}).done(function(){o(),i.$request.done(function(){var t=i.model.get("modelType").toLowerCase();delete n.currentUser.vips[t+"_"+i.model.id],i.$("a.js-vip").removeClass("add-to-vip-link"),i.model.trigger("vip:updated",-1),e(document).trigger("vip:updated",["remove",i.model])})}):o(),!1},takeActionForGroup:function(e){return this.takeActionForUser(e)},takeActionForResource:function(t){var n=this,r=this._currentAction,i=e(t.currentTarget);r=r||"follow";if(i.find(".spinner").length>0)return;return i.parent().append(spinner),this.$request=this.model[r](r).always(function(){n.$(".spinner").hide()}),!1},takeActionForSubject:function(t){var r=this._currentAction,i=this;r=r||"subscribe";var s=e(t.currentTarget),o=function(){i.$request=n.currentUser[r](i.model).done(function(){i.model.get("scope")==="private"&&r==="unsubscribe"&&n.currentSubject&&n.redirectToHome(),i.model.get("scope")==="protected"&&n.currentSubject&&n.redirectTo(i.model.urlFor("show"))})};return s.find(".spinner").length>0?!1:(s.html(spinner),this.model.isVip()&&r==="unsubscribe"?this.removeWithConfirm().always(function(){s.find(".spinner").remove()}).done(function(){o(),i.$request.done(function(){var t=i.model.get("modelType").toLowerCase();delete n.currentUser.vips[t+"_"+i.model.id],i.$("a.js-vip").removeClass("add-to-vip-link"),i.model.trigger("vip:updated",-1),e(document).trigger("vip:updated",["remove",i.model])})}):o(),!1)},removeWithConfirm:function(){return(new i({title:this.t("vip.unfollow_vip_title"),message:this.t("vip.unfollow_vip_alert")})).show()}})}),define("hbs!modules/common/templates/common/add_vip",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+="\n        ",s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"vip.remove_vip",s):a.call(e,"t","vip.remove_vip",s)))+"\n    ",r}function h(e,t){var r="",i,s;return r+="\n        ",s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"vip.add_vip",s):a.call(e,"t","vip.add_vip",s)))+"\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<a class="btn btn-primary add-to-vip-link js-vip">\n    ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.isVip),{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;return s+="\n</a>",s})}),define("modules/common/views/common/add_vip",["jquery","underscore","tibbr","modules/common/views/dialog/confirm","hbs!modules/common/templates/common/add_vip"],function(e,t,n,r,i){return n.View.extend({className:"button",events:{"click .js-vip":"takeAction"},initialize:function(){},render:function(){var e=this.model.get("actions").split(",");return!t.include(e,"add_vip")&&!t.include(e,"remove_vip")?this:(this.$el.html(this.renderTemplate(i)),this)},takeAction:function(){var t=this,r=this.model.get("modelType").toLowerCase(),i={};i[r+"_ids"]=this.model.id,this.model.isVip()?n.currentUser.action("remove_vips","update",{setModel:!1,data:i}).done(function(){delete n.currentUser.vips[r+"_"+t.model.id],t.model.setAction("remove_vip","add_vip"),t.$("a.js-vip").removeClass("add-to-vip-link"),t.render(),t.model.trigger("vip:updated",-1),e(document).trigger("vip:updated",["remove",t.model])}):this.addWithConfirm()},addToVip:function(){var t=this,r=this.model.get("modelType").toLowerCase(),i={};i[r+"_ids"]=this.model.id,i.set_actions=!0,n.currentUser.action("add_vips","update",{setModel:!1,data:i}).done(function(i){n.currentUser.vips[r+"_"+t.model.id]=t.model.toJSON(),r==="user"?t.model.set("actions",i.users[0].actions):t.model.set("actions",i.subjects[0].actions),t.render(),t.model.trigger("vip:updated",1),e(document).trigger("vip:updated",["add",t.model])}).fail(function(e){t.alertError(e)})},addWithConfirm:function(){var e=this;t.include(this.model.actions(),"unfollow")?this.addToVip():this.model.get("modelType")==="Subject"&&this.model.isOwner()?this.addToVip():t.include(this.model.actions(),"pending")||this.model.get("private_profile")?(new r({title:this.t("vip.private_user_title"),message:this.t("vip.private_user_text"),hideCancel:!0,ok:function(){e.addToVip()}})).show():(new r({title:this.t("vip.add_vip_title"),message:this.t("vip.add_vip_alert"),ok:function(){e.addToVip()}})).show()}})}),define("hbs!modules/common/templates/common/user_profile",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n        <div class="ui-tooltip-title">'+l((r=(r=e&&e.model,r==null||r===!1?r:r.display_name),typeof r===f?r.apply(e):r))+"</div>\n    ",n}function d(e,t){var r="",i,s;return r+="<li><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.title",s):c.call(e,"t","home.title",s)))+'</label><span class="value">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===f?i.apply(e):i))+"</span></li> ",r}function v(e,t){var r="",i,s,o;r+="\n                    ",o={hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.company),"!==","",o):c.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.company),"!==","",o));if(s||s===0)r+=s;return r+="\n                ",r}function m(e,t){var r="",i,s;return r+="\n                        <li><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.company",s):c.call(e,"t","home.company",s)))+'</label><span class="value">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.company),typeof i===f?i.apply(e):i))+"</span></li>\n                    ",r}function g(e,t){var r="",i,s;return r+="\n                    <li><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.location",s):c.call(e,"t","home.location",s)))+'</label><span class="value">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.location),typeof i===f?i.apply(e):i))+"</span></li>\n                ",r}function y(e,t){var r="",i,s;return r+="<li><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.phone",s):c.call(e,"t","home.phone",s)))+'</label> <span class="value">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.phone),typeof i===f?i.apply(e):i))+"</span></li>",r}function b(e,t){var r="",i,s,o;r+="\n                    ",o={hash:{},inverse:h.noop,fn:h.program(13,w,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.email),"!==","",o):c.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.email),"!==","",o));if(s||s===0)r+=s;return r+="\n                ",r}function w(e,t){var r="",i,s;return r+="<li><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.email",s):c.call(e,"t","home.email",s)))+'</label><span class="value"><a href="mailto:'+l((i=(i=e&&e.model,i==null||i===!1?i:i.email),typeof i===f?i.apply(e):i))+'">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.email),typeof i===f?i.apply(e):i))+"</a></span></li>",r}function E(e,t){var r="",i,s;return r+='\n                <li style="padding-right:10px;">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.subscribers_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.followres",s):c.call(e,"t","home.followres",s)))+"</li>\n            ",r}function S(e,t){var r="",i,s;return r+='\n                <li style="padding-right:10px;">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.posts_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.posts",s):c.call(e,"t","home.posts",s)))+'</li>\n                <li class="js-follow-count" style="padding-right:10px;">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.followers_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.followres",s):c.call(e,"t","home.followres",s)))+"</li>\n            ",r}function x(e,t){var r="",i,s;return r+='\n                <li>\n                    <i class="status-icon ui-inline-icon '+l((i=(i=e&&e.model,i==null||i===!1?i:i.current_status),typeof i===f?i.apply(e):i))+'"></i>',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,e&&e.status,s):c.call(e,"t",e&&e.status,s)))+"\n                </li>\n            ",r}function T(e,t){var r="",i,s;return r+='\n                <div class="button">\n                    <a class="btn follow js-hierarchy" href="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.hierarchyUrl),typeof i===f?i.apply(e):i))+'">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.view_in_hierarchy",s):c.call(e,"t","home.view_in_hierarchy",s)))+"</a>\n                </div>\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<i class="ex-employee hidden">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"user.deleted",a):c.call(t,"t","user.deleted",a)))+'</i>\n<div class="my-hovercard user '+l((o=(o=t&&t.model,o==null||o===!1?o:o.modelType),typeof o===f?o.apply(t):o))+' clearfix">\n    <div class="status"> '+l((o=(o=t&&t.model,o==null||o===!1?o:o.status_message),typeof o===f?o.apply(t):o))+"</div>\n    ",a={hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.modelType),"===","Subject",a):c.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.modelType),"===","Subject",a));if(u||u===0)s+=u;s+='\n    <div class="media-box employee">\n        <a class="js-profile-pic profile-pic img-shadow" href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,a):c.call(t,"urlFor","show",t&&t.model,a)))+'">\n            <img alt="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===f?o.apply(t):o))+'" src="',a={hash:{},data:i},s+=l((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.profile_image_url),3,a):c.call(t,"assetImage",(o=t&&t.model,o==null||o===!1?o:o.profile_image_url),3,a)))+'" class="bordered-large large">\n        </a>\n        <div class="info">\n            <ul class="profile-details">\n                ',a={hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.title),"!==","",a):c.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.title),"!==","",a));if(u||u===0)s+=u;s+="\n                ",u=n["if"].call(t,t&&t.displayCompany,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n                ",a={hash:{},inverse:h.noop,fn:h.program(8,g,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.location),"!==","",a):c.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.location),"!==","",a));if(u||u===0)s+=u;s+="\n                ",a={hash:{},inverse:h.noop,fn:h.program(10,y,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.phone),"!==","",a):c.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.phone),"!==","",a));if(u||u===0)s+=u;s+="\n                ",u=n["if"].call(t,t&&t.displayEmail,{hash:{},inverse:h.noop,fn:h.program(12,b,i),data:i});if(u||u===0)s+=u;s+='\n            </ul>\n        </div>\n    </div>\n    <div class="media-box employee">\n        <ul class="inline-list stats">\n            ',a={hash:{},inverse:h.program(17,S,i),fn:h.program(15,E,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.modelType),"===","Subject",a):c.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.modelType),"===","Subject",a));if(u||u===0)s+=u;s+="\n            ",a={hash:{},inverse:h.noop,fn:h.program(19,x,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,t&&t.status,"!==","",a):c.call(t,"compare",t&&t.status,"!==","",a));if(u||u===0)s+=u;s+='\n        </ul>\n    </div>\n    <div class="action-links employee ">\n        <span class="action-button">\n            ',u=n["if"].call(t,t&&t.isHierarchy,{hash:{},inverse:h.noop,fn:h.program(21,T,i),data:i});if(u||u===0)s+=u;return s+="\n        </span>\n    </div>\n</div>",s})}),define("hbs!modules/common/templates/common/group_profile",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n        <a class="profile-pic img-shadow" href="',s={hash:{},data:t},r+=l((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):f.call(e,"urlFor","show",e&&e.model,s)))+'">\n            <img alt="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===c?i.apply(e):i))+'" src="',s={hash:{},data:t},r+=l((i=n.assetImage||e&&e.assetImage,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.profile_image_url),e&&e.medium,s):f.call(e,"assetImage",(i=e&&e.model,i==null||i===!1?i:i.profile_image_url),e&&e.medium,s)))+'" class="medium bordered-medium">\n        </a>\n        ',r}function d(e,t){var r="",i,s;return r+='\n        <span class="profile-pic img-shadow">\n            <img alt="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===c?i.apply(e):i))+'" src="',s={hash:{},data:t},r+=l((i=n.assetImage||e&&e.assetImage,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.profile_image_url),e&&e.medium,s):f.call(e,"assetImage",(i=e&&e.model,i==null||i===!1?i:i.profile_image_url),e&&e.medium,s)))+'" class="medium bordered-medium">\n        </span>\n        ',r}function v(e,t){var r="",i,s;return r+="<p class='description'><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.location",s):f.call(e,"t","home.location",s)))+'</label> <span class="value"> '+l((i=(i=e&&e.model,i==null||i===!1?i:i.location),typeof i===c?i.apply(e):i))+"</span></p> ",r}function m(e,t){var r="",i,s;return r+="<p class='description'><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.phone",s):f.call(e,"t","home.phone",s)))+'</label> <span class="value"> '+l((i=(i=e&&e.model,i==null||i===!1?i:i.phone),typeof i===c?i.apply(e):i))+"</span></p>",r}function g(e,t){var r="",i,s;return r+="<p class='description'><label>",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"home.email",s):f.call(e,"t","home.email",s)))+'</label><span class="value"><a href="#">'+l((i=(i=e&&e.model,i==null||i===!1?i:i.email),typeof i===c?i.apply(e):i))+"</a></span></p>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="my-hovercard">\n    <div class="media-box">\n        ',o=n["if"].call(t,t&&t.isInteractiveGroup,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;s+='\n        <div class="info">\n            ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.location),{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n            ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.phone),{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+="\n            ",a={hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.email),"&&",t&&t.displayEmail,a):f.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.email),"&&",t&&t.displayEmail,a));if(u||u===0)s+=u;return s+='\n        </div>\n    </div>\n    <div class="media-box">\n        <ul class="inline-list stats">\n            <li style="padding-right: 10px;">',a={hash:{count:(o=(o=t&&t.model,o==null||o===!1?o:o.members),o==null||o===!1?o:o.total_entries)},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"home.followres",a):f.call(t,"t","home.followres",a)))+"</li>\n        </ul>\n    </div>\n</div>",s})}),define("hbs!modules/common/templates/common/subject_hover_profile",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+="\n            <p>",(i=n.error)?i=i.call(e,{hash:{},data:t}):(i=e&&e.error,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+"</p>\n            ",r}function h(e,t){var r="",i,s,o;r+='\n            <a class="profile-pic-ext" href="',o={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,o):f.call(e,"urlFor","show",e&&e.model,o)))+'"><img alt="" src="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.mediumImage),typeof i===u?i.apply(e):i))+'"></a>\n            <div class="info">\n                ',s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.closed),{hash:{},inverse:l.noop,fn:l.program(4,p,t),data:t});if(s||s===0)r+=s;r+='\n                <h6><a href="',o={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,o):f.call(e,"urlFor","show",e&&e.model,o)))+'">\n                    ',o={hash:{},inverse:l.noop,fn:l.program(6,d,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.scope),"!==","public",o):f.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.scope),"!==","public",o));if(s||s===0)r+=s;return o={hash:{},data:t},r+=a((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.display_name),25,o):f.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.display_name),25,o)))+'</a></h6>\n                <p class="test">',o={hash:{},data:t},r+=a((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.description),48,o):f.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.description),48,o)))+'</p>\n                <ul class="stats">\n                    <li><i class="ui-inline-icon follower-icon"></i><span class="count js-follow-count">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.subscribers_count),typeof i===u?i.apply(e):i))+'</span></li>\n                    <li><i class="ui-inline-icon post-icon"></i><span class="count">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.messages_count),typeof i===u?i.apply(e):i))+'</span></li>\n                </ul>\n            </div>\n        </div>\n        <div class="subject-activity">\n            <p class="created_by owner-list">',o={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"subject.owners",o):f.call(e,"t","subject.owners",o)))+': </p>\n            <p class="created_by"> ',o={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.created_on",o):f.call(e,"t","common.created_on",o)))+" "+a((i=(i=e&&e.model,i==null||i===!1?i:i.createdAt),typeof i===u?i.apply(e):i))+'</p>\n        </div>\n        <div class="action-links employee">\n            <span class="action-button "></span>\n        </div>\n    </div>\n</div>\n',r}function p(e,t){var r="",i,s;return r+='\n                <a class="subject-closed">\n                    <i class="arrow down"></i>\n                    <span>',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.subject.closed",s):f.call(e,"t","common.subject.closed",s)))+"</span>\n                </a>\n                ",r}function d(e,t){var n="",r;return n+='\n                    <i class="ui-inline-icon '+a((r=(r=e&&e.model,r==null||r===!1?r:r.scope),typeof r===u?r.apply(e):r))+'"></i>\n                    ',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=n.helperMissing,l=this;s+='<div class="subject-rollover-wrap clearfix">\n    <div class="subject-rollover">\n        <div class="media-box">\n            ',o=n["if"].call(t,t&&t.error,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s})}),define("modules/common/views/common/hover_profile",["jquery","underscore","tibbr","../../collections/users","../../models/user","models/subject","models/group","../../models/resource","modules/common/views/common/follow_button","modules/common/views/common/add_vip","hbs!modules/common/templates/common/user_profile","hbs!modules/common/templates/common/group_profile","hbs!modules/common/templates/common/subject_hover_profile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return n.View.extend({ownerTemplate:'<a title="{{model.display_name}}" href="{{urlFor "show" model}}">{{ model.display_name }}</a>',events:{"click a.js-hierarchy":"redirect"},initialize:function(){n.currentUser.idols&&this.bindTo(n.currentUser.idols,"change:follow",this.updateUserFollowerCount),n.currentUser.subjects&&this.bindTo(n.currentUser.subjects,"change:count",this.updateUserFollowerCount),this.qtip=this.options.qtip},render:function(){if(this.model instanceof n.Model)var e="render"+this.model.get("modelType");else{var t=this.options.object||{},r={User:i,Subject:s,Group:o,Resource:u},a=t.context||t.json_class;if(a===undefined)return this;this.searchBySubjectId=!0,this.model=new r[a]({id:t.id}),e="render"+a}try{this[e]()}catch(f){console.log("hover_prfoile.js > ",e,f)}return this},renderUser:function(){var e=this.model,t=this,r="";this.fetching||(this.fetching=!0,e.fetch({data:{set_actions:!0,include_chat_status:!0},global:!1}).done(function(){e.get("current_status")&&(r="home."+e.get("current_status")),t.$el.html(t.renderTemplate(l,{model:e,isHierarchy:n.isHierarchy&&t.model.useAPI!==!0,displayEmail:n.displayEmail,displayCompany:n.displayCompany,status:r})),t.AddVip(),t.AddFollow(),t.options.link===!1&&t.$(".js-profile-pic").removeAttr("href").css("cursor","default")}).fail(function(r){t.$el.html(t.renderTemplate(l,{model:e,displayEmail:n.displayEmail,displayCompany:n.displayCompany,status:""})),r.status===404&&(t.$(".profile-pic").addClass("ex-employee-pic"),t.$(".ex-employee").show()),t.$(".employee").remove()}))},renderGroup:function(e){var t=this;e=e||this.searchBySubjectId||!1;if(e){var n=new o;n.action("find_by_subject_id","read",{data:{params:{page:1,per_page:10,subject_id:t.model.id,set_actions:!0}},success:function(e,n){t.showGroupData(e,n,t)}})}else this.model.fetch({global:!1,data:{set_actions:!0},success:function(e,n){t.showGroupData(e,n,t)}})},showGroupData:function(e,t,r){r.$el.addClass("ppl-popup-wrap directory-popup"),r.$el.html(r.renderTemplate(c,{model:e,displayEmail:n.displayEmail,isInteractiveGroup:n.hasInteractiveGroup}))},renderSubject:function(){this.qtip.elements.titlebar.remove();var e=this;e.model.isGroup()?e.renderGroup(!0):this.model.fetch().done(function(){e.$el.addClass("ppl-popup-wrap directory-popup");var t=e.model.user;e.$el.html(e.renderTemplate(h,{model:e.model,user:t})),e.AddFollow(),e.AddVip(),e.updateOwners()}).fail(function(t){var r=n.Modules.Error.parse(t);e.$el.html(e.renderTemplate(h,{error:r}))})},updateOwners:function(){var t=this;e.ajax({url:n.serverUrl("subjects","owners",this.model.id),data:{params:{per_page:3}},dataType:"json",global:!1,beforeSend:function(){t.$(".owner-list").append(n.UI.spinner)}}).done(function(e){t.model.owners=(new r)._set(e);var n=t.model.owners.map(function(e){return t.renderInLineTemplate(t.ownerTemplate,{model:e,cacheKey:"hover_profile_inline_owner_list"})});t.$(".owner-list").append(n.join(", "))}).always(function(){t.$(".owner-list").find(".spinner").remove()})},updateUserFollowerCount:function(e,t){var n;switch(t.get("modelType")){case"User":n="followers_count";break;case"Subject":n="subscribers_count";break;default:}var r=t.get(n)+e;this.$(".js-follow-count").text(this.t("home.followres",{count:r})),t.set(n,r)},AddFollow:function(){var e=this.initChild(a,{model:this.model});this.$(".action-button").prepend(e.render().el)},AddVip:function(){var e=this.initChild(f,{model:this.model});this.$(".action-button").prepend(e.render().el)},redirect:function(e){window.gadget&&(n.publish("redirect",this.model.hierarchyUrl({host:n.host(),gadget:!1})),e.preventDefault())}})}),define("modules/common/models/temporary_asset",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{modelType:"TemporaryAsset"},initialize:function(){e.bindAll(this,"isImage","fileSize","icon","assetName"),this.config=t.appConfig("ui_config","config","file")||{},this.path=t.Helper.imagePath(this.config.path_path||"images/icons/")},icon:function(){return this._contentType()},_contentType:function(){var e=this.get("data_content_type"),t=this.config.types;return t[e]||"unknown"},assetName:function(){return this.get("data_file_name")},isImage:function(){return this.get("data_content_type").indexOf("image")!==-1},fileSize:function(){var e=parseInt(this.get("data_file_size")/1024);return e===0?"":e+"KB"},imageIcon:function(e){e=e||"";var t=e=="showcase/"?".jpg":".png";return this.path+e+this._contentType()+t},isTibbrFile:function(){return!0},for_template:{icon:"icon",imageIcon:"imageIcon",fileSize:"fileSize",isTibbrFile:!0,isImage:"isImage"}})}),define("hbs!modules/common/templates/post/file_io_app",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='\n    <a class="file-picker-item" >\n        <img width="25" height="25" src="',u={hash:{},data:i},s+=f((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.icon_url),1,u):a.call(t,"assetImage",(o=t&&t.model,o==null||o===!1?o:o.icon_url),1,u)))+'" alt="">\n        <span>'+f((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===l?o.apply(t):o))+"</span>\n    </a>\n",s})}),define("modules/common/views/post/file_picker_item",["jquery","underscore","tibbr","hbs!modules/common/templates/post/file_io_app"],function(e,t,n,r){return n.View.extend({tagName:"li",events:{"click a.file-picker-item":"loadFileIO"},attachFrame:function(){var e=this.parent,t=e.$("#js-filter-picker-"+this.model.id);this.$el.hasClass("buffered")||t.css({opacity:1,height:"310px"});if(t.length===0){var r=this.model.urlsType("file_picker").url()+"&cid="+this.cid;t=n.$iFrame().attr({style:"height: 310px; width: 100%;",src:r,id:"js-filter-picker-"+this.model.id,"class":"js-file-picker"}),e.$(".js-file-picker-frame").append(t),e.$el.addClass(this.cid)}else t.css({opacity:1,height:"310px"})},render:function(){return this.$el.html(this.renderTemplate(r)),this},loadFileIO:function(){var e=this.parent;return e.$(".js-file-picker-frame iframe.js-file-picker").css({opacity:0,height:"0px"}),e.$(".js-pickers li").removeClass("prevFileIo active"),this.$el.addClass("active prevFileIo"),this.attachFrame(),e.myComputerView&&e.myComputerView.$el.hide(),e.$(".js-file-picker-frame").show(),!1}})}),define("hbs!modules/common/templates/post/my_computer",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="dropzone file-upload-area drag-n-drop desktop-file js-open-file-dialog">\n    <div class="upload-box drop-zone">\n        <div class="instructions js-instructions">\n            <h3 class="drag-and-drop"> <i class="ui-inline-icon drag-drop-icon"></i> ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.drag_n_drop",u):a.call(t,"t","common.drag_n_drop",u)))+"</h3>\n            <p>",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.drag_or_browse_files",u):a.call(t,"t","common.drag_or_browse_files",u)))+'</p>\n        </div>\n        <div class="drag-drop-progress hidden js-asset-progress">\n            <div class="progress-bar js-progress lfloat " id="progress">\n                <div style="width: 0%;" class="bar"></div>\n            </div>\n            <p class="percentage lfloat"></p>\n            <p class="cancel-link lfloat js-cancel-upload"><a href="#">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.cancel",u):a.call(t,"t","common.cancel",u)))+'</a></p>\n        </div>\n    </div>\n</div>\n<div class="js-progress-ie hidden"></div>\n<div class="select-a-file hidden" id="file-selection">\n    <div class="padding-wrap">\n        <p class="title">',u={hash:{count:t&&t.maxFile},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.asset.choose_file_from_computer",u):a.call(t,"t","common.asset.choose_file_from_computer",u)))+'</p>\n        <div class="upload-button">\n            <span id="choose_file" class="choose-file"> ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.asset.choose_file",u):a.call(t,"t","common.asset.choose_file",u)))+'\n                <i class="arrow next"></i>\n            </span>\n            <input type="file" class="file-attach js-file-attach" id="file-post"  multiple/>\n        </div>\n    </div>\n</div>',s})}),define("modules/common/views/post/my_computer",["jquery","underscore","tibbr","require/jquery-iframe-transport","require/jquery-fileupload","modules/dialog","hbs!modules/common/templates/post/my_computer"],function(e,t,n,r,i,s,o){return n.View.extend({className:"js-post-my-computer",initialize:function(){this.tmpFiles=this.options.tmpFiles,this.maxFileAttachment=n.appConfig("webui","config","max_attachment"),this.hasResource=params&&params._uploadResource,this.paramName="temp_file[data]",this.uploadUrl=n.path("temp_asset_files"),this.hasResource&&(this.uploadUrl=n.path("resources/upload_file"),this.paramName="resource[file]")},events:{"click .js-cancel-upload":"cancelUpload","click .js-open-file-dialog":"openFileDialog"},render:function(){return this.$el.prepend(this.renderTemplate(o,{maxFile:this.maxFileAttachment})),this.fileUpload(),this},fileUpload:function(){var e=this,r=this.$(".js-asset-progress"),i=this.$(".js-instructions");return n.dragNDropSupport||(this.$(".js-open-file-dialog").remove(),this.parent.parent&&this.parent.parent.$(".js-file-attachment").removeClass("dnd-support").addClass("no-dnd-support"),r=this.$(".js-progress-ie").append(n.UI.loader)),this.$("input.js-file-attach").fileupload({url:this.uploadUrl,dataType:"json",paramName:this.paramName,global:!1,dropZone:e.$el,singleFileUploads:!0,maxNumberOfFiles:this.maxFileAttachment,start:function(){r.removeClass("hidden"),i.addClass("hidden"),n.Event.trigger("upload","start"),n.publish("upload","start")},stop:function(){r.addClass("hidden"),i.removeClass("hidden"),n.Event.trigger("upload","stop"),n.publish("upload","stop")},add:function(i,o){var u=e.tmpFiles.length,a=o.originalFiles.length;if(u+a>e.maxFileAttachment){if(this.maxAlert)return;s.alert({text:e.t("common.asset.max_upload_limit_reached",{count:e.maxFileAttachment}),close:function(){e.maxAlert=!1}}),this.maxAlert=!0;return}o.files=t.map(o.files,function(t){var i=e.tmpFiles.detect(function(e){return e.get("data_file_name")===t.name});return e._validationAlert?null:i?(s.alert({text:e.t("common.asset.already_uploaded",{file:t.name}),okFunction:function(){e._validationAlert=!1,r.addClass("hidden"),n.Event.trigger("upload","stop"),n.publish("upload","stop")}}),e._validationAlert=!0,null):t});try{e.jqXHR=o.submit()}catch(f){}},done:function(t,n){e.uploadDone(n)},error:function(t,i,o){if(o==="abort")return;t.responseText.length===0&&(t.responseText=JSON.stringify({error:e.t("common.errors.something_went_wrong")})),s.alert({text:n.Modules.Error.parse(t).join("<br>")}),n.dragNDropSupport||r.addClass("hidden")},progressall:function(e,t){if(n.dragNDropSupport){var i=parseInt(t.loaded/t.total*100,10);r.find(".bar").css("width",i+"%"),r.find(".percentage").text(i+"%")}else r.removeClass("hidden")}}).bind("fileuploadsubmit",function(e,t){t.formData={"temp_file[type]":"asset",_method:"POST",format:"json",authenticity_token:n._CSFR_TOEKN}}),!1},openFileDialog:function(){return this.$("#file-post").click(),!1},cancelUpload:function(){var t=this,n='<div style="padding:20px;"> <p class="mbl">'+this.t("common.cancel_confirm")+'</p><p><button class="btn btn-primary js-confirm-cancel">'+this.t("common.confirm")+'</button><button class="btn btn-link js-close-dialog">'+this.t("common.cancel")+"</button></p>";return s.view(n,{title:this.t("common.cancel_upload"),className:"email-alerts-dialog",open:function(n){e(document).on("click",".js-confirm-cancel",function(){t.jqXHR.abort(),s.closeAll()}),e(document).on("click",".js-close-dialog",function(){s.closeAll()})}}),!1},uploadDone:function(e){this.hasResource?this.resourceUpload(e):this.assetUploaded(e)},assetUploaded:function(e){if(e.result.errors)s.alert({text:e.result.errors.error});else{var n=t.clone(e.result);e.result.data_file_name=e.files[0].name,this.tmpFiles.add(n)}},resourceUpload:function(e){if(e.result.errors)s.alert({text:e.result.errors.error});else{e.result.data_file_name=e.result.title,e.result.data_content_type=(t.detect(e.result.custom_properties,function(e){return e.name==="file_content_type"})||{}).value;var n=t.clone(e.result);this.tmpFiles.add(n)}}})}),define("hbs!modules/common/templates/post/file_io_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<li class="attached-file-io js-file-io-'+f((o=(o=t&&t.model,o==null||o===!1?o:o.key),typeof o===a?o.apply(t):o))+'">\n    <p class="attached-file-io">\n        <img width="22" height="22" src="',u={hash:{},data:i},s+=f((o=n.asset||t&&t.asset,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.previewUrl),u):l.call(t,"asset",(o=t&&t.model,o==null||o===!1?o:o.previewUrl),u)))+'" alt="">\n        <span>',u={hash:{},data:i},s+=f((o=n.truncate||t&&t.truncate,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.title),60,u):l.call(t,"truncate",(o=t&&t.model,o==null||o===!1?o:o.title),60,u)))+'</span>\n        <a class="js-remove-file-io">x</a>\n    </p>\n</li>',s})}),define("hbs!modules/common/templates/post/file_pickers",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\n        <li class="active my-comp-upload">\n            <a class="clearfix">\n                <span><img src="',s={hash:{},data:t},r+=f((i=n.imagePath||e&&e.imagePath,i?i.call(e,"images/file-picker/computer-icon.png",s):a.call(e,"imagePath","images/file-picker/computer-icon.png",s)))+'" alt=""></span>\n                <span> ',s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"common.my_computer",s):a.call(e,"t","common.my_computer",s)))+"</span>\n            </a>\n        </li>\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l=this;s+='<ul class="js-pickers file-sharing-gadgets">\n    ',o=n["if"].call(t,t&&t.myCompUpload,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;return s+='\n</ul>\n<div class="file-upload-area file-picker-iframe-area js-file-picker-frame" style="display: none"></div>\n<div class="js-attached-container" style="margin-top: 5px; display: none">\n    <p class="selected-files">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.selected_files",u):a.call(t,"t","common.selected_files",u)))+"</p>\n    <ul></ul>\n</div>\n",s})}),define("hbs!modules/common/templates/post/drag_drop_file",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<li class="dragged-file dragged-file-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===f?o.apply(t):o))+'">\n    <p class="dragged-file-item">\n        <img width="22" height="22" src="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.imageIcon),typeof o===f?o.apply(t):o))+'" >\n        <span title="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.data_file_name),typeof o===f?o.apply(t):o))+'">',a={hash:{},data:i},s+=l((o=n.truncate||t&&t.truncate,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.data_file_name),20,a):c.call(t,"truncate",(o=t&&t.model,o==null||o===!1?o:o.data_file_name),20,a)))+'</span>\n        <a data-file-name="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.data_file_name),typeof o===f?o.apply(t):o))+'" data-file-id="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===f?o.apply(t):o))+'" data-is-new="',(u=n.isNew)?u=u.call(t,{hash:{},data:i}):(u=t&&t.isNew,u=typeof u===f?u.call(t,{hash:{},data:i}):u),s+=l(u)+'"  class="removeDraggedFile">x</a>\n    </p>\n\n</li>\n',s})}),define("modules/common/views/post/file_pickers",["jquery","underscore","tibbr","../../models/temporary_asset","../../models/og_file","./file_picker_item","./my_computer","hbs!modules/common/templates/post/file_io_item","hbs!modules/common/templates/post/file_pickers","hbs!modules/common/templates/post/drag_drop_file"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({className:"js-file-pickers",events:{"click .my-comp-upload":"showMyCompUpload","click .js-remove-file-io":"removeFile","click .removeDraggedFile":"removeDraggedFile"},initialize:function(){this.tmpFiles=new(n.Collection.extend({model:r})),this.resources=[],this.bindTo(this.tmpFiles,"add",this._addAsset),this.bindTo(this.tmpFiles,"remove",this._updateAsset),n.Event.bindTo(this,"file:added",this._addFile)},render:function(){return this.$el.prepend(this.renderTemplate(a,{myCompUpload:n.disableFileUpload})),this.renderExtAssets(),this.showMyCompUpload(),n.publish("rendered"),this},showMyCompUpload:function(t){t instanceof e.Event&&t.preventDefault();if(!n.disableFileUpload)return!1;this.$(".js-post-my-computer").length===0?params.my_computer?this.customUpload():this.nativeUpload():(this.$(".js-pickers li").removeClass("active"),e(t.currentTarget).addClass("active"),this.myComputerView.$el.show(),this.$(".js-file-picker-frame").hide())},customUpload:function(){var t=params.my_computer,n=e('<iframe class="js-post-my-computer" frameborder="0" style="height: 310px; width: 100%;"></iframe>').attr({src:t,id:"js-custom-uploader-"+this.cid});this.myComputerView={$el:{hide:function(){return n.css({opacity:0,height:"0px"})},show:function(){return n.css({opacity:1,height:"310px"})}}},this.$(".js-pickers").after(n)},nativeUpload:function(){this.myComputerView=this.initChild(o,{tmpFiles:this.tmpFiles}),this.$(".js-pickers").after(this.myComputerView.render().el)},removeFile:function(r){var i=e(r.currentTarget).parent().parent(),s=i.data("resource");this.resources=t.reject(this.resources,function(e){return e.key===s.key}),this.parent&&this.parent.trigger("og-file:update",this.resources),n.publish("attachment.resource.removed",s),n.publish("attachment.resource.updated",this.resources),i.remove()},removeDraggedFile:function(t){t.preventDefault();var r=e(t.currentTarget),i=r.data("file-id"),s=function(){r.parent().parent().remove()},o=this;return params._uploadResource?(n.publish("attachment.resource.removed",o.tmpFiles.get(i).toJSON()),o.tmpFiles.remove(i,{silent:!0}),s(),!1):(this.ajax({url:"temp_asset_files/"+i,type:"delete"}).done(function(e){o.tmpFiles.remove(e.id),s()}),!1)},renderExtAssets:function(){if(params.external_assets==="false")return t.delay(function(){e(".my-comp-upload").hide()},200),!1;var r=this.$(".js-pickers"),i=r.find(".file-picker-item"),o=this;return r.find(i).length===0&&n.currentUser.filePickersApps.each(function(e){var t=o.initChild(s,{model:e});try{r.append(t.render().el)}catch(n){console.error("view rendering error ",n)}}),!1},_addFile:function(e){console.log(e);if(!this.$el.hasClass(e.source))return!1;var r=this.$(".js-attached-container");if(e.file.action=="removeMe"){var s=this.$(".js-file-io-"+e.file.removeId),o=s.data("resource");return s.remove(),this.resources=t.reject(this.resources,function(t){return t.key===e.file.removeId}),this.parent&&this.parent.trigger("og-file:update",this.resources),o&&(n.publish("attachment.resource.removed",o),n.publish("attachment.resource.updated",this.resources)),!1}return this.$(".js-file-io-"+e.file.key).length?!1:(r.show().find("ul").append(this.renderTemplate(u,{model:new i(e.file)})),r.find(".js-file-io-"+e.file.key).data("resource",e.file),this.resources.push(e.file),this.parent&&this.parent.trigger("og-file:update",this.resources),n.publish("attachment.resource.added",e.file),n.publish("attachment.resource.updated",this.resources),!0)},_addAsset:function(e){this._updateAsset(e);var t=this.$(".js-attached-container");t.find("ul").append(this.renderTemplate(f,{model:e,isNew:!1})).end().show()},_updateAsset:function(e){if(params&&params._uploadResource)n.publish("attachment.resource.added",e.toJSON());else{var t=this.tmpFiles.pluck("id").join(",");this.parent&&this.parent.trigger("temp_asset:update",t),n.publish("attachment.resource.updated",t)}}})}),define("hbs!modules/common/templates/post/asset",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function l(e,t){var r="",i,s;return r+='\n    <ul class="attachments">\n        <li class="attachment-txt"><label> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.attach",s):u.call(e,"t","common.asset.attach",s)))+' :</label></li>\n        <li><a title=" ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.file",s):u.call(e,"t","common.asset.file",s)))+'" data-type="file"><i class="ui-inline-icon file-icon"></i> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.file",s):u.call(e,"t","common.asset.file",s)))+'</a></li>\n        <li><a title=" ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.link",s):u.call(e,"t","common.asset.link",s)))+'" data-type="link"><i class="ui-inline-icon link-icon"></i>',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.link",s):u.call(e,"t","common.asset.link",s)))+'</a></li>\n    </ul>\n    <div class="attach file-picker-attach js-file-attachment dnd-support hidden">\n        <fieldset class="file-picker-wrap">\n            <div class="file-picker js-file-picker-wrap">\n                <a class="close-btn" href="#"> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.close",s):u.call(e,"t","common.close",s)))+'</a>\n            </div>\n        </fieldset>\n    </div>\n    <div class="attach js-link-attachment hidden">\n        <h4> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.attach_link",s):u.call(e,"t","common.asset.attach_link",s)))+'\n            <a class="close-btn" data-parent="tib-box" href="#"> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.close",s):u.call(e,"t","common.close",s)))+'</a>\n        </h4>\n\n        <p>\n        <span id="link-partial" class="link-partial">\n            <label for="link_url"> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.url",s):u.call(e,"t","common.url",s)))+' </label>\n            <input  class="link_url optional js-link-url"  type="text" style="width: 64%"/>\n            <span id="link-preview-link" class="link-preview-link">\n                <a href="" class="preview-link remote" rel="preview"> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.preview",s):u.call(e,"t","common.preview",s)))+'</a>\n            </span>\n        </span>\n            <span id="link-preview-partial" class="link-preview-partial" style="display: none"></span>\n        </p>\n\n        <p>\n        <span>\n            <label> ',s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.asset.link_title",s):u.call(e,"t","common.asset.link_title",s)))+'</label>\n            <input class="link_title optional js-link-title"  style="width: 64%;" type="text"/>\n        </span>\n        </p>\n\n        <div class="link-attach-preview"></div>\n    </div>\n      <input class="js-tmp-files" type="hidden" name="message[temp_files]"/>\n      <input class="js-og-files" type="hidden"/>\n    ',r}function c(e,t){var r="",i,s;return r+=" ",s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.button_texts.reply",s):u.call(e,"t","common.button_texts.reply",s)))+"   ",r}function h(e,t){var r="",i,s;return r+="  ",s={hash:{},data:t},r+=a((i=n.t||e&&e.t,i?i.call(e,"common.button_texts.plain",s):u.call(e,"t","common.button_texts.plain",s)))+" ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f=this;s+='<div class="js-asset">\n  ',o=n["if"].call(t,t&&t.hasAsset,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n    <div class="submit-btn-holder post-btn rfloat">\n        <button class="btn btn-primary btn-submit tib-btn" id="tib-btn" name="commit">\n        <span class="js-button">',o=n["if"].call(t,t&&t.reply,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='\n        </span>\n            <span class="ui-inline-icon arrow-next"></span>\n        </button>\n    </div>\n</div>',s})}),define("hbs!modules/common/templates/post/link_preview",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var n="",r;return n+='\r\n    <a href="'+f((r=(r=e&&e.model,r==null||r===!1?r:r.url),typeof r===a?r.apply(e):r))+'" target="_blank"><img src="'+f((r=(r=e&&e.model,r==null||r===!1?r:r.preview_image),typeof r===a?r.apply(e):r))+'" style="max-width: 200px; max-height: 60px;"></a>\r\n    ',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<div id="linkSnap">\r\n  <div class=video-attach>\r\n    ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.hasPreview),{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(u||u===0)s+=u;return s+='\r\n    <strong>\r\n      <a target="_blank" href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'">'+f((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===a?o.apply(t):o))+'</a>\r\n    </strong>\r\n    <p>\r\n      <i class="ui-inline-icon link-icon"></i>\r\n      <a class="link-url" href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'" target="_blank">'+f((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+"</a>\r\n    </p>\r\n    <p> "+f((o=(o=t&&t.model,o==null||o===!1?o:o.description),typeof o===a?o.apply(t):o))+"</p>\r\n  </div>\r\n</div>",s})}),define("modules/common/views/post/asset",["jquery","underscore","tibbr","modules/dialog","../../models/link","./file_pickers","hbs!modules/common/templates/post/asset","hbs!modules/common/templates/post/link_preview"],function(e,t,n,r,i,s,o,u){return n.View.extend({tagName:"fieldset",className:"js-asset-fieldset",initialize:function(){t.bindAll(this,"updateTmpAsset","updateOgFile"),this.on("temp_asset:update",this.updateTmpAsset),this.on("og-file:update",this.updateOgFile),n.Event.bindTo(this,"upload",this.handleButton);if(this.useAPI&&TIBR){var e=this;this.usingApi=!0,this.tibrFilePickerID="file-pickers-"+this.cid,TIBR.events.on("tibr:"+this.tibrFilePickerID+":rendered",function(t){var n=t[0];n.subscribeToGadget("attachment.assets.updated",e.updateTmpAsset),n.subscribeToGadget("attachment.resource.updated",e.updateOgFile),n.subscribeToGadget("attachment.upload",e.handleButton)})}},events:{"click .attachments a":"showFile","click .close-btn":"close","click .preview-link":"showPreview","focusout .link_url":"setLinkUrl"},render:function(){return this._render(),this.$el.append('<div class="post-privacy-container rfloat mrl"></div>'),this},handleButton:function(e){e==="start"?this.$(".btn-submit").addClass("disabled"):this.$(".btn-submit").removeClass("disabled")},_render:function(){this.$(".js-asset").remove(),this.activeAttach=null;var e=n.asset===!1?!1:this.options.asset;this.$el.prepend(this.renderTemplate(o,{unique:this.uniqueID,hasAsset:e,reply:this.options.reply})),n.attachment===!1&&this.$("a[data-type=file]").remove()},showFile:function(t){var n=e(t.currentTarget),r=n.data("type");if(this.activeAttach===r)return;this.$(".attachments .active").removeClass("active"),n.parent().addClass("active"),this.$(".attach").hide(),this.$(".js-"+r+"-attachment").show(),this.activeAttach=r,r==="file"&&this.renderFilePickers(),e.colorbox&&e.colorbox.resize()},renderFilePickers:function(){if(this.usingApi){if(this.$("#"+this.tibrFilePickerID).length===0){var e='<div tibr-social-bar gadget="file_pickers" class="custom" id="'+this.tibrFilePickerID+'"></div>';this.$(".js-file-picker-wrap").append(e),TIBR.renderWidget(this.tibrFilePickerID)}}else this.$(".js-file-pickers").length===0&&this.$(".js-file-picker-wrap").append(this.initChild(s).render().el)},showPreview:function(){var e=this.$(".link_url"),n=e.val(),s=this;return s.$(".link-attach-preview").html(""),t.isEmpty(n)?r.alert({text:this.t("common.asset.invalid_url")}):(e.attr("disabled",!0).after(spinner),(new i).getPreview(n,function(t){e.removeAttr("disabled"),s.$(".spinner").remove(),s.$(".link-attach-preview").html(s.renderTemplate(u,{model:t}))})),!1},setLinkUrl:function(){var e=this.$(".link_url").val();t.isEmpty(e)||(/(http|https:\/\/)\S+/i.test(e)||(e=/(^www\.)\S+/i.test(e)?"http://"+e:e),this.$(".link_url").val(e))},close:function(e){return this.$(".attach").hide(),this._render(),this.activeAttach=null,!1},clear:function(e){this._render()},updateTmpAsset:function(e){this.$(".js-tmp-files").val(e)},updateOgFile:function(e){this.$(".js-og-files").data("resources",e)},changeText:function(){var t=e("#post-tabs li.active > a").data("type")||"plain";this.$("span.js-button").text(this.t("common.button_texts."+t))},onLeave:function(){this.activeAttach=null,this.usingApi&&TIBR.Widgets.clear(this.tibrFilePickerID)}})}),define("require/mentionsInput",["underscore","jquery"],function(e,t){return function(e,t,n){function u(){var t=e(this);window.event.propertyName=="value"&&!t.data("triggering.inputEvent")&&(t.data("triggering.inputEvent",!0).trigger("input"),window.setTimeout(function(){t.data("triggering.inputEvent",!1)},0))}function a(e){e.setAttribute("oninput","return");if(typeof e.oninput=="function")return!0;try{var t=document.createEvent("KeyboardEvent"),n=!1,r=function(e){n=!0,e.preventDefault(),e.stopPropagation()};return document.body.appendChild(e),e.addEventListener("input",r,!1),e.removeEventListener("input",r,!1),document.body.removeChild(e),n}catch(i){}}var r={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188,SPACE:32,HOME:36,END:35},i={triggerChar:"@",onDataRequest:e.noop,minChars:1,showAvatars:!0,elastic:!0,redactor:!1,classes:{autoCompleteItemActive:"active"},templates:{wrapper:t.template('<div class="mentions-input-box"></div>'),autocompleteList:t.template('<div class="mentions-autocomplete-list"></div>'),autocompleteListItem:t.template('<li data-ref-id="<%= id %>" data-ref-type="<%= type %>" data-display="<%= display %>"><%= content %></li>'),autocompleteListItemAvatar:t.template('<img  src="<%= avatar %>" />'),autocompleteListItemIcon:t.template('<div class="icon <%= icon %>"></div>'),mentionsOverlay:t.template('<div class="mentions"><div></div></div>'),mentionItemSyntax:t.template("@[<%= type %>:<%= id %>|<%= value %>]"),mentionItemHighlight:t.template("<strong><span><%= value %></span></strong>"),redactorHtml:t.template('<span contenteditable="false" class="js-mention <%=type %>" data-mention="<%= syntax %>"><%= value %></span>&#x200b;&#x200b; '),redactorHashHtml:t.template('<span contenteditable="false" class="js-mention <%=type %>" data-mention="#<%= value %> "> #<%= value %></span>&#x200b;&#x200b; '),hashItemSyntax:t.template("#<%= value %>"),hashItemHighlight:t.template("<strong><span><%= value %></span></strong>")}},s={htmlEncode:function(e){return t.escape(e)},highlightTerm:function(e,t){return!t&&!t.length?e:e.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+t+")(?![^<>]*>)(?![^&;]+;)","gi"),"<b>$1</b>")},setCaratPosition:function(e,t){if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()},rtrim:function(e){return e.replace(/\s+$/,"")}},o=function(n){function y(){u=e(o);if(u.attr("data-mentions-input")=="true")return;a=u.parent(),l=e(n.templates.wrapper()),u.wrapAll(l),l=a.find("> div"),u.attr("data-mentions-input","true"),u.bind("keydown",P),u.bind("keypress",D),u.bind("input",M),u.bind("click",L),u.bind("blur",A),n.elastic&&u.elastic()}function b(){f=e(n.templates.autocompleteList()),f.appendTo(l),f.delegate("li","mousedown",k)}function w(){c=e(n.templates.mentionsOverlay()),c.prependTo(l)}function E(){if(p)return;var e=C();t.each(d,function(t){var r=t.trigger==="#"?n.templates.hashItemSyntax(t):n.templates.mentionItemSyntax(t);e=e.replace(t.value,r)});var r=e;t.each(d,function(e){var i=t.extend({},e,{value:s.htmlEncode(e.value)}),o=e.trigger==="#"?n.templates.hashItemSyntax(i):n.templates.mentionItemSyntax(i),u=e.trigger==="#"?n.templates.hashItemHighlight(i):n.templates.mentionItemHighlight(i);r=r.replace(o,u)}),r=r.replace(/\n/g,"<br />"),r=r.replace(/ {2}/g,"&nbsp; "),u.data("messageText",e),c.find("div").html(r)}function S(r){p.restoreSelection(),setTimeout(e.proxy(function(){var e=t.extend({},r,{value:s.htmlEncode(r.value)});e.syntax=n.templates.mentionItemSyntax(e);var i=r.trigger==="#"?n.templates.redactorHashHtml:n.templates.redactorHtml,o=i(e);r.trigger==="+"&&(r.queryValue=r.queryValue.replace("+","\\+"));var u=p.getCode().replace(new RegExp(r.queryValue+"(?![\\s\\S]*"+r.queryValue+")"),o);p.setCode(""),p.oldIE()&&p.$editor.focus(),u=u.replace(/<br>$/,""),p.insertHtml(u)},this),100)}function x(){m=[]}function T(){var e=C();d=t.reject(d,function(t,n){return!t.value||e.indexOf(t.value)==-1}),d=t.compact(d)}function N(e){var t=C(),n=u.data("triggerChar"),r=e.value,i=e.id,o=e.type,a=new RegExp("\\"+n+g,"gi");a.exec(t);var f=a.lastIndex-g.length-1,l=a.lastIndex,c=t.substr(0,f),h=t.substr(l,t.length),v=(c+e.value).length+1,m={id:i,type:o,value:r,trigger:n,queryValue:n+g};d.push(m),x(),g="",H();var y=c+e.value+" "+h;u.val(y),p?S(m):(E(),u.focus(),s.setCaratPosition(u[0],v))}function C(){return e.trim(u.val())}function k(t){t.preventDefault(),t.stopPropagation();var n=e(this),r=v[n.attr("data-uid")];N(r)}function L(e){x()}function A(e){H()}function O(e,n,r){var i=t.lastIndexOf(e,n),o=e[i-1]===" ";if(!o&&i!==0)return;if(i>-1&&n==="#"&&t.lastIndexOf(e," ")>i){var u=s.rtrim(e.slice(i+1).join(""));N({id:u,value:u,type:"HashTag"});return}i>-1&&(g=e.slice(i+1).join(""),g=s.rtrim(g),t.defer(t.bind(F,this,g,n)))}function M(e){E(),T(),H(),t.isArray(n.triggerChar)?t.each(n.triggerChar,function(t){O(m,t,e)}):O(m,n.triggerChar,e)}function D(e){if(e.keyCode===r.RETURN){x();return}if(e.keyCode!==r.BACKSPACE){var t=String.fromCharCode(e.which||e.keyCode);m.push(t)}}function P(n){if(n.keyCode==r.LEFT||n.keyCode==r.RIGHT||n.keyCode==r.HOME||n.keyCode==r.END){t.defer(x),navigator.userAgent.indexOf("MSIE 9")>-1&&t.defer(E);return}if(n.keyCode==r.BACKSPACE){m=m.slice(0,-1+m.length);return}if(!f.is(":visible"))return!0;switch(n.keyCode){case r.UP:case r.DOWN:var i=null;return n.keyCode==r.DOWN?h&&h.length?i=h.next():i=f.find("li").first():i=e(h).prev(),i.length&&B(i),!1;case r.RETURN:case r.TAB:if(h&&h.length)return h.trigger("mousedown"),!1}return!0}function H(){h=null,f.empty().hide()}function B(e){e.addClass(n.classes.autoCompleteItemActive),e.siblings().removeClass(n.classes.autoCompleteItemActive),h=e}function j(r,i,o){f.show(),o==="#"&&(i=t.reject(i,function(e){return r==e.name}),i.unshift({avatar:"",icon:"",id:r,name:r,type:"HashTag"}));if(!i.length){H();return}f.empty();var u=e("<ul>").appendTo(f).hide();t.each(i,function(i,a){var f=t.uniqueId("mention_");v[f]=t.extend({},i,{value:i.name});var l=e(n.templates.autocompleteListItem({id:s.htmlEncode(i.id),display:s.htmlEncode(i.name),type:s.htmlEncode(i.type),content:s.highlightTerm(s.htmlEncode(i.name),r)})).attr("data-uid",f);a===0&&B(l);if(n.showAvatars&&o!=="#"){var c;i.avatar?c=e(n.templates.autocompleteListItemAvatar({avatar:i.avatar})):c=e(n.templates.autocompleteListItemIcon({icon:i.icon})),c.prependTo(l)}l=l.appendTo(u)}),f.show(),u.show()}function F(e,t){e&&e.length&&e.length>=n.minChars&&n.onDataRequest.call(this,"search",e,function(n){j(e,n,t),u.data("triggerChar",t)},t)}function I(){u.val(""),d=[],E()}var o,u,a,f,l,c,h,p,d=[],v={},m=[],g;return n=e.extend(!0,{},i,n),{init:function(e){o=e,p=n.redactor;if(!n.redactor)y(),w();else{u=o;var t=e.parent();l=t,c=t.find(".redactor_editor")}b(),n.redactor||I(),n.prefillMention&&N(n.prefillMention)},val:function(e){if(!t.isFunction(e))return;var n=d.length?u.data("messageText"):C();e.call(this,n)},reset:function(){I()},getMentions:function(e){if(!t.isFunction(e))return;e.call(this,d)},onInputBoxKeyDown:P,onInputBoxKeyPress:D,onInputBoxInput:M,onInputBoxClick:L,onInputBoxBlur:A}};return e.fn.mentionsInput=function(n,r){var i=arguments;if(typeof n=="object"||!n)r=n;return this.each(function(){var s=e.data(this,"mentionsInput")||e.data(this,"mentionsInput",new o(r));if(t.isFunction(s[n]))return s[n].apply(this,Array.prototype.slice.call(i,1));if(typeof n=="object"||!n)return s.init.call(this,this);e.error("Method "+n+" does not exist")})},e.event.special.input={setup:function(t,n){function h(){var t=e(i);i.value!=s&&!t.data("triggering.inputEvent")&&(s=i.value,t.data("triggering.inputEvent",!0).trigger("input"),window.setTimeout(function(){t.data("triggering.inputEvent",!1)},0))}function p(e){e.type=="focus"?(h(),clearInterval(r),r=window.setInterval(h,250)):e.type=="blur"?window.clearInterval(r):window.setTimeout(h,0)}var r,i=this,s=i.value,o=document.createElement(this.tagName),u="oninput"in o||a(o),f="onpropertychange"in o,l="inputEventNS"+~~(Math.random()*1e7),c=["focus","blur","paste","cut","keydown","drop",""].join("."+l+" ");if(u)return!1;e(this).find("input, textarea").andSelf().filter("input, textarea").bind(c,p),e(this).data("inputEventHandlerNS",l)},teardown:function(){var t=e(this);t.find("input, textarea").unbind(t.data("inputEventHandlerNS")),t.data("inputEventHandlerNS","")}},e.fn.input=function(e){return e?this.bind("input",e):this.trigger("input")},o}(t,e)}),define("modules/common/views/post/mentions_input",["jquery","underscore","tibbr","require/mentionsInput"],function(e,t,n,r){return n.View.extend({className:"tib-text message-box",id:"tib-text",tagName:"textarea",attributes:{name:"__content",autocomplete:"off"},triggerChar:"@",client_id:8,_resourceTriggerChar:function(){return n.appConfig("ui_config","config","resource_trigger_char")||"+"},render:function(){return t.bindAll(this,"bind"),this.options.placeholder&&this.$el.attr("placeholder",this.options.placeholder),this.options.resource&&(this.resource=this.options.resource),this.resourceTriggerChar=this._resourceTriggerChar(),this},bind:function(){var t=this;this.$el.TextAreaExpander(this.options.height||50,500).mentionsInput({triggerChar:this.resource?[this.triggerChar,"#"]:[this.triggerChar,"#"],minChars:1,elastic:!1,onDataRequest:function(r,i,s,o){switch(o){case"@":t.ajax({url:"/users/"+n.currentUser.id+"/list_message_targets",data:t.buildParams(i)}).done(function(e){s.call(this,t.responseData(e))});break;case"+":t.ajax({url:"/resources/list_message_targets",data:e.param({page:1,per_page:5,client_id:t.opts.resource.client_id||t.opts.resource.app_id,search_options:{search_str:i}})}).done(function(e){s.call(this,t.responseData(e))});break;case"#":t.ajax({url:"/users/"+n.currentUser.id+"/list_hash_tags",data:e.param({params:{per_page:10,page:1,search_str:i}})}).done(function(e){s.call(this,t.responseData(e))})}}}).simplePlaceholder()},responseData:function(e){var n=this;return t.map(e,function(e){return{id:e.value,name:e.caption,avatar:n.asset(e.image||"/assets/images/subjects/subject_images/missing_small.png"),type:n.type(e.t),icon:""}})},type:function(e){return{u:"User",s:"Subject",g:"Group",og_r:"Resource",ht:"HashTag"}[e]},buildParams:function(n){var r=this.options.params||{},i=r.type||"both",s="id",o=r.exclude_type||s,u={page:r.page||1,per_page:r.per_page||5,search_str:n},a=r.users_filters||{},f=r.subjects_filters||{},l=r.groups_filters||{},c="exclude_"+o,h,p={users_filters:t.extend(a,u),subjects_filters:t.extend(f,u)};return e.param({params:t.extend(p,{value_type:s})})},ajax:function(t){return t=t||{},t.url=t.url.replace(new RegExp("^"+window.prefix),"/"),t.dataType="json",t.type="GET",t.global=t.global||!1,this.useAPI?(t.method=t.type,t.params=t.data,delete t.data,delete t.type,TIBR.api(t)):(t.url=n.path(t.url),e.ajax(t))}})}),define("hbs!modules/common/templates/messages/reply_box",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='<form method="post" enctype="multipart/form-data">\n    <input type="hidden" name="format" value="json"/>\n    <a class="profile-pic" href="">\n        <img src="',u={hash:{},data:i},s+=f((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.currentUser,o==null||o===!1?o:o.profile_image_url),3,u):a.call(t,"assetImage",(o=t&&t.currentUser,o==null||o===!1?o:o.profile_image_url),3,u)))+'" class="bordered-large medium">\n    </a>\n\n    <div class="info">\n        <fieldset class="comment-box-wrap"></fieldset>\n        <input type="hidden" name="message[rich_content]" class="js_content"/>\n        <input type="hidden" name="message[parent_id]" class="parent_id" value="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===l?o.apply(t):o))+'"/>\n        <div class="asset-holder"></div>\n    </div>\n</form>',s})}),define("hbs!modules/common/templates/messages/reply_to_reply_form",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<input type="hidden" class="reply_to_reply" name="message[reply_of_reply_id]" value ="',(o=n.id)?o=o.call(t,{hash:{},data:i}):(o=t&&t.id,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'">',s})}),define("hbs!modules/common/templates/messages/reply_to_reply",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<p class="replying"><a href="#">'+f((o=(o=t&&t.currentUser,o==null||o===!1?o:o.display_name),typeof o===a?o.apply(t):o))+"</a> ",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.post.reply_of_reply",u):l.call(t,"t","common.post.reply_of_reply",u)))+' <a href="#">'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.display_name),typeof o===a?o.apply(t):o))+"</a></p>",s})}),define("modules/common/views/messages/reply_box",["jquery","underscore","tibbr","../../models/reply","modules/dialog","modules/common/views/post/asset","modules/common/views/post/mentions_input","hbs!modules/common/templates/messages/reply_box","hbs!modules/common/templates/messages/reply_to_reply_form","hbs!modules/common/templates/messages/reply_to_reply"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({errors:[],className:"reply-box-form compact",initialize:function(){t.bindAll(this,"reset","postComment","validateForm","resetButton","compact"),this.bindTo(this.parent,"update:replybox",this.updateReplybox),n.Event.bindTo(this,"show:upload",this.showUpload),this._richText=n.richText||{}},events:{"click button.btn-submit":"postComment","focus textarea.message-box":"focus","click div.js-reply-redactor":"focus",click:"handelClick"},handelClick:function(e){e.stopPropagation()},focus:function(e){this.$el.removeClass("compact");if(this.richText){this.$(".comment-box-wrap, .js-reply-redactor").hide(),this.$(".redactor_box").show();try{this.$(".redactor").setCode("<p><br></p>").setFocus()}catch(t){}}},compact:function(n){var r=this;if(e("#tibbr-ui-dialog").length===1)return;if(e(n.target).is("button"))return;return r.richText?t.str.stripTags(r.$("textarea.redactor").val()||"").length===0&&!e(n.target).hasClass("ui-button-text")&&!e(n.target).hasClass("reply-link")&&this.compactRichText():t.str.trim(r.$("textarea").val()).length===0&&!e(n.target).hasClass("js-blank-reply")&&r.$el.addClass("compact"),r.$(".replying, .reply_to_reply").remove(),!0},compactRichText:function(){this.$el.addClass("compact"),this.$(".comment-box-wrap, .js-reply-redactor").show(),this.$(".redactor_box").hide()},render:function(){return this.$el.html(this.renderTemplate(u)),this.assetView=this.initChild(s,{model:this.model,reply:!0,asset:t.isUndefined(this.options.asset)?!0:this.options.asset}),this.$(".asset-holder").html(this.assetView.render().el),this.$("form").attr({action:n.serverUrl("messages"),target:"iframe-"+this.cid}).csrfToken(),this.renderTibBox(),e("body").on("click",this.compact),this},renderTibBox:function(){!this._richText.enable||n.IE7?this.renderMentionInput():this.renderRedactor()},renderMentionInput:function(){this.mentionsInput=this.initChild(o,{placeholder:this.t("message.comment"),height:20,resource:this.options.resource,params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0}}}),this.$(".comment-box-wrap").html(this.mentionsInput.render().el),this.mentionsInput.bind()},renderRedactor:function(){var e=this;e.richText=!0,this.$(".comment-box-wrap").html('<div style="border: 0px; height: 15px; cursor: text; color: #bbbbbb" class="js-reply-redactor hidden input">'+this.t("message.comment")+"</div>"),t.delay(function(){e.$(".comment-box-wrap").hide().after("<textarea class='redactor js-redactor-reply'>");var t=e.$(".redactor");t.redactor({plugins:["mention"],tabFocus:!1,buttons:e._richText.reply_tool_bar,allowedTags:e._richText.allowed_tags,linebreak:!0}),t.insertHtml(""),e.$(".redactor_toolbar").css("width",81),e.$el.removeClass("compact")},10)},submit:function(i){i.preventDefault();var s=this;window.currentPostTarget=i.currentTarget,e(i.currentTarget).hide().parent().append(n.UI.loader);var o=this.$("form"),u=o.attr("action"),a=o.serializeJSON(),f=o.find("input.js-og-files").data("resources"),l=t.str.trim(o.find("input.js-link-url").val()||"");l.length>3&&(a.message.links=[{title:o.find("input.js-link-title").val(),url:l}]),f&&(a.message.resources=f),this.ajax({contentType:"application/json; charset=utf-8",url:u,data:JSON.stringify(a),global:!0,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")}}).done(function(e){var t=new r(e);s.parent.trigger("replyAdded",1,t),n.Event.trigger("reply:created",t),n.pub("reply:created",{Message:t.parent_id,Reply:t.id}),s.$(".replying, .reply_to_reply").remove(),s.reset(),s.compactRichText();try{n.tracker.trackSend("comment wall post","User engagement")}catch(i){}}).fail(function(e){s.alertError(e)}).always(function(e){s.resetButton()})},updateReplybox:function(t){return t?this.$("input.reply_to_reply").val()!==t.model.id.toString()&&(this.$(".replying, .reply_to_reply").remove(),this.$("form").prepend(this.renderTemplate(f,{model:t.model})).append(this.renderTemplate(a,{id:t.model.id}))):this.$(".replying, .reply_to_reply").remove(),this.focus(e.Event),!0},postComment:function(t){if(this.validateForm()){var n=this.$(".tib-text").val();this.$(".optional").each(function(t,n){e(n).val().length===0&&e(n).attr("disabled","disabled")}),this.richText?n=this.$(".redactor").mentionHTML():this.$(".tib-text").mentionsInput("val",function(e){n=e}),this.$(".js_content").val(n),this.submit(t)}else i.alert({target:t.currentTarget,text:this.errors.join("<br/>")}),this.errors=[];return!1},validateForm:function(){var e=!0;return this.errors=[],this.richText?t.str.stripTags(this.$(".redactor").mentionHTML()).length===0&&(e=!1,this.errors.push(this.t("message.errors.can_not_blank"))):!Modernizr.input.placeholder&&this.$(".tib-text").val()===this.$(".tib-text").attr("placeholder")?(e=!1,this.errors.push(this.t("message.errors.can_not_blank"))):t.str.trim(this.$(".tib-text").val())===0&&(e=!1,this.errors.push(this.t("message.errors.can_not_blank"))),e},reset:function(){try{this.$(".tib-text").mentionsInput("reset"),this.$(".redactor").setCode("<p><br></p>").setFocus()}catch(e){}this.assetView.clear(),this.resetButton()},resetButton:function(){this.$(".line-loader").hide(),e(window.currentPostTarget).show(),window.currentPostTarget=undefined},resize:function(){return this.mentionsInput&&this.mentionsInput.bind(),!1},showUpload:function(){if(!this.isOnScreen())return;this.$("a[data-type=file]:visible").click()},onLeave:function(){e("body").off("click",this.compact),this.$(".redactor").destroyEditor(),this.$(".redactor").remove()}})}),define("hbs!modules/common/templates/messages/link",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function l(e,t){var n="",r,i;n+="\n",i=(r=(r=e&&e.model,r==null||r===!1?r:r.markup),typeof r===u?r.apply(e):r);if(i||i===0)n+=i;return n+="\n",n}function c(e,t){var r="",i,s;r+='\n<div class="video-attach media-box">\n    ',s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.hasPreview),{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(s||s===0)r+=s;r+='\n    <div class="info">\n        <p class="link-title"><a href="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===u?i.apply(e):i))+'" class="passive-name '+a((i=(i=e&&e.model,i==null||i===!1?i:i.link_type),typeof i===u?i.apply(e):i))+'">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===u?i.apply(e):i))+'</a></p>\n        <p class="site-desc">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.description),typeof i===u?i.apply(e):i))+"</p>\n        <p><span>\n                ",s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.hasPreview),{hash:{},inverse:f.program(11,m,t),fn:f.program(6,p,t),data:t});if(s||s===0)r+=s;return r+="\n            </span>\n        </p>\n    </div>\n</div>\n",r}function h(e,t){var n="",r;return n+='\n    <a href="'+a((r=(r=e&&e.model,r==null||r===!1?r:r.url),typeof r===u?r.apply(e):r))+'" class="ui-inline file lfloat mrm img '+a((r=(r=e&&e.model,r==null||r===!1?r:r.link_type),typeof r===u?r.apply(e):r))+'">\n        <img src="'+a((r=(r=e&&e.model,r==null||r===!1?r:r.preview_image),typeof r===u?r.apply(e):r))+'" style="max-width: 200px; max-height: 60px;"></a>\n    ',n}function p(e,t){var r="",i,s;r+='\n                    <a href="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===u?i.apply(e):i))+'" ',s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.isTibbrLink),{hash:{},inverse:f.program(9,v,t),fn:f.program(7,d,t),data:t});if(s||s===0)r+=s;return r+=" >"+a((i=(i=e&&e.model,i==null||i===!1?i:i.shortUrl),typeof i===u?i.apply(e):i))+"</a>\n            ",r}function d(e,t){return'\n                       target="_self" '}function v(e,t){return'target="_blank" '}function m(e,t){var r="",i,s;r+='\n                    <!--<i class="ui-inline-icon link-icon"></i>-->\n                <a href="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===u?i.apply(e):i))+'" ',s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.isTibbrLink),{hash:{},inverse:f.program(9,v,t),fn:f.program(12,g,t),data:t});if(s||s===0)r+=s;return r+=" >"+a((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===u?i.apply(e):i))+"</a>\n            ",r}function g(e,t){return'\n                   target="_self" '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o,u="function",a=this.escapeExpression,f=this;return o=n["if"].call(t,(s=t&&t.model,s==null||s===!1?s:s.hasMarkup),{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i}),o||o===0?o:""})}),define("modules/common/views/messages/link_item",["jquery","underscore","tibbr","../../models/link","modules/dialog","hbs!modules/common/templates/messages/link"],function(e,t,n,r,i,s){return n.View.extend({tagName:"li",className:"asset-attachment",events:{"click a.video":"showVideo","click a.show_as_tab":"showAsTab"},render:function(){return this.$el.html(this.renderTemplate(s)),this.model.isTibbrLink()||this.$("a").attr("target","_blank"),this.model.isVideo()&&this.$("a").addClass("video"),window.gadget&&this.$("a").addClass("js-publish-link"),this},showVideo:function(){return this.$el.html(this.model.markup()),this.$("iframe").height("315").width("560"),!1},showAsTab:function(r){var s=e(r.currentTarget),o=t.str.underscored(s.attr("title"))+this.model.id;return s.data("ended")?i.alert({text:this.t("tibcast.ended_alert")}):e("#wall-tabs").length>0?n.application.wallTabView.addWithIframe({title:s.attr("title"),src:s.attr("href"),zoomView:s.data("zoomview"),"switch":!0,id:o,model:this.model}):window.open(s.attr("href")),!1}})}),define("modules/common/views/messages/link_list",["jquery","underscore","tibbr","./link_item"],function(e,t,n,r){return n.View.extend({tagName:"ul",initialize:function(e){this.bindTo(this.collection,"reset",this.render)},render:function(){var t=this.collection,n=e(this.el),i=this;return t.each(function(e){n.append(i.initChild(r,{model:e,collection:t}).render().el)}),this}})}),define("hbs!modules/common/templates/messages/asset_image",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,l;r+='\n    <img src="'+u((i=(i=e&&e.model,i==null||i===!1?i:i.previewUrl),typeof i===o?i.apply(e):i))+'"  class="js-qtip" title="'+u((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===o?i.apply(e):i))+'">\n    ',l={hash:{},inverse:a.noop,fn:a.program(2,c,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.isNative),"===",!1,l):f.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.isNative),"===",!1,l));if(s||s===0)r+=s;return r+="\n\n",r}function c(e,t){var r="",i,s;r+='\n        <div class="asset-details info">\n            <p><a class=" js-link js-action-target-link" href="'+u((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===o?i.apply(e):i))+'"\n                  data-target="'+u((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===o?i.apply(e):i))+'"\n                  data-native="'+u((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===o?i.apply(e):i))+'" data-app_id='+u((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===o?i.apply(e):i))+">"+u((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===o?i.apply(e):i))+"</a>\n            </p>\n            ",s=n.each.call(e,(i=e&&e.model,i==null||i===!1?i:i.action_links),{hash:{},inverse:a.noop,fn:a.programWithDepth(3,h,t,e),data:t});if(s||s===0)r+=s;return r+="\n        </div>\n    ",r}function h(e,t,r){var i="",s,a;return i+='\n                <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===o?s.call(e,{hash:{},data:t}):s),i+=u(s)+'" class="btn js-action-target-link" data-native="'+u((s=(s=r&&r.model,s==null||s===!1?s:s.isNative),typeof s===o?s.apply(e):s))+'"\n                   data-target="',(a=n.display_target)?a=a.call(e,{hash:{},data:t}):(a=e&&e.display_target,a=typeof a===o?a.call(e,{hash:{},data:t}):a),i+=u(a)+'" data-app_id='+u((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===o?s.apply(e):s))+">",(a=n.label)?a=a.call(e,{hash:{},data:t}):(a=e&&e.label,a=typeof a===o?a.call(e,{hash:{},data:t}):a),i+=u(a)+"</a>\n            ",i}function p(e,t){var n="",r;return n+='\n    <img src="'+u((r=(r=e&&e.model,r==null||r===!1?r:r.thumbnailUrl),typeof r===o?r.apply(e):r))+'" class="js-qtip" title="'+u((r=(r=e&&e.model,r==null||r===!1?r:r.title),typeof r===o?r.apply(e):r))+'" style="cursor: pointer"/>\n',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this,f=n.helperMissing;return s=n["if"].call(t,t&&t.isSingleImage,{hash:{},inverse:a.program(5,p,i),fn:a.program(1,l,i),data:i}),s||s===0?s:""})}),define("hbs!modules/common/templates/messages/asset",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n    <a class="js-action-target-link"\n       href="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.download_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'"\n       data-target="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.download_link),i==null||i===!1?i:i.display_target),typeof i===f?i.apply(e):i))+'"\n       data-native="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===f?i.apply(e):i))+'"\n       data-action_link="',s={hash:{},data:t},r+=l((i=n.stringify||e&&e.stringify,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.download_link),s):c.call(e,"stringify",(i=e&&e.model,i==null||i===!1?i:i.download_link),s)))+'"\n       data-app_id='+l((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===f?i.apply(e):i))+'>\n        <img src="',s={hash:{},data:t},r+=l((i=n.themeImagePath||e&&e.themeImagePath,i?i.call(e,"download-arrow.png",s):c.call(e,"themeImagePath","download-arrow.png",s)))+'" class="download-menu-icon">\n    </a>\n\n\n',r}function d(e,t){var r="",i,s,o;r+='\n    <div class="asset-details info">\n        <p><a class=" js-link js-action-target-link js-qtip"\n              title="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===f?i.apply(e):i))+'"\n              href="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'"\n              data-target="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===f?i.apply(e):i))+'"\n              data-native="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===f?i.apply(e):i))+'"\n              data-action_link="',o={hash:{},data:t},r+=l((i=n.stringify||e&&e.stringify,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.default_link),o):c.call(e,"stringify",(i=e&&e.model,i==null||i===!1?i:i.default_link),o)))+'"\n              data-app_id='+l((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===f?i.apply(e):i))+">",o={hash:{},data:t},r+=l((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.title),60,o):c.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.title),60,o)))+"</a></p>\n\n        ",s=n["if"].call(e,(i=e&&e.model,i==null||i===!1?i:i.isNative),{hash:{},inverse:h.program(6,m,t),fn:h.program(4,v,t),data:t});if(s||s===0)r+=s;return r+="\n    </div>\n",r}function v(e,t){var r="",i,s;return r+='\n            <a href="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'" data-action_link="',s={hash:{},data:t},r+=l((i=n.stringify||e&&e.stringify,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.default_link),s):c.call(e,"stringify",(i=e&&e.model,i==null||i===!1?i:i.default_link),s)))+'"\n               class="btn js-action-target-link">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"message.download",s):c.call(e,"t","message.download",s)))+"</a>\n\n        ",r}function m(e,t){var r="",i,s;r+="\n\n            ",s=n.each.call(e,(i=e&&e.model,i==null||i===!1?i:i.action_links),{hash:{},inverse:h.noop,fn:h.programWithDepth(7,g,t,e),data:t});if(s||s===0)r+=s;return r+="\n        ",r}function g(e,t,r){var i="",s,o,u;return i+='\n                <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===f?s.call(e,{hash:{},data:t}):s),i+=l(s)+'" class="btn js-action-target-link"\n                   data-action_link="',u={hash:{},data:t},i+=l((s=n.stringify||e&&e.stringify,s?s.call(e,e,u):c.call(e,"stringify",e,u)))+'"\n                   data-native="'+l((s=(s=r&&r.model,s==null||s===!1?s:s.isNative),typeof s===f?s.apply(e):s))+'"\n                   data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+'" data-app_id='+l((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===f?s.apply(e):s))+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+"</a>\n            ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<a class="file lfloat mrm icon js-link  js-qtip js-action-target-link"\n   href="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.link),typeof o===f?o.apply(t):o))+'"\n   title="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'"\n   data-target="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===f?o.apply(t):o))+'"\n   data-native="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===f?o.apply(t):o))+'"\n   data-action_link="',a={hash:{},data:i},s+=l((o=n.stringify||t&&t.stringify,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.default_link),a):c.call(t,"stringify",(o=t&&t.model,o==null||o===!1?o:o.default_link),a)))+'"\n   data-app_id='+l((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===f?o.apply(t):o))+'>\n    <img src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.imageIcon),a):c.call(t,"imagePath",(o=t&&t.model,o==null||o===!1?o:o.imageIcon),a)))+'" style="max-height: 60px;max-width: 60px;"/>\n</a>\n',u=(o=(o=t&&t.model,o==null||o===!1?o:o.appIcon),typeof o===f?o.apply(t):o);if(u||u===0)s+=u;s+="\n",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.downloadUrl),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n\n",u=n["if"].call(t,t&&t.isSingle,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;return s+="\n\n\n\n",s})}),define("modules/common/views/messages/asset_item",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/asset_image","hbs!modules/common/templates/messages/asset"],function(e,t,n,r,i){var s=n.View.extend({tagName:"li",events:{"click a.js-action-target-link":"actionTargetLink"},render:function(){var e=this.model.isImage(),t=this.collection.length===1&&e,s=this.collection.length===1,o=e?r:i;this.$el.html(this.renderTemplate(o,{isSingle:s,isSingleImage:t}));if(s){var u=t?"single-image":"single";this.$el.addClass(u).end()}return this.$(".js-qtip").qtip(n.qtipConfigs.tipsy()),this}});return t.extend(s.prototype,n.Modules.View.ActionLink),s}),define("modules/common/views/messages/asset_list",["jquery","underscore","tibbr","./asset_item"],function(e,t,n,r){return n.View.extend({tagName:"div",className:"attached-file-list",moreTempl:'<div class="more-pics"><a data-index="4" class="overlay"><i class="ui-inline-icon add-icon "></i><strong>{{number}}</strong><strong>{{t "common.more" }}</strong></a></div>',initialize:function(e){t.bindAll(this,"render","preViewImage"),this.type=e.type||"assets";var n=3,r=this.collection.length;this.hasMore=r>n&&this.type==="images",this.type==="assets"&&this.$el.css({width:"auto"}),this.type==="images"?(this.limit=n,this.classes="multi-image-list images-in-center clearfix",r<3&&(this.classes=this.classes+" compact")):(this.limit=r,this.classes="multi-files-list clearfix")},events:{"click .overlay":"preViewImage"},render:function(){this.$el.html("<ul/>"),this.type==="images"&&this.$("ul").append("<li class='img-1'></li><li class='img-2 empty'></li><li class='img-3 empty'></li>");var e=this.collection,n=this.$("ul"),i=this;return n.addClass(i.classes),t.each(e,function(t,s){if(s>=i.limit)return;var o=i.initChild(r,{model:t,collection:e,isCommunity:i.options.isCommunity,messageId:i.options.messageId,hostUrl:i.options.hostUrl});i.type==="images"?(o.$el.addClass("overlay"),i.$(".img-"+(s+1)).replaceWith(o.render().el)):(o.$el.addClass("asset"),n.append(o.render().el))}),this.hasMore&&this.$("li:last").append(this.renderInLineTemplate(this.moreTempl,{cacheKey:"asset_list_image_more",number:this.collection.length-i.limit})),this.$("li:last").addClass("last"),this},preViewImage:function(r){var i=this;r.preventDefault();if(i.options.isCommunity)return;if(e("#tibbr-ui-dialog").length>0)return!1;this.$("a.js-c-images").length===0&&t.each(this.collection,function(t){this.$el.append(e("<a>",{href:t.previewUrl(),title:t.get("title"),html:e("<a>",{"class":"btn cbox-btn",href:t.downloadUrl(),target:"_blank",html:'<i class="ui-inline-icon download-icon"></i><span>'+i.t("common.download")+"</span>"}),"class":"hidden js-c-images",rel:"colorbox-"+this.cid}))},this);var s=this.$(".overlay").index(r.currentTarget),o="750px",u="500px",a=!0;if(window.gadget){var f=e(window).width();o=f<600?f-20:"600px",u="400px",a=!1}var l={rel:"colorbox-"+this.cid,photo:!0,multiPhotos:!0,info:!0,slideshow:a,slideshowAuto:!1,slideshowStart:'<a class="btn cbox-btn"><i class="ui-inline-icon slideshow-icon"></i><span>'+i.t("common.slideshow")+"</span></a>",slideshowStop:'<a class="btn cbox-btn"><i class="ui-inline-icon pause-icon"></i><span>'+i.t("common.slideshow")+"</span></a>",scalePhotos:!0,preloading:!0,opacity:"0.45",width:o,height:u,current:'<span class="active">{current}</span> of {total}',target:this.$("a.js-c-images").get(s),onOpen:function(){e("#colorbox").css("z-index",99999),n.publish("resize",e(window).height()+200)},onClosed:function(){e("#colorbox").css("z-index",9999)}};if(window.gadget){var c=this.$el.offset();l.top=c.top-100}return e.fn.colorbox(l),!1}})}),define("modules/common/views/messages/mixed_asset_list",["jquery","underscore","tibbr","./asset_list"],function(e,t,n,r){return n.View.extend({initialize:function(e){var t=this.collection;this.images=t.images(),this.assets=t.assets()},render:function(){var e=this.$el;return this.images.length>0&&e.append(this.initChild(r,{collection:this.images,isCommunity:this.options.isCommunity,type:"images"}).render().el),this.assets.length>0&&e.append(this.initChild(r,{collection:this.assets,isCommunity:this.options.isCommunity,hostUrl:this.options.hostUrl,messageId:this.options.messageId}).render().el),this}})}),define("hbs!modules/common/templates/messages/delete",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<p>\n    <span class="confirm-msg">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.delete",u):a.call(t,"t","message.delete",u)))+'</span>\n    <a href="#" class="yes btn btn-submit">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.yes_button",u):a.call(t,"t","common.yes_button",u)))+'<i class="arrow next"></i></a>\n    <a class="cancel-btn" href="#">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.cancel",u):a.call(t,"t","common.cancel",u)))+"</a>\n</p>\n",s})}),define("modules/common/views/messages/delete",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/delete"],function(e,t,n,r){return n.View.extend({className:"confirm-delete",initialize:function(){t.bindAll(this,"cancel")},events:{"click a.cancel-btn":"cancel","click a.yes":"yes"},render:function(){return this.$el.html(this.renderTemplate(r)),this},cancel:function(){return this.$el.parent().children(":not('.hidden')").show(),this.$el.remove(),!1},yes:function(){var e=this;return this.model.destroy({complete:function(){n.pub("delete",{Message:e.model.id}),e.model.get("parent_id",null)?e.options.replyList.trigger("replyDeleted",-1,e.model):n.currentUser.messages&&n.currentUser.messages.remove(e.model),n.Event.trigger("message:deleted",e.model),n.currentSubject&&n.currentSubject.set("messages_reset",!0),e.params().controller==="subjects"?n.Event.trigger("announcement:change",{subjectId:e.params().id}):e.params().controller==="home"&&n.Event.trigger("announcement:change",{subjectId:undefined})}}),this.$el.parent().remove(),!1}})}),define("hbs!modules/common/templates/messages/copy_link",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<p style="min-width: 350px">\r\n\r\n<h2>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.copy_link_title",a):f.call(t,"t","message.copy_link_title",a)))+'</h2>\r\n<hr/>\r\n<textarea id="copy_link" style="width:450px">',(u=n.copy_link)?u=u.call(t,{hash:{},data:i}):(u=t&&t.copy_link,u=typeof u===c?u.call(t,{hash:{},data:i}):u),s+=l(u)+"</textarea>\r\n</p>\r\n",s})}),define("modules/common/views/messages/copy_link",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/copy_link"],function(e,t,n,r){return n.View.extend({className:"copy-link-info",render:function(){return this.$el.html(this.renderTemplate(r,{copy_link:this.options.copyText})),this}})}),define("hbs!modules/common/templates/messages/reply",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){return'\n    <div class="entry like-reply-box">\n'}function d(e,t){return'\n            <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\n        '}function v(e,t){var r="",i,s,o;r+='\n                <i class="arrow next"></i>\n                <a class="profile-name1 user_url reply-profile-hover js-reply-to-reply-hover js-publish js-vipable"\n                   data-event_key="user.selected"\n                   data-event_data="',o={hash:{},data:t},r+=l((i=n.setData||e&&e.setData,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.user),o):f.call(e,"setData",(i=e&&e.model,i==null||i===!1?i:i.user),o)))+'"\n                   data-id="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.id),typeof i===c?i.apply(e):i))+'"\n                   data-type="user"\n                   href="',o={hash:{},data:t},r+=l((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",(i=(i=e&&e.model,i==null||i===!1?i:i.reply_of_reply),i==null||i===!1?i:i.user),o):f.call(e,"urlFor","show",(i=(i=e&&e.model,i==null||i===!1?i:i.reply_of_reply),i==null||i===!1?i:i.user),o)))+'">'+l((i=(i=(i=(i=e&&e.model,i==null||i===!1?i:i.reply_of_reply),i==null||i===!1?i:i.user),i==null||i===!1?i:i.display_name),typeof i===c?i.apply(e):i))+"\n                    ",s=n["if"].call(e,(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.isVip),{hash:{},inverse:h.noop,fn:h.program(6,m,t),data:t});if(s||s===0)r+=s;return r+="\n                </a>\n            ",r}function m(e,t){return'\n                        <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\n                    '}function g(e,t){var r="",i,s;return r+='\n            <div>\n                <a id="geo-loc-reply" href="#" class="geo-loc-reply" title="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),typeof i===c?i.apply(e):i))+'"><i\n                        class="ui-inline-icon geo-icon"></i> ',s={hash:{},data:t},r+=l((i=n.truncate||e&&e.truncate,i?i.call(e,(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),40,s):f.call(e,"truncate",(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),40,s)))+'</a>\n\n                <div class="geo-map-reply"></div>\n                <span class="geo-map-nearBy-loaded"></span>\n            </div>\n        ',r}function y(e,t){var r="",i,s;r+="\n            ",i=n["if"].call(e,e&&e.canReplyOfReply,{hash:{},inverse:h.noop,fn:h.program(11,b,t),data:t});if(i||i===0)r+=i;return r+='\n            <span>|</span>\n                <a class="more-actions js-reply-actions"> ',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"message.more",s):f.call(e,"t","message.more",s)))+' <i class="arrow down"></i></a>\n            ',r}function b(e,t){var r="",i,s;return r+='\n            <span>|</span>\n                <a class="reply-link js-reply-to-reply no-reply" href="',s={hash:{},data:t},r+=l((i=n.url||e&&e.url,i?i.call(e,"messages",(i=e&&e.model,i==null||i===!1?i:i.parent_id),s):f.call(e,"url","messages",(i=e&&e.model,i==null||i===!1?i:i.parent_id),s)))+'"\n                   title="',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"actions.msg_reply",s):f.call(e,"t","actions.msg_reply",s)))+'">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"actions.msg_reply",s):f.call(e,"t","actions.msg_reply",s)))+"</a>\n            ",r}function w(e,t){var r="",i,s;return r+='\n                <a class="js-delete-reply delete-link">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"actions.delete",s):f.call(e,"t","actions.delete",s)))+"</a>\n            ",r}function E(e,t){var r="",i,s;return r+='\n    </div>\n    <div class="message-profile">\n        <p>\n            <em></em>\n            <a>',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"message.view_complete_post",s):f.call(e,"t","message.view_complete_post",s)))+"</a>\n        </p>\n    </div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;a={hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,t&&t.templateFor,"===","likes",a):f.call(t,"compare",t&&t.templateFor,"===","likes",a));if(u||u===0)s+=u;s+='\n    <a class="profile-pic profile-hover js-reply-hover js-publish js-vipable"\n       data-event_key="user.selected"\n       data-event_data="',a={hash:{},data:i},s+=l((o=n.setData||t&&t.setData,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"setData",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'"\n       data-id="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.id),typeof o===c?o.apply(t):o))+'"\n       data-type="user"\n       href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"urlFor","show",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'">\n        <img src="',a={hash:{},data:i},s+=l((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.profile_image_url),3,a):f.call(t,"assetImage",(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.profile_image_url),3,a)))+'" class="bordered-large medium"/>\n        ',u=n["if"].call(t,(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.isVip),{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+='\n    </a>\n    <div class="info js-reply-content">\n        <div class="msg tib-content">\n            <a class="js-reply-hover js-publish user_url"\n               data-event_key="user.selected"\n               data-event_data="',a={hash:{},data:i},s+=l((o=n.setData||t&&t.setData,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"setData",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'"\n               href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"urlFor","show",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'">'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.display_name),typeof o===c?o.apply(t):o))+"</a>\n            ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.reply_of_reply),{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='\n            <div class="js-reply-text reply-text">',u=(o=(o=t&&t.model,o==null||o===!1?o:o.getRichContent),typeof o===c?o.apply(t):o);if(u||u===0)s+=u;s+=' </div>\n        </div>\n        <div class="eog-holder hidden" id="eog-holder-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===c?o.apply(t):o))+'"></div>\n        <div class="attach-holder h-scroll hidden"></div>\n        ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.hasGeoMap),{hash:{},inverse:h.noop,fn:h.program(8,g,i),data:i});if(u||u===0)s+=u;s+='\n\n        <p class="action-links msg-action-links">\n            <i class="ui-inline-icon clock-icon"></i>\n            <i class="small time-stamp msg-datetime">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.postedAt),typeof o===c?o.apply(t):o))+'</i>\n            <span>|</span>\n            <a href="#" class="reply-like js-like-action-reply">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"actions.like",a):f.call(t,"t","actions.like",a)))+"</a>\n            ",u=n["if"].call(t,t&&t.hasParent,{hash:{},inverse:h.noop,fn:h.program(10,y,i),data:i});if(u||u===0)s+=u;s+="\n            ",u=n["if"].call(t,t&&t.canDelete,{hash:{},inverse:h.noop,fn:h.program(13,w,i),data:i});if(u||u===0)s+=u;s+='\n\n        </p>\n\n        <p class="like-replies js-like-reply"></p>\n    </div>\n',a={hash:{},inverse:h.noop,fn:h.program(15,E,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,t&&t.templateFor,"===","likes",a):f.call(t,"compare",t&&t.templateFor,"===","likes",a));if(u||u===0)s+=u;return s})}),define("modules/common/views/messages/reply_list_item",["jquery","underscore","tibbr","modules/dialog","../../models/message","../../collections/users","modules/common/views/messages/link_list","modules/common/views/messages/mixed_asset_list","modules/common/views/messages/delete","modules/common/views/common/hover_profile","./copy_link","hbs!modules/common/templates/messages/reply"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.View.extend({className:"reply",tagName:"li",likeType:"reply",initialize:function(){t.bindAll(this,"like","renderLike","showGeoLoc","profileHover","msg_reply","showCompleteMessage"),this.bindTo(this.model,"like:change",this.renderLike,this),this.bindTo(this.model,"like.delete.star:change",this.renderLikeNDelete,this),this.parentMessage=this.options.message,this.bindTo(this.model,"change",function(){this.parentMessage&&n.Event.trigger("model:change",this.parentMessage)})},events:{"click a.reply-like":"like","click a.js-reply-to-reply":"msg_reply","click a.js-delete-reply":"delete","click a.geo-loc-reply":"showGeoLoc","click a.continued":"continuedText","click div.message-profile":"showCompleteMessage","click a.js-custom-link":"customLink","click .js-reply-content  a.js-hash-tag":"hashTags","click a.create_meeting":"create_meeting"},render:function(){this.$el.html(this.renderTemplate(c,{templateFor:this.options.templateFor,include:["geo_location","user"],canDelete:window.gadget&&(this.model.get("user").id===n.currentUser.id||t.str.include(this.model.get("actions"),"delete")),canReplyOfReply:this.parentMessage&&!this.parentMessage.get("closed"),hasParent:this.parentMessage instanceof n.Model}));if(this.model.isUnread()){var e=this.model.get("reply_of_reply")?".js-reply-to-reply-hover.user_url":".js-reply-hover.user_url";this.$(e).after("<span class='badge-new'>"+this.t("common.new")+"</span>"),this.parent&&this.parent.parent&&this.parent.parent.$el.addClass("js-new-entry")}return this.model.links.length>0&&this.$(".attach-holder").append(this.initChild(o,{collection:this.model.links}).render().el).show(),this.model.parseResources(),this.model.assets.length>0&&this.$(".attach-holder").append(this.initChild(u,{collection:this.model.assets}).render().el).show(),this.renderLike(),this.profileHover(),this.renderResource(),this.model.user.get("deleted")&&this.$(".profile-pic:first").addClass("ex-employee-pic"),this.parentMessage instanceof n.Model&&this.moreMenu(),this},msg_reply:function(e){e.preventDefault();var n=this;return t.delay(function(){n.parent&&n.parent.focusReplyBox(n.model)}),!1},renderLikeNDelete:function(){var e=this.model.get("bulk_actions").split(",");t.include(e,"unlike")&&this.model.get("is_liked_by_current_user")===!1&&(this.model.get("like_to").push(n.currentUser.toJSON()),this.renderLike())},profileHover:function(){if(!n.hoverCard)return;this.$(".js-reply-hover").qtip(n.qtipConfigs.hovercard(f,{model:this.model.user})),this.model.replyUser&&this.$(".reply-profile-hover").qtip(n.qtipConfigs.hovercard(f,{model:this.model.replyUser})),this.$(".mention-hover").each(function(){e(this).qtip(n.qtipConfigs.hovercard(f,{model:!1,object:e(this).data().obj}))})},"delete":function(){var e=this.$(".confirm-delete");return this.$el.children().hide(),e.length===0&&this.$el.append(this.initChild(a,{model:this.model,replyList:this.parent.collection}).render().el),e.show(),!1},showGeoLoc:function(){var e=this.$(".geo-map-reply"),t=this.model;return e.hasClass("loaded")?(e.slideToggle("slow"),!1):(n.gMap.connect().done(function(){n.gMap.display(e,{latitude:t.geo_location.get("latitude"),longitude:t.geo_location.get("longitude"),width:540})}),e.addClass("loaded").show(),!1)},continuedText:function(){return this.$(".js-reply-text").html(this.model.getRichContent(!0)),this.profileHover(),!1},showCompleteMessage:function(){var e=new i({id:this.model.get("parent_id")}),t=this;return this.$el.html(n.UI.loader),e.fetch({data:{replies_per_page:2,paginate_replies:!0},success:function(e){var r=t.initChild(n.MessageView,{model:e});t.$el.html(r.render().el)}}),!1},manageActions:function(){var r=e.Deferred(),i=this,s=this.model.actions();if(!this.model.get("fetch_action")){var o=t.isUndefined(i.options.subject_id)?"":i.options.subject_id;n.currentUser.actionsForMessages([i.model.id],o).done(function(e){var n=e.actions_array[0].actions.split(","),o=t.union(s,n).join(",");i.model.set("actions",o,{silent:!0}),r.resolve(i.model.actions())})}else r.resolve(this.model.actions());return r.promise()},resetActionDropDown:function(){try{this.$(".js-more-actions").qtip("api").rendered=!1}catch(e){}},copy_link:function(){return this.renderDialog(l,{copyText:this.model.copyUrl(),dialog:{width:500,height:200}}),!1},share:function(){this.parent.parent.share()},email:function(){this.parent.parent.email()},navigate:function(e){e.method&&t.isFunction(this[e.method])&&this[e.method](e)},customLink:function(e){return typeof window.customActionLink=="function"&&window.customActionLink(e,n,this.model),!1},menuActions:function(e){switch(e){case"manage":return this.model.actions();case"apps":return this.model.appsActions;case"share":return this.model.shareActions;default:return[]}},moreMenu:function(){if(params.more_actions==="false"||n.Helper.themeName()==="compact"){this.$(".js-reply-actions").remove();return}this.$(".js-delete-reply").remove();var r=this;this.$(".js-reply-actions").qtip({position:{at:"bottom center",my:"top center",adjust:{x:18,y:0},viewport:e(window)},show:{event:"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus",style:{classes:"more-menu qtip-light qtip-shadow dropdown",tip:{border:1,width:12,height:10,offset:10}},content:{text:"<ul class='dropdown-menu'><li>"+spinner+"</li></ul>"},events:{render:function(i,s){r.manageActions().done(function(){var i=e('<ul class="dropdown-menu"></ul>'),o=r.model.mainMenu;t.each(o,function(n){var s=r.menuActions(n);if(n==="manage"&&s.length===0)return;i.append('<li class="js-'+n+'"><a class="js-more-subnav"><i class="ui-inline-icon '+n+'-icon"></i>'+" <span>"+r.t("actions.main."+n)+"</span> "+'<i class="arrow next"></i></a>');var o=e("<ul class='sub-menu hidden'></ul>");t.each(s,function(e){o.append('<li><a class="'+e+'" data-method="'+e+'">'+r.t("actions."+e)+"</a></li>"),i.find("li.js-"+n).append(o)}),n==="apps"&&(t.each(r.model.messageApps,function(t){o.append(e("<li/>").append(e("<a/>",{"data-href":t.url()+"&message_id="+r.model.get("id"),title:t.get("tooltip"),"data-open_separete":t.get("open_separete"),"class":"app-link","data-method":"message_apps","data-height":t.get("height")||600,"data-width":t.get("width")||500,text:t.get("title")})))}),i.find("li.js-"+n).append(o))}),t.each(r.model.customActions(),function(e){i.append('<li class="js-custom-action"><a  data-method="custom_action" data-handler="'+e.handler+'">'+'<i class="ui-inline-icon custom-icon"></i> <span>'+r.t("actions."+e.key)+"</span></a>")}),s.set("content.text",i),s.elements.content.find(".js-more-subnav").each(function(){e(this).qtip({position:{at:"right top",my:"left top",adjust:{x:0,y:-4},viewport:e(window)},show:{event:"mouseover",solo:!1,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus",style:{classes:"more-menu qtip-light qtip-shadow dropdown",tip:!1},events:{render:function(t,n){n.elements.content.on("click","a",function(){var t=e(this);return r.navigate(t.data()),n.hide(),!1})},show:function(i,s){e(".js-more-subnav").qtip("hide"),t.delay(function(){s.elements.content.find("a.copy_link").data("copy",r.model.copyUrl()).zclip({path:n.path("/images/swf/ZeroClipboard.swf"),copy:function(){return e(this).data("copy")},afterCopy:function(){e(this).trigger("copied")}})},100)},hide:function(e,t){t.elements.content.find("a.copy_link").zclip("remove")}},content:{text:e(this).closest("li").find(".sub-menu").clone().show()}})}),s.elements.content.on("hover","li.js-custom-action",function(){return e(".js-more-subnav").qtip("hide"),!1}),s.elements.content.on("click","li.js-custom-action > a",function(){var t=e(this);return r.custom_action(t.data(),t),s.hide(),!1})})}}})},message_apps:function(e){if(e.open_separete)return window.open(e.href);var t=e.width||200;return r.view("<iframe frameborder='0' height='"+e.height+"' width='"+t+"' src='"+e.href+"'></iframe>",{modal:!0,width:t+40,height:e.height})},create_meeting:function(){var e=requirejs("views/home/meeting_list");return r.render(e,{modal:!0,model:this.model,complete:function(e){e.$el.css({width:"auto"})},dialog:{width:410,height:250,title:this.t("common.choose_provider"),className:"create-meeting-dialog"}}),!1}});return t.extend(h.prototype,n.Modules.View.ActionLink),t.extend(h.prototype,n.Modules.View.Like),t.extend(h.prototype,n.Modules.View.Resource),h}),define("hbs!modules/common/templates/messages/reply_list",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){return'\n    <li class="all-comments">\n        <p class="comments-count">\n            <a class="toggle-comment" href="#"></a>\n        </p>\n    </li>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=this,l=n.helperMissing,c=this.escapeExpression;a={hash:{},inverse:f.noop,fn:f.program(1,h,i),data:i},u=(o=n.compare||t&&t.compare,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.numberOfReplies),">",2,a):l.call(t,"compare",(o=t&&t.model,o==null||o===!1?o:o.numberOfReplies),">",2,a));if(u||u===0)s+=u;return s+='\n<li class="comments">\n    <ul class="comment-list"></ul>\n</li>\n<li class="reply-box-wrap no-reply">\n    <div class="reply-box">\n        <fieldset class="comment-box-wrap">\n            <input autocomplete="off" id="tib-text" class="js-blank-reply"\n                   placeholder="',a={hash:{},data:i},s+=c((o=n.t||t&&t.t,o?o.call(t,"message.comment",a):l.call(t,"t","message.comment",a)))+'" style="width: 80%; border: 0px;">\n        </fieldset>\n    </div>\n</li>\n',s})}),define("modules/common/views/messages/reply_list",["jquery","underscore","tibbr","../../models/reply","./reply_box","./reply_list_item","hbs!modules/common/templates/messages/reply_list"],function(e,t,n,r,i,s,o){return n.View.extend({className:"replies meta",tagName:"ul",initialize:function(){t.bindAll(this,"focusReplyBox"),this.collection=this.model.messages,this.collection.sortBy(function(e){return e.sort_id}),this.bindTo(this.collection,"add",this.addItem),this.bindTo(this.collection,"update",this.prependItem),this.bindTo(this.collection,"replyDeleted",this.updateReply,this),this.on("replyAdded",this.updateReply,this),this.displayLength=2},events:{"click input.js-blank-reply":"showReplyBox","click a.js-show-all":"toggleComment","click a.js-call":"callComment"},render:function(){return this.$el.html(this.renderTemplate(o)),this.$("input.js-blank-reply").simplePlaceholder(),this.renderList(),this.renderReplies(),this},renderList:function(){this.collection.each(function(e){this.prependItem(e)},this)},reRender:function(){this.$(".comment-list").empty(),this.renderList()},updateReply:function(e,t){this.model.set("replies_count",this.model.get("replies_count")+e,{silent:!0}),this.collection.replies_count+=e,e>0?this.collection.add(t):this.collection.remove(t),this.$("a.toggle-comment").hasClass("reply-paginate")&&this.paginate()},addItem:function(e){this.$("ul.comment-list").append(this.initChild(s,{model:e,message:this.model}).render().el)},prependItem:function(e){this.$("ul.comment-list").prepend(this.initChild(s,{model:e,message:this.model}).render().el)},renderReplyBox:function(){var e=this.$(".reply-box"),t={model:this.model,parent:this,useAPI:this.useAPI};this.resource&&(t.resource={client_id:this.resource.application.id}),params.asset==="false"&&(t.asset=!1),this._replyBoxView&&this._replyBoxView.leave(),this._replyBoxView=new i(t),e.html(this._replyBoxView.render().el),this._replyBoxView.resize()},showReplyBox:function(){var e=this;this.renderReplyBox(),this.$(".reply-box-form").removeClass("compact"),t.delay(function(){e.$(".reply-box-form").find("textarea").focus()})},renderReplies:function(){var e=this.$("a.toggle-comment"),t=this.collection.replies_count,n=t-this.displayLength;if(t===this.collection.length){var r=this.$("li.reply");r.slice(0,r.length-this.displayLength).hide(),e.text(this.t("message.show_count_replies",{count:n})).addClass("js-show-all").show()}else t<=this.collection.per_page?e.text(this.t("message.show_count_replies",{count:n})).addClass("js-call").show():(e.addClass("reply-paginate"),this.paginate())},paginate:function(){this.$("a.toggle-comment").html(this.t("message.replies_pagination",{page:this.collection.length,total:this.collection.replies_count})).addClass("js-call").show()},toggleComment:function(e){e.preventDefault(),this.$(".all-comments").remove(),this.$("li.reply").show()},callComment:function(r){r instanceof e.Event&&r.preventDefault();var i=this.$("a.toggle-comment"),s=this;if(this.collection.hasMorePages){try{this.collection.dataParams.messages_before=this.collection.first().get("sort_id")}catch(o){this.collection.dataParams.messages_before=(t.first(this.model.get("messages"))||{}).sort_id}this.collection.page().fetch({silent:!0,update:!0,beforeSend:function(){i.prepend(n.UI.spinner)}}).done(function(e){s.collection._update(e,{silent:!0}),s.collection.hasMorePages?s.paginate():s.$(".all-comments").remove()})}this.$("li.reply:visible").removeClass("last").last().addClass("last")},focusReplyBox:function(e){this._replyBoxView||this.renderReplyBox();var r=this;t.defer(function(){r._replyBoxView.$("textarea").focus()}),e instanceof n.Model?this.trigger("update:replybox",{model:e}):this.trigger("update:replybox")}})}),define("hbs!modules/common/templates/messages/resources/default",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n            <h5><a class="js-link js-action-target-link"\n                   data-target="'+l((r=(r=(r=e&&e.model,r==null||r===!1?r:r.default_link),r==null||r===!1?r:r.display_target),typeof r===f?r.apply(e):r))+'"\n                   href="'+l((r=(r=(r=e&&e.model,r==null||r===!1?r:r.default_link),r==null||r===!1?r:r.link),typeof r===f?r.apply(e):r))+'"\n                   data-native="'+l((r=(r=e&&e.model,r==null||r===!1?r:r.isNative),typeof r===f?r.apply(e):r))+'"\n                   data-app_id='+l((r=(r=e&&e.model,r==null||r===!1?r:r.app_id),typeof r===f?r.apply(e):r))+">"+l((r=(r=e&&e.model,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+"</a></h5>\n        ",n}function d(e,t,r){var i="",s,o;return i+='\n            <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===f?s.call(e,{hash:{},data:t}):s),i+=l(s)+"&message_id="+l((s=r&&r.message_id,typeof s===f?s.apply(e):s))+'" class="btn js-action-target-link"\n               data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+'" data-app_id='+l((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===f?s.apply(e):s))+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+"</a>\n        ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="app-details">\n    <a class="js-link js-action-target-link ui-inline file lfloat mrm icon"\n       data-target="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===f?o.apply(t):o))+'"\n       href="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.link),typeof o===f?o.apply(t):o))+'"\n       data-native="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===f?o.apply(t):o))+'"\n       data-app_id="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===f?o.apply(t):o))+'"\n       style="text-align: left; height: 60px; "\n       title="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+'">\n        <img src="',a={hash:{},data:i},s+=l((o=n.asset||t&&t.asset,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.image),a):c.call(t,"asset",(o=t&&t.model,o==null||o===!1?o:o.image),a)))+'" height="60"/>\n    </a>\n\n    <div class="info" style="margin: 0px">\n        ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.title),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.action_links),{hash:{},inverse:h.noop,fn:h.programWithDepth(3,d,i,t),data:i});if(u||u===0)s+=u;return s+="\n    </div>\n</div>\n\n\n\n",s})}),define("hbs!modules/common/templates/messages/resources/link",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n                <a href="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.appLink),typeof i===f?i.apply(e):i))+'" class="lfloat icon">\n                    <img class="icon" src="',s={hash:{},data:t},r+=l((i=n.imagePath||e&&e.imagePath,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.appIcon),s):c.call(e,"imagePath",(i=e&&e.model,i==null||i===!1?i:i.appIcon),s)))+'" alt=""></a>\n                ',r}function d(e,t){var n="",r;return n+='\n                        <h5><a href="'+l((r=(r=e&&e.model,r==null||r===!1?r:r.url),typeof r===f?r.apply(e):r))+'" class="js-title">'+l((r=(r=e&&e.model,r==null||r===!1?r:r.title),typeof r===f?r.apply(e):r))+"</a></h5>\n                    ",n}function v(e,t){var n="",r;return n+="\n                        <p>"+l((r=(r=e&&e.model,r==null||r===!1?r:r.description),typeof r===f?r.apply(e):r))+" </p>\n                    ",n}function m(e,t){var r="",i,s;return r+='\n                    <p><a href="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'" class="link">\n                        ',s={hash:{},data:t},r+=l((i=n.asset||e&&e.asset,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.url),s):c.call(e,"asset",(i=e&&e.model,i==null||i===!1?i:i.url),s)))+"\n                    ",r}function g(e,t,r){var i="",s,o,u;return i+='\n                        <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===f?s.call(e,{hash:{},data:t}):s),i+=l(s)+"&message_id="+l((s=r&&r.message_id,typeof s===f?s.apply(e):s))+'" data-action_link="',u={hash:{},data:t},i+=l((s=n.stringify||e&&e.stringify,s?s.call(e,e,u):c.call(e,"stringify",e,u)))+'" class="btn js-action-target-link"\n                           data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+'" data-app_id='+l((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===f?s.apply(e):s))+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+"</a>\n                    ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="app-details">\n    <div class="icon-wrap">\n        <a href="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===f?o.apply(t):o))+'" class="img js-link-img"><img src="',a={hash:{},data:i},s+=l((o=n.asset||t&&t.asset,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.image),a):c.call(t,"asset",(o=t&&t.model,o==null||o===!1?o:o.image),a)))+'" style="max-width: 60px;  max-height: 60px"></a>\n\n        <div class="info">\n            <div class="media-box">\n                ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.appLink),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='\n\n                <div class="info">\n                    ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.title),{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n                    ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.description),{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+="\n                    ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.url),{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+="\n                </a>\n                    ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.action_links),{hash:{},inverse:h.noop,fn:h.programWithDepth(9,g,i,t),data:i});if(u||u===0)s+=u;return s+="\n                </div>\n            </div>\n        </div>\n    </div>\n</div>",s})}),define("hbs!modules/common/templates/messages/resources/meeting",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+='<div class="meeting-details highlighted-section">\n    <div class="meeting-wrap">\n        <a  href="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.meetingUrl),typeof o===f?o.apply(t):o))+'" class="profile-pic"><img src="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.displayImage),typeof o===f?o.apply(t):o))+'" alt="" width="52" height="52" /></a>\n        <div class="info">\n            <h6><a  href="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.meetingUrl),typeof o===f?o.apply(t):o))+'" class="meeting-title">',u=(o=(o=t&&t.model,o==null||o===!1?o:o.description),typeof o===f?o.apply(t):o);if(u||u===0)s+=u;return s+='</a></h6> <p>\n                <a class="tibcast-meeting" href="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.meetingUrl),typeof o===f?o.apply(t):o))+'" target="_blank"><img alt="" src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/resource/join-meeting.png",a):c.call(t,"imagePath","images/resource/join-meeting.png",a)))+'">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"actions.join_meeting",a):c.call(t,"t","actions.join_meeting",a)))+"</a>\n            </p>\n        </div>\n    </div>\n</div>",s})}),define("modules/common/views/messages/resources/item",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/resources/default","hbs!modules/common/templates/messages/resources/link","hbs!modules/common/templates/messages/resources/meeting"],function(e,t,n,r,i,s){return n.View.extend({className:"js-resource highlighted-section",render:function(){return this.$el.html(this._template()).addClass(this.model.get("type").replace("og:","")),this},_template:function(){return this.renderTemplate({"og:meeting":s,"og:link":i}[this.model.get("type")]||r)}})}),define("modules/common/views/messages/resources/list",["jquery","underscore","tibbr","./item"],function(e,t,n,r){return n.View.extend({className:"resource-holder",render:function(){return this.collection.each(function(e){this.$el.append(this.initChild(r,{model:e}).render().el)},this),this}})}),define("hbs!modules/common/templates/messages/mute",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<p class="confirm-msg">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.mute.info",u):a.call(t,"t","message.mute.info",u)))+'</p>\r\n<p class="tar">\r\n    <a class="cancel-btn mrm" href="#">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.cancel",u):a.call(t,"t","common.cancel",u)))+'</a>\r\n    <a href="#" class="yes btn btn-submit">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.yes_button",u):a.call(t,"t","common.yes_button",u)))+'<i class="ui-inline-icon arrow-next"></i></a>\r\n</p>\r\n\r\n',s})}),define("modules/common/views/messages/mute",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/mute"],function(e,t,n,r){return n.View.extend({tagName:"p",className:"confirm-mute",initialize:function(){t.bindAll(this,"render","cancel"),this.bindTo(this.model,"message:mute",this.muteHandler,this)},events:{"click a.cancel-btn":"cancel","click a.yes":"yes"},render:function(){return this.$el.html(this.renderTemplate(r)),this},cancel:function(){return this.parent.$(".js-tib-post").show(),this.closeDialog(),!1},yes:function(){return this.model.mute(),!1},muteHandler:function(){return e("#filters-main_wall").find("> li.current > a").hasClass("my_wall")?(this.parent.remove(),this.closeDialog()):this.cancel(),!1}})}),define("modules/pagebus",["tibbr"],function(e){return function(t,n){return e.PageBus={debug:!1,log:function(){if(this.debug===!1)return;var e=Array.prototype.slice.call(arguments),t=document.getElementById("errorDisplay");t&&(t.innerHTML=t.innerHTML+"<br >"+e.join(" ")),n.console&&console.log&&console.log("Gadget-PageBus:",e.join(" "))},hub:function(){return n.tibbrHub},clearSubs:function(){n.tibbrHub._container._subs.length=0},publish:function(e,t){n.tibbrHub.publish(e,t),this.log("Publish",e)},subscribe:function(e,t){var r=function(e,n,r){t(n)};n.tibbrHub.subscribe(e,r,null,null,null),this.log("Subscribe",e)},unsubscribe:function(e){n.tibbrHub.unsubscribe(e)},checkDebug:function(){if(n.location.href.indexOf("tdebug")>0||this.debug)this.debug=!0},init:function(e){this.checkDebug();var t;if(n.location.href.indexOf("ifmain")<0)try{parent.tibbrManagedHub?t=parent.tibbrManagedHub:(t=this.setup(),parent.tibbrManagedHub=t),this.inLine(t,e),this.log("init","Same domain ")}catch(r){try{this.ifFrame(e),this.log("init","Different domain ")}catch(r){n.tibbrManagedHub=this.setup(),this.inLine(n.tibbrManagedHub,e),this.log("init","Different domains, gadget not created with pagebus, communication would not work")}}else this.log("init","Same domain but  using iframe"),this.ifFrame(e)},setup:function(){var e=this;OpenAjax.hub.enableDebug=e.debug;var t={onPublish:function(e,t,n,r){return!0},onSubscribe:function(e,t){return!0},onSecurityAlert:function(t,n){e.log("setup",t,n)}};return this.log("setup: managedHubParams"),n.tibbrManagedHub=new OpenAjax.hub.ManagedHub(t)},inLine:function(t,r){this.log("InLine","called");var i=this,s=new OpenAjax.hub.InlineContainer(t,"inline"+Math.floor(Math.random()*1111),{Container:{onSecurityAlert:function(e,t){}},InlineContainer:{}}),o=new OpenAjax.hub.InlineHubClient({HubClient:{onSecurityAlert:function(e,t){}},InlineHubClient:{container:s}});o.connect(function(t,s,u){if(s){i.log("InLine hub client connection is succeeded"),n.tibbrHub=o;if(typeof r=="function")try{r()}catch(a){i.log("InLineHubConnectedError",u)}i.log("InLine hub client connection is succeeded: before trigger"),e.Event.trigger("tibco.hub.connected"),i.log("InLine hub client connection is succeeded: after trigger")}else i.log("Error inLine Hub Client Connection")})},ifFrame:function(t){var r=this,i=new OpenAjax.hub.IframeHubClient({HubClient:{onSecurityAlert:function(e,t){r.log("SecurityAlert:",t)}}});this.log("iFrame Hub client is called"),i.connect(function(s,o,u){if(o){r.log("iframe hub client connection is succeeded"),n.tibbrHub=i;if(typeof t=="function")try{t()}catch(a){r.log("onConnect Error Callback:",t)}r.log("iframe hub client connection is succeeded: before trigger"),e.Event.trigger("tibco.hub.connected"),r.log("iframe hub client connection is succeeded: after trigger")}else r.log("Error iFrame Hub Client Connection")}),r.log("iframe hub client is called")},gadgets:function(e,t){t=t||this.setup(),this.log("Pagebus initialized");var r=this,i=e.gadgets.length,s=e.scrolling||"auto";for(var o=0;o<i;o++){var u=e.gadgets[o],a=u.queryString||"",f=u.style||{border:"black solid 1px",width:"100%",height:"600px"},l=r.debug?"&tdebug=1":"";n["hub_"+u.container]=new OpenAjax.hub.IframeContainer(t,"iframe_"+u.container,{Container:{onSecurityAlert:function(e,t){r.log("gadgets:onSecurityAlert",e,t)}},IframeContainer:{parent:document.getElementById(u.container),iframeAttrs:{id:"iframe_"+u.container,scrolling:s,frameBorder:"0",marginheight:"0",marginwidth:"0",style:f},uri:e.gadgetURL+u.name+".html?ifmain=1&"+a+l,tunnelURI:e.tunnelURL.toLowerCase()}}),r.log("iframe container initialized")}}}}(e,window)}),define("modules/common/views/messages/share_on_community",["jquery","underscore","tibbr","modules/pagebus"],function(e,t,n,r){return n.View.extend({render:function(){this.$el.append("<div id='js-gadget'></div>");var e=this;return this.afterRenderToDom().done(function(){e.display()}),this},display:function(){var t=this;return window.tibbrManagedHub=null,r.init(),r.subscribe("tibco.tibbr.message.created",function(){t.dialog.close()}),this.initGadget(),r.subscribe("tibco.tibbr.share.ready",function(){r.publish("tibco.tibbr.message.share",t.model.toJSON())}),r.subscribe("tibco.tibbr.loaded",function(){e("#community_loading").remove()}),r.subscribe("tibco.tibbr.app.initialized",function(t){e("#community_loading").remove(),r.publish("tibco.tibbr.logged_in",{})}),!1},initGadget:function(){r.debug=!0;var e=function(){var e=window.location,t=e.protocol+"//"+e.hostname;return e.port!==""&&(t+=":"+e.port),t+n.context()},t="com-"+Math.floor(Math.random()*1111).toString(),i=t+"-post-to-community",s=e()+"/javascripts/pagebus/tunnel.html",o={tunnelURL:s,gadgetURL:"http://dev.tibbr.com/gadgets/",scrolling:"auto",frameborder:0,gadgets:[{container:"js-gadget",name:"share",style:{border:"0px",width:"100%",height:"500px"}}]};r.gadgets(o,window.tibbrManagedHub)}})}),define("require/autosuggest",["jquery","./underscore-string"],function(e,t){return function(e){e.fn.autoSuggest=function(n,r){function o(e){var t=0;for(k in e)e.hasOwnProperty(k)&&t++;return t}function u(){var t=s.extraParams;return e.isFunction(t)?t():t}var i={asHtmlID:!1,asHtmlName:null,startText:"Enter Name Here",usePlaceholder:!0,emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:!1,extraParams:"",matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!1,neverSubmit:!1,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,doNotMatch:!1,canGenerateNewSelections:!0,start:function(){},selectionClick:function(e){},selectionAdded:function(e){},selectionRemoved:function(e){e.remove()},formatList:!1,beforeRetrieve:function(e){return e},retrieveComplete:function(e){return e},resultClick:function(e){},resultsComplete:function(){},api:function(t){return e.getJSON(t)}},s=e.extend(i,r),a,f=null;typeof n=="function"?a=n:typeof n=="string"?a=function(e,t){var r="";s.retrieveLimit&&(r="&limit="+encodeURIComponent(s.retrieveLimit));var i=u().replace(/-tag-/g,encodeURIComponent(e));f=s.api(n+"?"+i),f.done(function(n){var r=s.retrieveComplete.call(this,n);t(r,e)})}:typeof n=="object"&&o(n)>0&&(a=function(e,t){t(n,e)});if(a)return this.each(function(n){function O(){var e=u.val();if(e==N)return;N=e,e.length>=s.minChars?(c.addClass("loading"),M(e)):(c.removeClass("loading"),p.hide())}function M(e){if(r.startText===e){c.removeClass("loading"),p.hide();return}s.beforeRetrieve&&(e=s.beforeRetrieve.call(this,e)),B(),a(e,D)}function D(t,n){s.matchCase||(n=n.toLowerCase()),n=n.replace("(","\\(","g").replace(")","\\)","g");var r=0;p.html(d.html("")).hide();var i=o(t);for(var a=0;a<i;a++){var f=a;_++;var h=!1;if(s.searchObjProps=="value")var m=t[f].value;else{var m="",g=s.searchObjProps.split(",");for(var y=0;y<g.length;y++){var b=e.trim(g[y]);m=m+t[f][b]+" "}}m&&(s.matchCase||(m=m.toLowerCase()),s.doNotMatch?h=!0:m.search(n)!=-1&&v.val().search(","+t[f][s.selectedValuesProp]+",")==-1&&(h=!0));if(h){var w=e('<li class="as-result-item" id="as-result-item-'+f+'"></li>').click(function(){var t=e(this).data("data"),n=t.num;if(e("#as-selection-"+n,c).length<=0&&!L){var r=t.attributes;u.val("").focus(),N="",P(r,n),s.resultClick.call(this,t),p.hide(),e.colorbox&&e.colorbox.resize()}L=!1}).mousedown(function(){l=!1}).mouseover(function(){e("li",d).removeClass("active"),e(this).addClass("active")}).data("data",{attributes:t[f],num:_}),E=e.extend({},t[f]);if(!s.matchCase)var S=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n+")(?![^<>]*>)(?![^&;]+;)","gi");else var S=new RegExp("(?![^&;]+;)(?!<[^<>]*)("+n+")(?![^<>]*>)(?![^&;]+;)","g");s.resultsHighlight&&n.length>0&&(E[s.selectedItemProp]=E[s.selectedItemProp].replace(S,"<em>$1</em>")),s.formatList?w=s.formatList.call(this,E,w):w=w.html(E[s.selectedItemProp]),d.append(w),delete E,r++;if(s.retrieveLimit&&s.retrieveLimit==r)break}}c.removeClass("loading"),r<=0&&d.html('<li class="as-message">'+s.emptyText+"</li>"),d.css("width",c.outerWidth());if(r>0||!s.showResultListWhenNoMatch)p.show(),e.colorbox&&e.colorbox.resize();s.resultsComplete.call(this)}function P(n,r){v.val((v.val()||",")+n[s.selectedValuesProp]+",");var i=e('<li class="as-selection-item" id="as-selection-'+r+'"  data-image="'+(n.image||"")+'" data-caption="'+n.caption+'" data-scope="'+n.s+'" data-type = "'+n.t+'" data-value="'+n[s.selectedValuesProp]+'"></li>').click(function(){s.selectionClick.call(this,e(this)),c.children().removeClass("selected"),e(this).addClass("selected")}).mousedown(function(){l=!1}),o=e('<a class="as-close">&times;</a>').click(function(){return v.val(v.val().replace(","+n[s.selectedValuesProp]+",",",")),s.selectionRemoved.call(this,i),l=!0,u.focus(),!1});return h.before(i.html("<span>"+t.truncate(n[s.selectedItemProp],50)+"</span>").append(o)),s.selectionAdded.call(this,h.prev(),n[s.selectedValuesProp]),h.prev()}function H(t){if(e(":visible",p).length>0){var n=e("li",p);if(t=="down")var r=n.eq(0);else var r=n.filter(":last");var i=e("li.active:first",p);i.length>0&&(t=="down"?r=i.next():r=i.prev()),n.removeClass("active"),r.addClass("active")}}function B(){f&&(f.abort(),f=null)}if(!s.asHtmlID){n=n+""+Math.floor(Math.random()*100);var i="as-input-"+n}else{n=s.asHtmlID;var i=n}s.start.call(this,{add:function(t){P(t,"u"+e("li",c).length).addClass("blur")},remove:function(e){v.val(v.val().replace(","+e+",",",")),c.find('li[data-value = "'+e+'"]').remove()}});var u=e(this);u.attr("autocomplete","off").addClass("as-input").attr("id",i),s.usePlaceholder?u.attr("placeholder",s.startText):u.val(s.startText);var l=!1;u.wrap('<ul class="as-selections" id="as-selections-'+n+'"></ul>').wrap('<li class="as-original" id="as-original-'+n+'"></li>');var c=e("#as-selections-"+n),h=e("#as-original-"+n),p=e('<div class="as-results" id="as-results-'+n+'"></div>').hide(),d=e('<ul class="as-list"></ul>'),v=e('<input type="hidden" class="as-values" name="'+s.asHtmlName+'" id="as-values-'+n+'" />'),m="";if(typeof s.preFill=="string"){var g=s.preFill.split(",");for(var y=0;y<g.length;y++){var b={};b[s.selectedValuesProp]=g[y],g[y]!=""&&P(b,"000"+y)}m=s.preFill}else{m="";var w=0;for(k in s.preFill)s.preFill.hasOwnProperty(k)&&w++;if(w>0)for(var y=0;y<w;y++){var E=s.preFill[y][s.selectedValuesProp];E==undefined&&(E=""),m=m+E+",",E!=""&&P(s.preFill[y],"000"+y)}}if(m!=""){u.val("");var S=m.substring(m.length-1);S!=","&&(m+=","),v.val(","+m),e("li.as-selection-item",c).addClass("blur").removeClass("selected")}u.after(v),c.click(function(){l=!0,u.focus()}).mousedown(function(){l=!1}).after(p);var x=null,T=null,N="",C=0,L=!1,A=null;u.focus(function(){return!s.usePlaceholder&&e(this).val()==s.startText&&v.val()==""?e(this).val(""):l&&(e("li.as-selection-item",c).removeClass("blur"),e(this).val()!=""&&(d.css("width",c.outerWidth()),p.show())),x&&clearInterval(x),x=setInterval(function(){s.showResultList&&(s.selectionLimit&&e("li.as-selection-item",c).length>=s.selectionLimit?(d.html('<li class="as-message">'+s.limitText+"</li>"),p.show()):O())},s.keyDelay),l=!0,s.minChars==0&&M(e(this).val()),!0}).blur(function(){!s.usePlaceholder&&e(this).val()==""&&v.val()==""&&m==""&&s.minChars>0?e(this).val(s.startText):l&&(e("li.as-selection-item",c).addClass("blur").removeClass("selected"),p.hide()),x&&clearInterval(x)}).keydown(function(t){A=t.keyCode,first_focus=!1;switch(t.keyCode){case 38:t.preventDefault(),H("up");break;case 40:t.preventDefault(),H("down");break;case 8:if(u.val()==""){var n=v.val().split(",");n=n[n.length-2],c.children().not(h.prev()).removeClass("selected"),h.prev().hasClass("selected")?(v.val(v.val().replace(","+n+",",",")),s.selectionRemoved.call(this,h.prev())):(s.selectionClick.call(this,h.prev()),h.prev().addClass("selected"))}u.val().length==1&&(p.hide(),N="",B()),e(":visible",p).length>0&&(T&&clearTimeout(T),T=setTimeout(function(){O()},s.keyDelay));break;case 9:case 188:if(s.canGenerateNewSelections){L=!0;var r=u.val().replace(/(,)/g,""),i=e("li.active:first",p);if(r!==""&&v.val().search(","+r+",")<0&&r.length>=s.minChars&&i.length===0){t.preventDefault();var o={};o[s.selectedItemProp]=r,o[s.selectedValuesProp]=r;var a=e("li",c).length;P(o,"00"+(a+1)),u.val(""),B();break}};case 13:L=!1;var i=e("li.active:first",p);i.length>0&&(i.click(),p.hide()),(s.neverSubmit||i.length>0)&&t.preventDefault();break;case 27:case 16:case 20:B(),p.hide()}});var _=0})}}(e)}),define("modules/common/views/common/auto_suggest",["jquery","underscore","backbone","tibbr","require/autosuggest"],function(e,t,n,r){return r.View.extend({tagName:"input",excludeSubjects:[],excludeUsers:[],excludeGroups:[],resultsComplete:function(){},initialize:function(){t.bindAll(this,"fill","buildParams","bind")},render:function(e){var t=this.options.attributes||{};return this.name=t.name||"auto_suggest",t.name="tibbr-"+this.name,this.asHtmlName=this.name,this.asHtmlID=t.id=t.id||this.name,this.$el.attr(t).addClass(this.name),this.preFill=this.preFill||this.options.preFill||[],this.startText=this.t("defaults.auto_suggest.startText"),this.buildParams(),this.valueInput=this.valueInput||"input#as-values-"+this.asHtmlID,this},closeAll:function(){return e("ul#as-selections-"+this.name).find(".as-close").click(),this},addItem:function(n){var r=e("#as-selections-"+this.asHtmlID),i=e("#as-values-"+this.asHtmlID),s=e("li",r).length,o=e("#as-original-"+this.asHtmlID),u=s+1,a=this._options,f=this.$el,l=!1;i.val((i.val()||",")+n[a.selectedValuesProp]+",");var c=e('<li class="as-selection-item" id="as-selection-'+u+'"  data-image="'+(n.image||"")+'" data-caption="'+n.caption+'" data-scope="'+(n.s||n.scope)+'" data-type = "'+(n.t||n.type)+'" data-value="'+n[a.selectedValuesProp]+'"></li>').click(function(){r.children().removeClass("selected"),e(this).addClass("selected")}).mousedown(function(){l=!1}),h=e('<a class="as-close">&times;</a>').click(function(){return i.val(i.val().replace(","+n[a.selectedValuesProp]+",",",")),a.selectionRemoved.call(this,c),l=!0,f.focus(),!1});return o.before(c.html("<span>"+t.str.truncate(n[a.selectedItemProp],50)+"</span>").append(h)),a.selectionAdded.call(this,o.prev(),n[a.selectedValuesProp]),o.prev()},url:function(e){var t="/users/"+r.currentUser.id+"/"+e;this._url=this.useAPI?t:r.path(t)},buildParams:function(){var n=this.options.params||{},r=n.type||"both",i=window.gadget?3:n.per_page||5,s=n.value_type||"login",o=n.exclude_type||s,u={page:n.page||1,per_page:i,search_str:"-tag-"},a=n.users_filters||{},f=n.subjects_filters||{},l=n.groups_filters||{},c="exclude_"+o,h,p=this.excludeValues("u").concat(this.excludeUsers),d=this.excludeValues("s").concat(this.excludeSubjects),v=this.excludeValues("g").concat(this.excludeGroups),m;switch(r){case"users":this.url("list_users"),a[c]=p,m=t.extend(a,u);break;case"subjects":this.url("list_subjects"),h=s==="login"||n.exclude_type===undefined?"exclude_name":c,f[h]=d,m=t.extend(f,u);break;case"groups":this.url("list_groups"),l[c]=v,m=t.extend(l,u);break;default:this.url("list_message_targets"),h=s==="login"||n.exclude_type===undefined?"exclude_name":c,f[h]=e.merge(d,v),a[c]=p,m={users_filters:t.extend(a,u),subjects_filters:t.extend(f,u)}}return this.startText=(this.options.attributes||{}).title||this.t("defaults.auto_suggest.text."+r),e.param({params:t.extend(m,{value_type:s})})},excludeValues:function(e){return t.compact(t.map(this.data(),function(t){if(t.type===e)return t.value}))},fill:function(e){return this.preFill=e,this.render().el},getValue:function(){return this.getValueInArray().join(",")},data:function(){return e.makeArray(e("ul#as-selections-"+this.asHtmlID+" > li.as-selection-item").map(function(){return e(this).data()}))},hasPrivateAndPublic:function(){var e=this.data();if(e.length===0)return!1;if(this.privatePost)return this.checkPrivatePost();var n=t.unique(t.pluck(e,"scope"));return t.include(n,"public")&&(t.include(n,"private")||t.include(n,"protected"))},checkPrivatePost:function(){var e=t.unique(t.map(this.data(),function(e){if(e.type==="s")return e.scope}));return t.include(e,"public")},hasPublic:function(){var e=this.data();if(e.length===0)return!1;var n=t.unique(t.pluck(e,"scope"));return t.include(n,"public")},hasPrivate:function(){var e=this.data();if(e.length===0)return!1;var n=t.unique(t.pluck(e,"scope"));return t.include(n,"private")},hasSubject:function(){var e=this.data();if(e.length===0)return!1;var n=t.unique(t.pluck(e,"type"));return t.include(n,"s")},hasOnly:function(e){var n=this.data();if(n.length===0)return!1;var r=t.unique(t.pluck(n,"type"));return r.length===1&&t.include(r,e)},hasOnlyPublicOrPrivate:function(e){var n=this.data();if(n.length===0)return!1;var r=t.unique(t.pluck(n,"scope"));return r.length===1&&t.include(r,e)},getValueInArray:function(){return t.compact((e(this.valueInput).val()||"").split(","))},bind:function(){var n=this,r=this.options.selectedItemProp||"caption";this._options={selectedItemProp:r,searchObjProps:this.options.searchObjProps||"caption",selectedValuesProp:this.options.selectedValuesProp||"value",asHtmlID:this.asHtmlID,asHtmlName:this.asHtmlName,showResultListWhenNoMatch:t.isUndefined(this.options.showResultListWhenNoMatch)?!0:this.options.showResultListWhenNoMatch,startText:n.startText,doNotMatch:t.isUndefined(this.options.doNotMatch)?!0:this.options.doNotMatch,canGenerateNewSelections:n.options.canGenerateNewSelections||!1,emptyText:this.t("defaults.auto_suggest.emptyText"),formatList:function(e,t){var i=e.t==="u"?"user":"subject",s="";return e.image&&(s='<img src ="'+n.asset(e.image)+'"  width="24" height="24" />'),t.html(s+'<span class="'+i+" "+(e.s||"public")+'">'+e[r]+"</span>")},selectionAdded:function(t){var r=e(t),i=r.data()||{},s=i.type==="u"?"user":"subject",o=i.image||"",u=o.length>5?'<img  src="'+n.asset(o)+'">':"";r.addClass(s).addClass(i.scope||"public").prepend('<i class="ui-inline-icon">'+u+"</i>"),e.colorbox&&e.colorbox.resize(),n.trigger("added",i)},selectionRemoved:function(e){e.remove(),n.trigger("removed",e)},preFill:this.preFill||[],extraParams:this.options.extraParams||this.buildParams,resultsComplete:this.resultsComplete},this.useAPI&&(this.options.api?this._options.api=this.options.api:this._options.api=function(e){return TIBR.api({url:e})}),this.$el.autoSuggest(this.options.url||this._url,this._options)}})}),define("hbs!modules/common/templates/messages/email",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div id="email-post">\n    <h3><b>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.email.title",u):a.call(t,"t","message.email.title",u)))+'</b></h3>\n    <div id="shar_message"></div>\n    <from>\n        <ul class="steps">\n            <li>\n                <div id="client_error"></div>\n            </li>\n            <li class="grid-line title"><label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.email.find_people",u):a.call(t,"t","message.email.find_people",u)))+'</label></li>\n            <li class="grid-line auto-suggest">\n            </li>\n            <li class="grid-line title"><label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.email.add_people",u):a.call(t,"t","message.email.add_people",u)))+'</label></li>\n            <li class="grid-line">\n                <textarea rows="5" name="message[text]" id="message_text" cols="41" class=" text"></textarea></li>\n            <li class="grid-line action">\n                <button class="btn btn-submit submit-btn" type="submit">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.email.share",u):a.call(t,"t","message.email.share",u)))+' <i class="arrow next"> </i></button>\n            </li>\n        </ul>\n    </from>\n</div>',s})}),define("modules/common/views/messages/email",["jquery","underscore","tibbr","modules/common/views/common/auto_suggest","hbs!modules/common/templates/messages/email"],function(e,t,n,r,i){return n.View.extend({className:"confirm-delete",events:{"click .submit-btn":"yes"},render:function(){return e(this.el).html(this.renderTemplate(i)),this.autoSuggest=this.initChild(r,{params:{type:"users",value_type:"id"},attributes:{name:"email_people"}}),this.$(".auto-suggest").html(this.autoSuggest.render().el),this},bind:function(){this.autoSuggest.bind()},yes:function(){this.$(".submit-btn").attr("disabled",!0).after(spinner);var e=this,t=this.autoSuggest.getValue();return n.currentUser.shareMessage(this.model,this.$("#message_text").val(),this.autoSuggest.getValue()).fail(function(t){e.dialog.alert({text:n.Modules.Error.parse(t).join(" ")})}).done(function(){e.dialog.close(),e.dialog.alert({text:e.t("message.email.success")})}).done(function(){n.pub("email",{Message:e.model.id,Users:t}),console.log({Message:e.model.id,Users:t})}).always(function(){e.$(".submit-btn").removeAttr("disabled"),e.$(".spinner").remove()}),!1}})}),define("modules/tags/input",["jquery","underscore","tibbr","require/underscore-string"],function(e,t,n){return n.View.extend({className:"media-box custom-input-box",templ:'        <div class="option-btn {{cname}} {{type}}-btn {{#if checked}} checked {{/if}}">        {{#if isCheckbox}}         <input type="hidden" name="{{name}}" class="hidden" value="{{unCheckedValue}}">         {{/if}}        <input id="input_{{id}}"  class="{{cname}}" {{#if disabled}} disabled {{/if}}  name="{{name}}"  type="{{type}}" value="{{value}}"></div>        {{#if label}}        <div class="input-option-label">            <label for="input_{{id}}">             {{#if icon}}<i class="ui-inline-icon {{icon}}"></i>{{/if}}                {{#if hint}}                    <span class="hint-wrap">                        <strong>{{{label}}}</strong>                        <span class="hint">{{{hint}}}</span>                    </span>                {{else}}                    <strong>{{{label}}}</strong>                {{/if}}            </label>        </div>        {{/if}}',initialize:function(e){var n=e.name||"";this.inputClassName=e.type+"-"+t.str.underscored(n.replace(/\[|]/g,"_"))},events:{click:"changeState"},render:function(){var e=this.options||{};return e.id=e.id||t.uniqueId("input"),e.name=e.name||e.id,e.type=e.type||"input",e.isCheckbox=e.type==="checkbox",e.unCheckedValue=e.unCheckedValue||"false",e.cname=this.inputClassName,e.storeKey="tibbr_tags_input",this.$el.html(this.renderInLineTemplate(this.templ,e)),this.$input=this.$("#input_"+e.id),this.__id="#input_"+e.id,this.options.checked&&this.$input.prop("checked",!0),this.checked=this.options.checked||!1,e.tagName==="tr"&&this.$(".input-option-label,.option-btn").wrap("<td/>"),this},changeState:function(){return this.silent=!1,this.changeStat(),!1},changeStat:function(){var t=e(this.__id),n=this.$(".option-btn");return this.$input.prop("disabled")?!1:(this.options.type==="radio"&&(e("div."+this.inputClassName).removeClass("checked"),e("input."+this.inputClassName).prop("checked",!1)),t.prop("checked",!this.checked),this.checked=!this.checked,n.toggleClass("checked"),this.silent||(t.trigger("change"),this.trigger("change",t.val(),this)),!1)},getValue:function(){return this.$input.val()},setValue:function(e){e&&this.$input.val(e)},isChecked:function(){return this.checked},unCheck:function(e){return this.isChecked()&&(this.silent=e,this.changeStat()),this},check:function(e){return this.isChecked()||(this.silent=e,this.changeStat()),this}})}),define("hbs!modules/common/templates/messages/rsvp_view",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;r+="\r\n    ",o={hash:{},inverse:c.noop,fn:c.program(2,d,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.attending_count),">",0,o):f.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.attending_count),">",0,o));if(s||s===0)r+=s;r+="\r\n\r\n    ",o={hash:{},inverse:c.noop,fn:c.program(4,v,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.may_be_attending_count),">",0,o):f.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.may_be_attending_count),">",0,o));if(s||s===0)r+=s;r+="\r\n\r\n\r\n    ",o={hash:{},inverse:c.noop,fn:c.program(6,m,t),data:t},s=(i=n.compare||e&&e.compare,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.not_attending_count),">",0,o):f.call(e,"compare",(i=e&&e.model,i==null||i===!1?i:i.not_attending_count),">",0,o));if(s||s===0)r+=s;return r+="\r\n",r}function d(e,t){var r="",i,s;return r+='\r\n    <div class="attending-list-wrap">\r\n    <h5 class="Top-pad-10">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.attending_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"calendar.yes",s):f.call(e,"t","calendar.yes",s)))+'</h5>\r\n    <ul class="js-attending"></ul>\r\n    </div>\r\n    <div><a id="js-see-more-attending" class="js-see-more" data-status= "attending"  data-page ="1">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"common.see_more",s):f.call(e,"t","common.see_more",s)))+"</a></div>\r\n    ",r}function v(e,t){var r="",i,s;return r+='\r\n    <div class="attending-list-wrap">\r\n        <h5 class="Top-pad-10">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.may_be_attending_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"calendar.may_be",s):f.call(e,"t","calendar.may_be",s)))+'</h5>\r\n        <ul class="js-may_be_attending"></ul>\r\n    </div>\r\n    <div><a id="js-see-more-may_be_attending" class="js-see-more" data-status= "may_be_attending"  data-page ="1">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"common.see_more",s):f.call(e,"t","common.see_more",s)))+"</a></div>\r\n    ",r}function m(e,t){var r="",i,s;return r+='\r\n    <div class="attending-list-wrap">\r\n        <h5 class="Top-pad-10">',s={hash:{count:(i=e&&e.model,i==null||i===!1?i:i.not_attending_count)},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"calendar.no",s):f.call(e,"t","calendar.no",s)))+'</h5>\r\n        <ul class="js-not_attending"></ul>\r\n    </div>\r\n    <div><a id="js-see-more-not_attending" class="js-see-more" data-status= "not_attending"  data-page ="1">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"common.see_more",s):f.call(e,"t","common.see_more",s)))+"</a></div>\r\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this,h="function";s+='<div class="calendar-wrap media-box">\r\n    <div class="calendar-date-display">\r\n        <p> '+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedDay),typeof o===h?o.apply(t):o))+"</p>\r\n        "+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedNumberDate),typeof o===h?o.apply(t):o))+'\r\n    </div>\r\n    <div class="info">\r\n        <div id="js-title-content" class="rich-post">\r\n        <a class="event-title" href="',(u=n.messageUrl)?u=u.call(t,{hash:{},data:i}):(u=t&&t.messageUrl,u=typeof u===h?u.call(t,{hash:{},data:i}):u),s+=l(u)+'">',(u=n.richText)?u=u.call(t,{hash:{},data:i}):(u=t&&t.richText,u=typeof u===h?u.call(t,{hash:{},data:i}):u);if(u||u===0)s+=u;s+="</a>\r\n        </div>\r\n\r\n        <p><label>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.when",a):f.call(t,"t","calendar.when",a)))+"</label><i>"+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedDateTime),typeof o===h?o.apply(t):o))+"</i></p>\r\n\r\n        <p><label> ",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.event_duration",a):f.call(t,"t","calendar.event_duration",a)))+"</label>\r\n            "+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedTime),typeof o===h?o.apply(t):o))+"</p>\r\n        <p><label>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.location",a):f.call(t,"t","calendar.location",a)))+"</label> "+l((o=(o=t&&t.model,o==null||o===!1?o:o.location),typeof o===h?o.apply(t):o))+" </p>\r\n\r\n        <p>",u=(o=(o=t&&t.model,o==null||o===!1?o:o.more_info),typeof o===h?o.apply(t):o);if(u||u===0)s+=u;s+='</p>\r\n    </div>\r\n</div>\r\n<div class="cal-asset-attachment" style="display: none"></div>\r\n<div class="col-wrap">\r\n    <div class="col ">\r\n        <h4>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.are_you_attending",a):f.call(t,"t","calendar.are_you_attending",a)))+'</h4>\r\n        <ul class="event-options js-rsvp-options">\r\n            <input type="hidden" id="rsvpCalId" data-calId=',(u=n.id)?u=u.call(t,{hash:{},data:i}):(u=t&&t.id,u=typeof u===h?u.call(t,{hash:{},data:i}):u),s+=l(u)+'/>\r\n\r\n            <!-- <li id="process"></li>  Don not know why it is being used. -->\r\n        </ul>\r\n        <p class="add-to-ical"> <img src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/i-cal-icon.jpg",a):f.call(t,"imagePath","images/i-cal-icon.jpg",a)))+'" />\r\n            <a class="iCal" href="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.exportPath),typeof o===h?o.apply(t):o))+'"> ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.add_to_ical",a):f.call(t,"t","calendar.add_to_ical",a)))+"</a></p>\r\n    </div>\r\n\r\n</div>\r\n\r\n",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.show_guest),{hash:{},inverse:c.noop,fn:c.program(1,p,i),data:i});if(u||u===0)s+=u;return s+="\r\n\r\n\r\n\r\n",s})}),define("hbs!modules/common/templates/messages/calendar_users",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function l(e,t){var r="",i,s,f;return r+='\n<li>\n    <a title="',(i=n.display_name)?i=i.call(e,{hash:{},data:t}):(i=e&&e.display_name,i=typeof i===o?i.call(e,{hash:{},data:t}):i),r+=u(i)+'" class="profile-pic"\n       href="',f={hash:{},data:t},r+=u((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e,f):a.call(e,"urlFor","show",e,f)))+'">\n        <img src="',f={hash:{},data:t},r+=u((i=n.assetImage||e&&e.assetImage,i?i.call(e,e&&e.profile_image_url,3,f):a.call(e,"assetImage",e&&e.profile_image_url,3,f)))+'" class="medium bordered-medium"\n             alt="',(s=n.display_name)?s=s.call(e,{hash:{},data:t}):(s=e&&e.display_name,s=typeof s===o?s.call(e,{hash:{},data:t}):s),r+=u(s)+'"/>\n    </a>\n</li>\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=n.helperMissing,f=this;return s=n.each.call(t,t&&t.users,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i}),s||s===0?s:""})}),define("modules/common/views/messages/rsvp_view",["jquery","underscore","tibbr","../../models/message","../../collections/users","./mixed_asset_list","./link_list","./resources/list","modules/tags/input","hbs!modules/common/templates/messages/rsvp_view","hbs!modules/common/templates/messages/calendar_users"],function(t,n,r,i,s,o,u,a,f,l,c){return r.View.extend({className:"event-confirmation-wrap",events:{"click .rtio-event":"callRsvpEvent","click .profile-pic":"closeDialog","click .event-title":"closeDialog","click a.continued":"continuedText","click a.js-see-more":"seeMore"},initialize:function(){n.bindAll(this,"callRsvpEvent"),this.parentModel=this.options.parentModel,this.dialogTitle='<h3 style="font-weight: bold;color:#333;margin:0;">'+this.t("calendar.rsvp_heading")+"</h3>",this.$el.html(this.renderTemplate(l,{messageUrl:this.parentModel.showUrl(),richText:this.parentModel.getRichContent()})),this.collection=new s([],{tibbrURL:{controller:"calendars",action:"users",id:this.model.id},dataParams:{per_page:15,page:1,status:"attending"}})},render:function(){var e=this;this.renderAssets(),this.model.get("attending_count")>0&&this.fetchUsers("attending",1),this.model.get("may_be_attending_count")>0&&this.fetchUsers("may_be_attending",1),this.model.get("not_attending_count")>0&&this.fetchUsers("not_attending",1);var n=this.model.getStatusRsvp(),r=this.$(".event-options");return t.each(n,function(n,i){var s=t("<li/>"),o=e.initChild(f,{className:"media-box custom-input-box ratio-event js-radio-event-"+i.value,name:"calendar_user",type:"radio",value:i.value,unCheckedValue:"0",checked:i.checked,label:i.status});s.append(o.render().el),r.append(s),o.$("input").data("calId",i.calId),o.$el.on("click",e.callRsvpEvent)}),r.find(".option-btn").on("click",function(){t(this).toggleClass("checked")}),this.$(".js-see-more").hide(),this},callRsvpEvent:function(e){var n=this,i=this.$("ul.js-rsvp-options div.checked > input").val();this.model.callRsvp(i).done(function(){n.closeDialog(),t("#calendar-response-message-"+n.model.id).html(n.model.setStatus()),t("#event-response-"+n.model.id).html(r.translate("calendar.change_response"))})},closeDialog:function(){this.dialog.close()},renderAssets:function(){this.parentModel.parseResources(),this.showResources(),this.parentModel.assets.length>0&&this.showAttachments(),this.parentModel.links.length>0&&this.showLinks()},showAttachments:function(){this.$(".cal-asset-attachment").append(this.initChild(o,{collection:this.parentModel.assets}).render().el).show()},showLinks:function(){this.$(".cal-asset-attachment").append(this.initChild(u,{collection:this.parentModel.links}).render().el).show()},showResources:function(){this.parentModel.resources.length>0&&this.$(".cal-asset-attachment").replaceWith(this.initChild(a,{collection:this.parentModel.resources}).render().el).show()},fetchUsers:function(e,t){var n=this,r=this.$(".js-"+e),i;this.collection.dataParams.status=e,this.collection.page(t).fetch({beforeSend:function(){r.append(spinner)}}).done(function(){n.$(".js-"+e).append(n.renderTemplate(c,{users:n.collection.forTemplate()})),n.collection.hasMorePages?n.$("#js-see-more-"+e).show().data("page",n.collection.nextPage):n.$("#js-see-more-"+e).hide()}).always(function(){r.find(".spinner").remove()})},continuedText:function(){return this.$("#js-title-content").html(this.parentModel.getRichContent(!0)),!1},seeMore:function(e){var n=t(e.currentTarget).data();this.fetchUsers(n.status,n.page)}})}),define("hbs!modules/common/templates/messages/calendar_element",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+='<div class="calendar-date-display">\r\n    <p> '+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedDay),typeof o===f?o.apply(t):o))+"</p>\r\n    "+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedNumberDate),typeof o===f?o.apply(t):o))+'\r\n</div>\r\n<div class="info">\r\n    <p><label>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.when",a):c.call(t,"t","calendar.when",a)))+"</label> <i> "+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedDateTime),typeof o===f?o.apply(t):o))+"</i></p>\r\n    <p><label>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.event_duration",a):c.call(t,"t","calendar.event_duration",a)))+"</label> "+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedTime),typeof o===f?o.apply(t):o))+"</p>\r\n    <p><label>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"calendar.location",a):c.call(t,"t","calendar.location",a)))+"</label> "+l((o=(o=t&&t.model,o==null||o===!1?o:o.location),typeof o===f?o.apply(t):o))+'</p>\r\n    <p class="event-details"> ',u=(o=(o=t&&t.model,o==null||o===!1?o:o.more_info),typeof o===f?o.apply(t):o);if(u||u===0)s+=u;return s+='</p>\r\n    <p class="response-link">\r\n        <label class="calendar-response-message" id="calendar-response-message-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===f?o.apply(t):o))+'">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.setStatus),typeof o===f?o.apply(t):o))+'</label>\r\n        <a class="event-response" href="#" id="event-response-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===f?o.apply(t):o))+'">',(u=n.status)?u=u.call(t,{hash:{},data:i}):(u=t&&t.status,u=typeof u===f?u.call(t,{hash:{},data:i}):u),s+=l(u)+'<i class="chevron">»</i></a>\r\n    </p>\r\n</div>',s})}),define("modules/common/views/messages/calendar_view",["jquery","underscore","tibbr","modules/dialog","./rsvp_view","hbs!modules/common/templates/messages/calendar_element"],function(e,t,n,r,i,s){return n.View.extend({tagName:"div",className:"calendar-wrap media-box",events:{"click .event-response":"showRSVP","click .calendar-date-display":"showRSVP"},render:function(){var e=this.model.setStatus()===this.t("calendar.not_responded_yet")?this.t("calendar.rsvp"):this.t("calendar.change_response");return this.$el.html(this.renderTemplate(s,{status:e})),this},showRSVP:function(){return r.render(i,{model:this.model,parent:this,parentModel:this.options.parent.model,dialog:{width:600,className:"event-overlay"}}),!1}})}),define("jqueryui/datepicker",["jquery","./core"],function(e){(function(e,t){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=s(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(t){var n="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(n,"mouseout",function(){e(this).removeClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).removeClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(n,"mouseover",function(){e.datepicker._isDisabledDatepicker(r.inline?t.parent()[0]:r.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),this.className.indexOf("ui-datepicker-prev")!==-1&&e(this).addClass("ui-datepicker-prev-hover"),this.className.indexOf("ui-datepicker-next")!==-1&&e(this).addClass("ui-datepicker-next-hover"))})}function o(t,n){e.extend(t,n);for(var r in n)n[r]==null&&(t[r]=n[r]);return t}e.extend(e.ui,{datepicker:{version:"1.10.4"}});var n="datepicker",r;e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return o(this._defaults,e||{}),this},_attachDatepicker:function(t,n){var r,i,s;r=t.nodeName.toLowerCase(),i=r==="div"||r==="span",t.id||(this.uuid+=1,t.id="dp"+this.uuid),s=this._newInst(e(t),i),s.settings=e.extend({},n||{}),r==="input"?this._connectDatepicker(t,s):i&&this._inlineDatepicker(t,s)},_newInst:function(t,n){var r=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:n,dpDiv:n?s(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,r){var i=e(t);r.append=e([]),r.trigger=e([]);if(i.hasClass(this.markerClassName))return;this._attachments(i,r),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(r),e.data(t,n,r),r.settings.disabled&&this._disableDatepicker(t)},_attachments:function(t,n){var r,i,s,o=this._get(n,"appendText"),u=this._get(n,"isRTL");n.append&&n.append.remove(),o&&(n.append=e("<span class='"+this._appendClass+"'>"+o+"</span>"),t[u?"before":"after"](n.append)),t.unbind("focus",this._showDatepicker),n.trigger&&n.trigger.remove(),r=this._get(n,"showOn"),(r==="focus"||r==="both")&&t.focus(this._showDatepicker);if(r==="button"||r==="both")i=this._get(n,"buttonText"),s=this._get(n,"buttonImage"),n.trigger=e(this._get(n,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:s,alt:i,title:i}):e("<button type='button'></button>").addClass(this._triggerClass).html(s?e("<img/>").attr({src:s,alt:i,title:i}):i)),t[u?"before":"after"](n.trigger),n.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,n,r,i,s=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){n=0,r=0;for(i=0;i<e.length;i++)e[i].length>n&&(n=e[i].length,r=i);return r},s.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length)}},_inlineDatepicker:function(t,r){var i=e(t);if(i.hasClass(this.markerClassName))return;i.addClass(this.markerClassName).append(r.dpDiv),e.data(t,n,r),this._setDate(r,this._getDefaultDate(r),!0),this._updateDatepicker(r),this._updateAlternate(r),r.settings.disabled&&this._disableDatepicker(t),r.dpDiv.css("display","block")},_dialogDatepicker:function(t,r,i,s,u){var a,f,l,c,h,p=this._dialogInst;return p||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},e.data(this._dialogInput[0],n,p)),o(p.settings,s||{}),r=r&&r.constructor===Date?this._formatDate(p,r):r,this._dialogInput.val(r),this._pos=u?u.length?u:[u.pageX,u.pageY]:null,this._pos||(f=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[f/2-100+c,l/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],n,p),this},_destroyDatepicker:function(t){var r,i=e(t),s=e.data(t,n);if(!i.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase(),e.removeData(t,n),r==="input"?(s.append.remove(),s.trigger.remove(),i.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):(r==="div"||r==="span")&&i.removeClass(this.markerClassName).empty()},_enableDatepicker:function(t){var r,i,s=e(t),o=e.data(t,n);if(!s.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase();if(r==="input")t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if(r==="div"||r==="span")i=s.children("."+this._inlineClass),i.children().removeClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1);this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e})},_disableDatepicker:function(t){var r,i,s=e(t),o=e.data(t,n);if(!s.hasClass(this.markerClassName))return;r=t.nodeName.toLowerCase();if(r==="input")t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if(r==="div"||r==="span")i=s.children("."+this._inlineClass),i.children().addClass("ui-state-disabled"),i.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0);this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,n)}catch(r){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(n,r,i){var s,u,a,f,l=this._getInst(n);if(arguments.length===2&&typeof r=="string")return r==="defaults"?e.extend({},e.datepicker._defaults):l?r==="all"?e.extend({},l.settings):this._get(l,r):null;s=r||{},typeof r=="string"&&(s={},s[r]=i),l&&(this._curInst===l&&this._hideDatepicker(),u=this._getDateDatepicker(n,!0),a=this._getMinMaxDate(l,"min"),f=this._getMinMaxDate(l,"max"),o(l.settings,s),a!==null&&s.dateFormat!==t&&s.minDate===t&&(l.settings.minDate=this._formatDate(l,a)),f!==null&&s.dateFormat!==t&&s.maxDate===t&&(l.settings.maxDate=this._formatDate(l,f)),"disabled"in s&&(s.disabled?this._disableDatepicker(n):this._enableDatepicker(n)),this._attachments(e(n),l),this._autoSize(l),this._setDate(l,u),this._updateAlternate(l),this._updateDatepicker(l))},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(t){var n,r,i,s=e.datepicker._getInst(t.target),o=!0,u=s.dpDiv.is(".ui-datepicker-rtl");s._keyEvent=!0;if(e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return i=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",s.dpDiv),i[0]&&e.datepicker._selectDay(t.target,s.selectedMonth,s.selectedYear,i[0]),n=e.datepicker._get(s,"onSelect"),n?(r=e.datepicker._formatDate(s),n.apply(s.input?s.input[0]:null,[r,s])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,u?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else t.keyCode===36&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var n,r,i=e.datepicker._getInst(t.target);if(e.datepicker._get(i,"constrainInput"))return n=e.datepicker._possibleChars(e.datepicker._get(i,"dateFormat")),r=String.fromCharCode(t.charCode==null?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||r<" "||!n||n.indexOf(r)>-1},_doKeyUp:function(t){var n,r=e.datepicker._getInst(t.target);if(r.input.val()!==r.lastVal)try{n=e.datepicker.parseDate(e.datepicker._get(r,"dateFormat"),r.input?r.input.val():null,e.datepicker._getFormatConfig(r)),n&&(e.datepicker._setDateFromField(r),e.datepicker._updateAlternate(r),e.datepicker._updateDatepicker(r))}catch(i){}return!0},_showDatepicker:function(t){t=t.target||t,t.nodeName.toLowerCase()!=="input"&&(t=e("input",t.parentNode)[0]);if(e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)return;var n,r,i,s,u,a,f;n=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==n&&(e.datepicker._curInst.dpDiv.stop(!0,!0),n&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),r=e.datepicker._get(n,"beforeShow"),i=r?r.apply(t,[t,n]):{};if(i===!1)return;o(n.settings,i),n.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(n),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return s|=e(this).css("position")==="fixed",!s}),u={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,n.dpDiv.empty(),n.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(n),u=e.datepicker._checkOffset(n,u,s),n.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:u.left+"px",top:u.top+"px"}),n.inline||(a=e.datepicker._get(n,"showAnim"),f=e.datepicker._get(n,"duration"),n.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[a]?n.dpDiv.show(a,e.datepicker._get(n,"showOptions"),f):n.dpDiv[a||"show"](a?f:null),e.datepicker._shouldFocusInput(n)&&n.input.focus(),e.datepicker._curInst=n)},_updateDatepicker:function(t){this.maxRows=4,r=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var n,i=this._getNumberOfMonths(t),s=i[1],o=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),s>1&&t.dpDiv.addClass("ui-datepicker-multi-"+s).css("width",o*s+"em"),t.dpDiv[(i[0]!==1||i[1]!==1?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(n=t.yearshtml,setTimeout(function(){n===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),n=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,n,r){var i=t.dpDiv.outerWidth(),s=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,u=t.input?t.input.outerHeight():0,a=document.documentElement.clientWidth+(r?0:e(document).scrollLeft()),f=document.documentElement.clientHeight+(r?0:e(document).scrollTop());return n.left-=this._get(t,"isRTL")?i-o:0,n.left-=r&&n.left===t.input.offset().left?e(document).scrollLeft():0,n.top-=r&&n.top===t.input.offset().top+u?e(document).scrollTop():0,n.left-=Math.min(n.left,n.left+i>a&&a>i?Math.abs(n.left+i-a):0),n.top-=Math.min(n.top,n.top+s>f&&f>s?Math.abs(s+u):0),n},_findPos:function(t){var n,r=this._getInst(t),i=this._get(r,"isRTL");while(t&&(t.type==="hidden"||t.nodeType!==1||e.expr.filters.hidden(t)))t=t[i?"previousSibling":"nextSibling"];return n=e(t).offset(),[n.left,n.top]},_hideDatepicker:function(t){var r,i,s,o,u=this._curInst;if(!u||t&&u!==e.data(t,n))return;this._datepickerShowing&&(r=this._get(u,"showAnim"),i=this._get(u,"duration"),s=function(){e.datepicker._tidyDialog(u)},e.effects&&(e.effects.effect[r]||e.effects[r])?u.dpDiv.hide(r,e.datepicker._get(u,"showOptions"),i,s):u.dpDiv[r==="slideDown"?"slideUp":r==="fadeIn"?"fadeOut":"hide"](r?i:null,s),r||s(),this._datepickerShowing=!1,o=this._get(u,"onClose"),o&&o.apply(u.input?u.input[0]:null,[u.input?u.input.val():"",u]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(!e.datepicker._curInst)return;var n=e(t.target),r=e.datepicker._getInst(n[0]);(n[0].id!==e.datepicker._mainDivId&&n.parents("#"+e.datepicker._mainDivId).length===0&&!n.hasClass(e.datepicker.markerClassName)&&!n.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||n.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==r)&&e.datepicker._hideDatepicker()},_adjustDate:function(t,n,r){var i=e(t),s=this._getInst(i[0]);if(this._isDisabledDatepicker(i[0]))return;this._adjustInstDate(s,n+(r==="M"?this._get(s,"showCurrentAtPos"):0),r),this._updateDatepicker(s)},_gotoToday:function(t){var n,r=e(t),i=this._getInst(r[0]);this._get(i,"gotoCurrent")&&i.currentDay?(i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear):(n=new Date,i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()),this._notifyChange(i),this._adjustDate(r)},_selectMonthYear:function(t,n,r){var i=e(t),s=this._getInst(i[0]);s["selected"+(r==="M"?"Month":"Year")]=s["draw"+(r==="M"?"Month":"Year")]=parseInt(n.options[n.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(i)},_selectDay:function(t,n,r,i){var s,o=e(t);if(e(i).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0]))return;s=this._getInst(o[0]),s.selectedDay=s.currentDay=e("a",i).html(),s.selectedMonth=s.currentMonth=n,s.selectedYear=s.currentYear=r,this._selectDate(t,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear))},_clearDate:function(t){var n=e(t);this._selectDate(n,"")},_selectDate:function(t,n){var r,i=e(t),s=this._getInst(i[0]);n=n!=null?n:this._formatDate(s),s.input&&s.input.val(n),this._updateAlternate(s),r=this._get(s,"onSelect"),r?r.apply(s.input?s.input[0]:null,[n,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],typeof s.input[0]!="object"&&s.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var n,r,i,s=this._get(t,"altField");s&&(n=this._get(t,"altFormat")||this._get(t,"dateFormat"),r=this._getDate(t),i=this.formatDate(n,r,this._getFormatConfig(t)),e(s).each(function(){e(this).val(i)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,n=new Date(e.getTime());return n.setDate(n.getDate()+4-(n.getDay()||7)),t=n.getTime(),n.setMonth(0),n.setDate(1),Math.floor(Math.round((t-n)/864e5)/7)+1},parseDate:function(t,n,r){if(t==null||n==null)throw"Invalid arguments";n=typeof n=="object"?n.toString():n+"";if(n==="")return null;var i,s,o,u=0,a=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,f=typeof a!="string"?a:(new Date).getFullYear()%100+parseInt(a,10),l=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,c=(r?r.dayNames:null)||this._defaults.dayNames,h=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,p=(r?r.monthNames:null)||this._defaults.monthNames,d=-1,v=-1,m=-1,g=-1,y=!1,b,w=function(e){var n=i+1<t.length&&t.charAt(i+1)===e;return n&&i++,n},E=function(e){var t=w(e),r=e==="@"?14:e==="!"?20:e==="y"&&t?4:e==="o"?3:2,i=new RegExp("^\\d{1,"+r+"}"),s=n.substring(u).match(i);if(!s)throw"Missing number at position "+u;return u+=s[0].length,parseInt(s[0],10)},S=function(t,r,i){var s=-1,o=e.map(w(t)?i:r,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});e.each(o,function(e,t){var r=t[1];if(n.substr(u,r.length).toLowerCase()===r.toLowerCase())return s=t[0],u+=r.length,!1});if(s!==-1)return s+1;throw"Unknown name at position "+u},x=function(){if(n.charAt(u)!==t.charAt(i))throw"Unexpected literal at position "+u;u++};for(i=0;i<t.length;i++)if(y)t.charAt(i)==="'"&&!w("'")?y=!1:x();else switch(t.charAt(i)){case"d":m=E("d");break;case"D":S("D",l,c);break;case"o":g=E("o");break;case"m":v=E("m");break;case"M":v=S("M",h,p);break;case"y":d=E("y");break;case"@":b=new Date(E("@")),d=b.getFullYear(),v=b.getMonth()+1,m=b.getDate();break;case"!":b=new Date((E("!")-this._ticksTo1970)/1e4),d=b.getFullYear(),v=b.getMonth()+1,m=b.getDate();break;case"'":w("'")?x():y=!0;break;default:x()}if(u<n.length){o=n.substr(u);if(!/^\s+/.test(o))throw"Extra/unparsed characters found in date: "+o}d===-1?d=(new Date).getFullYear():d<100&&(d+=(new Date).getFullYear()-(new Date).getFullYear()%100+(d<=f?0:-100));if(g>-1){v=1,m=g;do{s=this._getDaysInMonth(d,v-1);if(m<=s)break;v++,m-=s}while(!0)}b=this._daylightSavingAdjust(new Date(d,v-1,m));if(b.getFullYear()!==d||b.getMonth()+1!==v||b.getDate()!==m)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*24*60*60*1e7,formatDate:function(e,t,n){if(!t)return"";var r,i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,s=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,u=(n?n.monthNames:null)||this._defaults.monthNames,a=function(t){var n=r+1<e.length&&e.charAt(r+1)===t;return n&&r++,n},f=function(e,t,n){var r=""+t;if(a(e))while(r.length<n)r="0"+r;return r},l=function(e,t,n,r){return a(e)?r[t]:n[t]},c="",h=!1;if(t)for(r=0;r<e.length;r++)if(h)e.charAt(r)==="'"&&!a("'")?h=!1:c+=e.charAt(r);else switch(e.charAt(r)){case"d":c+=f("d",t.getDate(),2);break;case"D":c+=l("D",t.getDay(),i,s);break;case"o":c+=f("o",Math.round(((new Date(t.getFullYear(),t.getMonth(),t.getDate())).getTime()-(new Date(t.getFullYear(),0,0)).getTime())/864e5),3);break;case"m":c+=f("m",t.getMonth()+1,2);break;case"M":c+=l("M",t.getMonth(),o,u);break;case"y":c+=a("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=t.getTime()*1e4+this._ticksTo1970;break;case"'":a("'")?c+="'":h=!0;break;default:c+=e.charAt(r)}return c},_possibleChars:function(e){var t,n="",r=!1,i=function(n){var r=t+1<e.length&&e.charAt(t+1)===n;return r&&t++,r};for(t=0;t<e.length;t++)if(r)e.charAt(t)==="'"&&!i("'")?r=!1:n+=e.charAt(t);else switch(e.charAt(t)){case"d":case"m":case"y":case"@":n+="0123456789";break;case"D":case"M":return null;case"'":i("'")?n+="'":r=!0;break;default:n+=e.charAt(t)}return n},_get:function(e,n){return e.settings[n]!==t?e.settings[n]:this._defaults[n]},_setDateFromField:function(e,t){if(e.input.val()===e.lastVal)return;var n=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,i=this._getDefaultDate(e),s=i,o=this._getFormatConfig(e);try{s=this.parseDate(n,r,o)||i}catch(u){r=t?"":r}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=r?s.getDate():0,e.currentMonth=r?s.getMonth():0,e.currentYear=r?s.getFullYear():0,this._adjustInstDate(e)},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,n,r){var i=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},s=function(n){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),n,e.datepicker._getFormatConfig(t))}catch(r){}var i=(n.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,s=i.getFullYear(),o=i.getMonth(),u=i.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,f=a.exec(n);while(f){switch(f[2]||"d"){case"d":case"D":u+=parseInt(f[1],10);break;case"w":case"W":u+=parseInt(f[1],10)*7;break;case"m":case"M":o+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o));break;case"y":case"Y":s+=parseInt(f[1],10),u=Math.min(u,e.datepicker._getDaysInMonth(s,o))}f=a.exec(n)}return new Date(s,o,u)},o=n==null||n===""?r:typeof n=="string"?s(n):typeof n=="number"?isNaN(n)?r:i(n):new Date(n.getTime());return o=o&&o.toString()==="Invalid Date"?r:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var r=!t,i=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),(i!==e.selectedMonth||s!==e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&e.input.val()===""?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var n=this._get(t,"stepMonths"),r="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(r,-n,"M")},next:function(){e.datepicker._adjustDate(r,+n,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(r)},selectDay:function(){return e.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(r,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=new Date,R=this._daylightSavingAdjust(new Date(q.getFullYear(),q.getMonth(),q.getDate())),U=this._get(e,"isRTL"),z=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),X=this._get(e,"navigationAsDateFormat"),V=this._getNumberOfMonths(e),$=this._get(e,"showCurrentAtPos"),J=this._get(e,"stepMonths"),K=V[0]!==1||V[1]!==1,Q=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(e,"min"),Y=this._getMinMaxDate(e,"max"),Z=e.drawMonth-$,et=e.drawYear;Z<0&&(Z+=12,et--);if(Y){t=this._daylightSavingAdjust(new Date(Y.getFullYear(),Y.getMonth()-V[0]*V[1]+1,Y.getDate())),t=G&&t<G?G:t;while(this._daylightSavingAdjust(new Date(et,Z,1))>t)Z--,Z<0&&(Z=11,et--)}e.drawMonth=Z,e.drawYear=et,n=this._get(e,"prevText"),n=X?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z-J,1)),this._getFormatConfig(e)):n,r=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+n+"</span></a>",i=this._get(e,"nextText"),i=X?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z+J,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+i+"</span></a>",o=this._get(e,"currentText"),u=this._get(e,"gotoCurrent")&&e.currentDay?Q:R,o=X?this.formatDate(o,u,this._getFormatConfig(e)):o,a=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",f=z?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?a:"")+(this._isInRange(e,u)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+o+"</button>":"")+(U?"":a)+"</div>":"",l=parseInt(this._get(e,"firstDay"),10),l=isNaN(l)?0:l,c=this._get(e,"showWeek"),h=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),d=this._get(e,"monthNames"),v=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),g=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),w="",E;for(S=0;S<V[0];S++){x="",this.maxRows=4;for(T=0;T<V[1];T++){N=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),C=" ui-corner-all",k="";if(K){k+="<div class='ui-datepicker-group";if(V[1]>1)switch(T){case 0:k+=" ui-datepicker-group-first",C=" ui-corner-"+(U?"right":"left");break;case V[1]-1:k+=" ui-datepicker-group-last",C=" ui-corner-"+(U?"left":"right");break;default:k+=" ui-datepicker-group-middle",C=""}k+="'>"}k+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&S===0?U?s:r:"")+(/all|right/.test(C)&&S===0?U?r:s:"")+this._generateMonthYearHeader(e,Z,et,G,Y,S>0||T>0,d,v)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",L=c?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"";for(E=0;E<7;E++)A=(E+l)%7,L+="<th"+((E+l+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+h[A]+"'>"+p[A]+"</span></th>";k+=L+"</tr></thead><tbody>",O=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,O)),M=(this._getFirstDayOfMonth(et,Z)-l+7)%7,_=Math.ceil((M+O)/7),D=K?this.maxRows>_?this.maxRows:_:_,this.maxRows=D,P=this._daylightSavingAdjust(new Date(et,Z,1-M));for(H=0;H<D;H++){k+="<tr>",B=c?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(P)+"</td>":"";for(E=0;E<7;E++)j=m?m.apply(e.input?e.input[0]:null,[P]):[!0,""],F=P.getMonth()!==Z,I=F&&!y||!j[0]||G&&P<G||Y&&P>Y,B+="<td class='"+((E+l+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(P.getTime()===N.getTime()&&Z===e.selectedMonth&&e._keyEvent||b.getTime()===P.getTime()&&b.getTime()===N.getTime()?" "+this._dayOverClass:"")+(I?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!g?"":" "+j[1]+(P.getTime()===Q.getTime()?" "+this._currentClass:"")+(P.getTime()===R.getTime()?" ui-datepicker-today":""))+"'"+((!F||g)&&j[2]?" title='"+j[2].replace(/'/g,"&#39;")+"'":"")+(I?"":" data-handler='selectDay' data-event='click' data-month='"+P.getMonth()+"' data-year='"+P.getFullYear()+"'")+">"+(F&&!g?"&#xa0;":I?"<span class='ui-state-default'>"+P.getDate()+"</span>":"<a class='ui-state-default"+(P.getTime()===R.getTime()?" ui-state-highlight":"")+(P.getTime()===Q.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+P.getDate()+"</a>")+"</td>",P.setDate(P.getDate()+1),P=this._daylightSavingAdjust(P);k+=B+"</tr>"}Z++,Z>11&&(Z=0,et++),k+="</tbody></table>"+(K?"</div>"+(V[0]>0&&T===V[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=k}w+=x}return w+=f,e._keyEvent=!1,w},_generateMonthYearHeader:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m=this._get(e,"changeMonth"),g=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",w="";if(s||!m)w+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{a=r&&r.getFullYear()===n,f=i&&i.getFullYear()===n,w+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>";for(l=0;l<12;l++)(!a||l>=r.getMonth())&&(!f||l<=i.getMonth())&&(w+="<option value='"+l+"'"+(l===t?" selected='selected'":"")+">"+u[l]+"</option>");w+="</select>"}y||(b+=w+(s||!m||!g?"&#xa0;":""));if(!e.yearshtml){e.yearshtml="";if(s||!g)b+="<span class='ui-datepicker-year'>"+n+"</span>";else{c=this._get(e,"yearRange").split(":"),h=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?n+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10);return isNaN(t)?h:t},d=p(c[0]),v=Math.max(d,p(c[1]||"")),d=r?Math.max(d,r.getFullYear()):d,v=i?Math.min(v,i.getFullYear()):v,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";for(;d<=v;d++)e.yearshtml+="<option value='"+d+"'"+(d===n?" selected='selected'":"")+">"+d+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}}return b+=this._get(e,"yearSuffix"),y&&(b+=(s||!m||!g?"&#xa0;":"")+w),b+="</div>",b},_adjustInstDate:function(e,t,n){var r=e.drawYear+(n==="Y"?t:0),i=e.drawMonth+(n==="M"?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(r,i))+(n==="D"?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,i,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(n==="M"||n==="Y")&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),i=n&&t<n?n:t;return r&&i>r?r:i},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return t==null?[1,1]:typeof t=="number"?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return(new Date(e,t,1)).getDay()},_canAdjustMonth:function(e,t,n,r){var i=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(n,r+(t<0?t:i[0]*i[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var n,r,i=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),o=null,u=null,a=this._get(e,"yearRange");return a&&(n=a.split(":"),r=(new Date).getFullYear(),o=parseInt(n[0],10),u=parseInt(n[1],10),n[0].match(/[+\-].*/)&&(o+=r),n[1].match(/[+\-].*/)&&(u+=r)),(!i||t.getTime()>=i.getTime())&&(!s||t.getTime()<=s.getTime())&&(!o||t.getFullYear()>=o)&&(!u||t.getFullYear()<=u)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t=typeof t!="string"?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var i=t?typeof t=="object"?t:this._daylightSavingAdjust(new Date(r,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),i,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),e("#"+e.datepicker._mainDivId).length===0&&e("body").append(e.datepicker.dpDiv);var n=Array.prototype.slice.call(arguments,1);return typeof t!="string"||t!=="isDisabled"&&t!=="getDate"&&t!=="widget"?t==="option"&&arguments.length===2&&typeof arguments[1]=="string"?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n)):this.each(function(){typeof t=="string"?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(n)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(n))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.4"})(e)}),function(e){typeof define=="function"&&define.amd?define("require/timepicker",["jquery"],e):e(jQuery)}(function(e){function o(e){e.minTime&&(e.minTime=x(e.minTime)),e.maxTime&&(e.maxTime=x(e.maxTime)),e.durationTime&&typeof e.durationTime!="function"&&(e.durationTime=x(e.durationTime));if(e.disableTimeRanges.length>0){for(var t in e.disableTimeRanges)e.disableTimeRanges[t]=[x(e.disableTimeRanges[t][0]),x(e.disableTimeRanges[t][1])];e.disableTimeRanges=e.disableTimeRanges.sort(function(e,t){return e[0]-t[0]});for(var t=e.disableTimeRanges.length-1;t>0;t--)e.disableTimeRanges[t][0]<=e.disableTimeRanges[t-1][1]&&(e.disableTimeRanges[t-1]=[Math.min(e.disableTimeRanges[t][0],e.disableTimeRanges[t-1][0]),Math.max(e.disableTimeRanges[t][1],e.disableTimeRanges[t-1][1])],e.disableTimeRanges.splice(t,1))}return e}function u(t){var r=t.data("timepicker-settings"),i=t.data("timepicker-list");i&&i.length&&(i.remove(),t.data("timepicker-list",!1));if(r.useSelect){i=e("<select />",{"class":"ui-timepicker-select"});var o=i}else{i=e("<ul />",{"class":"ui-timepicker-list"});var o=e("<div />",{"class":"ui-timepicker-wrapper",tabindex:-1});o.css({display:"none",position:"absolute"}).append(i)}if(r.noneOption){r.noneOption===!0&&(r.noneOption=r.useSelect?"Time...":"None");if(e.isArray(r.noneOption))for(var u in r.noneOption){var l=a(r.noneOption[u],r.useSelect);i.append(l)}else{var l=a(r.noneOption,r.useSelect);i.append(l)}}r.className&&o.addClass(r.className),(r.minTime!==null||r.durationTime!==null)&&r.showDuration&&o.addClass("ui-timepicker-with-duration");var c=r.minTime;typeof r.durationTime=="function"?c=x(r.durationTime()):r.durationTime!==null&&(c=r.durationTime);var p=r.minTime!==null?r.minTime:0,v=r.maxTime!==null?r.maxTime:p+n-1;v<=p&&(v+=n),v===n-1&&r.timeFormat.indexOf("H")!==-1&&(v=n);var m=r.disableTimeRanges,y=0,b=m.length;for(var u=p;u<=v;u+=r.step*60){var T=u,N=S(T,r.timeFormat);if(r.useSelect){var C=e("<option />",{value:N});C.text(N)}else{var C=e("<li />");C.data("time",T<=86400?T:T%86400),C.text(N)}if((r.minTime!==null||r.durationTime!==null)&&r.showDuration){var k=E(u-c);if(r.useSelect)C.text(C.text()+" ("+k+")");else{var L=e("<span />",{"class":"ui-timepicker-duration"});L.text(" ("+k+")"),C.append(L)}}y<b&&(T>=m[y][1]&&(y+=1),m[y]&&T>=m[y][0]&&T<m[y][1]&&(r.useSelect?C.prop("disabled",!0):C.addClass("ui-timepicker-disabled"))),i.append(C)}o.data("timepicker-input",t),t.data("timepicker-list",o);if(r.useSelect)i.val(f(t.val(),r)),i.on("focus",function(){e(this).data("timepicker-input").trigger("showTimepicker")}),i.on("blur",function(){e(this).data("timepicker-input").trigger("hideTimepicker")}),i.on("change",function(){g(t,e(this).val(),"select")}),t.hide().after(i);else{var A=r.appendTo;typeof A=="string"?A=e(A):typeof A=="function"&&(A=A(t)),A.append(o),d(t,i),i.on("click","li",function(n){t.off("focus.timepicker"),t.on("focus.timepicker-ie-hack",function(){t.off("focus.timepicker-ie-hack"),t.on("focus.timepicker",s.show)}),h(t)||t[0].focus(),i.find("li").removeClass("ui-timepicker-selected"),e(this).addClass("ui-timepicker-selected"),w(t)&&(t.trigger("hideTimepicker"),o.hide())})}}function a(t,n){var r,i,s;return typeof t=="object"?(r=t.label,i=t.className,s=t.value):typeof t=="string"?r=t:e.error("Invalid noneOption value"),n?e("<option />",{value:s,"class":i,text:r}):e("<li />",{"class":i,text:r}).data("time",s)}function f(t,n){e.isNumeric(t)||(t=x(t));if(t===null)return null;var r=n.step*60;return S(Math.round(t/r)*r,n.timeFormat)}function l(){return new Date(1970,1,1,0,0,0)}function c(t){var n=e(t.target),r=n.closest(".ui-timepicker-input");r.length===0&&n.closest(".ui-timepicker-wrapper").length===0&&(s.hide(),e(document).unbind(".ui-timepicker"))}function h(e){var t=e.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&t.disableTouchKeyboard}function p(t,n,r){if(!r&&r!==0)return!1;var i=t.data("timepicker-settings"),s=!1,o=i.step*30;return n.find("li").each(function(t,n){var i=e(n);if(typeof i.data("time")!="number")return;var u=i.data("time")-r;if(Math.abs(u)<o||u==o)return s=i,!1}),s}function d(e,t){t.find("li").removeClass("ui-timepicker-selected");var n=x(m(e));if(n===null)return;var r=p(e,t,n);if(r){var i=r.offset().top-t.offset().top;(i+r.outerHeight()>t.outerHeight()||i<0)&&t.scrollTop(t.scrollTop()+r.position().top-r.outerHeight()),r.addClass("ui-timepicker-selected")}}function v(){if(this.value==="")return;var t=e(this);if(t.is(":focus"))return;var n=x(this.value);if(n===null){t.trigger("timeFormatError");return}var r=t.data("timepicker-settings"),i=!1;r.minTime!==null&&n<r.minTime?i=!0:r.maxTime!==null&&n>r.maxTime&&(i=!0),e.each(r.disableTimeRanges,function(){if(n>=this[0]&&n<this[1])return i=!0,!1});if(r.forceRoundTime){var s=n%(r.step*60);s>=r.step*30?n+=r.step*60-s:n-=s}var o=S(n,r.timeFormat);i?g(t,o,"error")&&t.trigger("timeRangeError"):g(t,o)}function m(e){return e.is("input")?e.val():e.data("ui-timepicker-value")}function g(e,t,n){if(e.is("input")){e.val(t);var r=e.data("timepicker-settings");r.useSelect&&e.data("timepicker-list").val(f(t,r))}return e.data("ui-timepicker-value")!=t?(e.data("ui-timepicker-value",t),n=="select"?e.trigger("selectTime").trigger("changeTime").trigger("change"):n!="error"&&e.trigger("changeTime"),!0):(e.trigger("selectTime"),!1)}function y(t){var n=e(this),r=n.data("timepicker-list");if(!r||!r.is(":visible")){if(t.keyCode!=40)return!0;h(n)||n.focus()}switch(t.keyCode){case 13:return w(n)&&s.hide.apply(this),t.preventDefault(),!1;case 38:var i=r.find(".ui-timepicker-selected");return i.length?i.is(":first-child")||(i.removeClass("ui-timepicker-selected"),i.prev().addClass("ui-timepicker-selected"),i.prev().position().top<i.outerHeight()&&r.scrollTop(r.scrollTop()-i.outerHeight())):(r.find("li").each(function(t,n){if(e(n).position().top>0)return i=e(n),!1}),i.addClass("ui-timepicker-selected")),!1;case 40:return i=r.find(".ui-timepicker-selected"),i.length===0?(r.find("li").each(function(t,n){if(e(n).position().top>0)return i=e(n),!1}),i.addClass("ui-timepicker-selected")):i.is(":last-child")||(i.removeClass("ui-timepicker-selected"),i.next().addClass("ui-timepicker-selected"),i.next().position().top+2*i.outerHeight()>r.outerHeight()&&r.scrollTop(r.scrollTop()+i.outerHeight())),!1;case 27:r.find("li").removeClass("ui-timepicker-selected"),s.hide();break;case 9:s.hide();break;default:return!0}}function b(t){var n=e(this),r=n.data("timepicker-list");if(!r||!r.is(":visible"))return!0;if(!n.data("timepicker-settings").typeaheadHighlight)return r.find("li").removeClass("ui-timepicker-selected"),!0;switch(t.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:d(n,r);break;default:return}}function w(e){var t=e.data("timepicker-settings"),n=e.data("timepicker-list"),r=null,i=n.find(".ui-timepicker-selected");if(i.hasClass("ui-timepicker-disabled"))return!1;i.length?r=i.data("time"):m(e)&&(r=x(m(e)),d(e,n));if(r!==null)if(typeof r=="string")e.val(r);else{var s=S(r,t.timeFormat);g(e,s,"select")}return!0}function E(e){var t=Math.round(e/60),n;if(Math.abs(t)<60)n=[t,i.mins];else if(t==60)n=["1",i.hr];else{var r=(t/60).toFixed(1);i.decimal!="."&&(r=r.replace(".",i.decimal)),n=[r,i.hrs]}return n.join(" ")}function S(e,r){if(e===null)return;var s=new Date(t.valueOf()+e*1e3);if(isNaN(s.getTime()))return;var o="",u,a;for(var f=0;f<r.length;f++){a=r.charAt(f);switch(a){case"a":o+=s.getHours()>11?i.pm:i.am;break;case"A":o+=s.getHours()>11?i.PM:i.AM;break;case"g":u=s.getHours()%12,o+=u===0?"12":u;break;case"G":o+=s.getHours();break;case"h":u=s.getHours()%12,u!==0&&u<10&&(u="0"+u),o+=u===0?"12":u;break;case"H":u=s.getHours(),e===n&&(u=24),o+=u>9?u:"0"+u;break;case"i":var l=s.getMinutes();o+=l>9?l:"0"+l;break;case"s":e=s.getSeconds(),o+=e>9?e:"0"+e;break;default:o+=a}}return o}function x(e){if(e==="")return null;if(!e||e+0==e)return e;typeof e=="object"&&(e=e.getHours()+":"+T(e.getMinutes())+":"+T(e.getSeconds())),e=e.toLowerCase();var t=new Date(0),n;e.indexOf(":")===-1?(n=e.match(/^([0-9]):?([0-5][0-9])?:?([0-5][0-9])?\s*([pa]?)m?$/),n||(n=e.match(/^([0-2][0-9]):?([0-5][0-9])?:?([0-5][0-9])?\s*([pa]?)m?$/))):n=e.match(/^(\d{1,2})(?::([0-5][0-9]))?(?::([0-5][0-9]))?\s*([pa]?)m?$/);if(!n)return null;var r=parseInt(n[1]*1,10),i;n[4]?r==12?i=n[4]=="p"?12:0:i=r+(n[4]=="p"?12:0):i=r;var s=n[2]*1||0,o=n[3]*1||0;return i*3600+s*60+o}function T(e){return("0"+e).slice(-2)}var t=l(),n=86400,r={className:null,minTime:null,maxTime:null,durationTime:null,step:30,showDuration:!1,timeFormat:"g:ia",scrollDefaultNow:!1,scrollDefaultTime:!1,selectOnBlur:!1,disableTouchKeyboard:!1,forceRoundTime:!1,appendTo:"body",orientation:"ltr",disableTimeRanges:[],closeOnWindowScroll:!1,typeaheadHighlight:!0,noneOption:!1},i={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},s={init:function(t){return this.each(function(){var n=e(this),a=[];for(var f in r)n.data(f)&&(a[f]=n.data(f));var l=e.extend({},r,a,t);l.lang&&(i=e.extend(i,l.lang)),l=o(l),n.data("timepicker-settings",l),n.addClass("ui-timepicker-input"),l.useSelect?u(n):(n.prop("autocomplete","off"),n.on("click.timepicker focus.timepicker",s.show),n.on("change.timepicker",v),n.on("keydown.timepicker",y),n.on("keyup.timepicker",b),v.call(n.get(0)))})},show:function(t){t&&t.preventDefault();var n=e(this),r=n.data("timepicker-settings");if(r.useSelect){n.data("timepicker-list").focus();return}h(n)&&n.blur();var i=n.data("timepicker-list");if(n.prop("readonly"))return;if(!i||i.length===0||typeof r.durationTime=="function")u(n),i=n.data("timepicker-list");if(i.is(":visible"))return;s.hide(),i.show();var o={};r.orientation=="rtl"?o.left=n.offset().left+n.outerWidth()-i.outerWidth()+parseInt(i.css("marginLeft").replace("px",""),10):o.left=n.offset().left+parseInt(i.css("marginLeft").replace("px",""),10),n.offset().top+n.outerHeight(!0)+i.outerHeight()>e(window).height()+e(window).scrollTop()?o.top=n.offset().top-i.outerHeight()+parseInt(i.css("marginTop").replace("px",""),10):o.top=n.offset().top+n.outerHeight()+parseInt(i.css("marginTop").replace("px",""),10),i.offset(o),n.parents(".ui-dialog").length>0&&i.css("z-index",99999);var a=i.find(".ui-timepicker-selected");a.length||(m(n)?a=p(n,i,x(m(n))):r.scrollDefaultNow?a=p(n,i,x(new Date)):r.scrollDefaultTime!==!1&&(a=p(n,i,x(r.scrollDefaultTime))));if(a&&a.length){var f=i.scrollTop()+a.position().top-a.outerHeight();i.scrollTop(f)}else i.scrollTop(0);return e(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",c),r.closeOnWindowScroll&&e(document).on("scroll.ui-timepicker",c),n.trigger("showTimepicker"),this},hide:function(t){var n=e(this),r=n.data("timepicker-settings");return r&&r.useSelect&&n.blur(),e(".ui-timepicker-wrapper:visible").each(function(){var t=e(this),n=t.data("timepicker-input"),r=n.data("timepicker-settings");r&&r.selectOnBlur&&w(n),t.hide(),n.trigger("hideTimepicker")}),this},option:function(t,n){var r=this,i=r.data("timepicker-settings"),s=r.data("timepicker-list");if(typeof t=="object")i=e.extend(i,t);else if(typeof t=="string"&&typeof n!="undefined")i[t]=n;else if(typeof t=="string")return i[t];return i=o(i),r.data("timepicker-settings",i),s&&(s.remove(),r.data("timepicker-list",!1)),i.useSelect&&u(r),this},getSecondsFromMidnight:function(){return x(m(this))},getTime:function(e){var t=this,n=m(t);if(!n)return null;e||(e=new Date);var r=x(n),i=new Date(e);return i.setHours(r/3600),i.setMinutes(r%3600/60),i.setSeconds(r%60),i.setMilliseconds(0),i},setTime:function(e){var t=this,n=S(x(e),t.data("timepicker-settings").timeFormat);return g(t,n),t.data("timepicker-list")&&d(t,t.data("timepicker-list")),this},remove:function(){var e=this;if(!e.hasClass("ui-timepicker-input"))return;return e.removeAttr("autocomplete","off"),e.removeClass("ui-timepicker-input"),e.removeData("timepicker-settings"),e.off(".timepicker"),e.data("timepicker-list")&&e.data("timepicker-list").remove(),e.removeData("timepicker-list"),this}};e.fn.timepicker=function(t){if(!this.length)return this;if(s[t])return this.hasClass("ui-timepicker-input")?s[t].apply(this,Array.prototype.slice.call(arguments,1)):this;if(typeof t=="object"||!t)return s.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.timepicker")}}),function(e){typeof define=="function"&&define.amd?define("require/datepair",["jquery"],e):e(jQuery)}(function(e){function i(e){return e}function s(e){e.on("change.datepair",null,u)}function o(e){e.off("change.datepair")}function u(t){var n=e(this);o(n);var r=n.data("datepair-settings"),i=e(t.target);i.hasClass(r.dateClass)?i.val()!==""?h(n,i):n.data("datepair-datedelta",null):i.hasClass(r.timeClass)&&(i.val()!==""?d(n,i):n.data("datepair-timedelta",null)),v(n),p(n),s(n)}function a(e){var t=e.data("datepair-settings");return e.find("."+t.startClass+"."+t.dateClass)}function f(e){var t=e.data("datepair-settings");return e.find("."+t.endClass+"."+t.dateClass)}function l(e){var t=e.data("datepair-settings");return e.find("."+t.startClass+"."+t.timeClass)}function c(e){var t=e.data("datepair-settings");return e.find("."+t.endClass+"."+t.timeClass)}function h(e,n){var r=e.data("datepair-settings"),i=a(e),s=f(e);if(!i.length||!s.length)return;if(!i.val()||!s.val()){if(r.defaultDateDelta!==null){if(i.val()){var o=r.parseDate(i),u=new Date(o.getTime()+r.defaultDateDelta*t);r.updateDate(s,u)}else if(s.val()){var l=r.parseDate(s),c=new Date(l.getTime()-r.defaultDateDelta*t);r.updateDate(i,c)}e.data("datepair-datedelta",r.defaultDateDelta*t)}else e.data("datepair-datedelta",null);return}var o=r.parseDate(i),l=r.parseDate(s);if(n.hasClass(r.startClass)){var h=new Date(o.getTime()+e.data("datepair-datedelta"));r.updateDate(s,h)}else n.hasClass(r.endClass)&&(l<o?(e.data("datepair-datedelta",0),r.updateDate(i,l)):e.data("datepair-datedelta",l.getTime()-o.getTime()))}function p(e){var n=e.data("datepair-settings");if(typeof n.setMinTime!="function")return;var r=null;if(!e.data("datepair-datedelta")||e.data("datepair-datedelta")<t||e.data("datepair-timedelta")&&e.data("datepair-datedelta")+e.data("datepair-timedelta")<t){var i=l(e);r=n.parseTime(i)}var s=c(e);n.setMinTime(s,r)}function d(e,n){var r=e.data("datepair-settings"),i=l(e),s=c(e);if(!i.length||!s.length)return;if(!i.val()||!s.val()){if(r.defaultTimeDelta!==null){if(i.val()){var o=r.parseTime(i),u=new Date(o.getTime()+r.defaultTimeDelta);r.updateTime(s,u)}else if(s.val()){var a=r.parseTime(s),p=new Date(a.getTime()-r.defaultTimeDelta);r.updateTime(i,p)}e.data("datepair-timedelta",r.defaultTimeDelta)}else e.data("datepair-timedelta",null);return}var o=r.parseTime(i),a=r.parseTime(s);if(n.hasClass(r.startClass)){var d=new Date(o.getTime()+e.data("datepair-timedelta"));r.updateTime(s,d),a=r.parseTime(s)}if((a.getTime()-o.getTime())*e.data("datepair-timedelta")<0){var v=f(e);if(v.val()){var m=a<o?t:-1*t,g=r.parseDate(v);r.updateDate(v,new Date(g.getTime()+m)),h(e,v)}}e.data("datepair-timedelta",a.getTime()-o.getTime())}function v(e){var t=l(e),n=c(e);if(t.length&&n.length&&e.data("datepair-timedelta")===null){e.trigger("rangeIncomplete");return}var r=a(e),i=f(e);if(r.length&&i.length&&e.data("datepair-datedelta")===null){e.trigger("rangeIncomplete");return}e.data("datepair-datedelta")+e.data("datepair-timedelta")>=0?e.trigger("rangeSelected"):e.trigger("rangeError")}var t=864e5,n={startClass:"start",endClass:"end",timeClass:"time",dateClass:"date",defaultDateDelta:0,defaultTimeDelta:36e5,parseTime:function(e){return e.timepicker("getTime")},updateTime:function(e,t){e.timepicker("setTime",t)},parseDate:function(e){return e.datepicker("getDate")},updateDate:function(e,t){e.datepicker("setDate",t)},setMinTime:function(e,t){e.timepicker("option","minTime",t)}},r={init:function(t){return this.each(function(){var r=e(this),o=e.extend({},n);t&&(o=e.extend(o,t)),o=i(o),r.data("datepair-settings",o),s(r);var u=a(r),h=f(r);if(u.val()&&h.val()){var d=o.parseDate(u),v=o.parseDate(h);r.data("datepair-datedelta",v.getTime()-d.getTime())}else r.data("datepair-datedelta",null);var m=l(r),g=c(r);if(m.val()&&g.val()){var y=o.parseTime(m),b=o.parseTime(g);r.data("datepair-timedelta",b.getTime()-y.getTime())}else r.data("datepair-timedelta",null);p(r)})},option:function(t,n){var r=this,s=r.data("datepair-settings");if(typeof t=="object")s=e.extend(s,t);else if(typeof t=="string"&&typeof n!="undefined")s[t]=n;else if(typeof t=="string")return s[t];return s=i(s),r.data("datepair-settings",s),r},getTimeDiff:function(){var e=this;return e.data("datepair-datedelta")*t+e.data("datepair-timedelta")},remove:function(){var e=this;return e.removeData("datepair-settings"),o(e),e},dateChanged:h};e.fn.datepair=function(t){if(r[t])return r[t].apply(this,Array.prototype.slice.call(arguments,1));if(typeof t=="object"||!t)return r.init.apply(this,arguments);e.error("Method "+t+" does not exist on jQuery.datepair")}}),define("hbs!modules/common/templates/post/meetings",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<a id="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===a?o.apply(t):o))+'" class="meeting-source-item img-wrap ucc-dialog">\n    <img class="js-meeting-icon" src="',u={hash:{},data:i},s+=f((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.icon_url),1,u):l.call(t,"assetImage",(o=t&&t.model,o==null||o===!1?o:o.icon_url),1,u)))+'" alt="">\n</a>\n',s})}),define("modules/common/views/post/meetings",["jquery","underscore","tibbr","modules/dialog","hbs!modules/common/templates/post/meetings"],function(e,t,n,r,i){return n.View.extend({tagName:"li",className:"meetingLi",initialize:function(e){t.bindAll(this,"render","loadMeetings"),this.parent=e.parent},events:{"click a.meeting-source-item":"loadMeetings"},launchFrame:function(t){return r.view(e("<iframe/>").attr({src:t,height:750,width:480,"class":"client-stream"}),{width:480,position:["top",100],className:"no-title-no-padding"}),!1},render:function(){return this.renderedTemplate=this.renderTemplate(i),this.$el.html(this.renderedTemplate),this.$el.css({display:"inline-block"}),this},loadMeetings:function(e){var t=e.currentTarget.id;return this.launchFrame(this.model.urlsType("new_meeting").url()+"&cid="+this.cid),this.parent.meetingConfig.meetingAppName=t,this.parent.meetingConfig.renderedTemplate=this.renderedTemplate,!1}})}),define("hbs!modules/common/templates/post/calender",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<fieldset class="duration datepair">\n    <ul>\n        <li>\n            <label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"calendar.start_time",u):a.call(t,"t","calendar.start_time",u)))+'</label>\n            <input type="hidden" class="calendar_start_date_hidden"/>\n            <input type="text" class="medium-textbox date start cal-text-box datestart" ref="calendar_start_date_hidden">\n            <input type="text" id="time_start" class="time start" >\n        </li>\n        <li>\n            <label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"calendar.end_time",u):a.call(t,"t","calendar.end_time",u)))+' </label>\n            <input type="hidden" class="calendar_end_date_hidden"/>\n            <input type="text" class="medium-textbox date end dateend" ref="calendar_end_date_hidden">\n            <input type="text"  id="time_end" class="time end" ref="calendar_end_time_hidden">\n        </li>\n    </ul>\n</fieldset>\n\n\n<fieldset>\n	<div class="textarea-wrap">\n        <input type="text"  placeholder="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.post.calender.where",u):a.call(t,"t","common.post.calender.where",u)))+'"\n               style="font-size:small"\n               class="cal-text-box calendar-location js-location" id="calendar-location">\n    </div>\n</fieldset>\n\n<fieldset>\n	<div class="textarea-wrap">\n    <textarea rows="2"  id="calendar-more-info" cols="40"\n              class="calendar-more-info cal-text-box js-more-info" autocomplete="off"\n              placeholder="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.post.calender.more_details",u):a.call(t,"t","common.post.calender.more_details",u)))+'"></textarea>  </div>\n</fieldset>\n\n<div class="add-calendar" id="add-calendar">\n      <span class="calendar-option">\n        <label><input type="checkbox"  class="js-show-guest" checked="checked" value="true">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.post.calender.show_guest_list",u):a.call(t,"t","common.post.calender.show_guest_list",u)))+"\n        </label>\n      </span>\n</div>\n",s})}),define("modules/common/views/post/calender",["jquery","underscore","tibbr","require/moment","jqueryui/datepicker","require/timepicker","require/datepair","./meetings","modules/dialog","hbs!modules/common/templates/post/calender"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({className:"calendarinfo",events:{"click input.datepicker":"showDatePicker","click input.end_date_picker":"showDatePicker"},initialize:function(){t.bindAll(this,"showDatePicker","bind","setDefaults","resetMeetingChoices"),this.meetingConfig={urlType:"new_meeting",view:u},n.Event.bindTo(this,"meeting:added",this.meetingAdded),this.render()},render:function(){return this.$el.empty(),this.appendTemplate(f,{start_hours:n.i18n.common.post.calender.start_hour,start_minute:n.i18n.common.post.calender.start_minutes,duration_hour:n.i18n.common.post.calender.duration_hours,duration_minute:n.i18n.common.post.calender.duration_minutes}),this.afterRenderToDom().done(this.bind),this.$("[placeholder]").simplePlaceholder(),this},setDefaults:function(){if(!this.options.isUpdate){this.$(".update_cal").hide(),this.$(".datestart").val(r().format(n.dateFormat.DDDD)),this.$(".calendar_start_date_hidden").val(r().format(n.serverDateFormat)),this.$(".calendar_end_date_hidden").val(r().format(n.serverDateFormat)),this.$(".dateend").val(r().format(n.dateFormat.DDDD));var e=this.roundTime();this.$("#time_start").val(e[0]),this.$("#time_end").val(e[1])}else{var t=this.model.calendar;this.$(".calendar_start_date_hidden").val(t.displayDate(r,"start_date_time",n.serverDateFormat)),this.$(".datestart").val(t.displayDate(r,"start_date_time","DDDD")),this.$(".calendar-more-info").val(t.get("more_info")),this.$(".calendar-location").val(t.get("location")),this.$("#time_start").val(t.displayDate(r,"start_date_time","hhhh"));var i=t.endDate().format(n.dateFormat.DDDD),s=t.endDate().format(n.dateFormat.hhhh);this.$("#time_end").val(s),this.$(".calendar_end_date_hidden").val(t.endDate().format(n.serverDateFormat)),this.$(".dateend").val(i)}},roundTime:function(){var e=r(r()),t=e.minutes(),i=e.hours();return e.minutes(parseInt((t+15)/30)*30%60),e.hours(t>30?i===23?0:++i:i),[e.format(n.dateFormat.hhhh),e.add("hours",1).format(n.dateFormat.hhhh)]},showDatePicker:function(){return!1},changeHHMM:function(e){var t=parseInt(e),n=Math.floor(t/3600),r=Math.floor((t-n*3600)/60);return n<10&&(n="0"+n),r<10&&(r="0"+r),n+":"+r},bind:function(){this.setDefaults(),this.$("input.time").timepicker({showDuration:!0,timeFormat:n.dateFormat.TTTT,scrollDefaultNow:!0}),this.$("input.date").each(function(){var t=e(this),r={dateFormat:n.dateFormat.DDD,altField:"."+t.attr("ref"),altFormat:n.serverDatePickerFormat,minDate:new Date};t.hasClass("future")&&(r.minDate=new Date),t.datepicker(r)}),this.$(".datepair").datepair()},initMeeting:function(){if(n.gadget)return;this.meetingConfig.target=e(".meeting-sources"),this.meetingConfig.targetItem=this.meetingConfig.target.find(".meeting-source-item"),this.renderExtAssets(this.meetingConfig,function(){n.currentUser.meetings.length>0&&e(".meeting-schedular").show()})},renderExtAssets:function(t,r){var i=t.target,s=t.targetItem,o=this;if(i.find(s).length===0){i.html("");var u=n.currentUser.meetings;u.each(function(e){var n=o.initChild(t.view,{model:e,parent:o});try{i.append(n.render().el)}catch(r){console.error("view rendering error ",r)}})}return e.isFunction(r)&&r(o),!1},resetMeetingChoices:function(t){return t instanceof e.Event&&t.preventDefault(),this.meeting=null,n.currentUser.meetings.length>0&&(e("#added-meeting").hide(),e("#meeting-choices").show(),e(".js-meeting-input").remove()),!1},meetingAdded:function(t){a.closeAll();try{this.meeting={app_id:t.meeting.meeting.app_id,custom_properties:t.meeting.meeting.custom_properties},e("#meeting-choices").hide(),e("#added-meeting").empty().prepend(this.meetingConfig.renderedTemplate).find(".js-meeting-icon").unwrap().end().find("span").text(this.t("common.meeting_added",{name:this.meetingConfig.meetingAppName})).end().append('<a><i class="ui-inline-icon close js-meeting-close"></i></a>').show().find("i.js-meeting-close").one("click",this.resetMeetingChoices)}catch(n){console.error("invalid data object returned from meeting app",t)}},dates:function(){var e=r(this.$(".calendar_start_date_hidden").val()+" "+this.$("#time_start").val(),n.serverDateTimeTimeZoneFormat),t=r(this.$(".calendar_end_date_hidden").val()+" "+this.$("#time_end").val(),n.serverDateTimeTimeZoneFormat),i=t.diff(e,"seconds");return{startDate:e,endDate:t,hours:i}},validate:function(){var e=!0,n="",r=this.dates().hours;if(t.isEmpty(this.$("input.calendar_start_date_hidden").val())||t.isEmpty(this.$("input.calendar_end_date_hidden").val()))e=!1,n=this.t("poll.date_not_empty");if(t.isEmpty(this.$("#time_end").val())||r<=0||t.isEmpty(this.$("#time_start").val()))e=!1,n=this.t("calendar.duration_empty");return{validate:e,errors:n}},postData:function(){var e=this.dates(),t=e.startDate.format(n.serverDateTimeTimeZoneFormat+n.currentUser.gmtValue()),r=e.hours,i=this.$(".js-location"),s=this.$(".js-more-info"),o={start_date_time:t,duration:this.changeHHMM(r),location:i.val()===i.attr("placeholder")?"":i.val(),more_info:s.val()===s.attr("placeholder")?"":s.val(),show_guest:this.$(".js-show-guest").prop("checked")};return this.meeting&&(o.meeting=this.meeting),o},isDurationExceed:function(){return this.dates().startDate.diff(r(new Date),"minutes")<-5}})}),define("hbs!modules/common/templates/messages/add",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<style type="text/css">\r\n    #cboxLoadedContent #as-results-add_people ul.as-list {\r\n       position: relative;\r\n    }\r\n    ul.as-selections li.as-original input {\r\n       width: 220px;\r\n    }\r\n</style>\r\n<ul class="steps error-wrap">\r\n    <li class="grid-line">\r\n        <div id="posting_tags">\r\n            <fieldset class="auto-suggest"></fieldset>\r\n        </div>\r\n        <fieldset class="post-privately" style="display: none">\r\n            <label for="post-privately" style="width: 350px">\r\n                <input id="post-privately" name="private" type="checkbox" value="true">\r\n                ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.share_private_message",u):a.call(t,"t","message.share_private_message",u)))+'\r\n            </label>\r\n        </fieldset>\r\n    </li>\r\n    <li class="grid-line entry" style="border:none">\r\n        <div id="msg_container"></div>\r\n    </li>\r\n    <li class="grid-line action">\r\n        <div align="right">\r\n            <input type="submit" value="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.action.add_to_post",u):a.call(t,"t","message.action.add_to_post",u)))+'" class="submit-btn btn btn-submit">\r\n        </div>\r\n    </li>\r\n</ul>',s})}),define("modules/common/views/messages/add",["jquery","underscore","tibbr","modules/dialog","modules/common/views/common/auto_suggest","hbs!modules/common/templates/messages/add"],function(e,t,n,r,i,s){return n.View.extend({className:"tibbr-share-dialog-wrap",events:{"click input:submit":"addToPost"},render:function(){this.$el.html(this.renderTemplate(s)),this.model.get("private_message")&&this.$(".post-privately").show().find("input:checkbox").prop("checked",!0);var e=this.options.html;return e.find(".action-links, .comment-box-wrap, .more_users, .vote-action, .replies").remove(),e.on("click","a",function(){return!1}),this.$("div#msg_container").html(e),this.renderAutoSuggest(),this},addToPost:function(){var e=this,n=this.model.get("private_message"),i=e.$("#post-privately").is(":checked");return this.autoSuggest.getValueInArray().length==0?(r.alert({text:this.t("common.errors.choose_subjects")}),!1):(n&&i===!1&&this.autoSuggest.hasPublic()||!n&&this.autoSuggest.hasPrivate()?r.confirm({text:e.t("common.scope.alert.mixed_scope"),okFunction:function(){e.submit(e.autoSuggest.getValue())}}):n&&i&&this.autoSuggest.hasOnly("u")?this.submit(t.collect(this.autoSuggest.getValueInArray(),function(e){return e+".p"}).join(",")):this.submit(this.autoSuggest.getValue()),!1)},submit:function(e){this.model.addSubjects(e).done(function(e){n.pub("add_recipients",{Recipients:t.pluck(e.subjects,"id")})})},renderAutoSuggest:function(){return this.autoSuggest=this.initChild(i,{params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0},type:"both",value_type:"login",per_page:5},attributes:{name:"add_people"}}),this.autoSuggest.excludeSubjects=this.model.subjects.pluck("name"),this.autoSuggest.excludeUsers=t.map(this.model.subjects.where({stype:"system"}),function(e){return e.get("name")}),this.$(".auto-suggest").html(this.autoSuggest.render().el),this.bindTo(this.autoSuggest,"added",this.targetChange,this),this.bindTo(this.autoSuggest,"removed",this.targetChange,this),this},targetChange:function(){var e=this,t=e.$("#post-privately"),n=t.is(":checked");e.autoSuggest.hasSubject()?t.prop("disabled",!0).prop("checked",!1):t.prop("disabled",!1)},bind:function(){this.autoSuggest.bind()}})}),define("modules/common/collections/question_users",["jquery","tibbr","../models/user"],function(e,t,n){return t.Collection.extend({className:"questions_users",model:n,tibbrURL:{controller:"questions",action:"get_option_users"}})}),define("hbs!modules/common/templates/messages/poll_option",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s,o;return r+='\r\n        <li>\r\n            <a title="',(i=n.display_name)?i=i.call(e,{hash:{},data:t}):(i=e&&e.display_name,i=typeof i===f?i.call(e,{hash:{},data:t}):i),r+=l(i)+'" href="',o={hash:{},data:t},r+=l((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e,o):c.call(e,"urlFor","show",e,o)))+'" data-id="',(s=n.id)?s=s.call(e,{hash:{},data:t}):(s=e&&e.id,s=typeof s===f?s.call(e,{hash:{},data:t}):s),r+=l(s)+'" class="js-option-profile-hover profile-pic">\r\n                <img src="',o={hash:{},data:t},r+=l((i=n.assetImage||e&&e.assetImage,i?i.call(e,e&&e.profile_image_url,5,o):c.call(e,"assetImage",e&&e.profile_image_url,5,o)))+'" class="medium">\r\n            </a>\r\n        </li>\r\n    ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="custom-input-box"></div>\r\n<div class="poll-bar-wrap">\r\n    <div class="poll-option-display">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.option_label),typeof o===f?o.apply(t):o))+'<a class="vote-count mls">',a={hash:{count:t&&t.userCount},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"poll.votes",a):c.call(t,"t","poll.votes",a)))+'</a>\r\n    </div>\r\n    <div class="poll-bar">\r\n        <div class="poll-bar-inner" id="_'+l((o=(o=t&&t.model,o==null||o===!1?o:o.question_id),typeof o===f?o.apply(t):o))+'"></div>\r\n    </div>\r\n</div>\r\n<ul class="voters-list">\r\n    ',u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.users),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;return s+='\r\n    <li><a class="more_users see-all hidden" id="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===f?o.apply(t):o))+'_more_users">...</a></li>\r\n</ul>',s})}),define("modules/common/views/messages/option_item",["jquery","underscore","tibbr","modules/tags/input","modules/common/views/common/hover_profile","hbs!modules/common/templates/messages/poll_option"],function(e,t,n,r,i,s){return n.View.extend({qtipConfig:n.qtipConfigs.pollUsers,tagName:"li",events:{"change input[type=radio]":"vote","change input[type=checkbox]":"vote","mouseenter .tb-poll-result-bar":"showVotes","mouseleave .tb-poll-result-bar":"showVotes"},initialize:function(){this.bindTo(this.model,"change",this.inputItem,this),this.parent=this.options.parent},render:function(){var e=this.parent.model.get("multi_select"),t=s,n=parseInt(this.model.get("option_users_count"));this.$el.html(this.renderTemplate(t,{userCount:n})),this.inputItem();var r=parseInt(this.model.get("option_users_count")),i=this.parent.model.getTotalVotes(this.model.get("question_id")),o=r/i*100;return this.$("#_"+this.model.get("question_id")).toggleClass("hidden",!o).css("width",o+"%"),this.profileHover(),this},inputItem:function(){var e=this.parent.model.get("multi_select"),t=e?"checkbox":"radio";this.$(".custom-input-box ").replaceWith(this.initChild(r,{name:"question_"+this.model.get("id"),checked:this.model.hasSelected(),type:t,disabled:this.parent.model.checkExpiryDate()}).render().el)},showVotes:function(e){e.type==="mouseleave"?this.$(".vote-count-label").css("visibility","hidden"):this.$(".vote-count-label").css("visibility","visible")},vote:function(t){if(this.loading)return;this.loading=!0;var n=this,r=e(t.target).is(":checked")?"answer":"unanswer";this.parent.model.voteOption(r,this.model).done(function(){n.loading=!1})},profileHover:function(){if(window.gadget)return;var r=this;this.$(".js-option-profile-hover").each(function(){var s=e(this);s.qtip(n.qtipConfigs.hovercard(i,{object:t.detect(r.model.get("users"),function(e){return e.id===s.data("id")})}))})}})}),define("text!modules/common/templates/messages/show_users_poll_item.html",[],function(){return"<a title=\"${model.get('display_name')}\" href=\"${model.showUrl}\">\r\n    {{html helper.imageTag(model.image(1), {'class':'bordered-1 small' ,'style': 'vertical-align: middle; padding: 2px;'})}}\r\n    ${model.get('display_name')}\r\n</a>"}),define("modules/common/views/messages/show_users_poll_item",["jquery","underscore","tibbr","models/user","text!modules/common/templates/messages/show_users_poll_item.html"],function(e,t,n,r,i){return n.View.extend({tagName:"li",className:"poll-li",render:function(){return this.$el.html(this.template.render(i,{model:this.model,storeKey:"templates_common_show_users_poll_item_html"})),this}})}),define("text!modules/common/templates/messages/show_users_poll_list.html",[],function(){return'<div class="more-actions-menu">\r\n    <ul class="stream"></ul>\r\n</div>'}),define("modules/common/views/messages/show_users_poll_list",["jquery","underscore","tibbr","modules/dialog","./show_users_poll_item","text!modules/common/templates/messages/show_users_poll_list.html"],function(e,t,n,r,i,s){return n.View.extend({className:"poll-user-box",initialize:function(){t.bindAll(this,"renderUsers","renderList")},events:{"click a.see-more":"renderUsers"},render:function(){return this.$el.html(this.template.render(s,{storeKey:"templates_common_show_users_poll_list_html"})),this.$("ul.stream").append("<li>"+n.UI.spinner+"</li>"),this.collection.length>0&&this.renderList(),this},renderList:function(){var e=this.collection,t=this.$("ul.stream").empty(),n=this;this.$("li.see-more").remove(),e.each(function(r){t.append(n.initChild(i,{model:r,collection:e}).render().el)}),e.hasMorePages&&t.append('<li class="see-more" style="text-align: center;padding: 2px;"><a href="#" class="see-more" style="color:#666"> '+this.t("poll.more_votes",{count:e.total_entries-e.length})+" </a></li>")},fetch:function(){this.collection.fetch().done(this.renderList)},renderUsers:function(){var n=requirejs("views/common/list_follower"),i=this,s=t.clone(this.collection);return e(".qtip").hide(),r.render(n,{collection:s,title:"",data:s.dataParams,fetch:s,dialog:{title:this.options.title||i.t("poll.people_who_like_this"),className:"email-alerts-dialog insight-activity-overlay",width:500}}),!1}})}),define("hbs!modules/common/templates/messages/more_poll_option",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<li class="add-poll-option">\r\n    <div class="media-box custom-input-box">\r\n        <div class="option-btn ${type}-btn  disabled">\r\n            <input  type="${type}" disabled >\r\n        </div>\r\n    </div>\r\n    <div class="poll-bar-wrap">\r\n        <div class="poll-option-display">\r\n            <input id="more_poll_option" maxlength="255" type="text" id="option_label" placeholder="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"poll.add_an_option",u):a.call(t,"t","poll.add_an_option",u)))+'" class="optiondefaultText add-more"  autocomplete="off">\r\n        </div>\r\n        <div class="poll-bar">\r\n        </div>\r\n    </div>\r\n    <input id="add_more_poll_option" type="button" value="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"poll.add_button",u):a.call(t,"t","poll.add_button",u)))+'" name="commit" class="btn btn-primary hidden">\r\n</li>',s})}),define("modules/common/views/messages/question",["jquery","underscore","tibbr","../../collections/question_users","./option_item","./show_users_poll_list","hbs!modules/common/templates/messages/more_poll_option","modules/dialog"],function(e,t,n,r,i,s,o,u){return n.View.extend({tagName:"ul",className:"poll-options",events:{"focusin .add-more":"addMoreOptions","focusout .add-more":"addMoreOptions","click #add_more_poll_option":"submitAddMore"},initialize:function(){t.bindAll(this,"render","addMoreOptions","submitAddMore"),this.bindTo(this.model,"change",this.render,this),this.bindTo(this.model,"error",this.error,this),this.collections={}},render:function(){var t=this,n=this.model.question_options,r=e(this.el).empty(),s=t.model.get("multi_select")?"checkbox":"radio";if(this.model.checkExpiryDate()){var u=this.model.getTotalVotes(this.model.get("id"));r.append(t.t("poll.vote_expired_counting",{count:u}))}return n.each(function(e){r.append(t.initChild(i,{model:e,collection:n}).render().el),e.get("option_users_count")>3&&(t.$("#"+e.id+"_more_users").removeClass("hidden"),t.showMoreUsers(e))}),t.model.checkExpiryDate()||t.model.get("allow_others_to_add_options")&&(r.append(t.renderTemplate(o,{type:s})),this.$("[placeholder]").simplePlaceholder()),this},addMoreOptions:function(e){return e.type==="focusin"?this.$("#add_more_poll_option").show():e.type==="focusout"&&(t.isEmpty(this.$("input.optiondefaultText").val())||this.$("input.optiondefaultText").val()===n.translate("poll.add_an_option"))&&this.$("#add_more_poll_option").hide(),this},submitAddMore:function(){this.model.addMoreOption(this.$("input#more_poll_option").val())},error:function(e){u.alert({text:e[0]}),this.render()},showMoreUsers:function(e){var t=this.collections[e.id]=this.collections[e.id]||new r([],{scopeId:this.model.id,dataParams:{params:{question_options_id:e.id,page:1,per_page:10,set_actions:!0}}});this.$("#"+e.id+"_more_users").qtip(n.qtipConfigs.pollUsers(s,{model:this.model,parent:this,collection:t}))}})}),define("hbs!modules/common/templates/messages/share_message",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n            <img alt="" src="',s={hash:{},data:t},r+=l((i=n.assetImage||e&&e.assetImage,i?i.call(e,(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.profile_image_url),1,s):f.call(e,"assetImage",(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.profile_image_url),1,s)))+'">\n        ',r}function d(e,t){var n="",r;return n+="\n                    "+l((r=(r=(r=e&&e.model,r==null||r===!1?r:r.user),r==null||r===!1?r:r.display_name),typeof r===c?r.apply(e):r))+"\n                ",n}function v(e,t){var r="",i,s;return r+="\n            ",s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"common.view_full_post",s):f.call(e,"t","common.view_full_post",s)))+"\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="bg-wrap">\n    <div class="media-box">\n        ',a={hash:{"class":"profile-pic"},inverse:h.noop,fn:h.program(1,p,i),data:i},u=(o=n.linkTo||t&&t.linkTo,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"linkTo",(o=t&&t.model,o==null||o===!1?o:o.user),a));if(u||u===0)s+=u;s+='\n        <div class="info">\n            <h6>\n                ',a={hash:{"class":"profile-name user_url"},inverse:h.noop,fn:h.program(3,d,i),data:i},u=(o=n.linkTo||t&&t.linkTo,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"linkTo",(o=t&&t.model,o==null||o===!1?o:o.user),a));if(u||u===0)s+=u;s+='\n            </h6>\n            <p class="posted-to jsPostedTo"></p>\n        </div>\n    </div>\n    <div class="msg tib-content js-share-content rich-post">',u=(o=(o=t&&t.model,o==null||o===!1?o:o.getRichContent),typeof o===c?o.apply(t):o);if(u||u===0)s+=u;s+='</div>\n    <div class="m-holder" style="display: none;"></div>\n    <div class="poll-wrap" style="display: none;"></div>\n    <div class="eog-holder" id="eog-holder-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===c?o.apply(t):o))+'" style="display: none"></div>\n    <div class="asset-attachment h-scroll" style="display: none;"></div>\n    <p class="action-links msg-action-links js-share-actions">\n        <a>\n            <i class="like-link liked"></i>\n            <i class="mid-dot">·</i>\n            <span class="count">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.likes_count),typeof o===c?o.apply(t):o))+'</span>\n        </a> <span>|</span>\n        <a>\n            <i class="reply-link"></i>\n            <i class="mid-dot">·</i>\n            <span class="count">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.replies_count),typeof o===c?o.apply(t):o))+"</span>\n        </a>\n        ",a={hash:{"class":"view-post"},inverse:h.noop,fn:h.program(5,v,i),data:i},u=(o=n.linkTo||t&&t.linkTo,o?o.call(t,t&&t.model,a):f.call(t,"linkTo",t&&t.model,a));if(u||u===0)s+=u;return s+="\n    </p>\n</div>\n",s})}),define("modules/common/views/messages/share_item",["jquery","underscore","tibbr","modules/dialog","modules/common/views/messages/mixed_asset_list","modules/common/views/messages/link_list","modules/common/views/messages/calendar_view","modules/common/views/messages/question","hbs!modules/common/templates/messages/share_message"],function(e,t,n,r,i,s,o,u,a){var f=n.View.extend({className:"shared-post",initialize:function(){this.bindTo(this.model,"addSubject:done",this.updatePostTo,this),this.bindTo(this.model,"removeSubjects:done",this.updatePostTo,this)},events:{"click a.js-action-target-link":"actionTargetLink","click a.continued":function(){return this.$(".js-share-content").html(this.model.getRichContent(!0)),!1},"click .js-share-actions >  a":function(){var e=this;return r.render(this.options.itemView,{model:this.model,dialog:{width:700,max_height:600,close:function(t){e.render()}}}),!1}},render:function(){return this.$el.html(this.renderTemplate(a)),this.model.getMessageType()==="calendar"&&this.model.calendar?this.$(".m-holder").append(this.initChild(o,{model:this.model.calendar,parent:this}).render().el).show():this.model.getMessageType()==="question"&&this.model.question&&this.$(".poll-wrap").append(this.initChild(u,{model:this.model.question,parent:this}).render().el).show(),this.model.parseResources(),this.model.assets.length>0&&this.$("div.asset-attachment").append(this.initChild(i,{collection:this.model.assets}).render().el).show(),this.model.links.length>0&&this.$("div.asset-attachment").append(this.initChild(s,{collection:this.model.links}).render().el).show(),this.postTo(),this.renderResource(),this},postTo:function(){this.$("a.js-more-people").qtip("remove"),this.$(".js-more-people-list")&&this.$(".js-more-people-list").remove();var r=this,i=e("<p class='posted-to js-posted-to'/>"),s=t.reject(this.model.postedWith().unKnownList,function(e){return t.isEmpty(e)}),o=t.reject(this.model.postedWith().knowList,function(e){return t.isEmpty(e)});o.length>0&&(t.each(o,function(n){try{var r=n.model.toJSON()}catch(s){r={}}i.append(e("<a>",{data:{model:n.model,event_key:(n.isUser?"user":"subject")+".selected",event_data:window.gadget?r:""},href:n.url,html:'<i class="ui-inline-icon '+n.icon+'"></i>'+"<span>"+t.str.truncate(n.name,20)+"</span>","class":"js-publish subject-tip"})).append(" ")}),s.length>0&&i.append(e("<a/>",{"class":"js-more-people",text:r.t("message.more_targets",{count:s.length})})),i.append('<span class="small time-stamp msg-datetime"><i class="ui-inline-icon clock-icon"></i>'+this.model.postedAt()+"</span>"),this.$(".js-posted-to").replaceWith(i),this.$("a.js-more-people").qtip(n.qtipConfigs.dropDown(s,{showEvent:"mouseenter",hideEvent:"mouseleave",fixed:!0})))},updatePostTo:function(e){this.model.subjects.reset(e.subjects),this.model._postedWith=undefined,this.model.set("private_message",e.private_message),this.postTo();var t=this;n.currentUser.batchActionOn([{target_class:t.model.get("json_class"),target_id:t.model.id}]).done(function(e){t.model.set("actions",e.actions_array[0].actions)}),r.close(),!this.model.get("private_message")&&this.$(".js-private").length&&this.$(".js-private").remove()}});return t.extend(f.prototype,n.Modules.View.ActionLink),t.extend(f.prototype,n.Modules.View.Resource),f}),define("hbs!modules/common/templates/post/post_privacy",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="post-privacy js-post-privacy">\n    <div class="privacy-text">\n        <span class="public text">\n           <span class="">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.asset.posted_to_public",u):a.call(t,"t","common.asset.posted_to_public",u)))+'</span>\n           <i class="ui-inline-icon arrow-down"></i>\n        </span>\n    </div>\n</div>\n<ul class="privacy-menu">\n    <li>\n        <a class="public js-change">\n         <span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.asset.posted_to_public",u):a.call(t,"t","common.asset.posted_to_public",u)))+'</span>\n        </a>\n    </li>\n    <li>\n        <a class="private js-change">\n            <span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.asset.posted_to_private",u):a.call(t,"t","common.asset.posted_to_private",u)))+'</span>\n        </a>\n    </li>\n</ul>\n<input type="hidden" class="js-private"  name="message[private_message]">',s})}),define("modules/common/views/post/post_privacy",["jquery","underscore","tibbr","require/qtip","hbs!modules/common/templates/post/post_privacy"],function(e,t,n,r,i){return n.View.extend({initialize:function(){t.bindAll(this,"changeValue","onlyPrivate","onlyPublic")},className:"tib lfloat",render:function(){return this.$el.html(this.renderTemplate(i)),this.type==="private"?this.onlyPrivate():(this.bindPrivate(),this.options["default"]==="private"&&this.changeTo("private")),this},bindPrivate:function(){var t=this;this.$(".post-privacy").qtip({position:{at:"top right",my:"top right",adjust:{x:1},viewport:e(window)},show:{event:"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus click",style:{classes:"privacy-drop-down ui-action-menu qtip-light qtip-shadow",tip:!1},content:{text:t.$(".privacy-menu").clone()},events:{render:function(n,r){var i=r.elements.tooltip;e(i).on("click","a.js-change",function(e){t.changeValue(e)})}}})},changeValue:function(t){var r=e(t.currentTarget),i=r.hasClass("private")?"private":"public";return this.changeTo(i),this.$(".post-privacy").qtip("hide"),n.Event.trigger("post.type:change",i==="private"?"users":"both"),!1},onlyPrivate:function(){return this.changeTo("private"),this.$el.find(".post-privacy").addClass("post-private"),this.$el.find(".privacy-menu, .arrow").remove(),this.$(".post-privacy").qtip("destroy"),this},onlyPublic:function(){return this.changeTo("public"),this.$el.find(".post-privacy").addClass("post-private"),this.$el.find(".privacy-menu, .arrow").remove(),this.$(".post-privacy").qtip("destroy"),this},changeTo:function(e){this.type=e;var t=this.t("common.asset.posted_to_"+e),n=this.$(".privacy-text");n.find("span.text").addClass(e).find("span").text(t),n.find("span.text").removeClass(e==="private"?"public":"private"),this.$("input.js-private").val(e==="private"?"true":"false")}})}),define("hbs!modules/common/templates/messages/share",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<fieldset class="post-to">\n    <label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.post",u):a.call(t,"t","home.post",u)))+'</label>\n    <div class="auto-suggest"></div>\n</fieldset>\n<fieldset>\n    <div class="textarea-wrap jsShareBox"></div>\n</fieldset>\n<fieldset class="shared-post">\n    <div class="js-entry entry"></div>\n</fieldset>\n<fieldset class="asset-holder mts rfloat">\n    <div class="tib rfloat">\n        <button type="submit" class="btn btn-primary btn-small tib-btn rfloat">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.post.share",u):a.call(t,"t","common.post.share",u)))+' <span class="ui-inline-icon arrow-next"></span>\n        </button>\n    </div>\n</fieldset>\n',s})}),define("modules/common/views/messages/share",["jquery","underscore","tibbr","modules/dialog","../../models/message","modules/common/views/messages/share_item","modules/common/views/common/auto_suggest","modules/common/views/post/post_privacy","modules/common/views/post/mentions_input","hbs!modules/common/templates/messages/share"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({className:"tibbr-share-dialog-wrap",attributes:{style:""},events:{"click button:submit":"addToPost"},render:function(){this.$el.html(this.renderTemplate(f));var e=this.initChild(s,{model:this.model}).render();return e.$(".view-post").remove(),e.$(".js-share-actions").removeClass("js-share-actions"),this.$(".js-entry").html(e.el),this.$(".asset-holder").prepend(this.initChild(u).render().el),this.renderAutoSuggest(),this.renderTibBox(),this.options.community&&this.$el.find(".m-holder, .poll-wrap, .eog-holder, .asset-attachment, .msg-action-links").remove(),this},renderTibBox:function(){!n.richText.enable||n.IE7?this.renderMentionInput():this.renderRedactor()},renderMentionInput:function(){this.mentionsInput=this.initChild(a,{placeholder:this.t("common.post.what_going_on"),height:30,resource:this.options.resource,params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0}}}),this.$(".jsShareBox").html(this.mentionsInput.render().el),this.mentionsInput.bind()},renderRedactor:function(){var e=this;e.richText=!0,this.$(".jsShareBox").append('<textarea class="ts-redactor" placeholder="'+this.t("common.post.what_going_on")+'"></textarea>').find("textarea.ts-redactor").one("focus",function(){var t=n.richText;e.$(".jsShareBox").hide().after("<textarea class='redactor'>");var r=e.$(".redactor");r.redactor({plugins:["mention"],tabFocus:!1,buttons:t.tool_bar,allowedTags:t.allowed_tags,linebreak:!0}),r.insertHtml(""),e.$(".redactor_toolbar").css("width",t.tool_bar.length*27)})},getTargets:function(){var e="";return t.isEmpty(this.options.postTarget)||(e=t.map(this.options.postTarget.split(","),function(e){return"@"+e}).join(" ")),this.options.postTo!==!1?e+" "+t.map(this.autoSuggest.getValueInArray(),function(e){return"@"+e}).join(" "):e},addToPost:function(){var e=[];this.autoSuggest.getValueInArray().length==0&&e.push(this.t("common.errors.choose_users"));var n;if(this.richText){try{n=this.$(".redactor").mentionHTML()}catch(i){n=""}t.str.stripTags(n).length===0&&(n="")}else n=this.$(".tib-text").val();return!Modernizr.input.placeholder&&n===this.$(".ts-redactor").attr("placeholder")?e.push(this.t("message.errors.can_not_blank")):t.str.trim(n).length==0&&e.push(this.t("message.errors.can_not_blank")),e.length===0?this.submit():r.alert({text:e.join("<br>")}),!1},submit:function(){var e=this,s={};s[this.model.get("modelType")]=this.model.id;var o=this.getTargets(),u;this.$(".tib-text").mentionsInput("val",function(e){u=e}),this.richText&&(u=this.$(".redactor").mentionHTML());var a=o+" "+u,f={message:{private_message:this.$(".js-private").val(),rich_content:a,embedded_message_id:this.model.id}};if(this.options.community){var l={community_message_preview:this.model.get("community_message_preview")};t.extend(f.message,l),delete f.message.embedded_message_id}return this.ajax({beforeSend:function(){e.$("button:submit").prop("disabled",!0).append(spinner)},url:"messages",data:f}).done(function(t){n.currentNav==="home"&&n.Event.trigger("message:created",new i(t));var r=e.model.get("embedding_messages_count")||0;e.model.set("embedding_messages_count",r+1),e.options.community&&parent.TIBR?parent.TIBR.events.trigger("share_post:close"):e.$dialog.dialog("close")}).done(function(){n.pub("share",s)}).fail(function(e){r.alert({text:n.Modules.Error.parse(e).join(" ")})}).always(function(){e.$("button:submit").prop("disabled",!1).find(".spinner").remove()})},renderAutoSuggest:function(){return this.options.community&&(this.autoSuggest=this.initChild(o,{params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0},type:"both",value_type:"login",per_page:5},attributes:{name:"share_post"}})),this.autoSuggest=this.initChild(o,{params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0},type:"both",value_type:"login",per_page:5},attributes:{name:"share_post"}}),this.$(".auto-suggest").html(this.autoSuggest.render().el),this.bindTo(this.autoSuggest,"added",this.targetChange,this),this.bindTo(this.autoSuggest,"removed",this.targetChange,this),this},bind:function(){this.autoSuggest.bind(),this.mentionsInput&&this.mentionsInput.bind()},onLeave:function(){this.$(".redactor").destroyEditor(),this.$(".redactor").remove()}})}),define("hbs!modules/common/templates/messages/poll_update",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var n="";return n+='\n                  <option value="'+l(typeof e===f?e.apply(e):e)+'">'+l(typeof e===f?e.apply(e):e)+"</option>\n                  ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div id="email-post-wrap">\n    <div id="poll_update_message"></div>\n    <div id="email-post" class="poll_expire_div">\n        <h3>',a={hash:{date:(o=t&&t.model,o==null||o===!1?o:o.formattedDate),time:(o=t&&t.model,o==null||o===!1?o:o.time)},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"poll.poll_will_end_on_date",a):c.call(t,"t","poll.poll_will_end_on_date",a)))+"</h3>\n\n        <fieldset>\n            <label>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"poll.change_date_time_to",a):c.call(t,"t","poll.change_date_time_to",a)))+'</label>\n            <input type="hidden" class="poll_date"/>\n            <input type="text" value="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.formattedDate),typeof o===f?o.apply(t):o))+'" size="20" class="pollUpdatedatepicker polldatepicker cal-text-box" id="poll_update_datepicker" />\n            <span id="calendar-start-date">\n              <label class="nfloat">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"poll.start_time",a):c.call(t,"t","poll.start_time",a)))+'</label>\n              <select name="date[hour]" id="poll_start_time_hour">\n                  ',u=n.each.call(t,t&&t.start_hours,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='\n              </select>\n\n              <select name="date[minute]" id="poll_start_time_minute">\n                  ',u=n.each.call(t,t&&t.start_minute,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;return s+='\n              </select>\n\n            </span>\n\n        </fieldset>\n        <fieldset class="action-links">\n            <input class="submit-btn btn btn-submit" type="submit" value="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"common.button_texts.save",a):c.call(t,"t","common.button_texts.save",a)))+'">&nbsp;\n        </fieldset>\n    </div>\n\n</div>',s})}),define("modules/common/views/messages/poll_update",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/poll_update","require/moment"],function(e,t,n,r,i){return n.View.extend({events:{"click .submit-btn":"update"},initialize:function(e){t.bindAll(this,"render","update"),this.$el.html(this.renderTemplate(r,{model:this.model,start_hours:n.i18n.common.post.calender.start_hour.split("_"),start_minute:n.i18n.common.post.calender.start_minutes.split("_")}))},options:n.i18n.common.post.poll_options.split("_"),render:function(){this.$(".pollUpdatedatepicker").datepicker({dateFormat:n.dateFormat.DDD,minDate:new Date,altField:this.$(".poll_date"),altFormat:n.serverDatePickerFormat});var e=this.model.get("expires_at").toDateArray(),t=e[4];return this.$("input.poll_date").val(e[0]+"-"+e[1]+"-"+e[2]),this.$("#poll_start_time_hour option[value="+e[3]+"]").attr("selected",!0),t>=0&&t<=15?this.$("#poll_start_time_minute option[value=15]").attr("selected",!0):t>15&&t<=30?this.$("#poll_start_time_minute option[value=30]").attr("selected",!0):t>30&&t<=45?this.$("#poll_start_time_minute option[value=45]").attr("selected",!0):t>45&&t<=60&&this.$("#poll_start_time_minute option[value=00]").attr("selected",!0),this},update:function(){var e=this.$(".poll_date").val(),t=this.$("#poll_start_time_hour").val(),r=this.$("#poll_start_time_minute").val(),i=e+" "+t+":"+r+n.currentUser.gmtValue();this.model.update(i)}})}),define("hbs!modules/common/templates/messages/calendar_update",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<fieldset class="update_message">\r\n</fieldset>\r\n<div style="float:right" class="update_cal">\r\n    <input class="submit-btn btn btn-submit" type="submit" value="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.button_texts.save",u):a.call(t,"t","common.button_texts.save",u)))+'">\r\n</div>\r\n',s})}),define("modules/common/views/messages/calendar_update",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/calendar_update","require/moment","modules/dialog"],function(e,t,n,r,i,s){return n.View.extend({events:{"click .submit-btn":"update"},className:"tib-box",initialize:function(){t.bindAll(this,"update","changeHHMM")},render:function(){this.$el.html(this.renderTemplate(r));var e=this.options.view;return e!==null&&(this.$(".update_message").html(e.el),this.model.get("msg_type")=="question"&&e.bindDate()),this.$(".calendar-option label input:checkbox").attr("checked",this.model.get("calendar").show_guest),this},update:function(){if(this.isValidate())switch(this.model.get("msg_type")){case"calendar":var e=i(this.$(".calendar_start_date_hidden").val()+" "+this.$("#time_start").val(),n.serverDateTimeTimeZoneFormat),t=i(this.$(".calendar_end_date_hidden").val()+" "+this.$("#time_end").val(),n.serverDateTimeTimeZoneFormat),r=e.format(n.serverDateTimeTimeZoneFormat+n.currentUser.gmtValue()),o=t.diff(e,"seconds"),u={message:{msg_type:"calendar",calendar:{id:this.model.calendar.get("id"),start_date_time:r,duration:this.changeHHMM(o),more_info:this.$(".calendar-more-info").val(),show_guest:this.$(".calendar-option label input:checkbox").is(":checked"),location:this.$(".calendar-location").val()}}},a=this;this.model.update(u).done(function(){a.dialog.close(),a.model.trigger("calendar:updated")});break;case"question":var f=i(i(this.$(".poll_date_hidden").val()+" "+this.$("#poll_time_start").val(),n.serverDateTimeTimeZoneFormat)).format();u={message:{question_attributes:{id:this.model.question.get("id"),expires_at:f,allow_others_to_add_options:this.$(".allow_others").is(":checked"),multi_select:this.$("#multi_select").is(":checked"),question_options:{"":{option_label:"hi"}}}}},this.model.update(u);break;case"plain":break;default:}else s.alert({text:this.errors.join("<br/>")}),this.errors=[]},isValidate:function(){this.errors=[];var e=!0,r=i(this.$(".calendar_end_date_hidden").val()+" "+this.$("#time_end").val(),n.serverDateTimeFormatLong),s=i(this.$(".calendar_start_date_hidden").val()+" "+this.$("#time_start").val(),n.serverDateTimeFormatLong),o=r.diff(s,"seconds");if(t.isEmpty(this.$("input.calendar_start_date_hidden").val())||t.isEmpty(this.$("input.calendar_end_date_hidden").val()))e=!1,this.errors.push(this.t("poll.date_not_empty"));if(t.isEmpty(this.$("#time_end").val())||o<=0||t.isEmpty(this.$("#time_start").val()))e=!1,this.errors.push(this.t("calendar.duration_empty"));return e},changeHHMM:function(e){var t=parseInt(e),n=Math.floor(t/3600),r=Math.floor((t-n*3600)/60);return n<10&&(n="0"+n),r<10&&(r="0"+r),n+":"+r}})}),define("hbs!modules/common/templates/post/post_poll_option",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n                <li>\n                    <label for="'+f(typeof e===a?e.apply(e):e)+'">'+f(typeof e===a?e.apply(e):e)+'</label>\n                    <input type="text" id="'+f(typeof e===a?e.apply(e):e)+'" maxlength="255"  class="poll-option-input js-options"\n                           placeholder="',s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"common.post.placeholder",s):l.call(e,"t","common.post.placeholder",s)))+'"/>\n                </li>\n            ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing,c=this;s+='<li>\n    <fieldset class="poll-wrap">\n        <ul class="poll-options question-options">\n            ',o=n.each.call(t,t&&t.options,{hash:{},inverse:c.noop,fn:c.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='\n        </ul>\n    </fieldset>\n</li>\n<div class="add-question">\n      <span id="allow-option">\n        <label><input type="checkbox" class="allow_others js-allow-others"  value="true">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"poll.allow_anyone_add_options",u):l.call(t,"t","poll.allow_anyone_add_options",u)))+'</label>\n        <label><input type="checkbox" class="js-multi-select" value="true">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"poll.allow_multiple_options",u):l.call(t,"t","poll.allow_multiple_options",u)))+'</label>&nbsp;&nbsp;&nbsp;&nbsp;\n       <br><br>\n        <input type="hidden" class="js-expire-at" class="poll_date"/>\n        <input type="hidden" class="poll_date_hidden"/>\n        <fieldset class="duration">\n            <ul>\n                <li>\n                    <label style="width:123px">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"poll.poll_will_end_on",u):l.call(t,"t","poll.poll_will_end_on",u)))+'</label>\n                    <input type="text" value="" size="20" class="polldatepicker medium-textbox date  cal-text-box"\n                           id="poll_expiry_datepicker" readonly="true">\n                    <input type="text" id="poll_time_start" class="time">\n\n                </li>\n            </ul>\n        </fieldset>\n          </span>\n</div>\n\n\n\n',s})}),define("modules/common/views/post/poll_option",["jquery","underscore","tibbr","require/moment","jqueryui/datepicker","require/timepicker","hbs!modules/common/templates/post/post_poll_option"],function(e,t,n,r,i,s,o){return n.View.extend({tagName:"ul",className:"poll-box-wrap",expiryDay:function(){return n.appConfig("poll","config","default_expiry_days")||3},collection:null,events:{"click input.poll-option-input":"showNext","keydown input.poll-option-input":"tabIt"},initialize:function(){this.render()},render:function(){this.$el.empty(),this.appendTemplate(o,{options:n.i18n.common.post.poll_options.split("_")}),this.$("ul.poll-options > li").slice(2).hide();var e=r(new Date).add("d",this.expiryDay()).format(n.dateFormat.DDDD);return this.$(".poll_date_hidden").val(r(new Date).add("d",this.expiryDay()).format(n.serverDateFormat)),this.$("#poll_expiry_datepicker").val(e),this},showNext:function(t){t.preventDefault(),e(t.target).parent().next().show()},tabIt:function(t){var n=t.keyCode||t.which;if(n==9){var r=e(t.currentTarget).parent().next().show();return r.find("input").focus(),r.next().show(),!1}},bindDate:function(){var e=this;this.$("input.polldatepicker").click(function(){e.$("input.polldatepicker").datepicker({dateFormat:n.dateFormat.DDD,minDate:new Date,maxDate:"+"+n.appConfig("poll","config","max_expiry_days")+"d",altField:e.$(".poll_date_hidden"),altFormat:n.serverDatePickerFormat}).datepicker("show")});var t=new Date;t.setMinutes(Math.round(t.getMinutes()/15)*15%60),this.model===undefined?this.$("input.time").timepicker({step:15,showDuration:!0,timeFormat:n.dateFormat.TTTT}).timepicker("setTime",t):this.$("input.time").timepicker({step:15,showDuration:!0,timeFormat:n.dateFormat.TTTT}).timepicker("setTime",this.model.question.get("expires_at"))},optionLabels:function(){var n=this;return e.map(this.$(".js-options"),function(r){var i=e(r).val(),s=Modernizr.input.placeholder?t.isEmpty(i):t.isEmpty(i)||i===n.t("common.post.placeholder");if(!s)return{option_label:i}})},validate:function(){var i=!0,s="",o=r(new Date),u=r(new Date(this.$("input.polldatepicker").val())),a=r(this.$(".poll_date_hidden").val()+" "+this.$("#poll_time_start").val(),n.serverDateFormatLong);return t.isEmpty(this.$("input.polldatepicker").val())&&(i=!1,s=this.t("poll.date_not_empty")),u.diff(o,"days")<=-2&&(i=!1,s=this.t("poll.poll_date_validation")),a.diff(r(new Date),"minutes")<=-1&&(i=!1,s=this.t("poll.poll_expiry_validation")),this.optionLabels().length<2&&!e("input.js-allow-others").prop("checked")&&(i=!1,s=this.t("poll.single_poll_option_message")),{validate:i,errors:s}},postData:function(){var e=this.$(".poll_date_hidden").val(),t=r(r(e+" "+this.$("#poll_time_start").val(),n.serverDateTimeTimeZoneFormat)).format(n.serverDateTimeTimeZoneFormat)+n.currentUser.gmtValue();return{expires_at:t,allow_others_to_add_options:this.$(".js-allow-others").prop("checked"),multi_select:this.$(".js-multi-select").prop("checked"),question_options:this.optionLabels()}}})}),define("hbs!modules/common/templates/messages/community",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<a href="'+a((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===u?o.apply(t):o))+'">'+a((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===u?o.apply(t):o))+"</a>",s})}),define("modules/common/views/messages/community",["jquery","underscore","tibbr","modules/pagebus","modules/overlay","hbs!modules/common/templates/messages/community"],function(e,t,n,r,i,s){return n.MessageCommunityView=n.View.extend({tagName:"li",initialize:function(){this.message=this.options.message,t.bindAll(this,"render","display")},events:{"click a":"display"},render:function(){return this.$el.html(this.renderTemplate(s)),this},display:function(){window.tibbrManagedHub=null,r.init(),r.subscribe("tibco.tibbr.loaded",function(){e("#community_loading").remove(),e.colorbox.resize()}),r.subscribe("tibco.tibbr.app.initialized",function(t){e("#community_loading").remove(),e.colorbox.resize(),r.publish("tibco.tibbr.logged_in",{})}),r.subscribe("tibco.tibbr.message.created",function(){i.close()}),this.postTo();var t={message:this.message.get("content")};return r.subscribe("tibco.tibbr.post.ready",function(){r.publish("tibco.tibbr.message.fill",t)}),r.subscribe("tibco.tibbr.auth",function(){r.publish("tibco.tibbr.message.fill",t)}),r.subscribe("tibco.tibbr.resize",function(t){e("iframe#"+t.iframe).height(t.height+20),i.resize()}),!1},postTo:function(){this.options.parent.hideCommunityMenu(),e(".post-to-community").remove();var t=function(){var e=window.location,t=e.protocol+"//"+e.hostname;return e.port!==""&&(t+=":"+e.port),t+n.context()},i="com-"+Math.floor(Math.random()*1111).toString(),s=i+"-post-to-community",o="<div id='"+s+"' style='width:620px; overflow: auto;' class='post-to-community'>"+"<div id='c-title'>"+this.t("home.post_to_community")+"</div>"+"<div id='community_loading' style='padding:  5px;'> "+spinner+" </div></div>",u=window.location,a=t()+"/javascripts/pagebus/tunnel.html",f={tunnelURL:a,gadgetURL:this.model.get("url")+"/a/gadgets/",scrolling:"auto",frameborder:0,gadgets:[{container:s,name:"post",style:{border:"0px",width:"100%",height:"300px"}}]};e.colorbox({html:o,overlayClose:!1,innerHeight:300,innerWidth:650}),r.gadgets(f,window.tibbrManagedHub)}})}),define("hbs!modules/common/templates/messages/global_announcement",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+="\r\n            ",i=n["if"].call(e,e&&e.announceSubject,{hash:{},inverse:c.noop,fn:c.program(2,p,t),data:t});if(i||i===0)r+=i;r+="\r\n            ",i=n["if"].call(e,e&&e.announceGlobal,{hash:{},inverse:c.noop,fn:c.program(4,d,t),data:t});if(i||i===0)r+=i;return r+="\r\n        ",r}function p(e,t){var r="",i,s;return r+='\r\n                <li><input type="radio" class="radio sub-announcement-type" value="subject" name="type" checked/>\r\n                    <label for="subject-announcement">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"announcement.subject_announcement",s):f.call(e,"t","announcement.subject_announcement",s)))+"</label>\r\n                </li>\r\n            ",r}function d(e,t){var r="",i,s;return r+='\r\n                <li>\r\n                <input type="radio" class="radio sub-announcement-type" value="global" name="type"/>\r\n                <label for="global-announcement">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"announcement.global_announcement",s):f.call(e,"t","announcement.global_announcement",s)))+"</label>\r\n                </li>\r\n            ",r}function v(e,t){var r="",i,s;return r+='\r\n            <li><input type="radio" class="radio sub-announcement-type" value="global" checked/>\r\n                <label for="global-announcement">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"announcement.global_announcement",s):f.call(e,"t","announcement.global_announcement",s)))+"</label>\r\n            </li>\r\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c=this;s+='<div class="announcement-settings-overlay">\r\n    <div><h2>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.make_global_announcement",a):f.call(t,"t","announcement.make_global_announcement",a)))+"</h2></div>\r\n    <h3>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.type_of_announcement",a):f.call(t,"t","announcement.type_of_announcement",a)))+"</h3>\r\n    <ul>\r\n        ",u=n["if"].call(t,t&&t.fromSubject,{hash:{},inverse:c.program(6,v,i),fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;return s+="\r\n\r\n    </ul>\r\n    <h3>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.duration",a):f.call(t,"t","announcement.duration",a)))+'</h3>\r\n    <ul>\r\n        <li>\r\n            <input type="radio" class="radio" id="manually" value="manualy" checked name="expiry"/>\r\n            <label for="manually">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.manually_remove",a):f.call(t,"t","announcement.manually_remove",a)))+'</label>\r\n        </li>\r\n        <li>\r\n            <input type="radio" class="radio" id="last-for" value="last-for" name="expiry"/>\r\n            <label for="last-for">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.days_to_keep",a):f.call(t,"t","announcement.days_to_keep",a)))+'</label>\r\n            <input type="text" id="days" style="width: 20px;" class="txt" value="1"/>\r\n\r\n            <p><span class="announcement-days-error">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"announcement.expires_at_input_invalid",a):f.call(t,"t","announcement.expires_at_input_invalid",a)))+'</span></p>\r\n        </li>\r\n    </ul>\r\n\r\n    <div id="tib" class="submit-btn-holder subject-post-btn rfloat">\r\n        <button class="btn btn-primary btn-submit tib-btn js-announcement-btn" id="subject-tib-btn" name="commit"\r\n                type="submit">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"common.button_texts.save",a):f.call(t,"t","common.button_texts.save",a)))+'\r\n        </button>\r\n        <span class="announcement-status"></span>\r\n    </div>\r\n\r\n</div>',s})}),define("modules/common/views/messages/global_announcement",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/global_announcement"],function(e,t,n,r){return n.View.extend({initialize:function(){this.bindTo(this.model,"change",this.render)},events:{"click .js-announcement-btn":"announce"},render:function(){var e=this.options.from===undefined?"":this.options.from;return this.$el.html(this.renderTemplate(r,{fromSubject:e==="subject",announceGlobal:this.options.announceGlobal,announceSubject:this.options.announceSubject})),this.$(".sub-announcement-type").length===1&&this.$(".sub-announcement-type").attr("checked","checked"),this},announce:function(){var t=this.options.subject_id===undefined?"":this.options.subject_id,n=e(".sub-announcement-type:checked").val(),r=this;if(this.validateForm()){this.$(".btn-submit").after(spinner);var i;e("#manually").is(":checked")||(i=e("#days").val()),this.model.setAnnouncement(n,i,t).done(function(){r.model.set("bulk_actions",null,{silent:!0})}).always(function(){r.dialog.close()})}return!1},validateForm:function(){var t=!0;if(this.$(".sub-announcement-type").is(":checked")){var n=e("#days").val();this.$("#last-for").is(":checked")&&(n<0||n==0||e.trim(n).length==0||isNaN(n))&&(this.$(".announcement-days-error").show(),t=!1)}return t}})}),define("hbs!modules/common/templates/messages/untag_post",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="<p>",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"actions.untag.title",u):a.call(t,"t","actions.untag.title",u)))+'</p>\n\n<div class="tag-list">\n    <div class="post-to-text"></div>\n</div>\n\n<div class="actions-wrap">\n    <a class="btn-link" href="javascript:void(0);">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"actions.untag.cancel",u):a.call(t,"t","actions.untag.cancel",u)))+'</a>\n    <input type="submit" value="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"actions.untag.submit",u):a.call(t,"t","actions.untag.submit",u)))+'" class="btn btn-submit">\n    <span class="arrow next"></span>\n</div>',s})}),define("modules/common/views/messages/untag_post",["jquery","underscore","tibbr","backbone","modules/dialog","modules/common/views/common/auto_suggest","hbs!modules/common/templates/messages/untag_post"],function(e,t,n,r,i,s,o){return n.View.extend({className:"untag-post-wrap",initialize:function(){t.bindAll(this,"render","getData","getSubjectIds"),this.bindTo(this.model,"change",this.render),this.autoSuggestData=[],this.untag_ids=[],this.actions=[]},events:{"click input:submit":"removeFromPost","click a.btn-link":"cancel"},render:function(){this.$el.html(this.renderTemplate(o)),this.$(".post-to-text").html(n.UI.loader);var e=this.options.html;return e.find(".action-links, .comment-box-wrap, .more_users, .vote-action, .replies").remove(),e.on("click","a",function(){return!1}),this.getData(),this},removeFromPost:function(){if(this.autoSuggest.getValueInArray().length==this.model.subjects.length)return i.alert({text:this.t("common.errors.remove_subjects")}),!1;var r=this.autoSuggest.getValue(),s=t.difference(this.getSubjectIds(),r.split(","));e("input:submit").attr("disabled",!0).after(n.UI.spinner),this.submit(s.join(","))},submit:function(e){this.model.removeSubjects(e).done(function(){n.pub("remove_recipients",{Recipients:e})})},getSubjectIds:function(){var e=[],t=this.model.subjects;return t.each(function(t){e.push(t.get("id").toString())}),e},renderAutoSuggest:function(){return this.autoSuggest=this.initChild(s,{attributes:{name:"remove_subjects"},preFill:this.autoSuggestData,showResultList:!1,startText:""}),this.$(".post-to-text").html(this.autoSuggest.render().el),this.autoSuggest.bind(),this.removeCloseIcon(this.untag_ids),this},getData:function(){var t=this.model.subjects,n=this,r=[];return t.each(function(e){if(e.get("stype")!=="system_resource"){var t=e.get("stype")==="system"&&e.get("owner_type")===""?"u":"s";n.autoSuggestData.push({caption:e._display_name,value:e.get("id"),image:e.image("small").replace(new RegExp("^"+window.prefix),"/"),t:t,s:e.get("scope")}),n.actions=e.get("actions").split(","),r.push(n.getActions(e))}}),e.when.apply(e,r).done(function(){n.renderAutoSuggest()})},removeCloseIcon:function(e){var n=this;t.delay(function(){t.each(e,function(e){n.removeClose(e)})},100)},cancel:function(){i.close()},removeClose:function(t){e("ul#as-selections-remove_subjects li[data-value="+t+"] a").remove()},getActions:function(r){var i=this,s=e.Deferred();return n.currentUser.batchActionOn([{target_class:r.get("json_class"),target_id:r.id,only:"remove_from_message",message:i.model.id}]).done(function(e){i.actions=e.actions_array[0].actions.split(",");if(t.include(i.actions,"remove_from_message")==0){var n=r.get("id");i.untag_ids.push(n),i.removeClose(n)}s.resolve()}),s.promise()}})}),function(e){typeof define=="function"&&define.amd?define("require/redactor",["jquery"],e):e(jQuery)}(function(e){var t,n;if(typeof i=="undefined")var i={};var s=((I18n.translations[I18n.locale]||{}).defaults||{}).redactor||{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment"};(function(o){e.fn.redactor=function(e){return this.each(function(){var t=o(this),n=t.data("redactor");n||t.data("redactor",n=new u(this,e))})};var u=function(e,t){this.$el=o(e),typeof t!="undefined"&&typeof t.lang!="undefined"&&t.lang!=="en"&&typeof i[t.lang]!="undefined"&&(s=i[t.lang]),this.opts=o.extend({iframe:!1,css:!1,lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,plugins:!1,cleanup:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,fixed:!1,fixedTop:0,fixedBox:!1,source:!0,shortcuts:!0,mobile:!0,air:!1,wym:!1,convertLinks:!1,convertDivs:!0,protocol:"http://",autosave:!1,autosaveCallback:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,fileUpload:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:!1,visual:!0,modal_file:String()+'<div id="redactor_modal_content">'+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">'+"<label>Name (optional)</label>"+'<input type="text" id="redactor_filename" class="redactor_input" />'+'<div style="margin-top: 7px;">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+"</form><br>"+"</div>",modal_image_edit:String()+'<div id="redactor_modal_content">'+"<label>"+s.title+"</label>"+'<input id="redactor_file_alt" class="redactor_input" />'+"<label>"+s.link+"</label>"+'<input id="redactor_file_link" class="redactor_input" />'+"<label>"+s.image_position+"</label>"+'<select id="redactor_form_image_align">'+'<option value="none">'+s.none+"</option>"+'<option value="left">'+s.left+"</option>"+'<option value="right">'+s.right+"</option>"+"</select>"+"</div>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+s._delete+"</a>&nbsp;&nbsp;&nbsp;"+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+s.cancel+"</a>"+'<input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+s.save+'" />'+"</div>",modal_image:String()+'<div id="redactor_modal_content">'+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">'+s.upload+"</a>"+'<a href="javascript:void(null);">'+s.choose+"</a>"+'<a href="javascript:void(null);">'+s.link+"</a>"+"</div>"+'<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">'+'<div id="redactor_tab1" class="redactor_tab">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+'<div id="redactor_tab2" class="redactor_tab" style="display: none;">'+'<div id="redactor_image_box"></div>'+"</div>"+"</form>"+'<div id="redactor_tab3" class="redactor_tab" style="display: none;">'+"<label>"+s.image_web_link+"</label>"+'<input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />'+"</div>"+"</div>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+s.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+s.insert+'" />'+"</div>",modal_link:String()+'<div id="redactor_modal_content">'+'<form id="redactorInsertLinkForm" method="post" action="">'+'<div id="redactor_tabs">'+'<a href="javascript:void(null);" class="redactor_tabs_act">URL</a>'+'<a href="javascript:void(null);">Email</a>'+'<a href="javascript:void(null);">'+s.anchor+"</a>"+"</div>"+'<input type="hidden" id="redactor_tab_selected" value="1" />'+'<div class="redactor_tab" id="redactor_tab1">'+'<label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  />'+"<label>"+s.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" />'+'<label><input type="checkbox" id="redactor_link_blank"> '+s.link_new_tab+"</label>"+"</div>"+'<div class="redactor_tab" id="redactor_tab2" style="display: none;">'+'<label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" />'+"<label>"+s.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab3" style="display: none;">'+"<label>"+s.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  />'+"<label>"+s.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />'+"</div>"+"</form>"+"</div>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+s.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+s.insert+'" />'+"</div>",modal_table:String()+'<div id="redactor_modal_content">'+"<label>"+s.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows" />'+"<label>"+s.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns" />'+"</div>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+s.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+s.insert+'" />'+"</div>",modal_video:String()+'<div id="redactor_modal_content">'+'<form id="redactorInsertVideoForm">'+"<label>"+s.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</div>"+'<div id="redactor_modal_footer">'+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+s.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+s.insert+'" />'+"</div>",toolbar:{html:{title:s.html,func:"toggle"},formatting:{title:s.formatting,func:"show",dropdown:{p:{title:s.paragraph,exec:"formatblock"},blockquote:{title:s.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:s.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:s.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:s.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:s.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:s.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:s.bold,exec:"bold"},italic:{title:s.italic,exec:"italic"},deleted:{title:s.deleted,exec:"strikethrough"},underline:{title:s.underline,exec:"underline"},unorderedlist:{title:"&bull; "+s.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+s.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+s.outdent,exec:"outdent"},indent:{title:"> "+s.indent,exec:"indent"},image:{title:s.image,func:"showImage"},video:{title:s.video,func:"showVideo"},file:{title:s.file,func:"showFile"},table:{title:s.table,func:"show",dropdown:{insert_table:{title:s.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:s.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:s.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:s.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:s.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:s.add_head,func:"addHead"},delete_head:{title:s.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:s.delete_column,func:"deleteColumn"},delete_row:{title:s.delete_row,func:"deleteRow"},delete_table:{title:s.delete_table,func:"deleteTable"}}},link:{title:s.link,func:"show",dropdown:{link:{title:s.link_insert,func:"showLink"},unlink:{title:s.unlink,exec:"unlink"}}},fontcolor:{title:s.fontcolor,func:"show"},backcolor:{title:s.backcolor,func:"show"},alignment:{title:s.alignment,func:"show",dropdown:{alignleft:{title:s.align_left,exec:"JustifyLeft"},aligncenter:{title:s.align_center,exec:"JustifyCenter"},alignright:{title:s.align_right,exec:"JustifyRight"},justify:{title:s.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:s.align_left},aligncenter:{exec:"JustifyCenter",title:s.align_center},alignright:{exec:"JustifyRight",title:s.align_right},justify:{exec:"JustifyFull",title:s.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:s.horizontalrule}}},t,this.$el.data()),this.dropdowns=[],this.init()};u.prototype={init:function(){function i(){this.enableAir(),this.buildToolbar(),typeof this.opts.plugins=="object"&&o.each(this.opts.plugins,o.proxy(function(e,t){typeof RedactorPlugins[t]!="undefined"&&(o.extend(this,RedactorPlugins[t]),typeof RedactorPlugins[t].init!="undefined"&&this.init())},this));if(this.opts.activeButtons!==!1&&this.opts.toolbar!==!1){var e=o.proxy(function(){this.observeFormatting()},this);this.$editor.click(e).keyup(e)}var t=!1;if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1){var n=this.browser("version").split(".");n[0]<536&&(t=!0)}this.isMobile(!0)===!1&&t===!1&&this.$editor.bind("paste",o.proxy(function(e){if(this.opts.cleanup===!1)return!0;this.pasteRunning=!0,this.setBuffer(),this.opts.autoresize===!0?this.saveScroll=this.document.body.scrollTop:this.saveScroll=this.$editor.scrollTop();var t=this.extractContent();setTimeout(o.proxy(function(){var e=this.extractContent();this.$editor.append(t),this.restoreSelection();var n=this.getFragmentHtml(e);n=n.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br>"),this.pasteCleanUp(n),this.pasteRunning=!1},this),1)},this)),this.keyup(),this.keydown(),this.opts.autosave!==!1&&this.autoSave(),setTimeout(o.proxy(function(){this.observeImages(),this.observeTables()},this),1);if(this.browser("mozilla")){this.$editor.click(o.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(r){}}this.opts.focus&&setTimeout(o.proxy(function(){this.$editor.focus()},this),1),this.opts.fixed&&(this.observeScroll(),o(document).scroll(o.proxy(this.observeScroll,this))),typeof this.opts.callback=="function"&&this.opts.callback(this),this.opts.toolbar!==!1&&this.$toolbar.find("a").attr("tabindex","-1")}this.height=this.$el.css("height"),this.width=this.$el.css("width"),n=this.document=document,t=this.window=window;if(this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;this.opts.iframe&&(this.opts.autoresize=!1);if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==!1){if(this.opts.source===!1){var e=this.opts.buttons.indexOf("html"),r=this.opts.buttons[e+1];this.opts.buttons.splice(e,1),typeof r!="undefined"&&r==="|"&&this.opts.buttons.splice(e,1)}o.extend(this.opts.toolbar,this.opts.buttonsCustom),o.each(this.opts.buttonsAdd,o.proxy(function(e,t){this.opts.buttons.push(t)},this))}this.opts.toolbar!==!1&&o.each(this.opts.toolbar.formatting.dropdown,o.proxy(function(e,t){o.inArray(e,this.opts.formattingTags)=="-1"&&delete this.opts.toolbar.formatting.dropdown[e]},this)),this.build(!1,i)},shortcuts:function(e,t){e.preventDefault(),this.execCommand(t,!1)},keyup:function(){this.$editor.keyup(o.proxy(function(e){var t=e.keyCode||e.which;this.browser("mozilla")&&!this.pasteRunning&&this.saveSelection(),typeof this.opts.keyupCallback=="function"&&this.opts.keyupCallback(this,e);if(t===8||t===46)return this.observeImages(),this.formatEmpty(e);if(t===13&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){if(this.browser("webkit"))try{this.formatNewLine(e)}catch(e){}this.opts.convertLinks&&this.$editor.linkify()}this.syncCode()},this))},keydown:function(){this.$editor.keydown(o.proxy(function(e){var t=e.keyCode||e.which,n=this.getParentNode(),r=this.getCurrentNode(),i=!1,s=e.ctrlKey||e.metaKey;(n||r)&&(o(n).get(0).tagName==="PRE"||o(r).get(0).tagName==="PRE")&&(i=!0),typeof this.opts.keydownCallback=="function"&&this.opts.keydownCallback(this,e),s&&this.opts.shortcuts&&(t===90?this.opts.buffer!==!1?(e.preventDefault(),this.getBuffer()):e.shiftKey&&!e.altKey?this.shortcuts(e,"redo"):!e.shiftKey&&!e.altKey&&this.shortcuts(e,"undo"):t===77&&!e.altKey?this.shortcuts(e,"removeFormat"):t===66&&!e.altKey?this.shortcuts(e,"bold"):t===73&&!e.altKey?this.shortcuts(e,"italic"):t===74&&!e.altKey?this.shortcuts(e,"insertunorderedlist"):t===75&&!e.altKey?this.shortcuts(e,"insertorderedlist"):t===76&&!e.altKey?this.shortcuts(e,"superscript"):t===72&&!e.altKey&&this.shortcuts(e,"subscript")),!s&&t!==90&&(this.opts.buffer=!1);if(i===!0&&t===13){e.preventDefault();var u=o(r).parent().text();return this.insertNodeAtCaret(this.document.createTextNode("\r\n")),u.search(/\s$/)==-1&&this.insertNodeAtCaret(this.document.createTextNode("\r\n")),this.syncCode(),!1}if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1)return this.safariShiftKeyEnter(e,t)},this))},build:function(e,r){if(e!==!0){this.$box=o('<div class="redactor_box"></div>'),this.opts.air&&(this.air=o('<div class="redactor_air" style="display: none;"></div>')),this.$content=null;function i(){this.$editor=this.$content.contents().find("body").attr("contenteditable",!0).attr("dir",this.opts.direction),n=this.document=this.$editor[0].ownerDocument,t=this.window=this.document.defaultView||window,this.opts.css!==!1&&this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />'),this.$editor.html(a),r&&(r.call(this),r=null)}this.textareamode=!0;if(this.$el.get(0).tagName==="TEXTAREA"){if(this.opts.iframe){var s=this;this.$content=o('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){i.call(s)})}else this.$content=this.$editor=o("<div></div>");var u=this.$el.get(0).className.split(/\s+/);o.each(u,o.proxy(function(e,t){this.$content.addClass("redactor_"+t)},this))}else this.textareamode=!1,this.$content=this.$editor=this.$el,this.$el=o('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height);this.$editor&&this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.tabindex!==!1&&this.$content.attr("tabindex",this.opts.tabindex),this.opts.minHeight!==!1&&this.$content.css("min-height",this.opts.minHeight+"px"),this.opts.wym===!0&&this.$content.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$content.css("height",this.height),this.$el.hide();var a="";this.textareamode?(a=this.$el.val(),a=this.savePreCode(a),this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)):(a=this.$editor.html(),a=this.savePreCode(a),this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)),a=this.paragraphy(a),this.$editor&&this.$editor.html(a),this.textareamode===!1&&this.syncCode()}else if(this.$el.get(0).tagName!=="TEXTAREA"){var a=this.$el.val(),f=o('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(a);this.$el.hide(),this.$el.after(f)}r&&this.$editor&&r.call(this)},enableAir:function(){if(this.opts.air===!1)return!1;this.air.hide(),this.$editor.bind("textselect",o.proxy(function(e){this.showAir(e)},this)),this.$editor.bind("textunselect",o.proxy(function(){this.air.hide()},this))},showAir:function(e){o(".redactor_air").hide();var t=this.air.innerWidth(),n=e.clientX;o(this.document).width()<n+t&&(n-=t);var r=e.clientY+o(document).scrollTop()+14;this.opts.iframe===!0&&(r+=this.$box.position().top,n+=this.$box.position().left),this.air.css({left:n+"px",top:r+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(e){e=this.stripTags(e),this.$editor.html(e).focus(),this.syncCode()},getCode:function(){var e="";return this.opts.visual?e=this.$editor.html():e=this.$el.val(),this.stripTags(e)},insertHtml:function(e){this.$editor.focus(),this.pasteHtmlAtCaret(e),this.observeImages(),this.syncCode()},pasteHtmlAtCaret:function(e){var t,n;if(this.document.getSelection){t=this.window.getSelection();if(t.getRangeAt&&t.rangeCount){n=t.getRangeAt(0),n.deleteContents();var r=this.document.createElement("div");r.innerHTML=e;var i=this.document.createDocumentFragment(),s,o;while(s=r.firstChild)o=i.appendChild(s);n.insertNode(i),o&&(n=n.cloneRange(),n.setStartAfter(o),n.collapse(!0),t.removeAllRanges(),t.addRange(n))}}else this.document.selection&&this.document.selection.type!="Control"&&this.document.selection.createRange().pasteHTML(e)},destroy:function(){var e=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(e).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(e).show()),this.opts.toolbarExternal&&o(this.opts.toolbarExternal).empty(),o(".redactor_air").remove();for(var t=0;t<this.dropdowns.length;t++)this.dropdowns[t].remove(),delete this.dropdowns[t];this.opts.autosave!==!1&&clearInterval(this.autosaveInterval)},observeFormatting:function(){var e=this.getCurrentNode();this.inactiveAllButtons(),o.each(this.opts.activeButtonsStates,o.proxy(function(t,n){o(e).closest(t,this.$editor.get()[0]).length!=0&&this.setBtnActive(n)},this));var t=o(e).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if(typeof t[0]!="undefined"&&typeof t[0].elem!="undefined"&&o(t[0].elem).size()!=0){var n=o(t[0].elem).css("text-align");switch(n){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}}},observeImages:function(){if(this.opts.observeImages===!1)return!1;this.$editor.find("img").each(o.proxy(function(e,t){this.browser("msie")&&o(t).attr("unselectable","on"),this.resizeImage(t)},this))},observeTables:function(){this.$editor.find("table").click(o.proxy(this.tableObserver,this))},observeScroll:function(){var e=o(this.document).scrollTop(),t=this.$box.offset().top,n=0;if(e>t){var r="100%";this.opts.fixedBox&&(n=this.$box.offset().left,r=this.$box.innerWidth()),this.fixed=!0,this.$toolbar.css({position:"fixed",width:r,zIndex:1005,top:this.opts.fixedTop+"px",left:n})}else this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:n})},setBuffer:function(){this.saveSelection(),this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===!1)return!1;this.$editor.html(this.opts.buffer),this.browser("msie")||this.restoreSelection(),this.opts.buffer=!1},execCommand:function(e,t){if(this.opts.visual==0)return this.$el.focus(),!1;try{var n;if(e==="inserthtml")this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(t)):this.pasteHtmlAtCaret(t),this.observeImages();else if(e==="unlink")n=this.getParentNode(),o(n).get(0).tagName==="A"?o(n).replaceWith(o(n).text()):this.execRun(e,t);else if(e==="JustifyLeft"||e==="JustifyCenter"||e==="JustifyRight"||e==="JustifyFull"){n=this.getCurrentNode();var r=o(n).get(0).tagName;if(this.opts.iframe===!1&&o(n).parents(".redactor_editor").size()==0)return!1;var i=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"];if(o.inArray(r,i)!=-1){var s=!1;e==="JustifyCenter"?s="center":e==="JustifyRight"?s="right":e==="JustifyFull"&&(s="justify"),s===!1?o(n).css("text-align",""):o(n).css("text-align",s)}else this.execRun(e,t)}else if(e==="formatblock"&&t==="blockquote"){n=this.getCurrentNode();if(o(n).get(0).tagName==="BLOCKQUOTE")if(this.browser("msie")){var u=o("<p>"+o(n).html()+" </p>");o(n).replaceWith(u)}else this.execRun(e,"p");else if(o(n).get(0).tagName==="P"){var a=o(n).parent();if(o(a).get(0).tagName==="BLOCKQUOTE"){var u=o("<p>"+o(n).html()+" </p>");o(a).replaceWith(u),this.setSelection(u[0],0,u[0],0)}else if(this.browser("msie")){var u=o("<blockquote>"+o(n).html()+"</blockquote>");o(n).replaceWith(u)}else this.execRun(e,t)}else this.execRun(e,t)}else e!=="formatblock"||t!=="pre"&&t!=="p"?(e==="inserthorizontalrule"&&this.browser("msie")&&this.$editor.focus(),e==="formatblock"&&this.browser("mozilla")&&this.$editor.focus(),this.execRun(e,t)):(n=this.getParentNode(),o(n).get(0).tagName==="PRE"?o(n).replaceWith("<p>"+this.encodeEntities(o(n).text())+" </p>"):this.execRun(e,t));e==="inserthorizontalrule"&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),typeof this.opts.execCommandCallback=="function"&&this.opts.execCommandCallback(this,e),this.opts.air&&this.air.hide()}catch(f){}},execRun:function(e,t){e==="formatblock"&&this.browser("msie")&&(t="<"+t+">"),this.document.execCommand(e,!1,t)},formatNewLine:function(e){var t=this.getParentNode();if(t.nodeName==="DIV"&&t.className==="redactor_editor"){var n=o(this.getCurrentNode());if(n.get(0).tagName==="DIV"&&(n.html()===""||n.html()==="<br>")){var r=o("<p>").append(n.clone().get(0).childNodes);n.replaceWith(r),r.html("<br />"),this.setSelection(r[0],0,r[0],0)}}},safariShiftKeyEnter:function(e,t){return e.shiftKey&&t===13?(e.preventDefault(),this.insertNodeAtCaret(o("<span><br /></span>").get(0)),this.syncCode(),!1):!0},formatEmpty:function(e){var t=o.trim(this.$editor.html());t=t.replace(/<br\s?\/?>/i,"");var n=t.replace(/<p>\s?<\/p>/gi,"");if(t===""||n===""){e.preventDefault();var r=o(this.opts.emptyHtml).get(0);return this.$editor.html(r),this.setSelection(r,0,r,0),this.syncCode(),!1}this.syncCode()},paragraphy:function(e){e=o.trim(e);if(e===""||e==="<p> </p>")return this.opts.emptyHtml;this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2 </p>"));var t=function(e,t,n){return e.replace(new RegExp(t,"g"),n)},n=function(n,r){return t(e,n,r)},r="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return e+="\n",n("<br />\\s*<br />","\n\n"),n("(<"+r+"[^>]*>)","\n$1"),n("(</"+r+">)","$1\n\n"),n("\r\n|\r","\n"),n("\n\n+","\n\n"),n("\n?((.|\n)+?)$","<p>$1 </p>\n"),n("<p>\\s*? </p>",""),n("<p>(<div[^>]*>\\s*)","$1<p>"),n("<p>\\s*(</?"+r+"[^>]*>)\\s* </p>","$1"),n("<p>(<li.+?) </p>","$1"),n("<p>\\s*(</?"+r+"[^>]*>)","$1"),n("(</?"+r+"[^>]*>)\\s* </p>","$1"),n("(</?"+r+"[^>]*>)\\s*<br />","$1"),n("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),e.indexOf("<pre")!=-1&&n("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,n,r,i){return t(n,"\\\\(['\"\\\\])","$1")+t(t(t(i,"<p>","\n")," </p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),n("\n </p>$"," </p>")},stripTags:function(e){var t=this.opts.allowedTags,n=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(n,function(e,n){return o.inArray(n.toLowerCase(),t)>"-1"?e:""})},savePreCode:function(e){var t=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return t!==null&&o.each(t,o.proxy(function(t,n){var r=n.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);r[2]=this.encodeEntities(r[2]),e=e.replace(n,"<pre"+r[1]+">"+r[2]+"</pre>")},this)),e},encodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(e){e=e.replace(/<br>/gi,"\n"),e=e.replace(/<\/p>/gi,"\n"),e=e.replace(/<\/div>/gi,"\n");var t=this.document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText},pasteCleanUp:function(e){var t=this.getParentNode();if(o(t).get(0).tagName==="PRE")return e=this.cleanupPre(e),this.pasteCleanUpInsert(e),!0;e=e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),e=e.replace(/(&nbsp;){2,}/gi,"&nbsp;"),e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=this.stripTags(e),e=e.replace(/<td><\/td>/gi,"[td]"),e=e.replace(/<td>&nbsp;<\/td>/gi,"[td]"),e=e.replace(/<td><br><\/td>/gi,"[td]"),e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),e=e.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),e=e.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),e=e.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),e=e.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),e=e.replace(/<param(.*?)>/gi,"[param$1]"),e=e.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),e=e.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/\[td\]/gi,"<td>&nbsp;</td>"),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),e=e.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),e=e.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),e=e.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),e=e.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),e=e.replace(/\[param(.*?)\]/gi,"<param$1>"),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2 </p>")),e=e.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi," </p>"),this.browser("mozilla")&&(e=e.replace(/<br>$/gi,"")),this.pasteCleanUpInsert(e)},pasteCleanUpInsert:function(e){this.execCommand("inserthtml",e),this.opts.autoresize===!0?o(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(e){var t=[],n=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return n!==null&&o.each(n,function(n,r){e=e.replace(r,"prebuffer_"+n),t.push(r)}),e=e.replace(/\s{2,}/g," "),e=e.replace(/\n/g," "),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g,""),e=e.replace(/[\s\n]*$/g,""),e=e.replace(/>\s+</g,"><"),t&&(o.each(t,function(t,n){e=e.replace("prebuffer_"+t,n)}),t=[]),e},formattingIndenting:function(e){return e=e.replace(/<li/g,"	<li"),e=e.replace(/<tr/g,"	<tr"),e=e.replace(/<td/g,"		<td"),e=e.replace(/<\/tr>/g,"	</tr>"),e},formattingEmptyTags:function(e){var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s* </p>","<p>&nbsp; </p>","<p>\\s*<br>\\s* </p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var n=0;n<t.length;++n){var r=t[n];e=e.replace(new RegExp(r,"gi"),"")}return e},formattingAddBefore:function(e){var t="\r\n",n=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var r=0;r<n.length;++r){var i=n[r];e=e.replace(new RegExp(i,"gi"),t+i)}return e},formattingAddAfter:function(e){var t="\r\n",n=[" </p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var r=0;r<n.length;++r){var i=n[r];e=e.replace(new RegExp(i,"gi"),i+t)}return e},formatting:function(e){return e=this.formattingRemove(e),e=this.formattingEmptyTags(e),e=this.formattingAddBefore(e),e=this.formattingAddAfter(e),e=this.formattingIndenting(e),e},toggle:function(){var e;if(this.opts.visual){var t=this.$editor.innerHeight();this.$editor.hide(),this.$content.hide(),e=this.$editor.html(),this.$el.height(t).val(e).show().focus(),this.setBtnActive("html"),this.opts.visual=!1}else{this.$el.hide();var e=this.$el.val();this.$editor.html(e).show(),this.$content.show(),this.$editor.html()===""&&this.setCode(this.opts.emptyHtml),this.$editor.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(o.proxy(function(){o.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:o.proxy(function(e){typeof this.opts.autosaveCallback=="function"&&this.opts.autosaveCallback(e,this)},this)})},this),this.opts.interval*1e3)},buildToolbar:function(){if(this.opts.toolbar===!1)return!1;this.$toolbar=o("<ul>").addClass("redactor_toolbar"),this.opts.air?(o(this.air).append(this.$toolbar),o("body").append(this.air)):this.opts.toolbarExternal===!1?this.$box.prepend(this.$toolbar):o(this.opts.toolbarExternal).html(this.$toolbar),o.each(this.opts.buttons,o.proxy(function(e,t){if(t!=="|"&&typeof this.opts.toolbar[t]!="undefined"){var n=this.opts.toolbar[t];if(this.opts.fileUpload===!1&&t==="file")return!0;this.$toolbar.append(o("<li>").append(this.buildButton(t,n)))}t==="|"&&this.$toolbar.append(o('<li class="redactor_separator"></li>'))},this))},buildButton:function(e,t){var n=o('<a href="javascript:void(null);" title="'+t.title+'" class="redactor_btn_'+e+'"></a>');typeof t.func=="undefined"?n.click(o.proxy(function(n){n.preventDefault&&n.preventDefault(),this.browser("msie")&&(n.returnValue=!1),o.inArray(e,this.opts.activeButtons)!=-1&&(this.inactiveAllButtons(),this.setBtnActive(e)),this.browser("mozilla")&&this.$editor.focus(),this.execCommand(t.exec,e)},this)):t.func!=="show"&&n.click(o.proxy(function(e){this[t.func](e)},this)),typeof t.callback!="undefined"&&t.callback!==!1&&n.click(o.proxy(function(n){t.callback(this,n,e)},this));if(e==="backcolor"||e==="fontcolor"||typeof t.dropdown!="undefined"){var r=o('<div class="redactor_dropdown" style="display: none;">');e==="backcolor"||e==="fontcolor"?r=this.buildColorPicker(r,e):r=this.buildDropdown(r,t.dropdown),this.dropdowns.push(r.appendTo(o(document.body))),this.hdlShowDropDown=o.proxy(function(t){this.showDropDown(t,r,e)},this),n.click(this.hdlShowDropDown)}return n},buildDropdown:function(e,t){return o.each(t,o.proxy(function(t,n){typeof n.className=="undefined"&&(n.className="");var r;typeof n.name!="undefined"&&n.name==="separator"?r=o('<a class="redactor_separator_drop">'):(r=o('<a href="javascript:void(null);" class="'+n.className+'">'+n.title+"</a>"),typeof n.callback=="function"?o(r).click(o.proxy(function(e){n.callback(this,e,t)},this)):typeof n.func=="undefined"?o(r).click(o.proxy(function(){this.execCommand(n.exec,t)},this)):o(r).click(o.proxy(function(e){this[n.func](e)},this))),o(e).append(r)},this)),e},buildColorPicker:function(e,t){var n;t==="backcolor"?this.browser("msie")?n="BackColor":n="hilitecolor":n="forecolor",o(e).width(210);var r=this.opts.colors.length;for(var i=0;i<r;++i){var u=this.opts.colors[i],a=o('<a rel="'+u+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:u});o(e).append(a);var f=this;o(a).click(function(){f.execCommand(n,o(this).attr("rel")),n==="forecolor"&&f.$editor.find("font").replaceWith(function(){return o('<span style="color: '+o(this).attr("color")+';">'+o(this).html()+"</span>")}),f.browser("msie")&&n==="BackColor"&&f.$editor.find("font").replaceWith(function(){return o('<span style="'+o(this).attr("style")+'">'+o(this).html()+"</span>")})})}var l=o('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(s.none);return t==="backcolor"?l.click(o.proxy(this.setBackgroundNone,this)):l.click(o.proxy(this.setColorNone,this)),o(e).append(l),e},setBackgroundNone:function(){o(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){o(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(e,t,n){if(this.getBtn(n).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(n),this.getBtn(n).addClass("dropact");var r=this.getBtn(n).offset().left;if(this.opts.air){var i=this.air.offset().top;o(t).css({position:"absolute",left:r+"px",top:i+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)o(t).css({position:"fixed",left:r+"px",top:"30px"}).show();else{var s=this.$toolbar.offset().top+30;o(t).css({position:"absolute",left:r+"px",top:s+"px"}).show()}}var u=o.proxy(function(e){this.hideDropDown(e,t,n)},this);o(document).one("click",u),this.$editor.one("click",u),this.$content.one("click",u),e.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),o(".redactor_dropdown").hide()},hideDropDown:function(e,t,n){o(e.target).hasClass("dropact")||(o(t).removeClass("dropact"),this.showedDropDown=!1,this.hideAllDropDown())},getBtn:function(e){return this.opts.toolbar===!1?!1:o(this.$toolbar.find("a.redactor_btn_"+e))},setBtnActive:function(e){this.getBtn(e).addClass("redactor_act")},setBtnInactive:function(e){this.getBtn(e).removeClass("redactor_act")},inactiveAllButtons:function(){o.each(this.opts.activeButtons,o.proxy(function(e,t){this.setBtnInactive(t)},this))},changeBtnIcon:function(e,t){this.getBtn(e).addClass("redactor_btn_"+t)},removeBtnIcon:function(e,t){this.getBtn(e).removeClass("redactor_btn_"+t)},addBtnSeparator:function(){this.$toolbar.append(o('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(e){var t=this.getBtn(e);t.parent().after(o('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(e){var t=this.getBtn(e);t.parent().before(o('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(e){var t=this.getBtn(e);t.parent().next().remove()},removeBtnSeparatorBefore:function(e){var t=this.getBtn(e);t.parent().prev().remove()},setBtnRight:function(e){if(this.opts.toolbar===!1)return!1;this.getBtn(e).parent().addClass("redactor_btn_right")},setBtnLeft:function(e){if(this.opts.toolbar===!1)return!1;this.getBtn(e).parent().removeClass("redactor_btn_right")},addBtn:function(e,t,n,r){if(this.opts.toolbar===!1)return!1;var i=this.buildButton(e,{title:t,callback:n,dropdown:r});this.$toolbar.append(o("<li>").append(i))},addBtnFirst:function(e,t,n,r){if(this.opts.toolbar===!1)return!1;var i=this.buildButton(e,{title:t,callback:n,dropdown:r});this.$toolbar.prepend(o("<li>").append(i))},addBtnAfter:function(e,t,n,r,i){if(this.opts.toolbar===!1)return!1;var s=this.buildButton(t,{title:n,callback:r,dropdown:i}),u=this.getBtn(e);u.parent().after(o("<li>").append(s))},addBtnBefore:function(e,t,n,r,i){if(this.opts.toolbar===!1)return!1;var s=this.buildButton(t,{title:n,callback:r,dropdown:i}),u=this.getBtn(e);u.parent().before(o("<li>").append(s))},removeBtn:function(e,t){var n=this.getBtn(e);t===!0&&n.parent().next().remove(),n.parent().removeClass("redactor_btn_right"),n.remove()},getFragmentHtml:function(e){var t=e.cloneNode(!0),n=this.document.createElement("div");return n.appendChild(t),n.innerHTML},extractContent:function(){var e=this.$editor.get(0),t=this.document.createDocumentFragment(),n;while(n=e.firstChild)t.appendChild(n);return t},saveSelection:function(){this.$editor.focus(),this.savedSel=this.getOrigin(),this.savedSelObj=this.getFocus()},restoreSelection:function(){typeof this.savedSel!="undefined"&&this.savedSel!==null&&this.savedSelObj!==null&&this.savedSel[0].tagName!=="BODY"?this.opts.iframe===!1&&o(this.savedSel[0]).closest(".redactor_editor").size()==0?this.$editor.focus():(this.browser("opera")&&this.$editor.focus(),this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]),this.browser("mozilla")&&this.$editor.focus()):this.$editor.focus()},getSelection:function(){var e=this.document;return this.window.getSelection?this.window.getSelection():e.getSelection?e.getSelection():e.selection.createRange()},hasSelection:function(){if(!this.oldIE()){var e;return(e=this.getSelection())&&e.focusNode!=null&&e.anchorNode!=null}var t=this.$editor.get(0),n;return t.focus(),t.document.selection?(n=t.document.selection.createRange(),n&&n.parentElement().document===t.document):!1},getOrigin:function(){if(!this.oldIE()){var e;return!(e=this.getSelection())||e.anchorNode==null?null:[e.anchorNode,e.anchorOffset]}var t=this.$editor.get(0),n;t.focus();if(!this.hasSelection())return null;n=t.document.selection.createRange();try{return this._getBoundary(t.document,n,!0)}catch(r){}},getFocus:function(){if(!this.oldIE()){var e;return!(e=this.getSelection())||e.focusNode==null?null:[e.focusNode,e.focusOffset]}var t=this.$editor.get(0),n;t.focus();if(!this.hasSelection())return null;n=t.document.selection.createRange();try{return this._getBoundary(t.document,n,!0)}catch(r){}},setSelection:function(e,t,n,i){n==null&&(n=e),i==null&&(i=t);if(!!this.oldIE()){var u=this.$editor.get(0),a=u.document.body.createTextRange();return this._moveBoundary(u.document,a,!1,n,i),this._moveBoundary(u.document,a,!0,e,t),a.select()}var s=this.getSelection();if(!s)return;if(s.collapse&&s.extend)s.collapse(e,t),s.extend(n,i);else{r=this.document.createRange(),r.setStart(e,t),r.setEnd(n,i);try{s.removeAllRanges()}catch(o){}s.addRange(r)}},getCurrentNode:function(){if(typeof this.window.getSelection!="undefined")return this.getSelectedNode().parentNode;if(typeof this.document.selection!="undefined")return this.getSelection().parentElement()},getParentNode:function(){return o(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){if(this.oldIE())return this.getSelection().parentElement();if(typeof this.window.getSelection!="undefined"){var e=window.getSelection();return e.rangeCount>0?this.getSelection().getRangeAt(0).commonAncestorContainer:!1}if(typeof this.document.selection!="undefined")return this.getSelection()},_getBoundary:function(e,t,n){var r,i,s,o,u;i=e.createElement("a"),r=t.duplicate(),r.collapse(n),u=r.parentElement();for(;;){u.insertBefore(i,i.previousSibling),r.moveToElementText(i);if(!(r.compareEndPoints(n?"StartToStart":"StartToEnd",t)>0&&i.previousSibling!=null))break}return r.compareEndPoints(n?"StartToStart":"StartToEnd",t)===-1&&i.nextSibling?(r.setEndPoint(n?"EndToStart":"EndToEnd",t),s=i.nextSibling,o=r.text.length):(s=i.parentNode,o=this._getChildIndex(i)),i.parentNode.removeChild(i),[s,o]},_moveBoundary:function(e,t,n,r,i){var s,o,u,a,f;return f=0,s=this._isText(r)?r:r.childNodes[i],o=this._isText(r)?r.parentNode:r,this._isText(r)&&(f=i),a=e.createElement("a"),o.insertBefore(a,s||null),u=e.body.createTextRange(),u.moveToElementText(a),a.parentNode.removeChild(a),t.setEndPoint(n?"StartToStart":"EndToEnd",u),t[n?"moveStart":"moveEnd"]("character",f)},_isText:function(e){return e!=null?e.nodeType==3:!1},_getChildIndex:function(e){var t=0;while(e=e.previousSibling)t++;return t},insertNodeAfterCaret:function(e){this.saveSelection(),this.insertNodeAtCaret(e),this.restoreSelection()},insertNodeAtCaret:function(e){if(this.window.getSelection){var t=this.getSelection();if(t.rangeCount){var n=t.getRangeAt(0);n.collapse(!1),n.insertNode(e),n=n.cloneRange(),n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n)}}else if(this.document.selection){var r=e.nodeType===1?e.outerHTML:e.data,i="marker_"+(""+Math.random()).slice(2);r+='<span id="'+i+'"></span>';var s=this.getSelection();s.collapse(!1),s.pasteHTML(r);var o=this.document.getElementById(i);s.moveToElementText(o),s.select(),o.parentNode.removeChild(o)}},getSelectedHtml:function(){var e="";if(this.window.getSelection){var t=this.window.getSelection();if(t.rangeCount){var n=this.document.createElement("div");for(var r=0,i=t.rangeCount;r<i;++r)n.appendChild(t.getRangeAt(r).cloneContents());e=n.innerHTML}}else this.document.selection&&this.document.selection.type==="Text"&&(e=this.document.selection.createRange().htmlText);return e},resizeImage:function(e){var t=!1,n=!1,r,i,s=o(e).width()/o(e).height(),u=10,a=10;o(e).off("hover mousedown mouseup click mousemove"),o(e).hover(function(){o(e).css("cursor","nw-resize")},function(){o(e).css("cursor",""),t=!1}),o(e).mousedown(function(u){u.preventDefault(),s=o(e).width()/o(e).height(),t=!0,n=!0,r=Math.round(u.pageX-o(e).eq(0).offset().left),i=Math.round(u.pageY-o(e).eq(0).offset().top)}),o(e).mouseup(o.proxy(function(n){t=!1,o(e).css("cursor",""),this.syncCode()},this)),o(e).click(o.proxy(function(e){n&&this.imageEdit(e)},this)),o(e).mousemove(function(f){if(t){n=!1;var l=Math.round(f.pageX-o(this).eq(0).offset().left)-r,c=Math.round(f.pageY-o(this).eq(0).offset().top)-i,h=o(e).height(),p=parseInt(h,10)+c,d=p*s;d>u&&o(e).width(d),p>a&&o(e).height(p),r=Math.round(f.pageX-o(this).eq(0).offset().left),i=Math.round(f.pageY-o(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection(),this.modalInit(s.table,this.opts.modal_table,300,o.proxy(function(){o("#redactor_insert_table_btn").click(o.proxy(this.insertTable,this)),setTimeout(function(){o("#redactor_table_rows").focus()},200)},this))},insertTable:function(){var e=o("#redactor_table_rows").val(),t=o("#redactor_table_columns").val(),n=o("<div></div>"),r=Math.floor(Math.random()*99999),i=o('<table id="table'+r+'"><tbody></tbody></table>');for(var s=0;s<e;s++){var u=o("<tr></tr>");for(var a=0;a<t;a++){var f=o("<td><br></td>");o(u).append(f)}o(i).append(u)}o(n).append(i);var l=o(n).html()+"<p> </p>";this.restoreSelection(),this.execCommand("inserthtml",l),this.modalClose(),this.observeTables()},tableObserver:function(e){this.$table=o(e.target).closest("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$tbody=o(e.target).closest("tbody"),this.$thead=o(this.$table).find("thead"),this.$current_td=o(e.target),this.$current_tr=o(e.target).closest("tr")},deleteTable:function(){o(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){o(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var e=o(this.$current_td).get(0).cellIndex;o(this.$table).find("tr").each(function(){o(this).find("td").eq(e).remove()}),this.syncCode()},addHead:function(){if(o(this.$table).find("thead").size()!==0)this.deleteHead();else{var e=o(this.$table).find("tr").first().clone();e.find("td").html("&nbsp;"),this.$thead=o("<thead></thead>"),this.$thead.append(e),o(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){o(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(e){var t=o(this.$current_tr).clone();t.find("td").html("&nbsp;"),e==="after"?o(this.$current_tr).after(t):o(this.$current_tr).before(t),this.syncCode()},insertColumn:function(e){var t=0;this.$current_tr.find("td").each(o.proxy(function(e,n){o(n)[0]===this.$current_td[0]&&(t=e)},this)),this.$table_tr.each(function(n,r){var i=o(r).find("td").eq(t),s=i.clone();s.html("&nbsp;"),e==="after"?o(i).after(s):o(i).before(s)}),this.syncCode()},showVideo:function(){this.saveSelection(),this.modalInit(s.video,this.opts.modal_video,600,o.proxy(function(){o("#redactor_insert_video_btn").click(o.proxy(this.insertVideo,this)),setTimeout(function(){o("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var e=o("#redactor_insert_video_area").val();e=this.stripTags(e),this.restoreSelection(),this.execCommand("inserthtml",e),this.modalClose()},imageEdit:function(e){var t=o(e.target),n=t.parent(),r=o.proxy(function(){o("#redactor_file_alt").val(t.attr("alt")),o("#redactor_image_edit_src").attr("href",t.attr("src")),o("#redactor_form_image_align").val(t.css("float")),o(n).get(0).tagName==="A"&&o("#redactor_file_link").val(o(n).attr("href")),o("#redactor_image_delete_btn").click(o.proxy(function(){this.imageDelete(t)},this)),o("#redactorSaveBtn").click(o.proxy(function(){this.imageSave(t)},this))},this);this.modalInit(s.image,this.opts.modal_image_edit,380,r)},imageDelete:function(e){o(e).remove(),this.modalClose(),this.syncCode()},imageSave:function(e){var t=o(e).parent();o(e).attr("alt",o("#redactor_file_alt").val());var n=o("#redactor_form_image_align").val();n==="left"?o(e).css({"float":"left",margin:"0 10px 10px 0"}):n==="right"?o(e).css({"float":"right",margin:"0 0 10px 10px"}):o(e).css({"float":"none",margin:"0"});var r=o.trim(o("#redactor_file_link").val());r!==""?o(t).get(0).tagName!=="A"?o(e).replaceWith('<a href="'+r+'">'+this.outerHTML(e)+"</a>"):o(t).attr("href",r):o(t).get(0).tagName==="A"&&o(t).replaceWith(this.outerHTML(e)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var e=o.proxy(function(){this.opts.imageGetJson!==!1?o.getJSON(this.opts.imageGetJson,o.proxy(function(e){var t={},n=0;o.each(e,o.proxy(function(e,r){typeof r.folder!="undefined"&&(n++,t[r.folder]=n)},this));var r=!1;o.each(e,o.proxy(function(e,n){var i="";typeof n.title!="undefined"&&(i=n.title);var s=0;!o.isEmptyObject(t)&&typeof n.folder!="undefined"&&(s=t[n.folder],r===!1&&(r=".redactorfolder"+s));var u=o('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+s+'" rel="'+n.image+'" title="'+i+'" />');o("#redactor_image_box").append(u),o(u).click(o.proxy(this.imageSetThumb,this))},this));if(!o.isEmptyObject(t)){o(".redactorfolder").hide(),o(r).show();var i=function(e){o(".redactorfolder").hide(),o(".redactorfolder"+o(e.target).val()).show()},s=o('<select id="redactor_image_box_select">');o.each(t,function(e,t){s.append(o('<option value="'+t+'">'+e+"</option>"))}),o("#redactor_image_box").before(s),s.change(i)}},this)):o("#redactor_tabs a").eq(1).remove();if(this.opts.imageUpload!==!1)this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&o("#redactor_file").size()!==0&&o("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:o.proxy(this.imageUploadCallback,this),error:o.proxy(this.opts.imageUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:o.proxy(this.imageUploadCallback,this),error:o.proxy(this.opts.imageUploadErrorCallback,this)});else{o(".redactor_tab").hide();if(this.opts.imageGetJson===!1)o("#redactor_tabs").remove(),o("#redactor_tab3").show();else{var e=o("#redactor_tabs a");e.eq(0).remove(),e.eq(1).addClass("redactor_tabs_act"),o("#redactor_tab2").show()}}o("#redactor_upload_btn").click(o.proxy(this.imageUploadCallbackLink,this)),this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&setTimeout(function(){o("#redactor_file_link").focus()},200)},this);this.modalInit(s.image,this.opts.modal_image,610,e)},imageSetThumb:function(e){this._imageSet('<img src="'+o(e.target).attr("rel")+'" alt="'+o(e.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(o("#redactor_file_link").val()!==""){var e='<img src="'+o("#redactor_file_link").val()+'" />';this._imageSet(e,!0)}else this.modalClose()},imageUploadCallback:function(e){this._imageSet(e)},_imageSet:function(e,t){this.restoreSelection();if(e!==!1){var n="";t!==!0?n='<p><img src="'+e.filelink+'" /> </p>':n=e,this.execCommand("inserthtml",n),t!==!0&&typeof this.opts.imageUploadCallback=="function"&&this.opts.imageUploadCallback(this,e)}this.modalClose(),this.observeImages()},showLink:function(){this.saveSelection();var e=o.proxy(function(){this.insert_link_node=!1;var e=this.getSelection(),t="",n="",r="";if(this.browser("msie")){var i=this.getParentNode();i.nodeName==="A"?(this.insert_link_node=o(i),n=this.insert_link_node.text(),t=this.insert_link_node.attr("href"),r=this.insert_link_node.attr("target")):this.oldIE()?n=e.text:n=e.toString()}else e&&e.anchorNode&&e.anchorNode.parentNode.tagName==="A"?(t=e.anchorNode.parentNode.href,n=e.anchorNode.parentNode.text,r=e.anchorNode.parentNode.target,e.toString()===""&&(this.insert_link_node=e.anchorNode.parentNode)):n=e.toString();o(".redactor_link_text").val(n);var s=self.location.href.replace(/\/$/i,""),u=t.replace(s,"");t.search("mailto:")===0?(this.setModalTab(2),o("#redactor_tab_selected").val(2),o("#redactor_link_mailto").val(t.replace("mailto:",""))):u.search(/^#/gi)===0?(this.setModalTab(3),o("#redactor_tab_selected").val(3),o("#redactor_link_anchor").val(u.replace(/^#/gi,""))):o("#redactor_link_url").val(u),r==="_blank"&&o("#redactor_link_blank").attr("checked",!0),o("#redactor_insert_link_btn").click(o.proxy(this.insertLink,this)),setTimeout(function(){o("#redactor_link_url").focus()},200)},this);this.modalInit(s.link,this.opts.modal_link,460,e)},insertLink:function(){var e=o("#redactor_tab_selected").val(),t="",n="",r="",i="";if(e==="1"){t=o("#redactor_link_url").val(),n=o("#redactor_link_url_text").val(),o("#redactor_link_blank").prop("checked")&&(r=' target="_blank"',i="_blank");var s="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/",u=new RegExp("^(http|ftp|https)://"+s,"i"),a=new RegExp("^"+s,"i");t.search(u)==-1&&t.search(a)==0&&this.opts.protocol!==!1&&(t=this.opts.protocol+t)}else e==="2"?(t="mailto:"+o("#redactor_link_mailto").val(),n=o("#redactor_link_mailto_text").val()):e==="3"&&(t="#"+o("#redactor_link_anchor").val(),n=o("#redactor_link_anchor_text").val());this._insertLink('<a href="'+t+'"'+r+">"+n+"</a>",o.trim(n),t,i)},_insertLink:function(e,t,n,r){this.$editor.focus(),this.restoreSelection(),t!==""&&(this.insert_link_node?(o(this.insert_link_node).text(t),o(this.insert_link_node).attr("href",n),r!==""?o(this.insert_link_node).attr("target",r):o(this.insert_link_node).removeAttr("target"),this.syncCode()):this.execCommand("inserthtml",e)),this.modalClose()},showFile:function(){this.saveSelection();var e=o.proxy(function(){var e=this.getSelection(),t="";this.oldIE()?t=e.text:t=e.toString(),o("#redactor_filename").val(t),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&o("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:o.proxy(this.fileUploadCallback,this),error:o.proxy(this.opts.fileUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:o.proxy(this.fileUploadCallback,this),error:o.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(s.file,this.opts.modal_file,500,e)},fileUploadCallback:function(e){this.restoreSelection();if(e!==!1){var t=o("#redactor_filename").val();t===""&&(t=e.filename);var n='<a href="'+e.filelink+'">'+t+"</a>";this.browser("webkit")&&!!this.window.chrome&&(n+="&nbsp;"),this.execCommand("inserthtml",n),typeof this.opts.fileUploadCallback=="function"&&this.opts.fileUploadCallback(this,e)}this.modalClose()},modalInit:function(e,t,n,r){o("#redactor_modal_overlay").size()===0&&(this.overlay=o('<div id="redactor_modal_overlay" style="display: none;"></div>'),o("body").prepend(this.overlay)),this.opts.overlay&&(o("#redactor_modal_overlay").show(),o("#redactor_modal_overlay").click(o.proxy(this.modalClose,this))),o("#redactor_modal").size()===0&&(this.modal=o('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),o("body").append(this.modal)),o("#redactor_modal_close").click(o.proxy(this.modalClose,this)),this.hdlModalClose=o.proxy(function(e){if(e.keyCode===27)return this.modalClose(),!1},this),o(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),t.indexOf("#")==0?o("#redactor_modal_inner").empty().append(o(t).html()):o("#redactor_modal_inner").empty().append(t),o("#redactor_modal_header").html(e),typeof o.fn.draggable!="undefined"&&(o("#redactor_modal").draggable({handle:"#redactor_modal_header"}),o("#redactor_modal_header").css("cursor","move"));if(o("#redactor_tabs").size()!==0){var i=this;o("#redactor_tabs a").each(function(e,t){e++,o(t).click(function(){o("#redactor_tabs a").removeClass("redactor_tabs_act"),o(this).addClass("redactor_tabs_act"),o(".redactor_tab").hide(),o("#redactor_tab"+e).show(),o("#redactor_tab_selected").val(e);if(i.isMobile()===!1){var t=o("#redactor_modal").outerHeight();o("#redactor_modal").css("margin-top","-"+(t+10)/2+"px")}})})}o("#redactor_modal .redactor_btn_modal_close").click(o.proxy(this.modalClose,this)),this.isMobile()===!1?(o("#redactor_modal").css({position:"fixed",top:"-2000px",left:"50%",width:n+"px",marginLeft:"-"+(n+60)/2+"px"}).show(),this.modalSaveBodyOveflow=o(document.body).css("overflow"),o(document.body).css("overflow","hidden")):o("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),typeof r=="function"&&r(),this.isMobile()===!1&&setTimeout(function(){var e=o("#redactor_modal").outerHeight();o("#redactor_modal").css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)},modalClose:function(){return o("#redactor_modal_close").unbind("click",this.modalClose),o("#redactor_modal").fadeOut("fast",o.proxy(function(){o("#redactor_modal_inner").html(""),this.opts.overlay&&(o("#redactor_modal_overlay").hide(),o("#redactor_modal_overlay").unbind("click",this.modalClose)),o(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&o(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},setModalTab:function(e){o(".redactor_tab").hide();var t=o("#redactor_tabs a");t.removeClass("redactor_tabs_act"),t.eq(e-1).addClass("redactor_tabs_act"),o("#redactor_tab"+e).show()},uploadInit:function(e,t){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},o.extend(this.uploadOptions,t),o("#"+e).size()!==0&&o("#"+e).get(0).tagName==="INPUT"?(this.uploadOptions.input=o("#"+e),this.element=o(o("#"+e).get(0).form)):this.element=o("#"+e),this.element_action=this.element.attr("action"),this.uploadOptions.auto?o(this.uploadOptions.input).change(o.proxy(function(){this.element.submit(function(e){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&o("#"+this.uploadOptions.trigger).click(o.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var e=this.document.createElement("div"),t='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return e.innerHTML=t,o(e).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),o("#"+this.id).load(o.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(e,t){if(this.uploadOptions.input){var n="redactorUploadForm"+this.id,r="redactorUploadFile"+this.id;this.form=o('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+t+'" name="'+n+'" id="'+n+'" enctype="multipart/form-data"></form>'),this.opts.uploadFields!==!1&&typeof this.opts.uploadFields=="object"&&o.each(this.opts.uploadFields,o.proxy(function(e,t){t.toString().indexOf("#")===0&&(t=o(t).val());var n=o("<input/>",{type:"hidden",name:e,value:t});o(this.form).append(n)},this));var i=this.uploadOptions.input,s=o(i).clone();o(i).attr("id",r),o(i).before(s),o(i).appendTo(this.form),o(this.form).css("position","absolute"),o(this.form).css("top","-2000px"),o(this.form).css("left","-2000px"),o(this.form).appendTo("body"),this.form.submit()}else e.attr("target",t),e.attr("method","POST"),e.attr("enctype","multipart/form-data"),e.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var e=o("#"+this.id)[0],t;e.contentDocument?t=e.contentDocument:e.contentWindow?t=e.contentWindow.document:t=window.frames[this.id].document;if(this.uploadOptions.success)if(typeof t!="undefined"){var n=t.body.innerHTML,r=n.match(/\{(.|\n)*\}/)[0],i=o.parseJSON(r);typeof i.error=="undefined"?this.uploadOptions.success(i):(this.uploadOptions.error(this,i),this.modalClose())}else alert("Upload failed!"),this.modalClose();this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(e){var t=navigator.userAgent.toLowerCase(),n=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return e=="version"?n[2]:e=="webkit"?n[1]=="chrome"||n[1]=="webkit":n[1]==e},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},outerHTML:function(e){return o("<p>").append(o(e).eq(0).clone()).html()},normalize:function(e){return parseInt(e.replace("px",""),10)},isMobile:function(e){return e===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1}},o.fn.getObject=function(){return this.data("redactor")},o.fn.getEditor=function(){return this.data("redactor").$editor},o.fn.getCode=function(){return o.trim(this.data("redactor").getCode())},o.fn.getText=function(){return this.data("redactor").$editor.text()},o.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},o.fn.setCode=function(e){this.data("redactor").setCode(e)},o.fn.insertHtml=function(e){this.data("redactor").insertHtml(e)},o.fn.destroyEditor=function(){this.each(function(){typeof o(this).data("redactor")!="undefined"&&(o(this).data("redactor").destroy(),o(this).removeData("redactor"))})},o.fn.setFocus=function(){this.data("redactor").$editor.focus()},o.fn.execCommand=function(e,t){this.data("redactor").execCommand(e,t)}})(e),function(t){function n(e,n){this.opts=t.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:s.drop_file_here,atext:s.or_choose},n),this.$el=t(e)}t.fn.dragupload=function(e){return this.each(function(){var t=new n(this,e);t.init()})},n.prototype={init:function(){if(navigator.userAgent.search("MSIE")===-1){this.droparea=t('<div class="redactor_droparea"></div>'),this.dropareabox=t('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=t('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",t.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",t.proxy(function(){return this.ondragleave()},this));var n=t.proxy(function(e){var t=parseInt(e.loaded/e.total*100,10);this.dropareabox.text("Loading "+t+"%")},this),r=e.ajaxSettings.xhr();r.upload&&r.upload.addEventListener("progress",n,!1);var i=function(){return r};this.dropareabox.get(0).ondrop=t.proxy(function(e){e.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var n=e.dataTransfer.files[0],r=new FormData;this.opts.uploadFields!==!1&&typeof this.opts.uploadFields=="object"&&t.each(this.opts.uploadFields,t.proxy(function(e,n){n.toString().indexOf("#")===0&&(n=t(n).val()),r.append(e,n)},this)),r.append("file",n),t.ajax({url:this.opts.url,dataType:"html",data:r,xhr:i,cache:!1,contentType:!1,processData:!1,type:"POST",success:t.proxy(function(e){var n=t.parseJSON(e);typeof n.error=="undefined"?this.opts.success(n):(this.opts.error(this,n),this.opts.success(!1))},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(e),function(e){var t="http://",n=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,r=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,i=function(){var s=this.childNodes,o=s.length;while(o--){var u=s[o];if(u.nodeType===3){var a=u.nodeValue;a&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(n,'$1<a href="'+t+'$2">$2</a>$3').replace(r,'$1<a href="$2">$2</a>$5'),e(u).after(a).remove())}else u.nodeType===1&&!/^(a|button|textarea)$/i.test(u.tagName)&&i.call(u)}};e.fn.linkify=function(){this.each(i)}}(e),function(e){e.event.special.textselect={setup:function(t,n){e(this).data("textselected",!1),e(this).data("ttt",t),e(this).on("mouseup",e.event.special.textselect.handler)},teardown:function(t){e(this).off("mouseup",e.event.special.textselect.handler)},handler:function(t){var n=e(this).data("ttt"),r=e.event.special.textselect.getSelectedText(n).toString();r!=""&&(e(this).data("textselected",!0),t.type="textselect",t.text=r,e.event.dispatch.apply(this,arguments))},getSelectedText:function(e){var r="";return t.getSelection?r=t.getSelection():n.getSelection?r=n.getSelection():n.selection&&(r=n.selection.createRange().text),r}},e.event.special.textunselect={setup:function(t,n){e(this).data("rttt",t),e(this).data("textselected",!1),e(this).on("mouseup",e.event.special.textunselect.handler),e(this).on("keyup",e.event.special.textunselect.handlerKey)},teardown:function(t){e(this).unbind("mouseup",e.event.special.textunselect.handler)},handler:function(t){if(e(this).data("textselected")){var n=e(this).data("rttt"),r=e.event.special.textselect.getSelectedText(n).toString();r==""&&(e(this).data("textselected",!1),t.type="textunselect",e.event.dispatch.apply(this,arguments))}},handlerKey:function(t){if(e(this).data("textselected")){var n=e(this).data("rttt"),r=e.event.special.textselect.getSelectedText(n).toString();(t.keyCode=27)&&r==""&&(e(this).data("textselected",!1),t.type="textunselect",e.event.dispatch.apply(this,arguments))}}}}(e)}),define("require/redactor_mention",["jquery","tibbr","require/redactor","require/mentionsInput"],function(e,t,n,r){window.RedactorPlugins=window.RedactorPlugins||{},window.RedactorPlugins.mention={init:function(){this.initMention()},initMention:function(){var n=this,i=this.$editor,s=this.opts.mention||{},o=arguments;this.useAPI=s.useAPI,s.redactor=this,s.triggerChar=["@","#"],_.isEmpty(n.opts.resource)||s.triggerChar.push(t.appConfig("ui_config","config","resource_trigger_char")||"+"),s.onDataRequest=function(r,i,s,o){switch(o){case"@":n.ajax({url:"users/"+t.currentUser.id+"/list_message_targets",data:n.buildParams(i)}).done(function(e){s.call(this,n.responseData(e))});break;case"+":n.ajax({url:"resources/list_message_targets",data:e.param({page:1,per_page:5,client_id:n.opts.resource.client_id||n.opts.resource.app_id,search_options:{search_str:i}})}).done(function(e){s.call(this,n.responseData(e))});break;case"#":n.ajax({url:"users/"+t.currentUser.id+"/list_hash_tags",data:e.param({params:{per_page:10,page:1,search_str:i}})}).done(function(e){s.call(this,n.responseData(e))})}},this.mention=e.data(i,"mentionsInput")||e.data(i,"mentionsInput",new r(s)),typeof s=="object"||!s?(this.mention.init(this.$el),this.initEvent()):e.error("Method  does not exist"),this.initApi()},responseData:function(e){var n=this;return _.map(e,function(e){return{id:e.value,name:e.caption,avatar:t.asset(e.image||"/assets/images/subjects/subject_images/missing_small.png"),type:n.type(e.t),icon:""}})},type:function(e){return{u:"User",s:"Subject",g:"Group",og_r:"Resource",ht:"HashTag"}[e]},buildParams:function(t){var n=this.opts.params||{},r=n.type||"both",i="id",s=n.exclude_type||i,o={page:n.page||1,per_page:n.per_page||5,search_str:t},u=n.users_filters||{only_postable:!0},a=n.subjects_filters||{only_postable:!0},f={users_filters:_.extend(u,o),subjects_filters:_.extend(a,o)};return e.param({params:_.extend(f,{value_type:i})})},initEvent:function(){var e=this;this.$el.attr("data-mentions-input","true"),this.$editor.bind("keydown",this.mention.onInputBoxKeyDown),this.$editor.bind("input",this.mention.onInputBoxInput),this.$editor.bind("keypress",function(n){e.mention.onInputBoxKeyPress(n),t.IE&&e.mention.onInputBoxInput(n)}),this.$editor.bind("click",this.mention.onInputBoxClick),this.$editor.bind("blur",this.mention.onInputBoxBlur)},initApi:function(){e.fn.hasMention=function(){return this.data("redactor").$editor.find(".js-mention").length>0},e.fn.mentionHTML=function(){var t=this.data("redactor").$editor.clone();return t.find(".js-mention").each(function(){e(this).replaceWith(e(this).data("mention"))}).end().html()}},ajax:function(n){return n=n||{},n.url=n.url.replace(new RegExp("^"+window.prefix),"/"),n.dataType="json",n.type="GET",n.global=n.global||!1,this.useAPI?(n.method=n.type,n.params=n.data,delete n.data,delete n.type,TIBR.api(n)):(n.url=t.path(n.url),e.ajax(n))}}}),define("hbs!modules/common/templates/post/post_box",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<form class="dropzone" enctype="multipart/form-data" method="post" target="upload_frame_public">\n    <input type="hidden" name="format" value="json"/>\n\n    <div class="js-main">\n\n        <div class="textarea-wrap js-main-textarea"></div>\n        <div style="display:hidden;" class="hidden">\n            <textarea id="__content" name="message[rich_content]"></textarea>\n        </div>\n\n        <div class="js-sub-main hidden">\n            <div class="question options holder"></div>\n            <div class="calender options holder"></div>\n            <div class="announcement options holder"></div>\n            <fieldset id="posting_tags" class="post-to">\n                <label>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.post",u):a.call(t,"t","home.post",u)))+' </label>\n                <div class="auto-suggest"></div>\n            </fieldset>\n            <div class="preview-resource hidden"style="padding: 10px;background: #eee;border: 1px solid #ccc;margin-top: 10px;overflow: hidden;"></div>\n            <div id="meeting-schedular" class="meeting-schedular hidden">\n                <div id="meeting-choices">\n                    <div class="label">  ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.add_meetings",u):a.call(t,"t","common.add_meetings",u)))+':</div>\n                    <ul class="meeting-sources meeting-list">\n                    </ul>\n                </div>\n                <div id="added-meeting" class="added-meeting hidden"></div>\n            </div>\n            <div class="asset-holder"></div>\n            <div id="announcement_div"></div>\n            <input type="hidden" name="message[msg_type]" class="post-type" value="plain">\n            <input id="allow_subject_announcement" name="allow_subject_announcement" type="hidden" value="false"/>\n        </div>\n    </div>\n</form>',s})}),define("modules/common/views/messages/edit_post",["jquery","underscore","tibbr","modules/dialog","require/redactor","require/redactor_mention","../../models/message","../../models/subject","../post/mentions_input","hbs!modules/common/templates/post/post_box"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({className:"tib-post_tib-box",events:{"focus textarea":"showFooter","click #edit-tib-btn":"submit"},initialize:function(){t.bindAll(this,"reset","resetButton"),this.parent=this.options.parent||{},n.richText=n.richText||{}},render:function(e){var t='<div class="submit-btn-holder post-btn rfloat"><button class="btn btn-primary btn-submit tib-btn" id="edit-tib-btn" name="commit"><span class="js-button">'+this.t("common.button_texts.plain")+'<span class="ui-inline-icon arrow-next"></span></button></div>';return this.inputClass=this.options.inputClass||"subject_name",this.data=e,this.$el.html(this.renderTemplate(f)).append(t),this.renderTibBox(),this},renderTibBox:function(){this.renderRedactor()},resetTibBox:function(){try{this.$(".tib-text").mentionsInput("reset"),this.$(".redactor").setCode("").setFocus()}catch(e){}},submit:function(t){t.preventDefault();var r=this;e(t.currentTarget).hide().parent().append(n.UI.loader);var i=this.$("form"),s=this.$(".redactor").mentionHTML();this.$("textarea#__content").val(s);var o=i.serializeJSON();window.currentPostTarget=t.currentTarget,this.model.action("","update",{data:JSON.stringify(o),beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")}}).done(function(e){var t=r.model;try{r.dialog.close()}catch(i){}n.Event.trigger("message:updated",t),n.pub("message_update",{Message:t.id,Subjects:t.subjects.pluck("id")}),n.publish("message.updated",e)}).fail(function(e){e.errors&&r.useAPI&&(e.responseText=e.errors),r.alertError(e),r.resetButton()}).always(function(e){i.find("input, textarea, select").removeAttr("disabled")})},renderRedactor:function(){var e=this;e.richText=!0,e.parent.richText=e.richText,this.$(".js-main-textarea").append('<textarea style="width: 547px; height: 65px; padding: 5px" class="js-updated-content ts-redactor redactor">'+n.Helper.contextToHtml(this.model.get("rich_content"))+"</textarea>");var t=n.richText.tool_bar?n.richText:{tool_bar:{}},r=e.$(".redactor");r.redactor({plugins:["mention"],tabFocus:!1,buttons:t.tool_bar,resource:e.options.resource||{},allowedTags:t.allowed_tags,linebreak:!0}),e.$(".redactor_toolbar").css("width",t.tool_bar.length*27)},bind:function(){this.mentionsInput&&this.mentionsInput.bind(),this.$("form").csrfToken().attr("action",this.options.actionUrl||n.serverUrl("messages"))},reset:function(){this.$("form textarea").val("").simplePlaceholder().focus(),this.$(".js-clean-after-post").remove(),this.resetButton(),this.resetTibBox()},resetButton:function(){this.$(".line-loader").hide(),e(window.currentPostTarget).show(),window.currentPostTarget=undefined},onLeave:function(){this.$(".redactor").destroyEditor(),this.$(".redactor").remove()}})}),define("hbs!modules/common/templates/messages/message",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){return'\n        <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\n        '}function d(e,t){return'\n                <div class="private legend js-private"></div>\n            '}function v(e,t){var r="",i,s;return r+='\n            <a class="subject-closed">\n                <i class="arrow down"></i>\n                <span>',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"message.closed",s):f.call(e,"t","message.closed",s)))+"</span>\n            </a>\n            ",r}function m(e,t){return'\n                    <i class="ui-inline-icon stream-icon private js-private"></i>\n                '}function g(e,t){var r="",i,s;return r+='\n                    <span class="js-delete-msg">|</span>\n                    <a class="js-delete-msg delete-link">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"actions.delete",s):f.call(e,"t","actions.delete",s)))+"</a>\n                ",r}function y(e,t){var r="",i,s;return r+='\n                        <a href="#" class="geo-location" title="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),typeof i===c?i.apply(e):i))+'">\n                            <i class="ui-inline-icon geo-icon"></i> ',s={hash:{},data:t},r+=l((i=n.truncate||e&&e.truncate,i?i.call(e,(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),22,s):f.call(e,"truncate",(i=(i=e&&e.model,i==null||i===!1?i:i.geo_location),i==null||i===!1?i:i.place),22,s)))+"\n                        </a>\n                    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="js-tib-post">\n    <a class="profile-hover js-hover-message profile-pic q-tip user js-publish js-vipable"\n       data-event_key="user.selected"\n       data-id="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.id),typeof o===c?o.apply(t):o))+'"\n       data-type="user"\n       data-event_data="',a={hash:{},data:i},s+=l((o=n.setData||t&&t.setData,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"setData",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'"\n       href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"urlFor","show",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'">\n        <img src="',a={hash:{},data:i},s+=l((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.profile_image_url),3,a):f.call(t,"assetImage",(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.profile_image_url),3,a)))+'" class="bordered-large large">\n        ',u=n["if"].call(t,(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.isVip),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+='\n    </a>\n\n\n    <div class="info">\n        <div class="bg-wrap js-wrap">\n            ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.private_message),{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n            ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.isClosed),{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='\n            <a class="js-star star-status live"> <img src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/cleardot.png",a):f.call(t,"imagePath","images/cleardot.png",a)))+'"></a>\n            <h6 class="profile-name-header">\n                ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.private_message),{hash:{},inverse:h.noop,fn:h.program(7,m,i),data:i});if(u||u===0)s+=u;s+='\n                <i class="ui-inline-icon stream-icon '+l((o=(o=t&&t.model,o==null||o===!1?o:o.getIconClass),typeof o===c?o.apply(t):o))+'"></i>\n                <a class="profile-hover js-hover-message profile-name user_url js-user-info js-publish js-vipable js-new-post"\n                   data-event_key="user.selected"\n                   data-event_data="',a={hash:{},data:i},s+=l((o=n.setData||t&&t.setData,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"setData",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'"\n                   href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",(o=t&&t.model,o==null||o===!1?o:o.user),a):f.call(t,"urlFor","show",(o=t&&t.model,o==null||o===!1?o:o.user),a)))+'">\n                    '+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.user),o==null||o===!1?o:o.display_name),typeof o===c?o.apply(t):o))+'\n                </a>\n                <span class="signature">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.signature),typeof o===c?o.apply(t):o))+'</span>\n            </h6>\n\n            <p class="posted-to js-posted-to"></p>\n\n            <div class="msg tib-content rich-post js-message-content">\n                ',u=(o=(o=t&&t.model,o==null||o===!1?o:o.getRichContent),typeof o===c?o.apply(t):o);if(u||u===0)s+=u;s+='\n            </div>\n\n            <div class="m-holder" style="display: none;"></div>\n            <div class="poll-wrap" style="display: none;"></div>\n            <div class="resource-holder" style="display: none"></div>\n            <div class="eog-holder" id="eog-holder-'+l((o=(o=t&&t.model,o==null||o===!1?o:o.id),typeof o===c?o.apply(t):o))+'" style="display: none"></div>\n            <div class="asset-attachment h-scroll" style="display: none;"></div>\n            <p class="js-goToPost"><a href="',a={hash:{},data:i},s+=l((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,a):f.call(t,"urlFor","show",t&&t.model,a)))+'" title="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"analytics.go_to_post",a):f.call(t,"t","analytics.go_to_post",a)))+'">\n                ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"analytics.go_to_post",a):f.call(t,"t","analytics.go_to_post",a)))+'</a></p>\n\n            <p class="action-links msg-action-links">\n                <a href="#" class="like-link js-like-action-message"\n                   title="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.like",a):f.call(t,"t","message.like",a)))+'">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.like",a):f.call(t,"t","message.like",a)))+'</a>\n                <span class="no-reply">|</span>\n                <a class="reply-link js-reply-link no-reply" href="#" title="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.reply",a):f.call(t,"t","message.reply",a)))+'">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.reply",a):f.call(t,"t","message.reply",a)))+"</a>\n                ",u=n["if"].call(t,t&&t.canDelete,{hash:{},inverse:h.noop,fn:h.program(9,g,i),data:i});if(u||u===0)s+=u;s+='\n                    <span>|</span>\n                <a class="more-actions js-more-actions"> ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.more",a):f.call(t,"t","message.more",a)))+' <i class="ui-inline-icon down-arrow"></i></a>\n                <span class="geo-n-share">\n                    <span class="js-share share-count hidden">\n                        <i class="ui-inline-icon share-icon"></i>',a={hash:{count:(o=t&&t.model,o==null||o===!1?o:o.embedding_messages_count)},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"message.share",a):f.call(t,"t","message.share",a)))+"\n                    </span>\n\n                    ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.hasGeoMap),{hash:{},inverse:h.noop,fn:h.program(11,y,i),data:i});if(u||u===0)s+=u;return s+='\n                </span>\n            </p>\n            <div class="geo-map"></div>\n            <span class="geo-map-nearBy-loaded"></span>\n\n            <p class="like js-like-message" style="display: none"></p>\n        </div>\n        <!--end of .bg-wrap-->\n    </div>\n    <!--.info-->\n</div>\n<!--.media-box-->\n',s})}),define("hbs!modules/common/templates/messages/community_share_message",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;s+='    <div class="shared-post">\n\n    <div class="bg-wrap">\n        <div class="media-box">\n            <a style="pointer-events:none; cursor: default" class=\'profile-pic\'>\n                <img alt="" src="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.comm_user_image_url),typeof o===f?o.apply(t):o))+'">\n            </a>\n\n            <div class="info">\n                <h6>\n                    <a style="pointer-events:none; cursor: default" class=\'profile-name user_url\'>\n                        '+l((o=(o=t&&t.model,o==null||o===!1?o:o.comm_user_display_name),typeof o===f?o.apply(t):o))+'\n                    </a>\n                </h6>\n\n                <p class="posted-to jsPostedTo">\n                    <span class="community-link"><img src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/community-small-icon.png",a):c.call(t,"imagePath","images/community-small-icon.png",a)))+'"> ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"files.from",a):c.call(t,"t","files.from",a)))+' <a href="',(u=n.go_to_community)?u=u.call(t,{hash:{},data:i}):(u=t&&t.go_to_community,u=typeof u===f?u.call(t,{hash:{},data:i}):u),s+=l(u)+'">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.community_url),typeof o===f?o.apply(t):o))+' </a></span>\n\n                </p>\n            </div>\n        </div>\n        <div class="msg tib-content js-share-content rich-post"><p style="margin: 5px 0px 0px 0px">\n            ',(u=n.messageContent)?u=u.call(t,{hash:{},data:i}):(u=t&&t.messageContent,u=typeof u===f?u.call(t,{hash:{},data:i}):u);if(u||u===0)s+=u;return s+='</p></div>\n\n        <p class="action-links msg-action-links js-share-actions">\n            <a>\n                <i class="like-link liked"></i>\n                <i class="mid-dot">·</i>\n                <span class="count">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.comm_likes_count),typeof o===f?o.apply(t):o))+'</span>\n            </a> <span>|</span>\n            <a>\n                <i class="reply-link"></i>\n                <i class="mid-dot">·</i>\n                <span class="count">'+l((o=(o=t&&t.model,o==null||o===!1?o:o.comm_replies_count),typeof o===f?o.apply(t):o))+'</span>\n            </a>\n                <a style="cursor: pointer" class="js-view-community-post view-post"> ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"common.view_full_post",a):c.call(t,"t","common.view_full_post",a)))+"</a>\n        </p>\n    </div>\n</div>\n",s})}),define("modules/common/views/messages/list_item",["jquery","underscore","tibbr","backbone","modules/dialog","modules/tags/select","../../collections/users","../common/hover_profile","./reply_list","./link_list","./mixed_asset_list","./resources/list","./delete","./mute","./copy_link","./share_on_community","./email","./calendar_view","../post/calender","./add","./share","./question","./poll_update","./calendar_update","../post/poll_option","./community","./global_announcement","./untag_post","./share_item","./edit_post","hbs!modules/common/templates/messages/message","hbs!modules/common/templates/messages/community_share_message"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M){var _=n.View.extend({className:"entry",tagName:"li",likeType:"message",initialize:function(){t.bindAll(this,"renderLike"),this.bindTo(this.model,"change:actions",this.resetActionDropDown,this),this.bindTo(this.model,"calendar:updated",this.updateCalendar,this),this.bindTo(this.model,"change:rich_content",this.updateMessageContent,this),this.bindTo(this.model,"addSubject:done",this.updatePostTo,this),this.bindTo(this.model,"removeSubjects:done",this.updatePostTo,this),this.bindTo(this.model,"removeSubjects:error",this.showError,this),this.bindTo(this.model,"like.delete.star:change",this.likeDelete,this),this.bindTo(this.model,"change:embedding_messages_count",this.updateShareCount,this),this.bindTo(this.model,"change",function(e){n.Event.trigger("model:change",this.model)},this),this.$el.addClass("js-msg-"+this.model.get("id")),this.el.id="js-msg-"+this.model.get("id"),this.replyView=this.initChild(a,{model:this.model})},events:{"click a.js-custom-link":"customLink","click a.like-link":"like","click a.star-status":"star","click a.js-reply-link":function(e){e.preventDefault(),this.replyView.focusReplyBox(e)},"mouseover img.large":"showLyncCard",mouseover:"showStar",mouseout:"showStar","click a.geo-location":"showGeo","click a.continued":"continuedText","click a.js-delete-msg":"delete","click a.resource-links":"goToResource","click a.create_meeting":"create_meeting","click a.js-action-target-link":"actionTargetLink","click .js-message-content  a.js-hash-tag":"hashTags","click .js-view-community-post":"viewPostFromCommunity"},profileHover:function(){if(!n.hoverCard)return;n.appConfig("webui","config","enable_lync")===!1&&this.$(".js-hover-message").qtip(n.qtipConfigs.hovercard(u,{model:this.model.user}))},subjectHover:function(){if(n.gadget||n.connect)return;this.$(".subject-tip").each(function(){e(this).qtip(n.qtipConfigs.hovercard(u,{model:e(this).data("model")}))}),this.mentionHover()},mentionHover:function(){this.$(".mention-hover").each(function(){e(this).qtip(n.qtipConfigs.hovercard(u,{model:!1,object:e(this).data().obj}))})},showLyncCard:function(){if(n.appConfig("webui","config","enable_lync")===!0)try{var e=new ActiveXObject("Name.NameCtrl.1");e.ShowOOUI(this.model.user.get("email"),0,window.event.clientX,window.event.clientY)}catch(t){console.log("error on lyncCard",t)}},render:function(){var e=this;return this.$el.html(this.renderTemplate(O,{canDelete:window.gadget&&(this.model.get("user").id===n.currentUser.id||t.str.include(this.model.get("actions"),"delete")),count:this.options.count,include:["geo_location","user"]})),this.$el.attr("read",this.model.identifyLastestMessageId()<=n.currentUser.recentReadMessageID),t.isEmpty(this.model.get("application_definition_name"))&&this.$(".stream-icon").not(".private").remove(),this.model.numberOfReplies()>0?this.$(".js-tib-post").addClass("tib-post"):this.$(".js-tib-post").addClass("media-box"),this.model.get("embedding_messages_count")&&this.$(".js-share").show(),this.$(".js-goToPost").remove(),this.model.getMessageType()==="calendar"&&this.model.calendar?(this.calendarView=this.initChild(g,{model:this.model.calendar,parent:this}),this.$(".m-holder").append(this.calendarView.render().el).show()):this.model.getMessageType()==="question"&&this.model.question&&this.$(".poll-wrap").append(this.initChild(E,{model:this.model.question,parent:this}).render().el).show(),this.$el.afterRenderToDom().done(function(){t.defer(function(){e.model.parseResources();if(e.model.assets.length>0){var t=e.initChild(l,{collection:e.model.assets,hostUrl:e.options.calling_server,messageId:params.srcMsgId,isCommunity:e.options.community}).render().el;e.$("div.asset-attachment").append(t).show()}if(e.model.resources.length>0){var n=e.initChild(c,{collection:e.model.resources,isCommunity:e.options.community}).render().el;e.$("div.resource-holder").replaceWith(n).show()}})}),this.model.links.length>0&&this.$("div.asset-attachment").append(this.initChild(f,{collection:this.model.links}).render().el).show(),this.postTo(),this.renderLike(),this.options.noReply||!this.model.canReply()?(this.$(".js-wrap").append(this.replyView.render().el),this.$(".no-reply").hide()):this.$(".js-wrap").append(this.replyView.render().el),this.profileHover(),this.subjectHover(),this.renderStar(this.model.hasStar()),this.renderShareMessage(),this.renderCommunityMessage(),this.renderResource(),this.model.isUnread()&&(this.$(".js-wrap .js-user-info").after("<span class='badge-new'>"+this.t("common.new")+"</span>"),this.$el.addClass("js-new-entry")),this.renderCommunity(),this.moreMenu(),this.model.user.get("deleted")&&this.$(".profile-pic:first").addClass("ex-employee-pic"),this},updateCalendar:function(){this.calendarView&&(this.calendarView.model=this.model.calendar,this.calendarView.render())},updateMessageContent:function(e){this.$el.find(".js-message-content").html(this.model.get("rich_content"))},resetActionDropDown:function(){try{this.$(".js-more-actions").qtip("api").rendered=!1}catch(e){}},navigate:function(e){e.method&&t.isFunction(this[e.method])&&this[e.method](e)},renderCommunity:function(){if(!n.currentUser.communities)return!1;var e=this;n.currentUser.communities.each(function(t){e.$("ul.community-list").append(e.initChild(N,{model:t,message:e.model,parent:e}).render().el)}),this.$("a.post-community-action").qtip(n.qtipConfigs.menu(this.$el,".qtip-community"))},hideMenu:function(){this.$(".js-more-actions").qtip("hide")},hideCommunityMenu:function(){this.$("a.post-community-action").qtip("hide")},updateShareCount:function(){this.$(".js-share").html('<i class="ui-inline-icon share-icon"></i>'+this.t("message.share",{count:this.model.get("embedding_messages_count")})).show()},"delete":function(){var e=this.$(".confirm-delete");return this.$el.children().hide(),e.length===0&&this.$el.append(this.initChild(h,{model:this.model}).render().el),e.show(),!1},mute:function(){return this.renderDialog(p,{model:this.model,parent:this,dialog:{title:this.t("message.mute.header"),className:"hide-post-dialog",width:"550px"}}),!1},unmute:function(e){var t=this;return this.model.unmute(),!1},copy_link:function(){return this.renderDialog(d,{copyText:this.model.copyUrl(),dialog:{width:500,height:200}}),!1},add:function(){return this.renderDialog(b,{model:this.model,html:this.$el.clone(),complete:function(e){e.$(".js-tib-post").css({"max-height":"200px",overflow:"auto",position:"relative"})},dialog:{title:"<span>"+this.t("actions.add")+"</span>",className:"share-dialog"}}),!1},share:function(){return this.renderDialog(w,{model:this.model,html:this.$el.clone(),dialog:{title:'<i class="ui-inline-icon share-icon"></i><span>'+this.t("actions.main.share")+"</span>",className:"share-dialog"}}),!1},share_on_network:function(){var t=this,r=n.host()+"/messages/"+this.model.get("id")+"/share_to_community?"+"tibbr_server_url="+n.currentUser.get("base_community").app_url;return i.view("<div style='overflow: hidden'><iframe id='Community_window' style='overflow: hidden' class='client-stream' frameborder='0' width='600' src='"+r+"'></iframe></div>",{modal:!0,width:625,"max-height":600,open:function(){n.Event.off("client:app:initialized:share_post"),n.Event.on("client:app:initialized:share_post",function(){n.publishToClient("message.share",t.model.toJSON())}),n.Event.off("client:app:resize:community_window"),n.Event.on("client:app:resize:community_window",function(t){e("iframe#Community_window").height(t.height)})},close:function(){n.Event.off("client:app:initialized:share_post")},title:'<i class="ui-inline-icon share-icon"></i><span>'+this.t("actions.main.share")+"</span>",className:"share-dialog"}),!1},viewPostFromCommunity:function(){var t=this,r=n.host()+"/messages/"+this.model.get("id")+"/view_shared_message?source_msg_id="+this.model.get("id");return i.view("<div style='overflow: hidden'><iframe id='Community_window' style='overflow: hidden' class='client-stream' frameborder='0' width='675' src='"+r+"'></iframe></div>",{modal:!0,width:700,"max-height":600,close:function(){n.Event.off("client:app:initialized:community_message_view")},open:function(){n.Event.off("client:app:initialized:community_message_view"),n.Event.on("client:app:initialized:community_message_view",function(){n.publishToClient("message.showCommunityMessage",{})}),n.Event.off("client:app:resize:community_window"),n.Event.on("client:app:resize:community_window",function(t){e("iframe#Community_window").height(t.height)})}}),!1},extend_poll:function(){this.renderDialog(S,{model:this.model.question,dialog:{width:600}}),this.bindTo(this.model.question,"change:closeOverlay",function(){i.close()})},update_poll:function(){return this.renderDialog(x,{view:new T({isUpdate:!0,model:this.model}),model:this.model,dialog:{height:300,width:600}}),this.bindTo(this.model.question,"change:closeOverlay",function(){i.close()}),!1},edit:function(){return this.renderDialog(A,{view:new A({model:this.model}),model:this.model,dialog:{title:this.t("actions.edit"),height:200,width:600}}),!1},update_calendar:function(){return this.renderDialog(x,{view:new y({isUpdate:!0,model:this.model}),isUpdate:!0,model:this.model,dialog:{height:300,width:600}}),!1},updatePostTo:function(e){this.model.subjects.reset(e.subjects),this.model._postedWith=undefined,this.model.set("private_message",e.private_message),this.postTo(),this.profileHover(),this.subjectHover();var t=this;n.currentUser.batchActionOn([{target_class:t.model.get("json_class"),target_id:t.model.id}]).done(function(e){t.model.set("actions",e.actions_array[0].actions)}),i.close(),!this.model.get("private_message")&&this.$(".js-private").length&&this.$(".js-private").remove()},showError:function(e){i.close(),i.alert({text:e[0]})},email:function(){return this.renderDialog(m,{model:this.model,dialog:{width:350,height:400}}),this.hideMenu(),!1},remove_subject:function(){return this.renderDialog(k,{model:this.model,html:this.$el.clone(),dialog:{title:this.t("actions.remove_subject"),className:"tibbr-ui-dialog untag-post-dialog",width:"auto"}}),!1},showStar:function(e){var t=this.$(".star-status");if(t.hasClass("starred"))return;e.type==="mouseover"?t.removeClass("hidden"):t.addClass("hidden")},star:function(t){var r=e(t.target).parent();r.hasClass("starred")?(this.model.action("unstar","update",{setModel:!1,silent:!0}).done(function(){n.data.clear("current_user:starred_messages")}),r.removeClass("starred"),this.model.setAction("unstar","star")):(this.model.action("star","update",{setModel:!1,silent:!0}),r.addClass("starred"),this.model.setAction("star","unstar"))},likeDelete:function(){var e=this.model.get("bulk_actions").split(",");t.include(e,"unlike")&&this.model.get("is_liked_by_current_user")===!1&&(this.model.set("is_liked_by_current_user",!0),this.renderLike()),t.include(e,"unstar")&&this.renderStar(!0),t.include(e,"msg_reply")&&(this.$(".no-reply").show(),this.$(".js-wrap").append(this.replyView.render().el))},renderStar:function(e){var t=this.$(".js-star");e?t.addClass("starred").removeClass("hidden"):t.addClass("hidden")},showGeo:function(){var e=this.$(".geo-map"),t=this.model,r=this.$(".geo-location");return e.hasClass("loaded")?(e.slideToggle("slow",function(){r.toggleClass("clicked")}),!1):(n.gMap.connect().done(function(){n.gMap.display(e,{latitude:t.geo_location.get("latitude"),longitude:t.geo_location.get("longitude")})}),e.addClass("loaded").show(),!1)},continuedText:function(){return this.$(".js-message-content").html(this.model.getRichContent(!0)),this.mentionHover(),!1},customLink:function(e){return typeof window.customActionLink=="function"&&window.customActionLink(e,n,this.model),!1},postTo:function(){this.$("a.js-more-people").qtip("remove"),this.$(".js-more-people-list")&&this.$(".js-more-people-list").remove();var r=this,i=e("<p class='posted-to js-posted-to'/>"),s='<i class="small time-stamp msg-datetime">'+this.model.postedAt()+"</i>",o=t.reject(this.model.postedWith().unKnownList,function(e){return t.isEmpty(e)}),u=t.reject(this.model.postedWith().knowList,function(e){return t.isEmpty(e)});u.length>0?(t.each(u,function(n){if(n.model.isVip())var r='<i class="ui-inline-icon '+n.icon+'"></i>'+"<span class='vip-icon-wrap'><i class='ui-inline-icon vip-icon'></i></span><span>"+t.str.truncate(n.name,20)+"</span>";else r='<i class="ui-inline-icon '+n.icon+'"></i>'+"<span>"+t.str.truncate(n.name,20)+"</span>";try{var s=n.model.toJSON()}catch(o){s={}}i.append(e("<a>",{data:{model:n.model,event_key:(n.isUser?"user":"subject")+".selected",event_data:window.gadget?s:""},href:n.url,html:r,"class":"js-publish subject-tip js-vipable","data-id":n.model.id,"data-type":n.isUser?"user":"subject"})).append(" ")}),o.length>0&&i.append(e("<a/>",{"class":"js-more-people",text:r.t("message.more_targets",{count:o.length})})),i.append(s),this.$(".js-posted-to").replaceWith(i),this.$("a.js-more-people").qtip(n.qtipConfigs.dropDown(o,{showEvent:"mouseenter",hideEvent:"mouseleave",fixed:!0}))):r.$("h6").append(s)},renderShareMessage:function(){var e=this.model.embeddedMessage;e&&this.$(".tib-content:first").after(this.initChild(L,{model:e,itemView:_}).render().el)},renderCommunityMessage:function(){var e=this.model.get("community_message_preview"),t=this;if(e){var r=n.host()+"/users/"+n.currentUser.id+"/go_to_community?tibbr_server_url="+e.community_url;t.$(".tib-content:first").after(t.renderTemplate(M,{messageContent:t.model.getRichContent(!1,null,e.rich_content,!0),model:e,go_to_community:r}))}},goToResource:function(e){if(!this.model.resource.get("app_id"))return!0;e.preventDefault(),n.application.navigateToClientApp(this.model.resource.get("app_id"),this.model.resource.get("url"))},custom_action:function(e,t){var r=e.handler;try{window[r].call(null,t,n,this.model.attributes)}catch(i){console.log(i)}return!1},global_announcement:function(){this.setAnnouncement()},subject_announcement:function(){this.setAnnouncement()},setAnnouncement:function(){var e=this.options.from,n,r,i=this.options.subject_id===undefined?"":this.options.subject_id,s=this.options.isVisibilityLimited===undefined?"false":this.options.isVisibilityLimited;return this.actions=this.model.actions(),n=i===""||s===!0?"false":t.include(this.actions,"global_announcement")&&!t.include(this.actions,"remove_global_announcement"),r=i===""?"false":t.include(this.actions,"subject_announcement")&&!t.include(this.actions,"remove_subject_announcement"),this.renderDialog(C,{dialog:{width:430},model:this.model,from:e,subject_id:i,announceGlobal:n,announceSubject:r}),!1},create_meeting:function(){var e=requirejs("views/home/meeting_list");return this.renderDialog(e,{modal:!0,model:this.model,complete:function(e){e.$el.css({width:"auto"})},dialog:{width:410,height:250,title:this.t("common.choose_provider"),className:"create-meeting-dialog"}}),!1},message_apps:function(e){if(e.open_separete)return window.open(e.href);var t=e.width||200;return i.view("<iframe  class='client-stream' frameborder='0' height='"+e.height+"' width='"+t+"' src='"+e.href+"'></iframe>",{modal:!0,width:t+40})},manageActions:function(){var r=e.Deferred(),i=this,s=t.compact(i.model.get("actions").split(","));if(!i.model.get("bulk_actions")){var o=t.isUndefined(i.options.subject_id)?"":i.options.subject_id;n.currentUser.actionsForMessages([i.model.id],o).done(function(e){var n=e.actions_array[0].actions.split(","),o=t.union(s,n).join(",");i.model.set("actions",o,{silent:!0}),i.model.set("bulk_actions",o,{silent:!0}),r.resolve(i.model.displaySubjectActions())})}else i.model.set("actions",i.model.get("bulk_actions"),{silent:!0}),r.resolve(this.model.displaySubjectActions());return r.promise()},menuActions:function(r){var i,s=this.options.from;switch(r){case"manage":return s==="subject"?i=this.model.displaySubjectActions():i=this.model.menuActions(),window.gadget&&(i=t.without(i,"add","global_announcement","remove_subject")),n.currentNav!=="messages"&&!e("#filters-main_wall").find("> li.current > a").hasClass("my_wall")&&(i=t.without(i,"mute")),i;case"apps":return this.model.appsActions;case"share":return!n.appConfig("webui","config","community","base_community")&&n.currentUser.get("base_community")&&t.some(n.currentUser.get("connected_communities"),function(e){return e.guid===n.currentUser.get("base_community").guid})&&this.model.shareActions.push("share_on_network"),this.model.shareActions;default:return[]}},moreMenu:function(){if(params.more_actions==="false"||n.Helper.themeName()==="compact"){this.$(".js-more-actions").remove();return}this.$(".js-delete-msg").remove();var r=this;this.$(".js-more-actions").qtip({position:{at:"bottom center",my:"top center",adjust:{x:18,y:0},viewport:e(window)},show:{event:"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus",style:{classes:"more-menu qtip-light qtip-shadow dropdown",tip:{border:1,width:12,height:10,offset:10}},content:{text:"<ul class='dropdown-menu'><li>"+spinner+"</li></ul>"},events:{render:function(i,s){r.manageActions().done(function(){var i=e('<ul class="dropdown-menu"></ul>'),o=r.model.mainMenu;t.each(o,function(s){var o=r.menuActions(s);if(s==="manage"&&o.length===0)return;i.append('<li  class="js-'+s+'"><a class="js-more-subnav"><i class="ui-inline-icon '+s+'-icon"></i>'+" <span>"+r.t("actions.main."+s)+"</span> "+'<i class="arrow next"></i></a>');var u=e("<ul class='sub-menu hidden'></ul>");t.each(o,function(e){e==="share_on_network"?u.append('<li class="js-sub-menu-'+e+'"><a class="'+e+'" data-method="'+e+'">'+r.t("actions."+e,{baseName:n.currentUser.get("base_community").name})+"</a></li>"):u.append('<li class="js-sub-menu-'+e+'"><a class="'+e+'" data-method="'+e+'">'+r.t("actions."+e)+"</a></li>"),i.find("li.js-"+s).append(u)}),s==="apps"&&(t.each(r.model.messageApps,function(t){u.append(e("<li/>").append(e("<a/>",{"data-href":t.url()+"&message_id="+r.model.get("id"),title:t.get("tooltip"),"data-open_separete":t.get("open_separete"),"class":"app-link","data-method":"message_apps","data-height":t.get("height")||600,"data-width":t.get("width")||500,text:t.get("title")})).addClass("js-app-link-"+r.model.get("id")))}),i.find("li.js-"+s).append(u))}),t.each(r.model.customActions(),function(e){i.append('<li class="js-custom-action"><a  data-method="custom_action" data-handler="'+e.handler+'">'+'<i class="ui-inline-icon custom-icon"></i> <span>'+r.t("actions."+e.key)+"</span></a>")}),s.set("content.text",i),s.elements.content.find(".js-more-subnav").each(function(){e(this).qtip({position:{at:"right top",my:"left top",adjust:{x:0,y:-4},viewport:e(window)},show:{event:"mouseover",solo:!1,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus",style:{classes:"profile-menu dropdown ui-action-menu qtip-light js-sub-tooltip",tip:!1},events:{render:function(t,n){n.elements.content.on("click","a",function(){var t=e(this);return r.navigate(t.data()),n.hide(),!1})},show:function(i,s){e(".js-more-subnav").qtip("hide"),s.elements.content.find("a.copy_link").zclip("remove"),t.delay(function(){s.elements.content.find("a.copy_link").data("copy",r.model.copyUrl()).zclip({path:n.path("/images/swf/ZeroClipboard.swf",r.useAPI),copy:function(){return e(this).data("copy")},afterCopy:function(){e(this).trigger("copied")}})},20)},hide:function(e,t){}},content:{text:e(this).closest("li").find(".sub-menu").clone().show()}})}),s.elements.content.on("hover","li.js-custom-action",function(){return e(".js-more-subnav").qtip("hide"),!1}),s.elements.content.on("click","li.js-custom-action > a",function(){var t=e(this);return r.custom_action(t.data(),t),s.hide(),!1})})}}})},onLeave:function(){this.calendarView&&this.calendarView.leave()}});return t.extend(_.prototype,n.Modules.View.ActionLink),t.extend(_.prototype,n.Modules.View.Like),t.extend(_.prototype,n.Modules.View.Resource),n.MessageView=_,_}),define("modules/common/views/common/see_more",["jquery","underscore","tibbr"],function(e,t,n){return n.View.extend({tagName:"p",className:"more-tibs",events:{"click a.js-more":"getMoreMessages"},initialize:function(){this.collection=this.options.collection,this.type=this.options.type,this.model=this.options.model,this.listenTo(n.Event,"scrolled_to_end",this.scrollWall,this),this.type==="like"&&n.currentUser.id.toString()===params.id?this.params={like_by:this.model.id,user_profile:!0}:this.params={},this.render()},render:function(){var e=this.collection;try{e.startAfter=e.last().get("sort_id")}catch(t){e.startAfter=null}return e.hasMorePages&&e.length>0?window.gadget&&e.length===e.per_page&&this.$el.html('<a href="#" class="remote js-more">'+this.t("common.see_more")+'<i class="down-arrow"></i></a>'):(this.noMoreMessage=e.length===0,e.fetched&&this.noMoreMessage&&this.$el.html('<a  class="remote">'+this.t("common.no_more_message")+"</a>")),this},getMoreMessages:function(){return this.requesting||(this.requesting=!0,this.collection.globalLoading=!1,this.collection.getMoreMessages(this.params),window.gadget?this.$("a").append(n.UI.spinner):this.$el.append('<a href="#" class="remote">'+loader+"</a>")),!1},scrollWall:function(){if(this.noMoreMessage)return;this.$el.is(":visible")&&this.getMoreMessages()},onLeave:function(){n.Event.stopListening(n.Event)}})}),define("hbs!modules/common/templates/common/no_vip",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="manage-vip-wrap">\n    <h3>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.no_vip",u):a.call(t,"t","vip.no_vip",u)))+'</h3>\n    <p class="clearfix">\n        <span class="manage-vip-text">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.click_to_add_vip",u):a.call(t,"t","vip.click_to_add_vip",u)))+'<a class="manage-vip-link" title="Manage VIP" data-type="<i class=\'ui-inline-icon vip-icon\'></i>" href="#"><b>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.manage_vip_link",u):a.call(t,"t","vip.manage_vip_link",u)))+'</b></a></span>\n        <img class="manage-vip-arrow" src="images/gray-up-arrow.png">\n    </p>\n\n</div>\n<div id="wall-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom">\n    <div class="tibbit_div">\n        <ol class="streams">\n            <li class="entry vip-posts">\n\n                <div class="tib-post">\n                    <a class="profile-pic" data-id="137" href="others-profile.html">\n                        <img class="large" src="images/vip-pic1.png">\n                        <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\n                    </a>\n                    <div class="info post-info">\n\n                        <div class="bg-wrap">\n                            <div class="legend private"></div>\n                            <h6>\n                                <a class="profile-name" href=""><i class="ui-inline-icon stream-icon private"></i>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.vip_tutor",u):a.call(t,"t","vip.vip_tutor",u)))+'</a></h6>\n                            <p class="msg tib-content">\n                                <img class="left-arrow" src="images/left-blue-arrow.png">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.user_indicator",u):a.call(t,"t","vip.user_indicator",u)))+'\n                            </p>\n                            <span class="geo-map-nearBy-loaded"></span>\n                            <p class="src-n-action"></p>\n\n\n\n                        </div>\n                    </div>\n                </div><!--.tib-post-->\n            </li>\n            <li class="entry vip-posts">\n                <div class="tib-post">\n                    <a class="profile-pic" data-id="137" href="others-profile.html">\n                        <img class="large" src="images/vip-pic1.png">\n                    </a>\n                    <div class="info post-info">\n\n                        <div class="bg-wrap">\n                            <div class="legend private"></div>\n                            <h6>\n                                <a class="profile-name" href=""><i class="ui-inline-icon stream-icon private"></i>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.vip_tutor",u):a.call(t,"t","vip.vip_tutor",u)))+'</a></h6>\n                            <p class="posted-to">\n                                <a href="#">\n                                    <i class="ui-inline-icon subject"></i>\n                                    <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\n                                    <span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.subject_example",u):a.call(t,"t","vip.subject_example",u)))+'</span>\n                                </a>\n                            </p>\n\n                            <p class="msg tib-content">\n                                <img class="top-arrow" src="images/top-blue-arrow.png">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.subject_indicator",u):a.call(t,"t","vip.subject_indicator",u)))+"\n                            </p>\n                        </div>\n                    </div>\n                </div><!--.tib-post-->\n            </li>\n        </ol>\n    </div>\n</div>",s})}),define("modules/common/views/messages/list",["jquery","underscore","tibbr","./list_item","./reply_list_item","../common/see_more","hbs!modules/common/templates/common/no_vip"],function(e,t,n,r,i,s,o){return n.View.extend({className:"tibbit_list streams",tagName:"ol",initialize:function(e){this.type=e.type,t.bindAll(this,"highLightNewMessages"),t.isString(e.id)&&(this.id=e.id),this.bindTo(this.collection,"reset",this.renderWithEvent),this.ListItemView=r,this.ReplyListItem=i,e.bindCreate!==!1&&n.Event.bindTo(this,"message:created",this.messageCreated),this.$el.attr("id",this.id||"my_posts")},events:{"click a.manage-vip-link":"manageVip"},highLightNewMessages:function(){var n=this;n.last_message&&(n.last_message.markAsRead(),n.last_message=undefined),t.delay(function(){if(n.collection.className=="WallMessages"||n.collection.className==="PrivateMessages"||n.collection.className==="VIPMessages"){var t=e("#end-of-activity-bar");t.length===0&&n.$("li[read=true]").first().prev().append("<div id='end-of-activity-bar' class='end-of-new-activity'><p>"+n.t("home.end_of_new_activity")+"</p></div>")}},400)},render:function(){var e=this;return this.options.load?this.collection.load({beforeSend:function(){e.$el.append(window.loader)}}).done(function(){e.options.load=!1}):this._render(),this},_render:function(){if(this.collection.total_entries===0&&this.options.emptyMessage)return this.$el.append("<div class='js-empty-result'>"+this.options.emptyMessage+"</div>"),this;var e=this,r=this.$el,i=this.collection;return i.getLatestUnreadMessage&&(this.last_message=i.getLatestUnreadMessage()),i.refresh&&r.empty(),e.renderList().done(function(){r.find(".line-loader").remove(),e.seeMoreView&&e.seeMoreView.leave(),e.seeMoreView=e.initChild(s,{collection:e.collection,type:this.type,model:this.model}),r.append(e.seeMoreView.render().el),e.highLightNewMessages(),e.collection.className==="VIPMessages"&&t.isEmpty(n.currentUser.vips)&&e.collection.length===0&&(r.prepend(e.renderTemplate(o)),e.seeMoreView.leave())}),this},manageVip:function(t){t.preventDefault(),e.fn.manageVip()},renderList:function(){var n,r,i,s=e.Deferred(),o=this,u=this.collection,a=document.createDocumentFragment(),f=this.options.from===undefined?"":this.options.from,l=this.options.readOnly,c=0,h=this.options.subject_id===undefined?"":this.options.subject_id,p=this.options.isVisibilityLimited===undefined?"false":this.options.isVisibilityLimited;return u.length===0?s.resolve(a):u.each(function(e){t.defer(function(){e.isParent()?r=o.ListItemView:(r=o.ReplyListItem,i="likes"),n=o.initChild(r,{model:e,collection:u,from:f,subject_id:h,templateFor:i,noReply:o.options.noReply,evaluteRecent:!0,readOnly:l,count:c+1,isVisibilityLimited:p}),c+=1;try{a.appendChild(n.render().el),o.$el.append(a)}catch(t){console.error("MessageListView ",e,t)}c===u.length&&s.resolve(a)})}),s.promise()},renderWithEvent:function(){this._render(),e(document).trigger("messages:rendered")},messageCreated:function(e){this.$(".js-empty-result").remove();var i=this,s;if(n.currentSubject){var o=i.params().id,u=n.currentSubject;u.isOwner()?(s=i.initChild(r,{model:e,from:"subject",subject_id:o}),i.$el.prepend(s.render().el),s.manageActions().done(function(){var r=e.get("actions").split(",");(t.include(r,"remove_subject_announcement")||t.include(r,"remove_global_announcement"))&&n.Event.trigger("announcement:change",{subjectId:o})})):(s=i.initChild(r,{model:e}),i.$el.prepend(s.render().el)),n.currentSubject.set("messages_reset",!0,{silent:!0})}else i.params().controller==="resources"?(s=i.initChild(r,{model:e,from:"resource"}),i.$el.prepend(s.render().el)):(s=i.initChild(r,{model:e,from:this.options.from}),i.$el.prepend(s.render().el));try{n.application.wallTabView.show(0)}catch(a){}},onLeave:function(){this.ListItemView=null,this.ReplyListItem=null}})}),define("modules/common/views/messages/filters",["jquery","underscore","backbone","tibbr","modules/common/views/common/wall_filters","modules/common/views/messages/list"],function(e,t,n,r,i,s){return i.extend({initialize:function(){this.options.bind&&this.event.bindTo(this,"filter:change",this.renderMessage),t.bindAll(this,"_rightBar")},render:function(){r.application.setWallAndPost(r.currentUser,!0),this.renderMessage(params)},renderMessage:function(e){if(window.params.controller==="subjects")return;e=e||{},e.id=e.id||"my_wall";var n=this,i=e.text||e.param1;return i&&(i=decodeURIComponent(i)),this.fetchMessageType(e).done(function(s){s.cid||(s=n.collection);if(s.className=="WallMessages"||s.className==="PrivateMessages"||s.className==="VIPMessages")r.currentUser.recentReadMessageID=s.last_read_message_id;n.event.trigger("section:change",e.id,i),n._Messages(s);var o=r.currentUser.get("badges"),u;switch(e.id){case"my_wall":u={unread:0};break;case"private":u={private_unread:0};break;case"vip":u={vip_unread:0}}u&&r.currentUser.set("badges",t.extend(o,u)).trigger("badges:updated")}).always(function(){t.defer(n._rightBar)})},_Messages:function(t,n){r.application._wallMessage&&(r.application._wallMessage.leave(),r.application._wallMessage=null);var i=r.application._wallMessage=new s({collection:t,type:n}),o=e("div.tibbit_div");return o.htmlWithEvent(i.render().el,"messages:rendered"),o},_rightBar:function(){var t=e(".js-right-nav"),n=this;(t.length===0||t.find("> div").length===0)&&requirejs(["views/common/right_nav"],function(t){e("#sidebar").append(r.currentController.renderView(t,{model:r.currentUser}).el)})},onLeave:function(){this._cleanUp()},_cleanUp:function(){r.application._wallMessage&&(r.application._wallMessage.leave(),r.application._wallMessage=null)}})}),define("hbs!templates/home/menu_section_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression;return s+='<a title="',(o=n.text)?o=o.call(t,{hash:{},data:i}):(o=t&&t.text,o=typeof o===a?o.call(t,{hash:{},data:i}):o),s+=f(o)+'"><i class="'+f((o=(o=t&&t.item,o==null||o===!1?o:o.key),typeof o===a?o.apply(t):o))+' ui-inline-icon"></i><span class="text-wrap">',(u=n.text)?u=u.call(t,{hash:{},data:i}):(u=t&&t.text,u=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(u)+"</span></a>\n",s})}),define("views/home/menu_section_item",["jquery","underscore","tibbr","modules/common/views/messages/filters","hbs!templates/home/menu_section_item"],function(e,t,n,r,i){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render","system","custom","badge"),this.item=this.options.item,this.key=this.options.key,this.urlParttern=this.options.url||"",this.bindTo(n.currentUser,"badges:updated",this.updateBadge,this),this.text=this.t("home.left_menu."+this.key+"_sections."+this.item.key,{name:n.currentUser.get("display_name")}),n.application._messageFilterView=n.application._messageFilterView||new r({bind:!0})},events:{"click a.system":"system","click a.custom":"custom","click a.what_happening, a.leader_board":"updateTotango"},render:function(){return this.$el.html(this.renderTemplate(i,{item:this.item,key:this.key,text:this.text})),this.key!=="main_wall"&&this.key!=="quick_links"&&this.$("i.ui-inline-icon").remove(),this.$("a").addClass(this.item.key).attr("href",this.url()).addClass(this.item.type||"system"),this.updateBadge(),this},url:function(){return this.item.type==="custom"?(this.item.target==="blank"&&this.$("a").attr("target","_blank"),this.item.url||"#"):this.urlParttern?n.url(this.urlParttern.replace("ID",this.item.key)+"/"+encodeURI(this.text)):this.item.url||"#"},updateBadge:function(){this.$("sup").remove(),this.badge()&&this.$("a").append('<sup class="badges">'+this.badge()+"</sup>")},badge:function(){var e=n.currentUser.get("badges");switch(this.item.key){case"my_wall":return e.unread;case"private":return e.private_unread;case"vip":return e.vip_unread}},custom:function(e){switch(this.item.handler){case"iframe":break;case"blank":case"inline":break;default:window[this.item.handle]&&window[this.item.handle](e,n,this.item)}return!1},system:function(e){if(this.urlParttern.match(/^insight/))return this.insight(e);if(n.currentNav!=="home"||t.isEmpty(this.urlParttern)||window.location.hash==="#client-stream")return!0;var r={id:this.item.key,text:this.text},i=this.setTarget(e);n.app.navigate(i.attr("href"),!1);if(i.hasClass("loading").length>0)return;i.addClass("loading"),n.Event.trigger("wallFilter:reset"),n.application._messageFilterView.renderMessage(r).done(function(){i.removeClass("loading")}),e.preventDefault()},setTarget:function(t){window.sub_menu_item=this.item.key;var n=e(t.currentTarget);return e("ul.sub-nav li").removeClass("current"),n.parent().addClass("current"),n},insight:function(e){return this.setTarget(e),!0},updateTotango:function(){n.tracker.trackSend("viewership of insights","User engagement")}})}),define("models/community",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"communities",defaults:{modelType:"Community"},cssClassName:"community-filter-link",initialize:function(){e.bindAll(this,"image","showUrl","appName")},image:function(){return this._path("images/my_streams/community-icon.png")},create:function(e,t){var n=this;this.action("","create",{data:{community:{name:e,url:t}},success:function(e,t){n.trigger("createCommunity",e)}})},appName:function(){return e.str.underscored(this.get("name"))},showUrl:function(){var e=t.appConfig("site","config")||{};return this.get("type")!=="session"?this.get("url")+t.context()+"web/community?fname="+e.prod_name+"&from="+e.site_root+"&name="+this.get("name")+"&theme="+this.get("color"):t.context()+"web/community_home"}})}),define("collections/my_communities",["tibbr","models/community"],function(e,t){return e.Collection.extend({className:"communities",tibbrURL:{controller:"users",action:"user_communities"},model:t})}),define("collections/communities",["tibbr","collections/users","models/community"],function(e,t,n){return e.Collection.extend({className:"communities",tibbrURL:{controller:"users",action:"unsubscribed_communities"},model:n})}),define("collections/community_notifications",["tibbr","collections/users"],function(e,t){return e.Collection.extend({className:"communities",tibbrURL:{controller:"users",action:"community_badges"}})}),define("hbs!templates/home/community_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="media-box">\n    <a href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.go_to_community),typeof o===a?o.apply(t):o))+'">\n        <img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/community-icon.png",u):l.call(t,"imagePath","images/community-icon.png",u)))+'">\n    </a>\n    <div class="info">\n        <a title="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===a?o.apply(t):o))+'" href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.go_to_community),typeof o===a?o.apply(t):o))+'">\n            <span class="v-align">'+f((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===a?o.apply(t):o))+"</span>\n        </a>\n    </div>\n</div>\n",s})}),define("views/home/community_item",["jquery","underscore","tibbr","models/community","hbs!templates/home/community_item"],function(e,t,n,r,i){return n.View.extend({tagName:"li",className:"ellipsis",initialize:function(){this.bindTo(this.model,"change",this.render,this)},events:{},render:function(){var e=n.host()+"/users/"+n.currentUser.id+"/go_to_community?tibbr_server_url="+this.model.get("guid");return this.model.set("go_to_community",e,{silent:!0}),this.$el.html(this.renderTemplate(i)),this.model.get("badge")&&this.model.get("badge")>0&&this.$(".info").append('<span class="badges">'+this.model.get("badge")+"</span></a>"),this}})}),define("hbs!templates/home/section_list",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var r="",i;return r+="\n            <p>",(i=n.sub_header)?i=i.call(e,{hash:{},data:t}):(i=e&&e.sub_header,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+"</p>\n        ",r}function h(e,t){var r="",i;r+='\n        <div class="action-links">\n            ',i=n.each.call(e,e&&e.action_items,{hash:{},inverse:f.noop,fn:f.program(4,p,t),data:t});if(i||i===0)r+=i;return r+="\n        </div>\n        ",r}function p(e,t){var r="",i;return r+='\n            <a class="mrxl ',(i=n.jClass)?i=i.call(e,{hash:{},data:t}):(i=e&&e.jClass,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+'" title="',(i=n.title)?i=i.call(e,{hash:{},data:t}):(i=e&&e.title,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+'"><i class="ui-inline-icon ',(i=n.iconClass)?i=i.call(e,{hash:{},data:t}):(i=e&&e.iconClass,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+'"></i><span>',(i=n.name)?i=i.call(e,{hash:{},data:t}):(i=e&&e.name,i=typeof i===u?i.call(e,{hash:{},data:t}):i),r+=a(i)+"</span></a>\n            ",r}function d(e,t){return'\n            <div class="search-box lfloat">\n                <form method="get" action="">\n                    <fieldset><input type="text" class="search-string" placeholder="Search">\n                        <button type="submit" title="Search" class="search-btn"></button>\n                    </fieldset>\n                </form>\n            </div>\n        '}function v(e,t){var r="",i,s;return r+='\n    <a href="',s={hash:{},data:t},r+=a((i=n.url||e&&e.url,i?i.call(e,(i=e&&e.explore,i==null||i===!1?i:i.link),s):l.call(e,"url",(i=e&&e.explore,i==null||i===!1?i:i.link),s)))+'" class="btn mtm rfloat js-explore"><span>'+a((i=(i=e&&e.explore,i==null||i===!1?i:i.text),typeof i===u?i.apply(e):i))+'</span>\n        <i class="ui-inline-icon arrow-next"></i>\n    </a>\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this,l=n.helperMissing;s+='<div class="flyout-header clearfix">\n    <div class="lfloat">\n        <h4>',(o=n.header)?o=o.call(t,{hash:{},data:i}):(o=t&&t.header,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+"</h4>\n        ",o=n["if"].call(t,t&&t.sub_header,{hash:{},inverse:f.noop,fn:f.program(1,c,i),data:i});if(o||o===0)s+=o;s+='\n    </div>\n    <div class="clearfix rfloat">\n        ',o=n["if"].call(t,t&&t.action_items,{hash:{},inverse:f.noop,fn:f.program(3,h,i),data:i});if(o||o===0)s+=o;s+="\n        ",o=n["if"].call(t,t&&t.has_search,{hash:{},inverse:f.noop,fn:f.program(6,d,i),data:i});if(o||o===0)s+=o;s+='\n    </div>\n</div>\n<ul class="search-results-list hidden js-search-list"></ul>\n<ul class="default-list js-list"></ul>\n',o=n["if"].call(t,t&&t.explore,{hash:{},inverse:f.noop,fn:f.program(8,v,i),data:i});if(o||o===0)s+=o;return s+='\n<p><span class="default-status"></span></p>\n',s})}),define("views/home/section_list",["jquery","underscore","tibbr","hbs!templates/home/section_list"],function(t,n,r,i){return r.View.extend({className:"quick-search fly-out",header:"Missing Header ?",attributes:{style:"width: 540px;"},listClassName:"",render:function(){return this.$el.html(this.renderTemplate(i,{header:this.header,sub_header:this.sub_header,has_search:this.has_search,action_items:this.action_items,explore:this.explore})),this.$el.addClass(this.type),this.$("ul.js-list").addClass(this.listClassName),this.buildList(),this},buildList:function(){this.$("ul.js-list").empty();if(!(this.collection.length>0))return!0;this.collection.each(function(e){var t=this.buildModel(e);t&&this.$("ul.js-list").append(this.initChild(this.itemView,{model:t}).render().el)},this)},buildModel:function(e){return e}})}),define("hbs!templates/home/community_success",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=n.helperMissing;return s+='<div class="community-success-wrap">\n    <p><b>'+f((o=(o=t&&t.model,o==null||o===!1?o:o.name),typeof o===a?o.apply(t):o))+"</b>",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.has_been_added",u):l.call(t,"t","home.left_menu.has_been_added",u)))+'</p>\n    <a class="btn btn-primary" href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'">\n        <span>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.go_to_community",u):l.call(t,"t","home.left_menu.go_to_community",u)))+'</span>\n        <span class="ui-inline-icon arrow-next"></span>\n    </a>\n</div>',s})}),define("views/home/community_success",["jquery","underscore","tibbr","hbs!templates/home/community_success"],function(e,t,n,r){return n.View.extend({render:function(){return this.$el.html(this.renderTemplate(r,{model:this.model})),this}})}),define("hbs!templates/home/community_add",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<p class="community-context mbl">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.connect_to_community_from_below",u):a.call(t,"t","home.left_menu.connect_to_community_from_below",u)))+'</p>\n\n<a class="js-community-select"></a>\n        <span class="js-no-community-found"></span>\n\n<p class="connect-btn mtl">\n	<a data-type="<i class=\'ui-inline-icon success-icon\'></i>" title="Connect" class="btn btn-primary new-community-link js-new-community-link">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.connect_cummunity",u):a.call(t,"t","home.left_menu.connect_cummunity",u)))+' <span class="ui-inline-icon arrow-next"></span></a>\n</p>\n',s})}),define("hbs!templates/home/community_dropdown_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<span class="lfloat">\n<i class="ui-inline-icon community-notifications"></i>\n<span>',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t&&t.title,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+"</span>\n</span>\n<small>",(o=n.url)?o=o.call(t,{hash:{},data:i}):(o=t&&t.url,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+"</small>\n",s})}),define("views/home/community_add",["jquery","underscore","tibbr","modules/dialog","modules/tags/select","views/home/community_success","hbs!templates/home/community_add","hbs!templates/home/community_dropdown_item"],function(e,t,n,r,i,s,o,u){return n.View.extend({className:"connect-new-communities-dialog",initialize:function(){this.currentCommunity="",n.Event.bindTo(this,"community:success",this.CommunitySuccess),this.communityWindow={}},events:{"click .js-new-community-link":"addNewCommunity"},render:function(){return this.$el.html(this.renderTemplate(o,{})),this.renderCommunityList(),this},renderCommunityList:function(){var e=this;if(this.collection.models.length>0){var n=t.map(this.collection.models,function(e){return{text:e.get("name"),model:e,value:e.get("guid"),storeKey:"comunity_add_select_item_list"}}),r=this.initChild(i,{tmpl:'<a class="custom-select-box default-value js-default-value clearfix">                        <span class="lfloat community-title">                    <i class="ui-inline-icon community-notifications"></i><span class="link" title="">{{data.text}}</span>                    </span>                        <small>{{data.value}}</small>                        <button><i class="ui-inline-icon arrow-down"></i></button>                    </a><ul class="js-dropdown custom-dropdown hidden"></ul>',itemTmp:'<li class="{{uid}}">                      <a class="clearfix" title="{{text}}">                        <span class="lfloat">                            <i class="ui-inline-icon community-notifications"></i>                             <span>{{text}}</span>                             </span>                          <small>{{value}}</small>                            </a>                              </li>',onDefaultValueChange:function(e,t){t.find("small").text(e.value),t.find(".link").html(e.text)},className:"custom-dropdown-container",storeKey:"comunity_add_select_box",selectedOptionHide:!0,onClickHide:!1,qtipClassName:"qtip-light custom-dropdown-tooltip add-community-dropdown",selectedIcon:this.selectIcon,options:n,setWidth:!0}).on("change",function(t,n){e.communitySelected(t)});this.communitySelected(n[0]),this.$(".js-no-community-found").html(""),this.$(".js-community-select").replaceWith(r.render().el)}else this.$(".js-no-community-found").html("<p>"+this.t("home.left_menu.no_communities_found")+"</p>"),this.$(".connect-btn").hide()},addNewCommunity:function(e){e.preventDefault(),this.communityWindow=window.open(this.currentCommunity,"communityConnect","width=1000,height=500,menubar=no,resizable=no,titlebar=no")},CommunitySuccess:function(e){this.communityWindow.close(),this.dialog.close(),n.data.clear("communities"),n.data.clear("all_communities"),r.render(s,{model:e,dialog:{title:this.t("home.left_menu.success"),width:600,max_height:350,position:["top",100]}})},communitySelected:function(e){this.currentCommunity=n.host()+"/oauth/authorizations/authorize?client_id="+e.model.id+"&url_type=enable_community"}})}),define("hbs!templates/home/community_manage_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<td class="title">\n    <img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/community-icon.png",u):a.call(t,"imagePath","images/community-icon.png",u)))+'">\n    <span>',u={hash:{},data:i},s+=f((o=n.truncate||t&&t.truncate,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.name),30,u):a.call(t,"truncate",(o=t&&t.model,o==null||o===!1?o:o.name),30,u)))+'</span>\n</td>\n<td class="url">\n    ',u={hash:{},data:i},s+=f((o=n.truncate||t&&t.truncate,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.guid),30,u):a.call(t,"truncate",(o=t&&t.model,o==null||o===!1?o:o.guid),30,u)))+'\n</td>\n<td class="action">\n    <a class="js-community-remove">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.remove_community",u):a.call(t,"t","home.left_menu.remove_community",u)))+"</a>\n</td>",s})}),define("views/home/community_manage_item",["jquery","underscore","tibbr","modules/dialog","modules/common/views/dialog/confirm","hbs!templates/home/community_manage_item"],function(e,t,n,r,i,s){return n.View.extend({tagName:"tr",events:{"click .js-community-remove":"removeAction"},render:function(){return this.$el.html(this.renderTemplate(s,{})),this},removeAction:function(e){var t=this;e.preventDefault(),(new i({title:this.t("home.left_menu.confirm_remove"),message:this.t("home.left_menu.confirm_remove_message"),ok:function(){t.callServerToRemove()}})).show()},callServerToRemove:function(){var e=this;this.ajax({url:"users/"+n.currentUser.id+"/disable_community",method:"PUT",data:{community_id:e.model.get("id")}}).done(function(t){e.$el.remove(),n.Event.trigger("community:removed")}).fail(function(e){r.alert({text:e.statusText})})}})}),define("hbs!templates/home/community_manage",["handlebars"],function(e){return e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'    <table>\n        <tbody class="js-community-list">\n        </tbody>\n    </table>\n'})}),define("views/home/community_manage",["jquery","underscore","tibbr","modules/dialog","views/home/community_manage_item","hbs!templates/home/community_manage"],function(e,t,n,r,i,s){return n.View.extend({className:"manage-communities-dialog",initialize:function(){n.Event.bindTo(this,"community:removed",this.communityRemoved)},events:{},render:function(){var e=this;this.$el.html(this.renderTemplate(s,{}));if(this.collection.models.length>0)this.collection.each(function(t){e.$(".js-community-list").append(e.initChild(i,{model:t}).render().el)});else{var t="<tr><td>"+this.t("home.left_menu.no_communities_found")+"</td></tr>";e.$(".js-community-list").append(t)}return this},communityRemoved:function(){if(this.$(".js-community-list tr").length===0){var e="<tr><td>"+this.t("home.left_menu.no_communities_found")+"</td></tr>";this.$(".js-community-list").append(e)}n.data.clear("communities"),n.data.clear("all_communities")}})}),define("views/home/community_list",["jquery","underscore","tibbr","modules/dialog","collections/my_communities","collections/communities","collections/community_notifications","views/home/community_item","views/home/section_list","views/home/community_add","views/home/community_manage"],function(e,t,n,r,i,s,o,u,a,f,l){return a.extend({attributes:{style:"width:470px"},className:"quick-search fly-out communities",initialize:function(){this.collection=new i,this.allcollection=new s,this.header=this.t("home.left_menu.communities"),this.action_items=[{jClass:"add-community-link",iconClass:"add-icon",title:this.t("home.left_menu.connect_title"),name:this.t("home.left_menu.connect")},{jClass:"manage-community-link",iconClass:"manage-icon",title:this.t("home.left_menu.manage_title"),name:this.t("home.left_menu.manage")}],this.itemView=u},events:{"click .add-community-link":"showAdd","click .manage-community-link":"showManage"},buildBadges:function(){var e=this;t.each(n.CommunityNotifications,function(t){e.collection.get(t.community_id).set("badge",t.community_badges&&t.community_badges.badges?t.community_badges.badges.unread:0)})},callBadges:function(){var e=this;if(!n.CommunityNotifications){var t=new o;t.scopeId=n.currentUser.id,t.getOrFetch({cacheKey:"communities-notifications",data:{params:{per_page:99}}}).done(function(t){n.CommunityNotifications=t,e.buildBadges()})}else e.buildBadges()},showAdd:function(e){e.preventDefault();var t=this.allcollection,i=this;t.scopeId=n.currentUser.id,t.getOrFetch({cacheKey:"all_communities",data:{params:{app_type:"community",per_page:99}}}).done(function(){r.render(f,{dialog:{title:i.t("home.left_menu.connect_to_community"),width:640,max_height:600,position:["top",100]},collection:t})})},showManage:function(e){e.preventDefault();var t=this.collection;r.render(l,{dialog:{title:this.t("home.left_menu.manage_community"),width:640,max_height:600,position:["top",100]},collection:t})},render:function(){var e=this.collection,t=this;return e.scopeId=n.currentUser.id,e.getOrFetch({cacheKey:"communities",data:{params:{per_page:99}}}).done(function(){e.length>0&&t.callBadges(),a.prototype.render.call(t)}),this}})}),define("hbs!templates/home/quick_search",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){return"js-favorite-list "}function d(e,t){return"js-default-list"}function v(e,t){var r="",i,s;return r+='\r\n    <div class="flyout-header clearfix js-no-search">\r\n        <div class="lfloat">\r\n            <p>',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"user.my_subjects_tab",s):f.call(e,"t","user.my_subjects_tab",s)))+'</p>\r\n        </div>\r\n    </div>\r\n    <ul class="js-default-list default-list js-no-search"></ul>\r\n',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<div class="flyout-header clearfix">\r\n    <div class="lfloat">\r\n        <h4>',(o=n.mainTitle)?o=o.call(t,{hash:{},data:i}):(o=t&&t.mainTitle,o=typeof o===c?o.call(t,{hash:{},data:i}):o),s+=l(o)+'</h4>\r\n\r\n        <p class="js-no-search">',(o=n.title)?o=o.call(t,{hash:{},data:i}):(o=t&&t.title,o=typeof o===c?o.call(t,{hash:{},data:i}):o),s+=l(o)+'</p>\r\n    </div>\r\n    <div class="rfloat clearfix">\r\n        <div class="search-box lfloat">\r\n            <form method="get" action="">\r\n                <fieldset>\r\n                    <input type="text" class="search-string js-quick-search-string" placeholder="',(o=n.placeHolder)?o=o.call(t,{hash:{},data:i}):(o=t&&t.placeHolder,o=typeof o===c?o.call(t,{hash:{},data:i}):o),s+=l(o)+'"/>\r\n                    <button type="submit" title="',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"common.search",a):f.call(t,"t","common.search",a)))+'" class="search-btn"></button>\r\n                </fieldset>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>\r\n<ul class="js-search-results-list default-list hidden"></ul>\r\n<ul class="',u=n["if"].call(t,t&&t.has_favorites,{hash:{},inverse:h.program(3,d,i),fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+=' js-no-search default-list"></ul>\r\n',u=n["if"].call(t,t&&t.has_favorites,{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;return s+='\r\n\r\n<a href="',a={hash:{},data:i},s+=l((o=n.url||t&&t.url,o?o.call(t,(o=t&&t.explore,o==null||o===!1?o:o.link),a):f.call(t,"url",(o=t&&t.explore,o==null||o===!1?o:o.link),a)))+'" class="btn mtm rfloat js-explore"><span>'+l((o=(o=t&&t.explore,o==null||o===!1?o:o.text),typeof o===c?o.apply(t):o))+'</span>\r\n    <i class="ui-inline-icon arrow-next"></i>\r\n</a>\r\n<p><span class="default-status"> </span></p>',s})}),define("hbs!templates/home/quick_search_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='<li class="ellipsis js-item"  href="',u={hash:{},data:i},s+=f((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,u):a.call(t,"urlFor","show",t&&t.model,u)))+'">\n    <div class="media-box" title="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.display_name),typeof o===l?o.apply(t):o))+'">\n		<a href="',u={hash:{},data:i},s+=f((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,u):a.call(t,"urlFor","show",t&&t.model,u)))+'">\n		<img src="',u={hash:{},data:i},s+=f((o=n.assetImage||t&&t.assetImage,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.subject_image_url),"small",u):a.call(t,"assetImage",(o=t&&t.model,o==null||o===!1?o:o.subject_image_url),"small",u)))+'" class="subject-pic bordered"></a>\n		<a href="',u={hash:{},data:i},s+=f((o=n.urlFor||t&&t.urlFor,o?o.call(t,"show",t&&t.model,u):a.call(t,"urlFor","show",t&&t.model,u)))+'">',u={hash:{},data:i},s+=f((o=n.truncate||t&&t.truncate,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.display_name),15,u):a.call(t,"truncate",(o=t&&t.model,o==null||o===!1?o:o.display_name),15,u)))+'</a>\n		<p class="stats">',u={hash:{count:t&&t.count},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"subject.followers_count",u):a.call(t,"t","subject.followers_count",u)))+"</p>\n	</div>\n</li>",s})}),define("views/home/quick_search",["jquery","underscore","tibbr","collections/users_search","collections/subjects_search","hbs!templates/home/quick_search","hbs!templates/home/quick_search_item"],function(e,t,n,r,i,s,o){return n.View.extend({className:"quick-search fly-out",attributes:{style:"width:570px"},events:{"keyup .search-string":"keyup","click li.js-item":"navigate","click .search-btn":"keyup","keypress .search-string":"keypress"},initialize:function(){var e=n.currentUser;this.timeout=null,this.lastSearchStr=" ",this.isSubject=this.id==="quick-search-subjects",this.hasFavorites=this.isSubject&&n.currentUser.favoriteSubjects.length>0,this.isSubject?(this.defaultCollection=new i([],{tibbrURL:"/users/"+e.id+"/frequently_visited_subjects",cacheKey:"frequently_visited_subjects",dataParams:{params:{per_page:6,page:1}}}),this.params={params:{page:(this.current_page||0)+1,include_self:!0,search_str:"",subscribers:e.id,per_page:6,order_by:"messages_count"}},this.collection=new i,this.explore={text:this.t("home.explore.subjects"),link:"/subjects/"}):(this.defaultCollection=new r([],{tibbrURL:"/users/"+e.id+"/frequently_visited_users",cacheKey:"frequently_visited_users",dataParams:{params:{per_page:6,page:1}}}),this.params={params:{page:(this.current_page||0)+1,per_page:6,connections_of:e.id}},this.collection=new r,this.explore={text:this.t("home.explore.people"),link:"/explore/"}),this.collection.scopeId=e.id,this.bindTo(this.collection,"reset",this.populateSearchList,this)},render:function(){var e=this.isSubject?this.hasFavorites?this.t("user.my_favorite_tab"):this.t("user.my_subjects_tab"):this.t("user.my_favorite_people"),t=this.isSubject?this.t("home.left_menu.subjects"):this.t("home.left_menu.people"),r=this.isSubject?this.t("user.export_subjects"):this.t("user.export_people"),i=this.isSubject?this.t("user.my_subjects_search"):this.t("user.my_people_search"),o=this.isSubject?"subjects/directory":"explore/people_directory";return this.$el.html(this.renderTemplate(s,{title:e,is_subject:this.isSubject,has_favorites:this.hasFavorites,mainTitle:t,exportLink:r,placeHolder:i,explore:this.explore})),this.$("a.js-link").attr("href",n.url(o)),this.populateDefaultList(),this},keyup:function(t){switch(t.keyCode){case 40:case 38:break;case 9:case 13:this.submit();break;case 27:e(".search-string").html(""),e(".qtip").qtip("hide");break;default:this.search()}t.stopPropagation(),t.preventDefault()},keypress:function(e){switch(e.keyCode){case 9:case 13:case 27:e.preventDefault();break;case 38:e.preventDefault(),this.prev();break;case 40:e.preventDefault(),this.next()}e.stopPropagation()},search:function(){var e=this.$("span.search-status"),r=t.str.trim(this.$("input.search-string").val()),i=t.str.trim(this.lastSearchStr),s=this.collection,o={params:{per_page:6,search_str:r}},u=this.timeout;r!=i&&r.length!==0&&r!=this.t("common.search")?(u&&clearTimeout(u),this.timeout=setTimeout(function(){e.html(n.UI.spinner),s.fetch({data:o})},1e3)):(r.length===0||r===this.t("common.search"))&&this.populateDefaultList()},submit:function(){console.log("search page will be shown")},populateDefaultList:function(){this.$("span.default-status").html(""),this.$("span.search-status").first().html("");var e=this.$(".js-default-list").empty();this.hasFavorites&&this.appendItems(n.currentUser.favoriteSubjects,this.$(".js-favorite-list").empty()),this.$(".js-search-results-list").empty().addClass("hidden"),this.$(".js-no-search").removeClass("hidden");var t=this;this.defaultCollection.getOrFetch({beforeSend:function(){t.$("span.default-status").append(loader)}}).done(function(){t.appendItems(t.defaultCollection,e)}).always(function(){t.$(".line-loader").remove()})},populateSearchList:function(){this.$("span.default-status").html("");var e=t.str.trim(this.$("input.search-string").first().val());this.$("span.search-status").first().html("");var n=this.$(".js-search-results-list").empty();this.$(".js-no-search").addClass("hidden"),e.length===0?this.appendItems(this.collection,n):this.appendItems(this.collection,n)},appendItems:function(e,t){var n=this,r;e.length>0?(e.each(function(e){r=n.id==="quick-search-subjects"?e.get("subscribers_count"):e.get("followers_count"),e.get("modelType")==="User"&&e.set("subject_image_url",e.get("profile_image_url"),{silent:!0}),t.append(n.renderTemplate(o,{model:e,count:r}))}),t.removeClass("no-result")):t.html(this.t("subject.emptyText")).addClass("no-result"),t.removeClass("hidden"),this.options.$container&&this.options.$container.height(this.$el.height()+100)},navigate:function(t){var r=e(t.currentTarget);n.redirectTo(r.attr("href"))}})}),define("models/filter",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{modelType:"Filter"},initialize:function(){e.bindAll(this,"image","showUrl","badge")},image:function(){return this._path("images/my_streams/"+this.get("type")+".gif")},showUrl:function(){return this.get("url")?this.get("url"):this._url("messages/"+this.get("type")+"/filters/"+encodeURI(this.get("name")))},badge:function(){return this.get("type")==="my_wall"?t.currentUser.get("badges").unread:this.get("type")==="private"?t.currentUser.get("badges").private_unread:!1},appName:function(){return this.get("type")}})}),define("models/filter_criteria",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{cfield:"keywords",cvalue:"",coperator:"equal_to"},initialize:function(){e.bindAll(this,"value")},value:function(){return this.get("criteria_entity")?this.get("criteria_entity").display_name:this.get("cvalue")},date:function(){var e=this.get("cvalue");return e=e.split(" ")[0].split("-"),new Date(e[0],e[1]-1,e[2])}})}),define("collections/filter_criterias",["tibbr","models/filter_criteria"],function(e,t){return e.Collection.extend({className:"FiltersCriteria",model:t,getFromType:function(e,t){return this.filter(function(n){return t?n.get("cfield")===e&&n.get("coperator")===t:n.get("cfield")===e})},userTo:function(){var e=this.detect(function(e){return e.get("cfield")==="to_user"});return e&&e.get("should_destroy")&&(this.remove(e),e=undefined),e},criteriaEntityIds:function(e){return _.map(this.getFromType(e),function(e){return e.get("criteria_entity_id")})}})}),define("models/message_filter",["underscore","tibbr","models/filter","collections/filter_criterias"],function(e,t,n,r){return n.extend({defaults:{modelType:"MessageFilter"},baseName:"message_filters",initialize:function(){e.bindAll(this,"showUrl","image","manageUrl"),this.set({type:this.get("id")}),this.criterias=new r(this.get("criterias"))},cssClassName:"message-filter-link",showUrl:function(){return this._url("messages/"+this.id+"/filters/"+encodeURI(this.get("name")))},image:function(){return this._path("images/my_streams/default.gif")},manageUrl:function(){return this._url("filters/manage")},create:function(e,t){var n=this,i=JSON.stringify({message_filter:{name:e,criterias:t}});this.action("","create",{data:i,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")},success:function(e){e.set("type",e.get("id")),n.trigger("create",e),n.criterias=new r(n.get("criterias"))},error:function(e){n.trigger("error",n.parseError(e))}})},update:function(e,t){var n=this,i=JSON.stringify({message_filter:{name:e,criterias:t}});this.action("","update",{data:i,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")},complete:function(t){t.status===200?(n.set("name",e),n.trigger("updated",n),n.criterias=new r(n.get("criterias"))):n.trigger("error",n.parseError(t))}})},for_template:{showUrl:"showUrl"}})}),define("collections/message_filters",["tibbr","models/message_filter"],function(e,t){return e.Collection.extend({className:"filters",tibbrURL:{controller:"users",action:"message_filters"},model:t})}),define("views/home/filter_item",["jquery","underscore","tibbr","modules/common/views/messages/filters"],function(e,t,n,r){return n.View.extend({tagName:"li",className:"ellipsis",tmpl:'                <div class="media-box js-item">                     <a title="{{model.name}}" href="{{model.showUrl}}"><img  src="{{model.image}}" ></a>                    <div class="info">                        <a href="{{model.showUrl}}" title=""><span class="v-align">{{model.name}}</span></a>                    </div>                </div>',events:{"click a":"link","click .js-item":"navigate"},render:function(){return this.$el.html(this.renderInLineTemplate(this.tmpl)),this},link:function(t){return n.currentNav!=="home"?!0:(n.app.navigate(e(t.currentTarget).attr("href"),!1),n.application.removeClientSteam(),e(".qtip").qtip("hide"),this.initChild(r).renderMessage({id:this.model.id,text:this.model.get("name")}),!1)},navigate:function(e){e.preventDefault(),n.redirectTo(this.model.showUrl())}})}),define("text!templates/filters/criteria_list.html",[],function(){return'${model.value}\n<a class="close-btn js-remove">X</a>\n'}),define("views/filters/criteria_list",["jquery","underscore","tibbr","text!templates/filters/criteria_list.html"],function(e,t,n,r){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render"),this.$el.html(this.template.render(r,{model:this.model}))},events:{"click a.js-remove":"close"},close:function(){this.remove(),this.model.isNew()?this.collection.remove(this.model):this.model.set("should_destroy",!0)}})}),define("text!templates/filters/criteria_options.html",[],function(){return'<div class="stream-filter-by ${type}">\n    <h4>${t(\'home.filters.\'+type)}</h4>\n    <label for="add-keywords">${t(\'home.filters.add_\'+type)}</label>\n\n    {{if type === "keywords" }}\n    <input type="text" maxlength="50" size="30" class="filter_text_type" name="add-keywords"\n           placeholder="${t(\'home.filters.placeholder\')}" id="add-keywords">\n    <a class="btn btn-submit filter-add">${t(\'home.filters.add\')}</a>\n    <p class="hint">${t(\'home.filters.enter_the_keywords_and_customize\')}</p>\n    {{else}}\n    <fieldset class="auto-suggest"></fieldset>\n    {{/if}}\n</div>\n<div class="current-list-wrap">\n  <p>${t(\'home.filters.current_list\')}</p>\n  <ul id="current_list_${type}" class="current-list"></ul>\n</div>'}),define("views/filters/criteria_options",["jquery","underscore","tibbr","models/filter_criteria","collections/filter_criterias","views/filters/criteria_list","modules/common/views/common/auto_suggest","text!templates/filters/criteria_options.html","modules/dialog"],function(e,t,n,r,i,s,o,u,a){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render"),this.criterias=this.model.criterias,this.type=this.options.type||"keywords",this.coperator=this.options.coperator,this.bindTo(this.criterias,"add",this.renderKeyWords,this),this.bindTo(this.criterias,"change",this.renderKeyWords,this),this.bindTo(this.criterias,"remove",this.updateExcludeValues,this)},events:{"click .filter-add":"addKeyWord"},render:function(){return e(this.el).html(this.template.render(u,{model:this.model,type:this.type})),this.renderKeyWords(),this.renderAutoSuggest(),this},addKeyWord:function(t){var i=e(t.target),s=i.parent().find("input");if(s.val().length===0)a.alert({text:n.translate("home.filters.error_add_keyword")});else if(this.validateMaxNumberOfKeywords()){var o=this.criterias.detect(function(e){return e.get("cvalue")===s.val()});if(o)a.alert({text:n.translate("home.filters.same_keyword")});else{var u=new r({cvalue:s.val()});this.criterias.add(u),s.val("")}}},validateMaxNumberOfKeywords:function(){if(this.type==="keywords"){var e=this.criterias.getFromType("keywords"),t=n.appConfig("ui_config","config","max_filters_keywords")||10;return e.length===t?(a.alert({text:this.t("home.filters.keywords_limit_reached",{count:t})}),!1):!0}return!0},addCriteria:function(e){this.autoSuggest&&this.autoSuggest.closeAll();var t=new r({cvalue:e.value,cfield:this.type,coperator:this.coperator,criteria_entity:{display_name:e.caption}});return this.criterias.add(t),!1},updateExcludeValues:function(){this.autoSuggest&&(this.autoSuggest.excludeUsers=t.compact(t.map(this.criterias.getFromType("owner"),function(e){if(e.get("should_destroy")!==!0)return e.get("cvalue")})),this.autoSuggest.excludeSubjects=t.compact(t.map(this.criterias.getFromType("subject"),function(e){if(e.get("should_destroy")!==!0)return e.get("cvalue")})))},renderAutoSuggest:function(){if(this.type==="keywords")return;var e=this.type==="subject"?"subjects":"users";this.autoSuggest=this.initChild(o,{attributes:{name:"input-"+this.type+"-"+this.coperator},params:{type:e,value_type:"id",exclude_type:"id"}}),this.autoSuggest.excludeUsers=t.map(this.criterias.getFromType("owner"),function(e){return e.get("cvalue")}),this.autoSuggest.excludeSubjects=t.map(this.criterias.getFromType("subject"),function(e){return e.get("cvalue")}),this.bindTo(this.autoSuggest,"added",this.addCriteria,this),this.$(".auto-suggest").html(this.autoSuggest.render().el)},bind:function(){this.autoSuggest&&this.autoSuggest.bind()},renderKeyWords:function(){var e=this,n=e.$("#current_list_"+this.type).empty(),r=this.criterias.getFromType(this.type,this.coperator);t.each(r,function(t){!t.get("should_destroy")==1&&n.append(e.initChild(s,{model:t,collection:e.criterias}).render().el)}),this.updateExcludeValues()}})}),define("text!templates/filters/datepicker.html",[],function(){return'<span class="label">${label}: </span><input type="text" size="8"  name="${model.get(\'coperator\')}" class ="${model.get(\'coperator\')}"   />'}),define("views/filters/datepicker",["jquery","underscore","tibbr","models/filter_criteria","collections/filter_criterias","text!templates/filters/datepicker.html","require/moment"],function(e,t,n,r,i,s,o){return n.View.extend({tagName:"span",className:"date",initialize:function(){t.bindAll(this,"render","add")},events:{},render:function(){var e="",n=this.model.get("coperator");return n==="not_greater_than"||n==="greater_than"?e=this.t("home.filters.start_date"):e=this.t("home.filters.end_date"),this.$el.html(this.template.render(s,{model:this.model,collection:this.collection,label:e})),this.$("input").datepicker({onSelect:this.add,dateFormat:"yy-mm-dd"}),t.isEmpty(this.model.get("cvalue"))||this.$("input").datepicker("setDate",this.model.date()),this},add:function(e,n){this.$(".greater_than ")&&this.limitDate(e),this.$(".not_greater_than ")&&this.limitNotDate(e);if(!t.isEmpty(e)){this.model.set("cvalue",e);try{this.collection.add(this.model)}catch(r){console.log(r)}}this.$el.click()},limitDate:function(t){var n=t.split("-"),r=new Date(n[0],n[1]-1,n[2]);r.setDate(r.getDate()),e(".less_than").datepicker("option",{minDate:r})},limitNotDate:function(t){var n=t.split("-"),r=new Date(n[0],n[1]-1,n[2]);r.setDate(r.getDate()),e(".not_less_than").datepicker("option",{minDate:r})}})}),define("text!templates/filters/time_criteria.html",[],function(){return'<div class="wrap time-filter stream-filter-by ${coperator}">\n        <h4>${t(\'home.filters.time\')}</h4>\n        <p>\n            <label>\n                <input type="radio"  name="time_filter_${coperator}" class="radio chronological" checked="checked" value="0">\n                <span>${t(\'home.filters.chronological\')}</span>\n            </label>\n        </p>\n        <p>\n            <label class="dates">\n                <input type="radio" name="time_filter_${coperator}" class="radio custom" value="1">\n                <span>${t(\'home.filters.time_period\')}</span>\n            </label>\n        </p>\n</div>\n<div class="current-list-wrap"></div>'}),define("views/filters/time_criteria",["jquery","underscore","tibbr","models/filter_criteria","collections/filter_criterias","views/filters/datepicker","text!templates/filters/time_criteria.html","require/moment"],function(e,t,n,r,i,s,o,u){return n.TimeCriteriaView=n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render"),this.type=this.options.type,this.coperator=this.options.coperator,this.criterias=this.model.criterias;var e=this.criterias.getFromType(this.type,this.coperator+"greater_than")[0]||new r({cfield:this.type,coperator:this.coperator+"greater_than"}),n=this.criterias.getFromType(this.type,this.coperator+"less_than")[0]||new r({cfield:this.type,coperator:this.coperator+"less_than"});this._criterias=new i([e,n]),this.isNew=e.isNew()&&n.isNew()},events:{"click input.radio":"changeSelection"},render:function(){return this.$el.html(this.template.render(o,{model:this.model,coperator:this.coperator,criterias:this._criterias})),this.isNew||this.$("input.radio.custom").attr("checked","checked"),this.renderDates(),this},renderDates:function(){var e=this;this._criterias.each(function(t){e.$el.find(".dates").append(e.initChild(s,{model:t,collection:e.criterias}).render().el)})},changeSelection:function(t){var n=e(t.currentTarget),r=this;n.hasClass("chronological")?this.isNew?this._criterias.each(function(e){r.criterias.remove(e)}):this._criterias.each(function(e){e.set("should_destroy",!0)}):this.isNew||this._criterias.each(function(e){e.set("should_destroy",!1)})}})}),define("text!templates/filters/app_filter.html",[],function(){return'<label><input type="checkbox" class="radio js-source-type ">${ model.get("name")}</label>\n'}),define("views/filters/app_filter",["jquery","underscore","tibbr","models/filter_criteria","text!templates/filters/app_filter.html"],function(e,t,n,r,i){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render","updateOrCreate");var e=this;this.criterias=this.options.criterias,this.criteria=this.criterias.find(function(t){return t.get("cvalue")===e.model.get("mtypes")})||new r({cfield:"mtype",cvalue:this.model.get("mtypes")})},events:{"change input.js-source-type":"updateOrCreate"},render:function(){return this.$el.html(this.template.render(i,{model:this.model})),this.$("input.js-source-type").prop("checked",this.criteria.id>0),this},updateOrCreate:function(e){var t=this.$("input.js-source-type");t.is(":checked")?this.criterias.add(this.criteria):this.criteria.isNew()?this.criterias.remove(this.criteria):this.criteria.set("should_destroy",!0)}})}),define("views/filters/app_filters",["jquery","underscore","tibbr","views/filters/app_filter"],function(e,t,n,r){return n.View.extend({tagName:"ul",className:"source-options",initialize:function(){t.bindAll(this,"render")},render:function(){var e=this;return t.each(n.currentUser.subscribedFilters.servers(),function(t){e.$el.append(e.initChild(r,{model:t,criterias:e.options.criterias}).render().el)}),this}})}),define("text!templates/filters/add_filter.html",[],function(){return'\n  <li>\n    <p class="filter-name">\n      <label for="stream-name">${t(\'home.filters.filter_name\')} </label>\n      <input type="text" size="30" name="stream-name" maxlength="50" id="stream-name" value="${model.get(\'name\')}">\n    </p>\n  </li>\n  <li class="filters">\n    <p class="filter-by"> ${t(\'home.filters.filter_by\')}</p>\n    <ul class="keywords-container filter-options"></ul><!-- render function in add_filter.js inserts keywords to this <ul> -->\n    <p id="more-filter">\n      <a style="cursor: pointer">${t(\'home.filters.show_more_filter_opt\')}</a>\n    </p>\n    <ol class="advanced-filter hidden"></ol>\n    <div id="filter-not-matching-post" class="clearb ptm bt hidden">\n      <h3>${t(\'home.filters.filter_not_include_post\')}</h3>\n      <ol class="not-match-filter"></ol>\n    </div>\n  </li>\n  <li class="filter-mywall-option js-app-filters clearb ptm bt" >\n    <h3>${t(\'home.filters.source_type_include\')}</h3>\n  </li>\n\n  <li class="filter-mywall-option">\n    <label for="to_user_messages">\n      <input type="checkbox" data-cvalue="${currentUser.id}" name="to_user_messages" id="to_user_messages" data-cfield="to_user" class="radio js-user-to">\n      ${t(\'home.filters.show_messages_people_i_follow\')}\n    </label>\n  </li>\n  <li class="action">\n    <input type="submit" id="save_filter" class="btn btn-submit" value="${t(\'home.filters.save_filter\')}">\n    <!--<input type="reset" class="reset" value="Cancel" id="cancel_button">-->\n  </li>\n\n\n'}),define("views/filters/add_filter",["jquery","underscore","tibbr","models/message_filter","models/filter_criteria","collections/filter_criterias","views/filters/criteria_options","views/filters/time_criteria","views/filters/app_filters","text!templates/filters/add_filter.html","modules/overlay","modules/dialog"],function(e,t,n,r,i,s,o,u,a,f,l,c){return n.View.extend({tagName:"ol",className:"steps",initialize:function(){t.bindAll(this,"render"),this.criterias=this.model.criterias,this.bindTo(this.model,"create",this.saved,this),this.bindTo(this.model,"updated",this.updated,this),this.bindTo(this.model,"error",this.error,this)},events:{"click input#save_filter":"save","click p#more-filter a":"addMoreOptions","click input#cancel_button":"cancel","change input.js-user-to":"updateUserMessage","blur input#stream-name":"formatStreamName"},render:function(){return this.$el.html(this.template.render(f,{model:this.model})),this.$("#filter-not-matching-post h3").hide(),this.renderCriterias("keywords-container","keywords"),this.renderAppFilters(),this.$(".js-user-to").prop("checked",this.criterias.userTo()),this},renderCriterias:function(e,t,r){r=r||"equal_to";var i=this;this.model.criterias.each(function(e){e.get("should_destroy")&&i.model.criterias.remove(e)});var s=this.$("."+e),u=this.initChild(o,{model:this.model,filters:n.currentUser.subscribedFilters.servers(),type:t,coperator:r});return s.find("."+t).length===0&&s.append(u.render().el),u.bind(),this},renderDateCriterias:function(e,t){this.$(e).append(this.initChild(u,{model:this.model,type:"created_at",coperator:t}).render().el)},formatStreamName:function(t){var n=t.keyCode?t.keyCode:t.which;if(n===37||n===39)return!0;var r=e("#stream-name").val(),i=r.replace(/[\,\;\:\.\!\'\#\$\%\&\*\+\-\/\=\?\^\_\`\{\|\}\~\[\]\(\)\\\@\<\>\"\£]/gi,"_");e("#stream-name").val(i)},save:function(){var e=this.criterias.map(function(e){var t=e.toJSON();return delete t.json_class,delete t.criteria_entity,t}),n=this.$("input#stream-name").val();return this.model.isNew()?t.str.trim(n).length===0?c.alert({text:this.t("home.filters.name_error")}):(this.$("#save_filter").attr("disabled","disabled").after(spinner),this.model.create(n,e)):(this.$("#save_filter").attr("disabled","disabled").after(spinner),this.model.update(n,e)),!1},saved:function(e){this.collection.add(e),this.updated(e)},updated:function(e){c.closeAll(),n.redirectTo("messages/"+e.id+"/filters/"+encodeURIComponent(e.get("name")))},updateUserMessage:function(e){var n=this.$("input.js-user-to"),r=n.data();this.userToCriteria=this.criterias.userTo()||new i(r);if(n.is(":checked")){var s=this.criterias.detect(function(e){return e.get("cfield")==="to_user"});s===undefined&&this.criterias.add(this.userToCriteria),this.userToCriteria.set("should_destroy",!1)}else this.userToCriteria.set("should_destroy",!0),t.isNumber(this.userToCriteria.id)||this.criterias.remove(this.userToCriteria)},renderAppFilters:function(){var e=this.$("ul.source-options");e.length===0&&this.$("li.js-app-filters").append(this.initChild(a,{criterias:this.criterias}).render().el)},addMoreOptions:function(e){return this.$("#more-filter").hide(),this.$("#filter-not-matching-post, .advanced-filter").toggle(),this.$("#filter-not-matching-post h3").show(),this.$(".advanced-filter").find("li").length===0&&(this.renderCriterias("advanced-filter","owner"),this.renderCriterias("advanced-filter","subject"),this.renderDateCriterias(".advanced-filter",""),this.renderCriterias("not-match-filter","owner","not_equal_to"),this.renderCriterias("not-match-filter","subject","not_equal_to"),this.renderDateCriterias(".not-match-filter","not_")),this},cancel:function(){this.dialog.close()},error:function(e){c.alert({text:e[0]}),this.$("#save_filter").removeAttr("disabled","disabled"),this.$(".spinner").remove()}})}),define("text!templates/filters/filter_list_item.html",[],function(){return"<a class=\"edit-filter\" style=\"cursor: pointer\">${model.get('name')}</a>\n{{imageTag 'images/close-btn.png',{'class':'confirm_link_image'} }}"}),define("views/filters/filter_list_item",["jquery","underscore","tibbr","views/filters/add_filter","text!templates/filters/filter_list_item.html","modules/dialog"],function(e,t,n,r,i,s){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render"),this.bindTo(this.model,"change",this.render,this),this.bindTo(this.model,"destroy",this.remove,this),this.$el.html(this.template.render(i,{model:this.model}))},events:{"click a.edit-filter":"editFilter","click img.confirm_link_image":"deleteFilter"},editFilter:function(){return e(".add-filter").show(),this.$el.parent().find(".active").removeClass("active"),this.$el.addClass("active"),e("#form_container").html(this.initChild(r,{model:this.model,collection:this.collection}).render().el),this},deleteFilter:function(t){var r=e(t.target),i=this;s.remove({text:n.translate("home.filters.delete_filter"),okFunction:function(){i.model.destroy({error:function(){},complete:function(e){e.status===200?i.collection.remove(i.model):s.alert({text:e.responseText})}}),e("#form_container").html("")}})}})}),define("text!templates/filters/manage.html",[],function(){return'<div id="manage-filters" class="manage-filters">\n    <h2>${t(\'home.filters.manage_filters\')}</h2>\n    <div class="custom-filters">\n        <p>${t(\'home.filters.click_filters_to_edit\')}</p>\n        <ul id="filters_list" class="custom-filters filters-list"></ul>\n        <p class="add-filter"><a id="add_new_filter" class="btn btn-submit js-add-filter">${t(\'home.filters.add_new_filter\')} <i class="arrow next"></i></a></p>\n    </div>\n    <div id="form_container" class="form-wrap error-wrap"></div>\n</div>\n'}),define("views/filters/manage",["jquery","underscore","tibbr","models/message_filter","views/filters/filter_list_item","views/filters/add_filter","text!templates/filters/manage.html"],function(e,t,n,r,i,s,o){return n.View.extend({id:"manage-filters-wrap",events:{"click a.js-add-filter":"addFilter"},initialize:function(){t.bindAll(this,"render"),this.bindTo(this.collection,"add",this.added,this)},render:function(){this.$el.html(this.template.render(o));var e=this.collection,t=this.$("#filters_list"),n=this;return e.each(function(r){t.append(n.initChild(i,{model:r,collection:e}).render().el)}),this.delegateEvents(),this},addFilter:function(){this.$("#form_container").html(""),this.$("#filters_list").find("li.active").removeClass("active"),e(".add-filter").hide(),this.renderAddFilter()},renderAddFilter:function(){return this.$("#form_container").append(this.initChild(s,{collection:this.collection,model:new r}).render().el),this},added:function(e){this.render(e)}})}),define("views/home/filters_list",["jquery","underscore","tibbr","collections/message_filters","views/home/filter_item","views/filters/manage","modules/dialog","views/home/section_list"],function(t,n,r,i,s,o,u,a){return a.extend({listClassName:"apps-tip-list",type:"filters",initialize:function(){r.currentUser.messageFilters=r.currentUser.messageFilters||(new i)._set(r.currentUser.get("message_filters")),this.collection=r.currentUser.messageFilters,this.bindTo(this.collection,"change",this.render,this),this.bindTo(this.collection,"add",this.render,this),this.bindTo(this.collection,"remove",this.render,this),this.header=this.t("home.left_menu.my_filters"),this.explore={text:this.t("home.left_menu.manage_filters"),link:"filters/manage"},this.itemView=s},events:{"click a.js-explore":"showManage"},render:function(){var e=this.collection,t=this;return e.total_entries>10&&e.length===10?(e.scopeId=r.currentUser.id,e.fetch({data:{params:{per_page:99}},success:function(){t.render()}})):t._super(),this},buildModel:function(e){return e.set("image",r.Helper.imagePath("images/filters-icon.png"),{silent:!0}),e},showManage:function(){t("li.filters.active").removeClass("active"),this.options.parent.hideMenu();var e=r.currentUser.messageFilters;return e.scopeId=r.currentUser.id,e.fetched=!1,u.render(o,{dialog:{width:830,max_height:600,position:["top",100]},collection:e,fetch:e,data:{params:{per_page:99}}}),!1}})}),define("views/home/app_item",["jquery","underscore","tibbr","modules/common/views/messages/filters"],function(e,t,n,r){return n.View.extend({tagName:"li",className:"ellipsis",tmpl:'                <div class="media-box js-item">                     <a title="{{model.name}}" href="{{model.showUrl}}"><img  src="{{model.image}}" ></a>                    <div class="info">                        <a href="{{model.showUrl}}" title=""><span class="v-align">{{model.name}}</span></a>                    </div>                </div>',initialize:function(){t.bindAll(this,"client"),this.options.parent||(this.tmpl='                        <td class="app-details"><div class="media-box">                        <a title="{{model.name}}" href="{{model.showUrl}}" class="img {{model.app_type}} {{model.app_type}}-{{model.id}} profile-pic">                        <img alt="{{model.name}}" src="{{assetImage model.icon_url 1 }}" width="60" height="60" class="large"/></a>                        <div class="info"><h6 class="app-name">{{model.name}}</h6>                        <p class="company-name">{{model.publisher}}</p></div></div></td>                        <td class="date-stamp"><p>{{model.release_date}}</p></td><td class="action-button"></td>',this.setElement("<tr></tr>"))},events:{click:"navigate"},navigate:function(e){var t=this.model;if(t.get("is_meeting"))return!0;e.preventDefault(),this.client()},render:function(){return this.$el.html(this.renderInLineTemplate(this.tmpl)),this},client:function(){var e=this.model,t;this.parent.parent.hideMenu&&this.parent.parent.hideMenu();if(e.urlType("home").length>0){var r=e.urlType("home")[0];return r.get("open_separete")?(r.get("authenticate")?t=r.url():t=r.get("url"),window.open(t,"_blank"),window.focus(),!1):n.redirectTo(n.url("apps",e.id,"launch"))}return n.redirectTo(n.url("apps",e.id,"details"))}})}),define("views/home/app_list",["jquery","underscore","tibbr","views/home/section_list","views/home/app_item"],function(t,n,r,i,s){return i.extend({type:"my-apps",listClassName:"apps-tip-list",initialize:function(){this.bindTo(r.currentUser.subscribedFilters,"change",this.buildList,this),this.bindTo(r.currentUser.subscribedFilters,"add",this.buildList,this),this.bindTo(r.currentUser.subscribedFilters,"remove",this.buildList,this),this.header=this.t("home.left_menu.apps"),this.sub_header=this.t("home.left_menu.my_favorite_apps"),this.explore={text:this.t("home.explore.apps"),link:this.parent.item.link},this.itemView=s,this.collection=r.currentUser.subscribedFilters},buildModel:function(e){return e.urlType("home").length>0?e:null}})}),define("views/home/meeting_list",["jquery","underscore","tibbr","modules/dialog","views/home/section_list","views/home/app_item"],function(t,n,r,i,s,o){return s.extend({type:"my-apps",listClassName:"apps-tip-list",initialize:function(){this.header=this.t("home.left_menu.meetings"),this.sub_header=this.t("home.left_menu.start_a_meeting_now"),this.itemView=o,this.collection=r.currentUser.meetings},events:{"click li":"navigate"},navigate:function(e){e.preventDefault();var n=t(e.currentTarget);t(".qtip").qtip("hide"),this.client(n.find("a").attr("href"))},client:function(e){this.options.parent&&this.options.parent.hideMenu();var n;r.currentSubject&&r.currentSubject.id&&(n="&subject_id="+r.currentSubject.id,e+=n),this.model&&this.model.get("modelType")==="Message"&&(e+="&message_id="+this.model.id),i.closeAll(),i.view(t("<iframe/>").attr({src:e,"class":"client-stream",height:750,width:480}),{width:480,className:"no-title-no-padding"})},buildModel:function(e){return e.set({showUrl:e.urlsType("instant_meeting").url(),is_meeting:!0},{silent:!0}),e}})}),define("views/home/file_item",["jquery","underscore","tibbr"],function(e,t,n){return n.View.extend({tagName:"li",className:"ellipsis js-item",events:{click:"navigate"},tmpl:'                <div class="media-box js-item">                     <a title="{{model.name}}" href="{{url "files/" id=model.guid}}"><img  src="{{model.image}}" ></a>                    <div class="info">                        <a href="{{url "files/" id=model.guid}}" title=""><span class="v-align">{{model.name}}</span></a>                    </div>                </div>',render:function(){return this.$el.html(this.renderInLineTemplate(this.tmpl)),this},navigate:function(e){e.preventDefault(),n.redirectTo("files/?id="+this.model.get("guid"))}})}),define("views/home/files_list",["jquery","underscore","tibbr","views/home/section_list","views/home/file_item"],function(t,n,r,i,s){return i.extend({type:"files-menu",listClassName:"apps-tip-list",initialize:function(){this.header=this.t("home.left_menu.files"),this.sub_header=this.t("home.left_menu.choose_file_app"),this.explore={text:this.t("home.explore.files"),link:this.parent.item.link},this.itemView=s,this.collection=r.currentUser.browseShareApps}})}),define("hbs!templates/home/insight_list",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="flyout-header clearfix">\n    <div class="lfloat">\n        <h4>',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.insight",u):a.call(t,"t","home.left_menu.insight",u)))+'</h4>\n    </div>\n</div>\n<ul class="default-list app-lists insight-lists">\n    <li class="ellipsis js-whats-happening js-item">\n        <div class="media-box">\n            <a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"insight/what_happening",u):a.call(t,"url","insight/what_happening",u)))+'"><img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/sales-icon.png",u):a.call(t,"imagePath","images/sales-icon.png",u)))+'" /></a>\n            <div class="info">\n                <a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"insight/what_happening",u):a.call(t,"url","insight/what_happening",u)))+'" title=""><span class="v-align">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.insight_sections.what_happening",u):a.call(t,"t","home.left_menu.insight_sections.what_happening",u)))+'</span></a>\n            </div>\n        </div>\n    </li>\n    <li class="ellipsis js-leaderboard js-item">\n        <div class="media-box">\n            <a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"insight/leader_board",u):a.call(t,"url","insight/leader_board",u)))+'"><img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/analytics-icon.png",u):a.call(t,"imagePath","images/analytics-icon.png",u)))+'" /></a>\n            <div class="info">\n                <a href="',u={hash:{},data:i},s+=f((o=n.url||t&&t.url,o?o.call(t,"insight/leader_board",u):a.call(t,"url","insight/leader_board",u)))+'" title=""><span class="v-align">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.insight_sections.leader_board",u):a.call(t,"t","home.left_menu.insight_sections.leader_board",u)))+"</span></a>\n            </div>\n        </div>\n    </li>\n</ul>",s})}),define("views/home/insight_list",["jquery","underscore","tibbr","hbs!templates/home/insight_list"],function(e,t,n,r){return n.View.extend({className:"quick-search fly-out",events:{"click li.js-item":"navigate"},attributes:{style:"width: 540px;"},render:function(){return this.$el.html(this.renderTemplate(r)),this},navigate:function(t){t.preventDefault();var r=e(t.currentTarget),i=r.hasClass("js-whats-happening")?"insight/what_happening":"insight/leader_board";n.redirectTo(i)}})}),define("hbs!templates/home/menu_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression;return s+='<a  class="open_'+f((o=(o=t&&t.item,o==null||o===!1?o:o.open),typeof o===a?o.apply(t):o))+'">',(u=n.title)?u=u.call(t,{hash:{},data:i}):(u=t&&t.title,u=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(u)+'<i class="ui-inline-icon right-arrow"></i></a>\n',s})}),define("views/home/menu_item",["jquery","underscore","tibbr","views/home/menu_section_item","views/home/community_list","views/home/quick_search","views/home/filters_list","views/home/app_list","views/home/meeting_list","views/home/files_list","views/home/insight_list","hbs!templates/home/menu_item"],function(e,t,n,r,i,s,o,u,a,f,l,c){return n.View.extend({tagName:"li",initialize:function(){t.bindAll(this,"render","subMenu","title"),this.item=this.options.item},events:{"click a.has-sub-nav":"subMenu","click a.open_iframe":"client",show:"showMenu","show-qtip":"showQtip",hide:"hideMenu","hide-qtip":"hideQtip"},render:function(){var e=this.item,t=e.key==="main_wall"?"home":e.key;return this.$el.html(this.renderTemplate(c,{item:e,title:this.title()})).addClass(t),e.hasOwnProperty("sections")&&(this.$el.addClass("has-sub-menu"),this.$("a").addClass("has-sub-nav"),this.buildSubMenu()),this.$el.addClass(e.open),(e.open==="inline"||e.link)&&this.$("a").attr("href",n.url(e.link)),e.open==="blank"&&this.$("a").attr("href",e.link).attr("target","_blank"),this.$("a").addClass(t).data("context",e.key),t==="home"?(this.$("> a").remove(),this):(t==="files"&&(n.currentUser.browseShareApps.length>0?this.$("a").addClass("open_next").find(".next").addClass("arrow"):this.$("a").removeClass("open_next").find(".next").removeClass("arrow")),this)},buildSubMenu:function(){var i=this.item.sections;if(this.item.key==="main_wall"&&n.currentUser.hasVipWall()){var s=function(e){return e.key==="vip"},o=t.detect(i,s);o&&(i=t.reject(i,s),i.unshift(o))}var u=e("<ul id='filters-"+this.item.key+"' class='sub-nav '/>"),a=this;t.each(i,function(e){n.configuration.execute(e.enable)&&u.append(a.initChild(r,{item:e,key:a.item.key,url:a.item.url}).render().el),a.item.expand&&a.$el.addClass("expand")}),this.$el.append(u)},subMenu:function(e){e.preventDefault(),this.$("ul.sub-nav").slideToggle("fast",function(){}),this.$el.closest("li").toggleClass("collapsed")},title:function(){return this.item.translate===!1?this.item.key:this.t("home.left_menu."+this.item.key)},client:function(e){return e.preventDefault(),n.application.navigateToClientApp(this.item.id)},showMenu:function(t){if(this.$el.hasClass("showing"))return;this.$el.addClass("showing");if(!this.$("a").hasClass("open_next")){n.currentNav!=="home"&&this.$el.hasClass("home")&&this.$el.hasClass("collapsed")&&this.subMenu(t),n.currentNav!=="insight"&&this.$el.hasClass("insight")&&this.$el.hasClass("collapsed")&&this.subMenu(t);return}var r=this,i,s=this.$("a").data("context"),o=this.childView(s),u=o.View,a=o.options||{};if(u){i=e("<div class='js-sub-container'><div class='fly-out-tip  sub-container quick-search-tip menu-tip '></div></div>"),a.$container=i,this._subView=this.initChild(u,a),i.find(".sub-container").append(this._subView.render().el),this.$el.append(i);var f=r._subView.$el.width();r._subView.$el.addClass("qtip-shadow"),r.effect(f),i.css({height:r._subView.$el.height()+100,width:f+100})}},hideMenu:function(){this.$el.removeClass("showing"),this._subView&&(this._subView.leave(),this._subView=null),this.$(".sub-container, .js-sub-container").remove()},showQtip:function(t,n){var r=e(t.currentTarget),i=r.find("a").data("context"),s=this.childView(i),o=s.View,u=s.options||{};this._subView=this.initChild(o,u),n.set("content.text",this._subView.render().el)},hideQtip:function(){this._subView&&(this._subView.leave(),this._subView=null)},childView:function(e){switch(e){case"communities":return{View:i};case"subjects":return{View:s,options:{id:"quick-search-subjects"}};case"people":return{View:s,options:{id:"quick-search-people"}};case"filters":return{View:o};case"apps":return{View:u};case"meetings":return{View:a};case"files":return{View:f};case"insight":return{View:l};default:return{}}},effect:function(t){t+=20;var n=this.$("> a"),r=this.$(".js-sub-container"),i=r.outerHeight(),s=this.$el.outerHeight(!0),o=n.offset(),u=e(window).scrollTop();o=o.top-u;var a=e(window).height(),f=a-o,l=f-i;if(l<0){var c=l-s;r.css({marginTop:c+"px"})}}})}),define("views/home/menu_list",["jquery","underscore","tibbr","views/home/menu_item"],function(e,t,n,r){return n.View.extend({tagName:"ul",className:"primary-nav",initialize:function(){t.bindAll(this,"render"),this.bindTo(n.currentUser,"badges:updated",this.updateBadge,this),this.bindTo(n.currentUser,"communityBadges:updated",this.updateCommunityBadge,this),this.event.bindTo(this,"render:menu",this.reRender),this.config=t.clone(n.appConfig("ui_config","config","home","menu"));var e=this;t.each(n.currentUser.subscribedFilters.leftNav(),function(t){e.config.push({enable:!0,key:t.get("title"),translate:!1,link:t.get("url")+"?user_id="+n.currentUser.id,open:"iframe",id:t.id})})},render:function(){var e=this;return t.each(this.config,function(t){var i=n.configuration.execute(t.enable);t.key==="video_conference"&&i&&!n.currentUser.privileges.on("Message").can("create_conference")&&(t.enable=!1),t.key==="communities"&&(i=n.appConfig("webui","config","community","base_community")&&(n.currentUser.get("unconnected_communities").length>0||n.currentUser.get("connected_communities").length>0)),t.key==="apps"&&(i=n.currentUser.hasApps()),t.key==="meetings"&&(i=n.currentUser.meetings.length>0),t.key==="developer_center"&&!n.currentUser.privileges.on("ApplicationDefinition").can("develop")&&(i=!1),(i===!0||i==="enabled")&&e.$el.append(e.initChild(r,{item:t}).render().el)}),this},reRender:function(){var e=this.$(".sub-nav >li.current > a").attr("class"),t=e&&e.split(" ").join(".");this.$el.empty(),this.leaveChild(),this.render(),this.bind(),n.Event.trigger("nav:left:rendered"),t&&this.$("."+t).parent().addClass("current")},bind:function(){var t=e(".primary-nav"),r=n.currentNav,i=t.find(".has-sub-nav").not("."+r);i.parent().addClass("collapsed").not(".expand").find(".sub-nav").hide(),t.find("."+r).hasClass("collapsed")&&t.find(".has-sub-nav."+r).click(),t.find("li.current").removeClass("current"),t.find("li."+r).not(".has-sub-menu").addClass("current")},updateBadge:function(){var e=this.$("li.home"),t=n.currentUser.get("badges").unread;e.find("sup").remove(),t>0&&n.currentNav!=="home"&&e.find("a").append('<sup class="badges ">'+t+"</sup>")},updateCommunityBadge:function(){var e=this.$("li.communities"),r=0;t.each(n.CommunityNotifications,function(e){r=r+(e.community_badges&&e.community_badges.badges)?e.community_badges.badges.unread:0}),e.find("sup").remove(),r>0&&e.find("a").append('<sup class="badges ">'+r+"</sup>")}})}),define("hbs!templates/home/subject_section",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="section profile-section">\n    <a href="',(o=n.link)?o=o.call(t,{hash:{},data:i}):(o=t&&t.link,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'" class="profile-picture reload"><img src="',(o=n.image)?o=o.call(t,{hash:{},data:i}):(o=t&&t.image,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'">\n    </a>\n</div>',s})}),define("hbs!templates/home/user_section",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="profile-section">\n    <div class="section profile-section">\n        <a class="profile-picture huge" href="',(o=n.link)?o=o.call(t,{hash:{},data:i}):(o=t&&t.link,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'">\n            <img alt="',(o=n.display_name)?o=o.call(t,{hash:{},data:i}):(o=t&&t.display_name,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'" src="',(o=n.image)?o=o.call(t,{hash:{},data:i}):(o=t&&t.image,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'"/>\n        </a>\n    </div>\n</div>',s})}),define("hbs!templates/home/vip_section",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="vip-post-introduction hidden" style="display: block; visibility: visible;">\n    <h3>\n       ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.introducding_new",u):a.call(t,"t","vip.introducding_new",u)))+"\n    </h3>\n    ",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.tips_text",u):a.call(t,"t","vip.tips_text",u)))+'\n    <a href="#" class="link js-manage">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.tips_manage_link",u):a.call(t,"t","vip.tips_manage_link",u)))+"</a>.</p>\n    <p>",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.make_default_text",u):a.call(t,"t","vip.make_default_text",u)))+'</p>\n    <div class="actions">\n        <div class="media-box custom-input-box">\n            <div class="option-btn checkbox-btn js-chk">\n                <input type="hidden" value="0" class="hidden" name="exclude_msg[]">\n                <input type="checkbox">\n            </div>\n            <div class="input-option-label">\n                <label for="input_input1369">\n                    ',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"vip.dont_show_again",u):a.call(t,"t","vip.dont_show_again",u)))+'\n                </label>\n            </div>\n        </div>\n        <a href="#" class="btn btn-submit ok-btn js-ok">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.ok",u):a.call(t,"t","common.ok",u)))+"</a>\n    </div>\n</div>",s})}),define("views/home/nav/left",["jquery","underscore","tibbr","require/menu_aim","views/home/profile_section","views/home/menu_list","hbs!templates/home/subject_section","hbs!templates/home/user_section","hbs!templates/home/vip_section"],function(e,t,n,r,i,s,o,u,a){return n.View.extend({className:"padding-wrap js-left-menu",initialize:function(){t.bindAll(this,"changeSection"),this.event.bindTo(this,"section:change",this.changeSection),this.profileView=this.initChild(i,{model:this.model}),this.section="currentUser",this.on("profile:change",this.profileChange,this),this.bindTo(this.model,"change:profile_image_url",this.changeImage,this),this.bindTo(this.model,"change:display_name",this.changeName,this),this.event.bindTo(this,"nav:left:rendered",this.bind,this),this.$el.append("<div class='js-profile-section'/>")},render:function(){return this.$(".js-profile-section").html(this.profileView.render().el),this.renderNav(),this},renderNav:function(){var t=e("<nav/>");t.append(this.initChild(s).render().el),this.$el.append(t)},changeSection:function(t,r){n.application.setSubNav(t),e("#active_wall").text(r)},profileChange:function(e){e.get("modelType")==="Subject"?(this.section="Subject",this.$(".js-profile-section").html(this.renderTemplate(o,{image:e.image(5),link:e.showUrl()}))):e.get("modelType")==="User"&&e.id!==n.currentUser.id?(this.section="user",this.$(".js-profile-section").html(this.renderTemplate(u,{display_name:e.get("display_name"),link:e.urlFor("show"),image:e.image(5)}))):this.section!=="currentUser"&&(this.section="currentUser",this.$(".js-profile-section").html(this.profileView.render().el))},changeImage:function(){this.$(".profile-picture > img").attr("src",this.model.image(5))},changeName:function(){e("span.js-user-display-name").html(this.model.get("display_name"))},bind:function(){n.IE7?this.menuAIM():this.menuQTIP(),this.vipTip()},menuAIM:function(){var t=e(".primary-nav"),r=function(r){var i=e(r);n.$menuRow=i,t.find("li.active").removeClass("active"),i.hasClass("has-sub-menu")||i.addClass("active"),i.trigger("show")},i=function(t){if(!t)return;e(t).removeClass("active").trigger("hide"),e(".sub-container",t).hide(),n.$menuRow=null};t.menuAim({activate:r,exit:i,tolerance:75})},menuQTIP:function(){var t=e(".primary-nav");t.find("li.next").each(function(){var n=e(this);n.qtip({content:{text:spinner},position:{my:"left center",at:"center right"},show:{delay:150,solo:!0},hide:{event:"mouseleave",fixed:!0,delay:400},events:{show:function(e,r){t.find("li.active").removeClass("active"),n.hasClass("has-sub-menu")||n.addClass("active"),n.trigger("show-qtip",r)},hide:function(e,t){n.removeClass("active").trigger("hide-qtip",t)}},style:{classes:"fly-out-tip quick-search-tip menu-tip ui-tibbr-tip qtip-light qtip-shadow",tip:!1}})})},vipTip:function(){if(this._vipTib)return;var t=this,r=n.currentUser.preferences.withName("webclient.right_nav","vip_tips");if(r&&r.get("value")==="1")return;e(".primary-nav .vip.home").qtip({content:{text:function(){return t.renderTemplate(a)}},position:{at:"right center",my:"left center",viewport:e(window),adjust:{x:3,y:0},effect:!1},events:{render:function(t,r){r.elements.content.on("click",".js-chk",function(t){t.preventDefault();var n=e(t.currentTarget),r=n.hasClass("checked");r?n.removeClass("checked"):n.addClass("checked")}).on("click",".js-ok",function(e){e.preventDefault(),r.elements.content.find(".js-chk").hasClass("checked")?(n.currentUser.createOrUpdatePref("webclient.right_nav","vip_tips",1),r.destroy()):r.hide()}).on("click",".js-manage",function(t){t.preventDefault(),e.fn.manageVip()})}},show:{solo:!0},hide:"unfocus",style:{classes:"qtip-light qtip-shadow vip-post-tooltip",tip:{border:1,width:25,height:18,offset:0},width:!1}}),this._vipTib=!0}})}),define("modules/common/views/post/post_box",["jquery","underscore","tibbr","modules/dialog","require/redactor_mention","../../models/message","../../models/subject","./asset","../common/auto_suggest","./post_privacy","./mentions_input","hbs!modules/common/templates/post/post_box"],function(e,t,n,r,i,s,o,u,a,f,l,c){return n.View.extend({className:"tib-post_tib-box",events:{"focus textarea":"showFooter"},initialize:function(){t.bindAll(this,"reset","resetButton","postPrivacy"),n.Event.bindTo(this,"private:post",this.makePrivate),n.Event.bindTo(this,"all:post",this.allPrivacy),n.Event.bindTo(this,"show:upload",this.showUpload),this.on("public:post",this.makePublic,this),this.on("private:post",this.makePrivate,this),this.renderPrivacyView=this.options.privacy!==!1,this.renderPrivacyView&&(this.privacyView=this.initChild(f,{type:this.options.type})),n.richText=n.richText||{}},render:function(e){return this.inputClass=this.options.inputClass||"subject_name",this.data=e,this.$el.html(this.renderTemplate(c)),this.renderTibBox(),this},renderAsset:function(){this.cleanAsset(),this.assetView=new u({useAPI:this.useAPI,uniquename:this.options.inputClass,asset:t.isUndefined(this.options.asset)?!0:this.options.asset}),this.$(".asset-holder").html(this.assetView.render().el)},renderTibBox:function(){!n.richText.enable||n.IE7?this.renderMentionInput():this.renderRedactor()},resetTibBox:function(){try{this.$(".tib-text").mentionsInput("reset"),this.$(".redactor").setCode("").setFocus()}catch(e){}},renderMentionInput:function(){this.mentionsInput=this.initChild(l,{placeholder:this.options.placeholder||this.t("common.post.what_going_on"),height:this.options.height||30,resource:this.options.resource,params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0}}}),this.$(".textarea-wrap").html(this.mentionsInput.render().el)},renderRedactor:function(){var e=this;e.richText=!0,e.parent.richText=e.richText,this.$(".js-main-textarea").append('<textarea class="ts-redactor" placeholder="'+this.options.placeholder+'"></textarea>').find("textarea.ts-redactor").one("focus",function(){var t=n.richText;e.$(".js-main-textarea").hide().after("<textarea class='redactor'>");var r=e.$(".redactor");r.redactor({plugins:["mention"],tabFocus:!1,buttons:t.tool_bar,resource:e.options.resource||{},useAPI:e.useAPI,allowedTags:t.allowed_tags,linebreak:!0}),r.insertHtml(""),e.$(".redactor_toolbar").css("width",t.tool_bar.length*27),e.showFooter()})},renderAutoSuggest:function(e,t){e=e||this.data,n.appConfig("ui_config","config","post_to")==="blank"&&(e=[]),this.autoSugest&&this.autoSugest.leave(),this.autoSugest=this.initChild(a,{attributes:{name:this.inputClass},params:{subjects_filters:{only_postable:!0},users_filters:{only_postable:!0},type:t},preFill:[e]}),this.$(".auto-suggest").html(this.autoSugest.render().el)},bind:function(){this.autoSugest&&this.autoSugest.bind(),this.mentionsInput&&this.mentionsInput.bind(),this.$("form").csrfToken().attr("action",this.options.actionUrl||n.serverUrl("messages"))},reset:function(){this.$("form textarea").val("").simplePlaceholder().focus(),this.$(".js-clean-after-post").remove(),this.autoSugest&&(this.autoSugest.closeAll(),this.autoSugest.addItem(this.data)),this.renderAsset(),n.currentNav!=="groups"&&this.postPrivacy(),e("#filters-main_wall").find("a.private").parent().hasClass("current")||params.action==="filters"&&params.id==="private"?this.makePrivate():this.allPrivacy(),this.storeChild(this.assetView),this.assetView.changeText(),this.resetButton(),this.resetTibBox()},resetButton:function(){this.$(".line-loader").hide(),e(window.currentPostTarget).show(),window.currentPostTarget=undefined},postPrivacy:function(){if(this.renderPrivacyView===!1)return;return this.$(".js-post-privacy").length===0&&this.$(".post-privacy-container").append(this.privacyView.render().el),this.privacyView},makePrivate:function(){return this.privacyView.type="private",this.privacyView.onlyPrivate()},makePublic:function(){return this.privacyView.onlyPublic()},changeToPrivacy:function(e){this.privacyView.options["default"]=e},allPrivacy:function(){if(!this.privacyView)return;var e=this.privacyView.type;this.privacyView.type="all",e!==this.privacyView.type&&this.privacyView.render()},showFooter:function(){return this._haveFooter?!0:(this.options.postTo===!1?this.$("fieldset.post-to").remove():(this.renderAutoSuggest(this.data,this.options.type==="private"?"users":"both"),this.autoSugest.bind(),n.currentSubject&&(this.autoSugest.privatePost=n.currentSubject.get("scope")==="private")),this.renderAsset(),this.postPrivacy(this.options.privacy!==!1),e(".js-main-box-close").show(),e("#as-results-subject_name").hide(),this.$(".js-sub-main").removeClass("hidden"),this._haveFooter=!0,this._haveFooter)},hideFooter:function(){e(".js-main-box-close").hide(),e("ul#post-tabs li:first").addClass("active"),this.$(".js-sub-main").addClass("hidden")},showUpload:function(){if(!this.isOnScreen())return;this.showFooter(),this.$("a[data-type=file]").click()},cleanAsset:function(){this.assetView&&(this.assetView.leave(),this.assetView=null)},onLeave:function(){this.cleanAsset(),this.privacyView=null,this.$(".redactor").destroyEditor(),this.$(".redactor").remove()}})}),define("hbs!modules/common/templates/post/status",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="bg-wrap">\n    <!--<a class="close-btn js-main-box-close" style="display: none;" href="#">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.close",u):a.call(t,"t","common.close",u)))+'</a>-->\n    <ul id="post-tabs"  class="horizontal-list posting-options js-post-tabs">\n      <li class="active"><a href="#" class="plain" data-type="plain">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.status.post",u):a.call(t,"t","common.status.post",u)))+'</a></li>\n      <li><a href="#" class="question" data-type="question">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.status.poll",u):a.call(t,"t","common.status.poll",u)))+'</a></li>\n      <li><a href="#" class="calendar" data-type="calendar">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.status.calender",u):a.call(t,"t","common.status.calender",u)))+'</a></li>\n    </ul>\n    <div id="tib-box" class="public tib-box"></div>\n</div>',s})}),define("modules/common/views/post/post",["jquery","underscore","tibbr","modules/dialog","modules/overlay","../../models/message","./post_box","./poll_option","./calender","hbs!modules/common/templates/post/status"],function(e,t,n,r,i,s,o,u,a,f){return n.View.extend({className:"post-section",id:"posting-tab-wrap",events:{"click ul.js-post-tabs a":"showPost"},errors:[],initialize:function(){t.bindAll(this,"showPost","changeMessage","post","getTargets","validateForm","display","renderPost","renderAutoSuggest","submit","fillMessage","changePostTo"),this.on("subject.name:change",this.changePostTo,this),n.Event.bindTo(this,"post.type:change",this.changeAutoSuggest),n.subscribe("message.fill",this.fillMessage),this.data=this.options.data,this.inputClass=this.options.inputClass,this.bind=t.isUndefined(this.options.bind)?!0:this.options.bind,this.placeholder=this.options.placeholder||this.t("common.post.what_going_on"),this.Message=s},postMessage:function(e){var t=this;return this.render(),this.$("#post-tabs").hide(),this.$el.css("width","600px"),i.view(this.el,{onComplete:function(){t.$("a[data-type=plain]").click(),t.showPost({currentTarget:"<a data-type='plain'></a>"}),t.$("textarea[name='__content']").val(e.message),t.postBoxView.showFooter(),e.url&&(t.$("a[data-type=link]").click(),t.$("input.js-link-url").val(e.url)),i.resize(),t.$el.off("click",".tib-btn",t.post),t.$el.on("click",".tib-btn",t.post)}}),!1},fillMessage:function(e){console.log("fillMessage"),this.$("textarea[name='__content']").val(e.message),this.postBoxView.showFooter();var n=this;this.richText&&t.delay(function(){n.$(".ts-redactor").focus(),n.$(".redactor").setCode(e.message)},300),e.link&&(this.$("a[data-type=link]").click(),this.$("input.js-link-url").val(e.link))},render:function(){return this.$el.html(this.renderTemplate(f)),this.$container=this.$("#tib-box"),this.$el.on("click",".tib-btn",this.post),this},renderPost:function(e){return this.$el.html('<div id="tib-box-only" class="tib-box"></div>'),this.$el.on("click",".tib-btn",this.post),this.inputClass="announcement_subject",this.$container=this.$("#tib-box-only"),this.data=[e],this.bind=!0,this.showPost({currentTarget:"<a data-type='plain'></a>"}),this.postBoxView.showFooter(),this},display:function(){this.$("a[data-type=plain]").click()},renderAutoSuggest:function(e,r){return this.$(".tib-post_tib-box").length>0?!0:(e=e||this.data||{caption:n.currentUser.get("display_name"),image:n.currentUser.image("small").replace(new RegExp("^"+window.prefix),"/"),t:"u",s:"public",value:n.currentUser.get("login")},r=r||this.options.type||(this.params().action==="filters"&&this.params().id==="private"?"private":"public"),this.params().id==="private"&&this.params().action==="filters"&&(e=[]),this.postBoxView=this.initChild(o,t.extend({inputClass:this.inputClass,height:this.options.height,type:r,placeholder:this.placeholder},this.options)),this.$container.html(this.postBoxView.render(e).el),this.bind&&this.postBoxView.bind(),this.richText=this.postBoxView.richText,!0)},changeAutoSuggest:function(e){this.postBoxView&&this.postBoxView.autoSugest&&(this.postBoxView.autoSugest.privatePost=e==="users",n.currentSubject&&n.currentSubject.get("scope")==="private"&&(this.postBoxView.autoSugest.privatePost=!0))},changePostTo:function(e){this.postBoxView&&(this.postBoxView.data=e,this.postBoxView.autoSugest&&this.postBoxView.autoSugest.closeAll().addItem(e))},assetView:function(){return this.postBoxView.asset},showPost:function(t){var n=e(t.currentTarget),r=this.$container,i,s=n.data("type"),o=null;this.renderAutoSuggest(this.data),this.$("#post-tabs > li").removeClass("active"),n.parent().addClass("active"),this.$("div.holder, div.add-question, div.add-calendar, .meeting-schedular").hide().find("input, textarea, select").removeAttr("disabled");switch(s){case"question":this.$("div.calender.holder, div.add-calendar").find("input, textarea, select").attr("disabled",!0),i=this.$("div.question.options"),i.find("ul.question-options").length===0?(this.PollView=this.initChild(u,{isUpdate:!1}),i.html(this.PollView.el).show(),this.PollView.bindDate()):(i.show(),this.$("div.add-question").show()),o=this.t("common.post.what_would_you_like"),this.postBoxView.showFooter();break;case"calendar":this.$("div.question.holder").find("input, textarea, select").attr("disabled",!0),i=this.$("div.calender.options"),i.find("div.calendarinfo").length===0?(this.calendarView=this.initChild(a,{isUpdate:!1}),i.html(this.calendarView.el).show()):(i.show(),this.$("div.add-calendar").show()),this.calendarView.initMeeting(),o=this.t("common.post.calender.what_are_you_planing"),this.postBoxView.showFooter();break;default:o=this.placeholder,this.$("div.holder, div.add-calendar, div.add-question").find("input, textarea, select").attr("disabled",!0),this.$(".post-btn").show()}return this.$("[placeholder]").not(".tib-text").simplePlaceholder(),this.changeMessage(o),this.changeButtonText(s),this.$("input.post-type").val(s),r.show(),e.colorbox&&e.colorbox.resize(),!1},changeMessage:function(e){this.richText&&this.$(".ts-redactor").attr("placeholder",e).val("").simplePlaceholder(),this.$(".tib-text").attr("placeholder",e).val("").simplePlaceholder()},changeButtonText:function(e){e=e||"plain",this.$("span.js-button").text(this.t("common.button_texts."+e))},post:function(t){console.log("test");if(this.$(".btn-submit").hasClass("disabled"))return!1;if(this.validateForm(e(t.currentTarget))){var n=this.getTargets(),i,s=this.$("input.post-type").val(),o=this;this.$(".tib-text").mentionsInput("val",function(e){i=e}),this.richText&&(i=this.$(".redactor").mentionHTML()),this.$("#__content").val(n+" "+i);if(this.checkResource(t)&&this.checkTargetScope(t))switch(s){case"calendar":this.calendarView.isDurationExceed()?r.confirm({target:t.currentTarget,text:this.t("calendar.duration_exceed"),cancelLabel:this.t("dialog.common.dont_send"),saveLabel:this.t("dialog.common.send_anyway"),okFunction:function(){o.submit(t)}}):this.submit(t);break;default:this.submit(t)}}else r.alert({target:t.currentTarget,text:this.errors.join("<br/>")}),this.errors=[];return!1},submit:function(r){r.preventDefault();var i=this;window.currentPostTarget=r.currentTarget,e(r.currentTarget).hide().parent().append(n.UI.loader);var s=this.$("form"),o=s.attr("action"),u=s.serializeJSON(),a=this.$("input.post-type").val(),f=s.find("input.js-og-resource").data("resources"),l=s.find("input.js-og-files").data("resources"),c=t.str.trim(s.find("input.js-link-url").val());c.length>3&&c!=="undefined"&&(u.message.links=[{title:s.find("input.js-link-title").val(),url:c}]),f&&(u.resource=f),l&&(u.message.resources=l);switch(a){case"question":this.PollView&&(u.message.question=this.PollView.postData());break;case"calendar":this.calendarView&&(u.message.calendar=this.calendarView.postData())}this.ajax({url:o,contentType:"application/json; charset=utf-8",data:JSON.stringify(u),global:!0,beforeSend:function(e){e.setRequestHeader("Content-type","application/json; charset=utf-8")}}).done(function(e){var t=new i.Message(e);i.reset();try{n.tracker.trackSend("create wall post","User engagement")}catch(r){}n.Event.trigger("message:created",t),n.pub("message_create",{Message:t.id,Subjects:t.subjects.pluck("id")}),n.publish("message.created",e)}).fail(function(e){e.errors&&i.useAPI&&(e.responseText=e.errors),i.alertError(e),i.postBoxView.resetButton()}).always(function(){s.find("input, textarea, select").removeAttr("disabled")})},reset:function(){this.postBoxView.reset(),this.calendarView&&(this.calendarView.render(),this.calendarView.resetMeetingChoices()),this.PollView&&this.PollView.render().bindDate(),this.changeAutoSuggest&&this.changeAutoSuggest()},checkTargetScope:function(e){if(this.options.postTo===!1)return!0;var t=this,n=this.$(".js-private").val(),i;return this.postBoxView.autoSugest.hasPrivateAndPublic()?(this.postBoxView.autoSugest.hasOnlyPublicOrPrivate("public")&&n?i=this.t("common.scope.alert.private_message"):i=this.t("common.scope.alert.mixed_scope"),r.confirm({target:e.currentTarget,text:i,okFunction:function(){t.$(".js-private").val("false"),t.submit(e)}}),!1):this.postBoxView.autoSugest.hasPrivate()===!0&&n===!1&&this.postBoxView.autoSugest.hasOnlyPublicOrPrivate("private")?!0:!0},checkResource:function(e){if(this.options.resource){var n=this,i=this.options.resource;if(i.scope==="private"&&this.postBoxView.autoSugest&&this.postBoxView.autoSugest.checkPrivatePost()){var s=i.type.replace("og:","");s=t.include(["file","link"],s)?s:"resource";var o=this.t("common.scope.alert.mixed_resource."+s);return r.confirm({text:o,okFunction:function(){n.$(".js-private").val("false"),n.submit(e)}}),!1}return!0}return!0},getTargets:function(){var e="";return t.isEmpty(this.options.postTarget)||(e=t.map(this.options.postTarget.split(","),function(e){return"@"+e}).join(" ")),this.options.postTo!==!1?e+" "+t.map(this.postBoxView.autoSugest.getValueInArray(),function(e){return"@"+e}).join(" "):e},validateForm:function(){var n="",r=!1;if(this.richText){try{n=this.$(".redactor").mentionHTML()}catch(i){}t.str.stripTags(n).length===0&&(n="")}else n=this.$(".tib-text").val();this.errors=[];var s=!0,o=this.$("input.post-type").val();if(this.richText)try{r=this.$(".redactor").hasMention()}catch(i){}else r=this.$(".tib-text:first").data("messageText").match("@\\[(.*)\\]");!Modernizr.input.placeholder&&n===this.$(".tib-text").attr("placeholder")?(s=!1,this.errors.push(this.t("message.errors.can_not_blank"))):t.str.trim(n).length==0&&(s=!1,this.errors.push(this.t("message.errors.can_not_blank"))),this.options.postTo!==!1&&!r&&t.isEmpty(this.postBoxView.autoSugest.getValueInArray())&&t.isEmpty(this.options.postTarget)&&(s=!1,this.errors.push(this.t("message.errors.subject_can_not_blank")));switch(o){case"calendar":var u=this.calendarView.validate();if(!u.validate)return this.errors.push(u.errors),!1;return s;case"question":u=this.PollView.validate();if(!u.validate)return this.errors.push(u.errors),!1;return s}if(this.inputClass==="announcement_subject"){if(e(".sub-announcement-type").is(":checked")){var a=e("#days").val();e("#last-for").is(":checked")&&(a===0||e.trim(a).length===0||isNaN(a)?(e(".announcement-days-error").show(),this.errors.push(this.t("announcement.expires_at_input_invalid")),s=!1):e("#days").attr("name","announcement[days]"))}e("input#manually").is(":checked")&&(e("#days").val(1),e(".announcement-days-error").hide())}return s},closeColorbox:function(){e.colorbox.close()},onLeave:function(){n.unsubscribe("message.fill"),this.Message=null}})}),define("views/common/post",["underscore","tibbr","modules/common/views/post/post"],function(e,t,n){return n.extend({})}),define("jqueryui/tabs",["jquery","./core","./widget"],function(e){(function(e,t){function i(){return++n}function s(e){return e=e.cloneNode(!1),e.hash.length>1&&decodeURIComponent(e.href.replace(r,""))===decodeURIComponent(location.href.replace(r,""))}var n=0,r=/#.*$/;e.widget("ui.tabs",{version:"1.10.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,n=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",n.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),n.active=this._initialActive(),e.isArray(n.disabled)&&(n.disabled=e.unique(n.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.options.active!==!1&&this.anchors.length?this.active=this._findActive(n.active):this.active=e(),this._refresh(),this.active.length&&this.load(n.active)},_initialActive:function(){var t=this.options.active,n=this.options.collapsible,r=location.hash.substring(1);if(t===null){r&&this.tabs.each(function(n,i){if(e(i).attr("aria-controls")===r)return t=n,!1}),t===null&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active")));if(t===null||t===-1)t=this.tabs.length?0:!1}return t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),t===-1&&(t=n?!1:0)),!n&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var n=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(n),i=!0;if(this._handlePageNav(t))return;switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:i=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:t.preventDefault(),clearTimeout(this.activating),this._activate(r);return;case e.ui.keyCode.ENTER:t.preventDefault(),clearTimeout(this.activating),this._activate(r===this.options.active?!1:r);return;default:return}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,i),t.ctrlKey||(n.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))},_panelKeydown:function(t){if(this._handlePageNav(t))return;t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP)return this._activate(this._focusNextTab(this.options.active-1,!1)),!0;if(t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN)return this._activate(this._focusNextTab(this.options.active+1,!0)),!0},_findNextTab:function(t,n){function i(){return t>r&&(t=0),t<0&&(t=r),t}var r=this.tabs.length-1;while(e.inArray(i(),this.options.disabled)!==-1)t=n?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){if(e==="active"){this._activate(t);return}if(e==="disabled"){this._setupDisabled(t);return}this._super(e,t),e==="collapsible"&&(this.element.toggleClass("ui-tabs-collapsible",t),!t&&this.options.active===!1&&this._activate(0)),e==="event"&&this._setupEvents(t),e==="heightStyle"&&this._setupHeightStyle(t)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,n=this.tablist.children(":has(a[href])");t.disabled=e.map(n.filter(".ui-state-disabled"),function(e){return n.index(e)}),this._processTabs(),t.active===!1||!this.anchors.length?(t.active=!1,this.active=e()):this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(n,r){var i,o,u,a=e(r).uniqueId().attr("id"),f=e(r).closest("li"),l=f.attr("aria-controls");s(r)?(i=r.hash,o=t.element.find(t._sanitizeSelector(i))):(u=t._tabId(f),i="#"+u,o=t.element.find(i),o.length||(o=t._createPanel(u),o.insertAfter(t.panels[n-1]||t.tablist)),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),l&&f.data("ui-tabs-aria-controls",l),f.attr({"aria-controls":i.substring(1),"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var n=0,r;r=this.tabs[n];n++)t===!0||e.inArray(n,t)!==-1?e(r).addClass("ui-state-disabled").attr("aria-disabled","true"):e(r).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var n={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){n[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,n),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var n,r=this.element.parent();t==="fill"?(n=r.height(),n-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");if(r==="absolute"||r==="fixed")return;n-=t.outerHeight(!0)}),this.element.children().not(this.panels).each(function(){n-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,n-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):t==="auto"&&(n=0,this.panels.each(function(){n=Math.max(n,e(this).height("").height())}).height(n))},_eventHandler:function(t){var n=this.options,r=this.active,i=e(t.currentTarget),s=i.closest("li"),o=s[0]===r[0],u=o&&n.collapsible,a=u?e():this._getPanelForTab(s),f=r.length?this._getPanelForTab(r):e(),l={oldTab:r,oldPanel:f,newTab:u?e():s,newPanel:a};t.preventDefault();if(s.hasClass("ui-state-disabled")||s.hasClass("ui-tabs-loading")||this.running||o&&!n.collapsible||this._trigger("beforeActivate",t,l)===!1)return;n.active=u?!1:this.tabs.index(s),this.active=o?e():s,this.xhr&&this.xhr.abort(),!f.length&&!a.length&&e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(s),t),this._toggle(t,l)},_toggle:function(t,n){function o(){r.running=!1,r._trigger("activate",t,n)}function u(){n.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),i.length&&r.options.show?r._show(i,r.options.show,o):(i.show(),o())}var r=this,i=n.newPanel,s=n.oldPanel;this.running=!0,s.length&&this.options.hide?this._hide(s,this.options.hide,function(){n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),u()}):(n.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),s.hide(),u()),s.attr({"aria-expanded":"false","aria-hidden":"true"}),n.oldTab.attr("aria-selected","false"),i.length&&s.length?n.oldTab.attr("tabIndex",-1):i.length&&this.tabs.filter(function(){return e(this).attr("tabIndex")===0}).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}),n.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var n,r=this._findActive(t);if(r[0]===this.active[0])return;r.length||(r=this.active),n=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:n,currentTarget:n,preventDefault:e.noop})},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return typeof e=="string"&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),n=t.data("ui-tabs-aria-controls");n?t.attr("aria-controls",n).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),this.options.heightStyle!=="content"&&this.panels.css("height","")},enable:function(n){var r=this.options.disabled;if(r===!1)return;n===t?r=!1:(n=this._getIndex(n),e.isArray(r)?r=e.map(r,function(e){return e!==n?e:null}):r=e.map(this.tabs,function(e,t){return t!==n?t:null})),this._setupDisabled(r)},disable:function(n){var r=this.options.disabled;if(r===!0)return;if(n===t)r=!0;else{n=this._getIndex(n);if(e.inArray(n,r)!==-1)return;e.isArray(r)?r=e.merge([n],r).sort():r=[n]}this._setupDisabled(r)},load:function(t,n){t=this._getIndex(t);var r=this,i=this.tabs.eq(t),o=i.find(".ui-tabs-anchor"),u=this._getPanelForTab(i),a={tab:i,panel:u};if(s(o[0]))return;this.xhr=e.ajax(this._ajaxSettings(o,n,a)),this.xhr&&this.xhr.statusText!=="canceled"&&(i.addClass("ui-tabs-loading"),u.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){u.html(e),r._trigger("load",n,a)},1)}).complete(function(e,t){setTimeout(function(){t==="abort"&&r.panels.stop(!1,!0),i.removeClass("ui-tabs-loading"),u.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr},1)}))},_ajaxSettings:function(t,n,r){var i=this;return{url:t.attr("href"),beforeSend:function(t,s){return i._trigger("beforeLoad",n,e.extend({jqXHR:t,ajaxSettings:s},r))}}},_getPanelForTab:function(t){var n=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+n))}})})(e)}),define("modules/wall_tab",["jquery","jqueryui/tabs","underscore"],function(e,t,n){return function(e){var t,r="",i="wall-tabs",s,o,u,a="<li><a href='{{href}}' data-id='{{id}}' title='{{title}}' class='{{classes}}'>{{label}}</a>{{close}}</li>",f=function(o){u=o=o||{};var f=o.id||i+"-"+t,l="#"+f,c=n.str.truncate(o.title,50)||"Tibbr Tab "+t,h=o.className||"wall-tab",p=n.templateSettings.interpolate,d=o.close!==!1?"<span class='ui-icon ui-icon-close'>Remove Tab</span>":"";n.templateSettings.interpolate=/\{\{(.+?)\}\}/g;var v=n.template(a,{href:l,id:f,title:o.title,label:c,classes:h,close:d});n.templateSettings.interpolate=p;var m=e(v).data({counter:t,model:u.model,onRender:u.onRender,view:u.view,iframe:u.iframe});return s.find(".ui-tabs-nav").append(m),s.append("<div id='"+f+"'><p>"+o.content||r+"</p></div>"),s.tabs("refresh"),o["switch"]&&s.tabs("option","active",s.find("ul.ui-tabs-nav > li").index(m)),t++,s},l=function(e){n.each(e,function(e){f({id:"event"+n.str.dasherize(e.name),title:e.name,content:e.content})})},c=function(n){var r=e("#"+i),s=r.find(".ui-tabs-nav li:eq("+n+")"),o=s.attr("aria-controls"),u=e("#"+o);s.remove(),u.remove(),t--,e("tabs").tabs("refresh")},h=function(t){return e("#"+i).tabs("option","active",t)},p=function(n){return i=n,s=e("#"+i).tabs({cache:!0}),s.on("click","span.ui-icon-close",function(){var t=e(this).parent(),n=s.find(".ui-tabs-nav li").index(t);h(0),c(n)}),t=1,g(),s},d=function(e,t,r,i){t=t||500;var s="";return r,'<div class="streams"><iframe id="'+i+'" name="'+i+'" src = "'+n.str.escapeHTML(e)+'" frameBorder="0" border="0" style="visibility:visible;overflow: auto;width:100%;border:0px;height:'+t+'px;" src="about:blank" '+s+" ></iframe></div>"},v=function(){return'   <div id="zoom-view" class="zoom-view"><a class="zoom" id="expand-icon" href="#">expand</a><div>'},m=function(e){var t="";return e.zoomView&&(t=v()),e.iframe=t+d(e.src,e.height,e.secure,e.id),f(e)},g=function(){};return{add:f,init:p,show:h,addEvents:l,addWithIframe:m,remove:c}}(e)}),define("hbs!templates/common/wall_filters",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n    <li class="'+l((r=(r=t,r==null||r===!1?r:r.key),typeof r===f?r.apply(e):r))+'"><a href="#" class="filter" data-type="'+l((r=(r=t,r==null||r===!1?r:r.key),typeof r===f?r.apply(e):r))+'">'+l(typeof e===f?e.apply(e):e)+"</a></li>\n    ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<a class="manage-vip rfloat" style="display: none">\n    <i class="ui-inline-icon manage-icon"></i> <span>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"vip.tips_manage_link",a):c.call(t,"t","vip.tips_manage_link",a)))+'</span>\n</a>\n<a id="subject-search-icon" class="subject-search-icon rfloat">\n  <img src="',a={hash:{},data:i},s+=l((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/subject-search-icon.png",a):c.call(t,"imagePath","images/subject-search-icon.png",a)))+'" alt="">\n</a>\n<a class="updated-posts rfloat" href="#" style="height: 16px;"><span>',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"home.filter_posts",a):c.call(t,"t","home.filter_posts",a)))+'</span><i class="ui-inline-icon arrow-down"></i></a>\n<ul class="filter-posts hidden">\n    <li class="first"><a >',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"home.filter_posts",a):c.call(t,"t","home.filter_posts",a)))+"</a></li>\n    ",u=n.each.call(t,t&&t.list,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;return s+="\n</ul>\n",s})}),define("views/common/wall_filters",["jquery","underscore","tibbr","hbs!templates/common/wall_filters"],function(e,t,n,r){return n.View.extend({className:"wall-header",initialize:function(){t.bindAll(this,"render","list","changeSection","reset"),this.event.bindTo(this,"section:change",this.changeSection),this.event.bindTo(this,"wallFilter:reset",this.reset),this.key=params.controller==="subjects"?"subjects":"wall",this.$el.html(this.renderTemplate(r,{key:this.key,list:this.list()})),this.$("li.all_post").addClass("active").find("a").text(this.options.name),this.templ=r},events:{"click .manage-vip":function(){e.fn.manageVip()}},render:function(){return this.bind(),this},reset:function(e){this.$el.html(this.renderTemplate(this.templ,{key:this.key,list:this.list()})),this.$("li.all_post").addClass("active"),this.bind();try{e.initAdvancedSearch()}catch(t){}},hide:function(){this.$(".updated-posts").hide()},show:function(){this.$(".updated-posts").show()},changeWall:function(t,r){var i=e(t.currentTarget),s=i.data("type"),o=e(r),u=this.$(".updated-posts");o.find(".active").removeClass("active"),i.parent().addClass("active"),u.qtip("hide"),s==="all_post"?(u.find("span").text(this.$("li.first").text()),s=null):u.find("span").text(i.text()),n.Event.trigger("filter:change",{id:this.filterId,cache:!1,filter:s,text:e("#active").text()})},changeSection:function(e,t){this.filterId=e;switch(e){case"chat":this.$(".updated-posts").hide();break;case"vip":this.$(".manage-vip").show();break;default:this.$(".updated-posts").show(),this.$(".manage-vip").hide()}},list:function(){return this.t("home."+this.key+"_filters")},bind:function(){var t=this,n={position:{at:"bottom left",my:"top left"},show:{event:"click",modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus"};this.$(".updated-posts").qtip(e.extend({},n,{style:{classes:"filter-posts-tooltip qtip-light",tip:!1},position:{at:"top right",my:"top right",adjust:{x:1,y:0},effect:!1},content:{text:t.$(".filter-posts").clone()},events:{render:function(n,r){var i=r.elements.tooltip;e(i).on("click","a.filter",function(e){return t.changeWall(e,i),!1})}}})).click(function(e){return e.preventDefault(),!1})}})}),define("hbs!templates/common/wall_tab",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="wall-header"></div>\n<div id="wall-tabs" class="wall-view">\n    <ul>\n        <li><a id="active_wall" href="#wall-tabs-1">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.my_wall",u):a.call(t,"t","home.my_wall",u)))+'</a></li>\n    </ul>\n    <div id="stream-wrap" class="stream-wrap rfloat"></div>\n    <div id="wall-tabs-1">\n        <div class="tibbit_div"></div>\n    </div>\n</div>',s})}),define("views/common/wall_tab",["jquery","underscore","tibbr","modules/wall_tab","views/common/wall_filters","hbs!templates/common/wall_tab"],function(e,t,n,r,i,s){return n.View.extend({className:"wall",id:"wall",events:{"tabsactivate div#wall-tabs":"tabSelected"},initialize:function(e){t.bindAll(this,"render","tabSelected","wallPage","change"),this._template=e.template||s},render:function(){this.$el.html(this.renderTemplate(this._template,{isHome:n.currentNav==="home"}));if(n.currentNav==="home"||n.currentNav==="subjects")this.wallFilters=this.initChild(i,{name:this.options.name}).render(),this.$(".wall-header").replaceWith(this.wallFilters.el);t.isString(this.options.name)&&this.$("#active_wall").text(this.options.name.replace(/%20/gi," "));var r=this.options.$container||e("#content");return r.append(this.el),this.bind(),this},bind:function(){this.tab=r.init("wall-tabs")},setName:function(e){this.$("a#active_wall").text(e)},add:function(e){e.id=e.id||t.uniqueId("wall-tabs-");var n=this.indexById(e.id);return n>0?this.show(n):r.add(e)},addEvents:function(e){r.addEvents(e)},remove:function(e){r.remove(this.indexById(e))},addWithIframe:function(e){e.id=e.id||t.uniqueId("tab");var n=this.indexById(e.id);n>0?this.show(n):r.addWithIframe(e)},show:function(e){return r.show(e||0)},edit:function(e){var t=this.indexById(e.id);t>0?(this.remove(e.id),e.index=t,e.src?this.addWithIframe(e):this.add(e)):console.warn("can not edit the tab with id "+e.id)},indexById:function(e){try{return this.$(".ui-tabs-nav li").index(this.find(e).parent())}catch(t){return!1}},find:function(t){try{return this.$("a[data-id="+t+"]")}catch(n){return e([])}},tabSelected:function(e,t){this.viewHandler(t),this.wallPage(t),this.trigger("walltab:selected",t.newTab);try{t.index===0?this.wallFilters.show():this.wallFilters.hide()}catch(n){}},viewHandler:function(e){var n=this,r=e.newTab,i=e.newPanel,s=r.data("view"),o=r.data("onRender"),u="js-view-"+i.attr("id"),a,f=r.data("iframe");t.isObject(s)&&!i.hasClass(u)&&(t.isUndefined(s.context)?(a=new s.View(s.options),e.newTab.on("remove",function(){try{a&&(a.leave(),a=null)}catch(t){console.warn("try to remove wall tab ViewHandler:",e.index)}n.show(0)})):(a=s.context.initChild(s.View,s.options),s.context.on("before:leave",function(){try{a&&(a.leave(),a=null)}catch(t){console.warn("try to remove wall tab ViewHandler:",e.index)}n.show(0)})),a.$tab=r,i.html(a.render().el).addClass(u),t.isFunction(o)&&o(a,e),r.data("_view",a)),f&&!i.hasClass(u)&&i.html(f).addClass(u)},wallPage:function(t){var n=t.newTab.find("a"),r=t.newTab,i=t.newPanel,s=e(document).height(),o=this.tab;n.hasClass("wall-tab-page")?(o.hasClass("zoomed")||(o.addClass("zoomed"),e(".js-hide-on-wall-change").hide()),i.find("iframe").height(s+"px")):(n.attr("id")==="active_wall"||n.hasClass("no-zoomed"))&&o.hasClass("zoomed")&&(this.$(".zoomed").removeClass("zoomed"),r.find("iframe").height("500px"),e(".js-hide-on-wall-change").show())},change:function(e,t){}})}),define("collections/groups",["tibbr","models/group"],function(e,t){return e.Collection.extend({className:"groups",tibbrURL:{controller:"groups",action:"index"},model:t})}),define("collections/groups_search",["jquery","tibbr","collections/groups"],function(e,t,n){return n.extend({tibbrURL:{controller:"users",action:"search_groups"}})}),define("models/sp_list",["underscore","tibbr"],function(e,t){return t.Model.extend({defaults:{modelType:"SpList"},baseName:"sp_lists",initialize:function(){e.bindAll(this,"getFolders","path","name")},getFolders:function(e,t,n){var r=this;this.action("list_items","read",{data:{params:{id:e,site:t,next_link:n}},error:function(){r.trigger("errorDirectory")},success:function(e,t){r.trigger("successDirectory",t)}})},name:function(){return e.str.truncate(this.get("name"),15)},path:function(){return e.str.truncate(this.get("path").replace(this.get("name"),""),30)}})}),define("collections/sharepoint/search",["jquery","tibbr","models/sp_list"],function(e,t,n){return t.Collection.extend({className:"Search",model:n,tibbrURL:{controller:"sp_lists",action:"search"}})}),define("modules/common/collections/resource_search",["jquery","tibbr","./resources"],function(e,t,n){return n.extend({tibbrURL:{controller:"users",action:"search_resources"},perPage:5,load:function(e){this.fetch({data:{search_str:e,page:1,per_page:this.perPage,set_actions:!0}})}})}),define("collections/resource_search",["jquery","tibbr","modules/common/collections/resource_search"],function(e,t,n){return n.extend({})}),define("models/og_file",["underscore","tibbr","modules/common/models/og_file"],function(e,t,n){return n.extend({})}),define("hbs!templates/common/global_search_results_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function c(e,t){var r="",i,s;return r+='\r\n    <a class="profile-pic" href="',s={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):u.call(e,"urlFor","show",e&&e.model,s)))+'">\r\n        <img src="',s={hash:{},data:t},r+=a((i=n.assetImage||e&&e.assetImage,i?i.call(e,(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.profile_image_url),s):u.call(e,"assetImage",(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.profile_image_url),s)))+'" class="medium bordered-small">\r\n    </a>\r\n    <div class="info">\r\n        <h5><a href="',s={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):u.call(e,"urlFor","show",e&&e.model,s)))+'">'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.user),i==null||i===!1?i:i.display_name),typeof i===f?i.apply(e):i))+'</a></h5>\r\n        <a href="',s={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):u.call(e,"urlFor","show",e&&e.model,s)))+'">',s={hash:{},data:t},r+=a((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.content),30,s):u.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.content),30,s)))+"</a>\r\n    </div>\r\n",r}function h(e,t){var r="",i,s;return r+='\r\n    <a href="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.url),typeof i===f?i.apply(e):i))+'">\r\n        <img src="',s={hash:{},data:t},r+=a((i=n.imagePath||e&&e.imagePath,i?i.call(e,"images/unknownfile-sm-icon.png",s):u.call(e,"imagePath","images/unknownfile-sm-icon.png",s)))+'" class="file-type-icon">\r\n        <span class="ctipsy" title="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===f?i.apply(e):i))+'">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===f?i.apply(e):i))+"</span>\r\n    </a>\r\n",r}function p(e,t){var r="",i,s;return r+='\r\n    <a class="js-action-target-link profile-pic"\r\n       data-target="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===f?i.apply(e):i))+'"\r\n       href="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'"\r\n       data-native="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===f?i.apply(e):i))+'"\r\n       data-app_id="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===f?i.apply(e):i))+'">\r\n        <img src="',s={hash:{},data:t},r+=a((i=n.imagePath||e&&e.imagePath,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.image),s):u.call(e,"imagePath",(i=e&&e.model,i==null||i===!1?i:i.image),s)))+'" class="medium bordered-small"/>\r\n    </a>\r\n    <div class="info">\r\n        <h5> <a class="js-action-target-link"\r\n                 data-target="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===f?i.apply(e):i))+'"\r\n                 href="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'"\r\n                 data-native="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===f?i.apply(e):i))+'"\r\n                 data-app_id="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===f?i.apply(e):i))+'">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===f?i.apply(e):i))+'</a>\r\n        </h5>\r\n        <a class="js-action-target-link"\r\n           data-target="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===f?i.apply(e):i))+'"\r\n           href="'+a((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.link),typeof i===f?i.apply(e):i))+'"\r\n           data-native="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===f?i.apply(e):i))+'"\r\n           data-app_id="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===f?i.apply(e):i))+'">',s={hash:{},data:t},r+=a((i=n.truncate||e&&e.truncate,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.description),30,s):u.call(e,"truncate",(i=e&&e.model,i==null||i===!1?i:i.description),30,s)))+"\r\n        </a>\r\n    </div>\r\n\r\n",r}function d(e,t){var r="",i,s,o;r+='\r\n    <a class="profile-pic" href="',o={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,o):u.call(e,"urlFor","show",e&&e.model,o)))+'">\r\n        <img src="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.profileImageMedium),typeof i===f?i.apply(e):i))+'" class="medium bordered-small">\r\n    </a>\r\n    <div class="info">\r\n        <h5>\r\n            ',s=n["if"].call(e,e&&e.isGroup,{hash:{},inverse:l.program(10,m,t),fn:l.program(8,v,t),data:t});if(s||s===0)r+=s;return r+="\r\n        </h5>\r\n    </div>\r\n",r}function v(e,t){var r="",i,s;return r+='\r\n                <a title="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===f?i.apply(e):i))+'" href="',s={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):u.call(e,"urlFor","show",e&&e.model,s)))+'">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===f?i.apply(e):i))+"</a>\r\n            ",r}function m(e,t){var r="",i,s;r+="\r\n                ",i=n["if"].call(e,e&&e.isSubject,{hash:{},inverse:l.noop,fn:l.program(11,g,t),data:t});if(i||i===0)r+=i;return r+='\r\n                <a class="detail" title="'+a((i=(i=e&&e.model,i==null||i===!1?i:i.name),typeof i===f?i.apply(e):i))+'" href="',s={hash:{},data:t},r+=a((i=n.urlFor||e&&e.urlFor,i?i.call(e,"show",e&&e.model,s):u.call(e,"urlFor","show",e&&e.model,s)))+'">'+a((i=(i=e&&e.model,i==null||i===!1?i:i.display_name),typeof i===f?i.apply(e):i))+"</a>\r\n            ",r}function g(e,t){var n="",r;return n+='\r\n                    <i class="'+a((r=(r=e&&e.model,r==null||r===!1?r:r.scope),typeof r===f?r.apply(e):r))+' ui-inline-icon lfloat"></i>\r\n                ',n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=n.helperMissing,a=this.escapeExpression,f="function",l=this;o=n["if"].call(t,t&&t.isMessage,{hash:{},inverse:l.noop,fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+="\r\n\r\n",o=n["if"].call(t,t&&t.isSpList,{hash:{},inverse:l.noop,fn:l.program(3,h,i),data:i});if(o||o===0)s+=o;s+="\r\n\r\n",o=n["if"].call(t,t&&t.isResources,{hash:{},inverse:l.noop,fn:l.program(5,p,i),data:i});if(o||o===0)s+=o;s+="\r\n\r\n",o=n["if"].call(t,t&&t.isUsersSubjectsGroups,{hash:{},inverse:l.noop,fn:l.program(7,d,i),data:i});if(o||o===0)s+=o;return s+="\r\n\r\n\r\n",s})}),define("views/common/global_search_results_item",["jquery","underscore","tibbr","models/og_file","hbs!templates/common/global_search_results_item"],function(e,t,n,r,i){return n.View.extend({tagName:"li",events:{"click a":"navigate",hover:"setClass"},render:function(){var e=this.model.baseName;return this.model.get("type")==="og:file"&&(this.model=new r(this.model.toJSON())),this.$el.html(this.renderTemplate(i,{isUsersSubjectsGroups:e=="users"||e==="subjects"||e==="groups",isMessage:e==="messages",isSpLists:e==="sp_lists",isResources:e==="resources",isGroup:e==="groups",isSubject:e==="subjects"})),this},navigate:function(e){if(this.model.baseName!=="resources")n.redirectTo(this.model.urlFor("show"));else{var t=this.$("a.js-action-target-link:first"),r=t.data();r.link=t.attr("href"),n.Modules.View.ActionLink.actionTargetLink()}return!1},setClass:function(){e("div#global-search-results").find("li.active").removeClass("active").end(),this.$el.addClass("active")}})}),define("hbs!templates/common/global_search_results",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i;return r+='\r\n    <div class="',(i=n.key)?i=i.call(e,{hash:{},data:t}):(i=e&&e.key,i=typeof i===a?i.call(e,{hash:{},data:t}):i),r+=f(i)+' hidden js-result">\r\n        <h4>',(i=n.translation)?i=i.call(e,{hash:{},data:t}):(i=e&&e.translation,i=typeof i===a?i.call(e,{hash:{},data:t}):i),r+=f(i)+"</h4>\r\n        <ul></ul>\r\n    </div>\r\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<div class="js-results" style="overflow: auto; clear: both;">\r\n    ',o=n.each.call(t,t&&t.types,{hash:{},inverse:l.noop,fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;return s+='\r\n</div>\r\n<div class="show-all hidden js-result"><a class="show-all"></a></div>\r\n<p class="no-result hidden js-result" style="margin-left: 6px">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.no_search_result",u):c.call(t,"t","common.no_search_result",u)))+"</p>",s})}),define("views/common/global_search_results",["jquery","underscore","tibbr","views/common/global_search_results_item","hbs!templates/common/global_search_results"],function(e,t,n,r,i){return n.View.extend({initialize:function(e){t.bindAll(this,"displayFooterInfo"),this.collections=this.options.collections||{}},render:function(){return this.$el.html(this.renderTemplate(i,{types:this.types()})),this},types:function(){return t.collect(this.collections,function(e,t){return{key:t,translation:this.t("common.global_search."+t)}},this)},displayFooterInfo:function(r){var i=t.detect(this.collections,function(e){return e.total_pages>1}),s=0;t.each(this.collections,function(e){s+=e.length}),i&&this.$(".show-all").find("a").attr({href:n.url("explore/search?q="+r)}).text(this.t("common.show_all_results_for",{search_str:r})).end().removeClass("hidden"),s===0?this.$(".no-result").removeClass("hidden"):this.$(".js-results").css("max-height",e(window).height()-100)},displayResultFor:function(e,t){if(t.length){var n=this.$("."+e),i=n.find("ul").empty();t.each(function(e){i.append(this.initChild(r,{model:e}).render().el)},this),n.removeClass("hidden")}}})}),define("hbs!templates/common/global_search",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<fieldset>\r\n    <input type="text" class="search-string" placeholder="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.search",u):a.call(t,"t","common.search",u)))+'"/>\r\n    <button type="submit" title="',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.search",u):a.call(t,"t","common.search",u)))+'" class="search-btn"></button>\r\n</fieldset>\r\n\r\n\r\n',s})}),define("views/common/global_search",["jquery","underscore","tibbr","collections/users_search","collections/subjects_search","collections/all_messages","collections/groups_search","collections/sharepoint/search","collections/resource_search","views/common/global_search_results","hbs!templates/common/global_search"],function(e,t,n,r,i,s,o,u,a,f,l){return n.View.extend({id:"global-search",className:"search-box rfloat mvxl",events:{"keyup .search-string":"keyup","click .search-btn":"submit"},initialize:function(){t.bindAll(this,"search","submit"),this.qtipped=!1,this.config=n.appConfig("ui_config","config","search"),this.timeout=null,this.lastSearchStr=" ",this.searchFor=this.options.searchFor||this.config.list,this.collections={},this.activeElement=null,this.currentElementIndex=0,this.$container=e("#global-search-results"),this.$container.length===0&&(this.$container=e('<div id="global-search-results" class="hidden"></div>').insertAfter("#container"))},_collection:function(e){return new({subjects:i,users:r,messages:s,eog_resources:a,groups:o,sharepoint:u}[e.toLowerCase()])},render:function(){var e=this;return this.config.spotlight?(t.each(this.searchFor,function(t){e.collections[t]=e._collection(t)}),this.resultView=this.initChild(f,{el:"#global-search-results",collections:this.collections}),this.resultView.render()):this.$el.off("keyup",".search-string"),this.$el.html(this.renderTemplate(l)),this},keyup:function(e){switch(e.keyCode){case 40:case 38:this.changeFocus(e);break;case 9:case 13:try{this.activeElement.click()}catch(t){this.submit()}break;case 27:this.$el.qtip("hide");break;default:this.search()}return!1},search:t.debounce(function(){var r=e.trim(this.$("input.search-string").val()),i=this,s=e.trim(this.lastSearchStr),o={params:{per_page:5,search_str:r}};this.qtipped||(this.$el.qtip(n.qtipConfigs.gSearch(this)),this.qtipped=!0),this.$el.qtip("enable");if(r.length===0)return this.$el.qtip("hide"),!0;if(r!==s){this.lastSearchStr=r;var u=[];this.$container.find(".line-loader").remove(),this.$container.prepend(n.UI.loader),this.resultView.leaveChild(),this.resultView.$(".js-result").addClass("hidden"),this.$el.qtip("show"),t.each(this.collections,function(e,s){var a=t.clone(o);s=="sharepoint"?(delete a.search_str,a.search_string=r):e.scopeId=n.currentUser.id,s==="messages"&&(a.include_replies=!0);var f=e.fetch({global:!1,data:o});f.done(function(){i.renderResult(s,e,r)}),u.push(f)}),e.when.apply(e,u).always(function(){i.resultView.displayFooterInfo(r)})}return!1},700),showList:function(){if(this.qtipped&&e.trim(this.$("input.search-string").val()).length>0)return this.$el.qtip("show"),!0},renderResult:function(e,t){this.$container.find(".line-loader").remove(),this.resultView.displayResultFor(e,t)},changeFocus:function(e){this.activeElement=this.$container.find("li.active");var t,n=this.$container.find("li");if(e.keyCode==40){if(this.activeElement&&this.activeElement.length){var r=n.index(this.activeElement);this.currentElementIndex=r+1}}else this.currentElementIndex-=1;return this.currentElementIndex===-1&&(this.currentElementIndex=0),t=n.eq(this.currentElementIndex),t.length&&(this.$container.find("li.active").removeClass("active"),t.addClass("active"),this.activeElement=t),this.scroll(),!1},scroll:function(){var e=this.$container.find(".js-results"),t=this.activeElement,n=t.offset().top,r=e.height();return n>r&&e.scrollTop(n-e.offset().top+e.scrollTop()),n<1&&e.scrollTop(n-120-e.offset().top+e.scrollTop()),this},submit:function(){var t=e.trim(this.$("input.search-string").val());t===this.t("common.search")&&(t="");if(t.length===0)return;this.$(".search-string").trigger("focusout"),n.redirectTo("explore/search?q="+t)},splice:function(e){var n=t.indexOf(this.searchFor,e);n>-1&&this.searchFor.splice(n,1)},_cleanUp:function(){var n=this;t.delay(function(){e("input.search-string").val(""),n.cleanUp()},200)},cleanUp:function(){this.lastSearchStr="",this.resultView&&(this.resultView.leaveChild(),this.resultView.$(".js-result").addClass("hidden")),this.$el.qtip("disable")}})}),define("modules/common/models/notification",["underscore","tibbr","require/moment","./user","./resource_action_link"],function(e,t,n,r,i){return t.Model.extend({baseName:"notifications",defaults:{modelType:"Notification"},actor:{},getUrl:function(n,r,i,s){var o,u=t.Helper;switch(n){case"User":o="users/"+r;break;case"Subject":o="subjects/"+r;break;case"Message":o="messages/"+r;break;case"Resource":case"EogResource":o="resources/"+r;break;case"ApplicationDefinition":o="apps/"+r+"/details";break;default:return""}var a=!0;return t.isMobile&&e.include(["User","Subject","Message"],n)&&(a=!1),u.url(o,{gadget:!1,host:a})},postDate:function(){return this.displayDate(n,"ntime")},getNotificationType:function(){return this.get("ntype")==="recommends_subject_to_me"},unread:function(e,t){this.action("mark_as_read","update",{data:{notification_ids:e},complete:t})},parse:function(e){return this._parse(e),e},initialize:function(e){e&&this._parse(e)},_buildLink:function(e){if(e.type==="Link"){var n=e.url;return n+=(n.indexOf("?")>0?"&":"?")+"user_id="+t.currentUser.id,e.authorize?t.path("/oauth/authorizations/authorize?client_id="+e.app_id+"&redirect_url="+n):n}return t.path("/oauth/authorizations/authorize?client_id="+e.app_id+"&resource_action_id="+e.resource_action_id)},_parse:function(n){if(n){var s=n.text,o=this,u=n.ntype,a="",f=e.map(s.match(t.wikiRegex),function(t){var s={rawString:t},a=t.replace(/@\[|[\]$]/g,""),f=a.match(/^Link:/);if(!f){s.modelId=/:\w+\|/.exec(a)[0].replace(/:|\|/g,""),s.context=a.split(/:\w+\|/.exec(a)[0])[0],s.client_id=n.client_id,s.appObj=e.string.startsWith(s.context,"APP.");var l=a.split(/:\w+\|/.exec(a)[0])[1]||"";s.title=s.context=="Message"&&l===""?"post":l,s.isVip=s.context==="User"?(new r({id:s.modelId})).isVip():!1,e.string.isBlank(s.title)&&(s.title=s.context),s.url=o.getUrl(s.context,s.modelId,s.title,s.client_id),o.get("stype")==="system_resource"&&(s.action_link=(new i(e.detect(o.get("subject").resource.action_links,function(e){return e["default"]===!0}))).forTemplate(),s.stype="system_resource",s.url=s.action_link.link);if(s.context==="EogResource"){var c=s.title.split("||");s.url=c[0],s.title=c[1],s.action_link={isNative:!1,display_target:c[2],link:c[0]}}s.appObj&&(o.appNotification=!0,o.appId=s.appId=u.split(".")[1],s.context=s.appObjLinkType=s.context.replace("APP.",""))}else{s.context="Link";var h=JSON.parse(a.replace(/Link:\"(.*)\"/,"$1"));s.title=h.title,s.link=s.url=o._buildLink(h),s.action_link=h}return s.image_url=function(e){var t="";e&&(t="?style="+e);if(s.appObj)return o._path("application_definitions/"+s.appId+"/icon")+t;switch(s.context){case"User":return o._path("users/"+s.modelId+"/profile_image")+t;case"Subject":return n.img_url;case"Group":return o._path("groups/"+s.modelId+"/profile_image")+t}return"#"},s});e.each(f,function(t){var n,r=$("<a/>",{href:t.url,text:t.title,"class":t.context,attr:{"data-wiki":function(){var n=e.clone(t);return n.rawString=encodeURI(n.rawString),JSON.stringify(n.context==="Link"||n.context==="EogResource"||n.stype==="system_resource"?n.action_link:n)},"data-target":(t.action_link||{}).display_target}});if(t.appObj)n="notifications-app-links";else switch(t.context){case"Group":n="active-links js-read notifications-"+t.context;break;case"Link":case"EogResource":n="js-action-link js-read notifications-"+t.context;break;default:t.stype==="system_resource"?n=n="js-action-link js-read notifications-"+t.context:n="js-dialog js-read notifications-"+t.context}r.addClass(n),s=s.replace(t.rawString,$("<div/>").append(r).html())}),this.actor=f[0],this.wikiData=f;if(e.string.startsWith(u,"AppNotification.")){this.appNotification=!0;var l=this.viaAppId=u.split(".")[1];this.viaAppSubType=u.split(".")[2],this.viaAppImageUrl=function(e){var t="";return e&&(t="?style="+e),o._path("application_definitions/"+l+"/icon")+t}}this.html=s}},appImageUrlSmall:function(){if(this.viaAppImageUrl)return this.viaAppImageUrl("small")},getDateWords:function(e){var r=e.onlyDateArray(),i=(new Date).toDateOnlyArray(),s=n(i),o=s.diff(r,"days");if(o<=0)return t.translate("subject.Notifications.today");if(o===1)return t.translate("subject.Notifications.yesterday");if(o>=2)return n(e).format("LL")},for_template:{actor:"actor",html:"html",actor_image:function(){return this.actor.image_url()},appNotification:"appNotification",viaAppImageUrl:"appImageUrlSmall"}})}),define("models/notification",["underscore","tibbr","modules/common/models/notification"],function(e,t,n){return n.extend({})}),define("models/subscription",["underscore","tibbr","models/user","models/subject"],function(e,t,n,r){return t.Model.extend({defaults:{modelType:"Subscription"},initialize:function(){e.bindAll(this,"parseHtml","getUrl","getImageUrl","getUser","getSubject")},parseHtml:function(){var e,t=this.get("user"),n=this.get("subject"),r=t.id,i=n.id,s=t.display_name,o=n.name,u=this.getUrl("User",r),a=this.getUrl("Subject",i),f=this.getImageUrl("User",r),l=this.getImageUrl("Subject",i);return" <p><a class='notifications-User' href='"+u+"'> "+s+" </a> has requested to follow <a class='notifications-Subject' href='"+a+"'>"+o+" </a></p>"},getUrl:function(e,n){switch(e){case"User":return t.url("/users/"+n);case"Subject":return t.url("/subjects/"+n);case"Message":return t.url("/message-id/"+n)}},getUser:function(){return this.user||(this.user=new n(this.get("user"))),this.user},getSubject:function(){return this.subject||(this.subject=new r(this.get("subject"))),this.subject},getImageUrl:function(e,t){switch(e){case"User":return this._path("/users/"+t+"/profile_image");case"Subject":return this._path("/subjects/"+t+"/profile_image")}return"#"}})}),define("models/follower",["underscore","tibbr","models/user"],function(e,t,n){return t.Model.extend({defaults:{modelType:"Follower"},initialize:function(){e.bindAll("getUser")},getUser:function(){return this.user||(this.user=new n(this.get("follower"))),this.user}})}),define("modules/common/collections/notifications",["underscore","tibbr","modules/common/models/notification"],function(e,t,n){return t.Collection.extend({className:"notifications",tibbrURL:{controller:"notifications"},model:n,parse:function(e){return this.unreads=e.total_unread,e.notifications},_set:function(t){this.reset(),this.unreads=t.total_unread;var r=this;return e.each(t.notifications,function(e){r.add(new n(e),{silent:!0})}),this},addSubjectRequest:function(e){var n=[{title:this.t("user.actions.follow"),rel:"subscribe",id:"invitation-accept",className:"js-invitation-requests js-invitation-accept",data:{id:e.id,action:"subscribe",section:"invitation",user_id:t.currentUser.id}},{title:this.t("user.actions.ignore"),rel:"unsubscribe",id:"invitation-ignore",className:"js-invitation-requests js-invitation-ignore",data:{id:e.id,action:"unsubscribe",section:"invitation",user_id:t.currentUser.id}}];this.add({type:this.t("notifications.subject_invitation"),id:"111-"+e.get("id"),ntime:e.get("context_properties").invitation_created_at,ntype:"recommends_subject_to_me",actions:n,stype:e.get("stype"),subject:e.toJSON(),text:this.t("notifications.invitation_to_follow",{subject:"@[Subject:"+e.id+"|"+e.get("display_name")+"]"}),img_url:e.image(5)},{silent:!0})},addSubscriptionRequest:function(t){var n=[],r,i=t.get("actions",""),s=t.getUser(),o=t.getSubject(),u=o.get("eog_resource")||{};e.each(i.split(","),function(r){n.push({title:e.str.capitalize(r),rel:r,id:"subscription-"+r,className:"js-subscriptions-requests js-subscriptions-"+r,data:{id:t.get("id"),subject_id:o.get("id"),action:r,user_id:s.id}})}),e.isEmpty(u)?r="@[Subject:"+o.id+"|"+o.get("display_name")+"]":r="@[Resource:"+u.id+"|"+o.get("display_name")+"]",this.add({type:this.t("notifications.subscription_request"),id:"222-"+t.get("id"),ntime:t.get("created_at"),ntype:"request_to_follow",actions:n,client_id:u.app_id,text:this.t("notifications.requested_to_follow_list",{user:"@[User:"+s.get("id")+"|"+s.get("display_name")+"]",list:r})},{silent:!0})},addFollowerRequest:function(e){var t=e.getUser(),n=[{title:this.t("user.actions.approve"),rel:"approve",id:"follower-accept",className:"js-follower-requests js-follower-accept",data:{id:e.id,action:"approve",follower_id:t.id}},{title:this.t("user.actions.reject"),rel:"reject",id:"follower-ignore",className:"js-follower-requests js-follower-ignore",data:{id:e.id,action:"reject",follower_id:t.id}}];this.add({type:this.t("notifications.follower_request"),id:"333-"+e.get("id"),ntime:e.get("created_at"),ntype:"request_to_follow",actions:n,text:this.t("notifications.requested_to_follow",{user:"@[User:"+t.get("id")+"|"+t.get("display_name")+"]"})},{silent:!0})}})}),define("collections/notifications",["underscore","tibbr","modules/common/collections/notifications"],function(e,t,n){return n.extend({})}),define("collections/subscriptions",["tibbr","models/subscription"],function(e,t){return e.Collection.extend({className:"subscriptions",model:t})}),define("collections/follower_list",["tibbr","models/follower"],function(e,t){return e.Collection.extend({className:"followers",model:t})}),define("hbs!modules/common/templates/messages/notification",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i;r+='\r\n                <div class="request-section">\r\n                    ',i=n.each.call(e,e&&e.actions,{hash:{},inverse:l.noop,fn:l.program(2,p,t),data:t});if(i||i===0)r+=i;return r+="\r\n                </div>\r\n\r\n            ",r}function p(e,t){var r="",i,s;r+='\r\n                        <a  id="'+f((i=(i=e&&e.model,i==null||i===!1?i:i.type),typeof i===a?i.apply(e):i))+"-",(s=n.id)?s=s.call(e,{hash:{},data:t}):(s=e&&e.id,s=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(s)+'"\r\n                           class="notification-links submit-btn btn btn-submit ',s=n["if"].call(e,e&&e.className,{hash:{},inverse:l.noop,fn:l.program(3,d,t),data:t});if(s||s===0)r+=s;r+='"\r\n                           rel="',(s=n.rel)?s=s.call(e,{hash:{},data:t}):(s=e&&e.rel,s=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(s)+'"\r\n                            ',s=n["if"].call(e,e&&e.data,{hash:{},inverse:l.noop,fn:l.program(5,v,t),data:t});if(s||s===0)r+=s;return r+="\r\n                                >",(s=n.title)?s=s.call(e,{hash:{},data:t}):(s=e&&e.title,s=typeof s===a?s.call(e,{hash:{},data:t}):s),r+=f(s)+"</a>\r\n                    ",r}function d(e,t){var r="",i;return r+=" ",(i=n.className)?i=i.call(e,{hash:{},data:t}):(i=e&&e.className,i=typeof i===a?i.call(e,{hash:{},data:t}):i),r+=f(i)+" ",r}function v(e,t){var r="",i;r+="\r\n                           data-params = '{ ",i=n.each.call(e,e&&e.data,{hash:{},inverse:l.noop,fn:l.program(6,m,t),data:t});if(i||i===0)r+=i;return r+=' "type": "'+f((i=(i=e&&e.model,i==null||i===!1?i:i.type),typeof i===a?i.apply(e):i))+"\" }'\r\n                            ",r}function m(e,t){var n="",r;return n+=' "'+f((r=(r=t,r==null||r===!1?r:r.key),typeof r===a?r.apply(e):r))+'":"'+f(typeof e===a?e.apply(e):e)+'" , ',n}function g(e,t){var r="",i,s;return r+='\r\n                <div class="read-or-mute mrs">\r\n                    <a class="mark-read js-mark" title="',s={hash:{},data:t},r+=f((i=n.t||e&&e.t,i?i.call(e,"notifications.mark_read",s):c.call(e,"t","notifications.mark_read",s)))+'"><i class="ui-inline-icon mark-read-icon"></i></a>\r\n                </div>\r\n            ',r}function y(e,t){var n="",r;return n+='\r\n            <div class="rfloat">\r\n                <div class="posted-content mhl">\r\n                    <img src="'+f((r=(r=e&&e.model,r==null||r===!1?r:r.image_url),typeof r===a?r.apply(e):r))+'" alt="posted-img">\r\n                </div>\r\n            </div>\r\n        ',n}function b(e,t){return'\r\n                    <span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>\r\n                '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this,c=n.helperMissing;s+='<div class="notification-content clearfix">\r\n    <div class="media-box">\r\n        <div class="rfloat">\r\n            ',o=n["if"].call(t,t&&t.actions,{hash:{},inverse:l.program(8,g,i),fn:l.program(1,h,i),data:i});if(o||o===0)s+=o;s+="\r\n        </div>\r\n        ",o=n["if"].call(t,t&&t.isImage,{hash:{},inverse:l.noop,fn:l.program(10,y,i),data:i});if(o||o===0)s+=o;s+='\r\n        <div class="info">\r\n            <a href="'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.actor),o==null||o===!1?o:o.url),typeof o===a?o.apply(t):o))+'" class="profile-pic js-read"><img width="45" height="45" src="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.actor_image),typeof o===a?o.apply(t):o))+'" class="js-read">\r\n                ',u=n["if"].call(t,(o=(o=t&&t.model,o==null||o===!1?o:o.actor),o==null||o===!1?o:o.isVip),{hash:{},inverse:l.noop,fn:l.program(12,b,i),data:i});if(u||u===0)s+=u;s+='\r\n            </a>\r\n            <div class="info">\r\n                <p class="notify-text"><a href="#" class="notifications-User"> ',(u=n.text)?u=u.call(t,{hash:{},data:i}):(u=t&&t.text,u=typeof u===a?u.call(t,{hash:{},data:i}):u);if(u||u===0)s+=u;return s+='</p>\r\n                <p><i class="time-stamp">',(u=n.time)?u=u.call(t,{hash:{},data:i}):(u=t&&t.time,u=typeof u===a?u.call(t,{hash:{},data:i}):u),s+=f(u)+"</i></p>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n",s})}),define("modules/common/views/messages/notification_item",["jquery","underscore","tibbr","modules/common/models/message","hbs!modules/common/templates/messages/notification"],function(e,t,n,r,i){return n.View.extend({tagName:"li",className:"notification-li",events:{"click a.inactive-links":"inactiveLinkHandler","click a.js-mark":"markAsRead","click a.js-dialog":"navigateToPost","click a.js-hash-tag":"hashTags","click a.js-read":"markAsRead",mouseenter:function(){this.$(".js-mark").show()},mouseleave:function(){this.$(".js-mark").hide()}},inactiveLinkHandler:function(e){e.preventDefault()},render:function(){var e=this.model.get("image_url")?!0:!1,t=this,r=n.Helper.hashToUrl(this.model.html);return this.$el.html(this.renderTemplate(i,{text:r,time:this.model.postDate(),actions:this.model.get("actions"),isImage:e})).addClass(this.model.get("status")),this.model.get("status")==="read"?this.$(".js-mark").remove():this.$(".js-mark").hide(),window.gadget&&(this.$(".notifications-User").removeAttr("href"),this.$(".notifications-User").removeClass("js-dialog"),this.$(".profile-pic").removeAttr("href"),this.$(".notifications-User").not(".btn-submit").css({cursor:"default"}),this.$(".profile-pic").not(".btn-submit").css({cursor:"default"})),this.$(".js-mark").qtip(n.qtipConfigs.tipsy()),this},markAsRead:function(e){var t=this;this.model.action("mark_as_read","update",{id:!1,data:{notification_ids:t.model.id},setModel:!1}).done(function(){t.$el.removeClass("unread"),t.$(".js-mark").remove()})},navigateToPost:function(t){window.gadget&&(t.preventDefault(),n.publish("redirect",e(t.currentTarget).attr("href")))}})}),define("hbs!templates/common/notification_container",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function";return s+='<div class="notification-box hidden" style="display: block; visibility: visible;">\n    <h4 id="requests-h">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"subject.Notifications.action_item",a):f.call(t,"t","subject.Notifications.action_item",a)))+'</h4>\n    <ul class="stream js-request"></ul>\n    <div class="js-requests-more show-all">\n        <a href="',(u=n.requestUrl)?u=u.call(t,{hash:{},data:i}):(u=t&&t.requestUrl,u=typeof u===c?u.call(t,{hash:{},data:i}):u),s+=l(u)+'" class="js-see-more notification-stream-link">\n            ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"subject.Notifications.show_all_action_items",a):f.call(t,"t","subject.Notifications.show_all_action_items",a)))+"\n        </a>\n    </div>\n    <h4>",a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"subject.Notifications.notifications",a):f.call(t,"t","subject.Notifications.notifications",a)))+'</h4>\n    <ul class="stream js-notification "></ul>\n    <div class="js-notification-more show-all">\n        <a href="',(u=n.notificationUrl)?u=u.call(t,{hash:{},data:i}):(u=t&&t.notificationUrl,u=typeof u===c?u.call(t,{hash:{},data:i}):u),s+=l(u)+'" class="js-see-more notification-stream-link">\n            ',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"subject.Notifications.show_all_notifications",a):f.call(t,"t","subject.Notifications.show_all_notifications",a)))+"\n        </a>\n    </div>\n</div>\n",s})}),define("views/common/notification_list",["jquery","underscore","tibbr","models/user","models/subject","modules/common/views/messages/notification_item","hbs!templates/common/notification_container"],function(t,n,r,i,s,o,u){var a=r.View.extend({maxToShow:5,events:{"click a.js-subscriptions-requests":"subscriptionsRequestsHandle","click a.js-invitation-requests":"invitationRequestsHandle","click a.js-follower-requests":"followerRequestsHandle","click a.js-action-link":"actionTargetLink","mouseover div.notification-box":function(){if(r.Helper.OSName()==="windows")return;t(document).trigger("scroll:stop")},"mouseout div.notification-box":function(){if(r.Helper.OSName()==="windows")return;t(document).trigger("scroll:resume")},"click a.js-see-more":"redirect"},subscriptionsRequestsHandle:function(e){e.preventDefault();var n=this,i=t(e.target),s=i.data("params"),o=i.parents("li").first();r.currentUser.approve(i.attr("rel"),s.subject_id,s.user_id).done(function(){o.remove(),n.options.requests.trigger("action:taken","subscriptions",s.id)})},invitationRequestsHandle:function(e){e.preventDefault();var n=this,i=t(e.target),s=i.data("params"),o=i.parents("li").first(),u=t(".notification-box"),a=i.attr("rel")==="subscribe"?"subscribe":"unsubscribe";r.currentUser.action(a,"update",{data:{params:{subject_id:s.id}}}).done(function(){o.remove(),n.options.requests.trigger("action:taken","invitation",s.id),n.options.requests.length>0&&n.options.requests.length<4&&u.find(".js-requests-more").remove(),n.options.requests.length===0&&(u.find("#requests-h").remove(),u.find(".js-requests-more").remove())})},followerRequestsHandle:function(e){e.preventDefault();var n=this,i=t(e.target),s=i.data("params"),o=i.parents("li").first();r.currentUser.action_on_follower_request(s.action,s.follower_id,{success:function(){o.remove(),n.options.requests.trigger("action:taken","follwerRequest",s.id)}})},render:function(){this.$el.html(this.renderTemplate(u,{notificationUrl:r.url("users/notifications"),requestUrl:r.url("users/requests")}));var e=this.collection,t=this.$el,n=this,i=this.options.subCollection;return e.length>0?(e.each(function(e,r){if(r>n.maxToShow-1)return;t.find("ul.js-notification").append(n.initChild(o,{model:e,collection:n.collection}).render().el)}),e.length<4&&t.find(".js-notification-more").remove()):(t.find("ul.js-notification").append("<li>"+this.t("subject.Notifications.you_have_no_notifications")+"</li>"),t.find(".js-notification-more").hide()),this.options.requests.length>0?(this.options.requests.each(function(e){var r=new o({model:e,collection:n.collection});t.find("ul.js-request").append(r.render().el)}),this.options.requests.length<4&&t.find(".js-requests-more").remove()):(t.find("ul.js-request").remove(),t.find("#requests-h").remove(),t.find(".js-requests-more").remove()),this},redirect:function(e){window.gadget&&(t(e.target).parent().hasClass("js-notification-more")?r.publish("redirect",r.url("users/notifications",{host:r.host(),gadget:!1})):t(e.target).parent().hasClass("js-requests-more")&&r.publish("redirect",r.url("users/requests",{host:r.host(),gadget:!1})),e.preventDefault())},onLeave:function(){if(r.Helper.OSName()==="windows")return;t(document).trigger("scroll:resume")}});return n.extend(a.prototype,r.Modules.View.ActionLink),a}),define("hbs!modules/common/templates/messages/notifications",["handlebars"],function(e){return e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<a rel="non-action-notification" data-seemore=\'1\' title="Notifications" class="notifications apps-notifications" data-direct="true" >\r\n    <span class="count"></span>\r\n</a>'})}),define("modules/common/views/messages/notification",["jquery","underscore","tibbr","models/notification","models/subscription","models/follower","collections/notifications","collections/subscriptions","collections/follower_list","collections/subjects","views/common/notification_list","hbs!modules/common/templates/messages/notifications"],function(e,t,n,r,i,s,o,u,a,f,l,c){return n.View.extend({qtipConfig:n.qtipConfigs.popup,id:"js-apps-notifications",className:"notification",countNo:10,initialize:function(){this.collection=new o,this.collection.requestCount=0,this.requests=new o,this.bindTo(this.collection,"resetCount",this.updateCount,this),this.bindTo(this.requests,"action:taken",this.actionTaken,this),this.subCollection=new u,this.followRequest=new a,this.invitedSub=new f,t.bindAll(this,"render","bind","updateNotification","updateSubscription")},render:function(){return this.$el.html(this.renderTemplate(c)),this.bind(),this.updateNotification(),this.updateSubscription(),this},actionTaken:function(e,t){var n=t;switch(e){case"subscriptions":n="222-"+t;break;case"invitation":n="111-"+t;break;case"follwerRequest":n="333-"+t}var r=this.requests.find(function(e){return e.get("id")==n});this.requests.remove(r),this.collection.requestCount=this.requests.length,this.updateCount()},buildRequestNotifications:function(){this.requests.reset();var e=this;this.invitedSub.each(function(t){e.requests.addSubjectRequest(t)}),this.subCollection.each(function(t){e.requests.addSubscriptionRequest(t)}),this.followRequest.each(function(t){e.requests.addFollowerRequest(t)}),this.collection.requestCount=this.requests.length,this.requests.models.slice(0,5)},fetch:function(e){e=e||{};var t=this,r=n.currentUser.get("id");n.currentUser.action("combined_apis","read",{data:{params:{set_actions:!0,subject_invitations:{set_states:!0,user_id:r,per_page:5},notifications:{count:5},subscription_requests:{user_id:r,per_page:5},follower_requests:{per_page:5}}},success:function(n,r){t.collection.unreads=r.notifications.total_unread,t.collection.data=r.notifications,t.collection._set(r.notifications),r.subscription_requests&&t.subCollection._set(r.subscription_requests),r.subject_invitations&&t.invitedSub._set(r.subject_invitations),r.follower_requests&&t.followRequest._set(r.follower_requests),t.buildRequestNotifications(),e.success&&"function"==typeof e.success&&e.success()}})},updateCount:function(){var e=this.collection.unreads+this.collection.requestCount;e>0?(this.$(".count").show().text(e),this.$(".notifications").addClass("active")):this.resetCount()},resetCount:function(){var t=this;this.ajax({url:"notifications/mark_as_read",method:"PUT",data:{id:!1,setModel:!1}}).done(function(){t.$(".count").hide().text(0),e(".notifications").removeClass("active")})},updateNotification:function(){var e=this;n.currentUser.on("notification:updated",function(t){e.collection.unreads=t.notifications.total_unread>0?t.notifications.total_unread:0,e.collection.requestCount=(t.follower_requests||0)+(t.invited_subjects||0)+t.subscription_requests||0,e.collection.trigger("resetCount"),e.collection.models=e.collection.models.slice(0,5)})},updateSubscription:function(){var e=this;n.currentUser.on("subscriptionReqest:updated",function(t){e.subCollection=(new u)._set(t)})},bind:function(){var t=this;this.$(".notifications").qtip(e.extend({},this.qTipOptions,{content:{text:function(){return t.collection.length===0?n.translate("subject.Notifications.no_notification"):n.UI.lineLoader}},show:{event:"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},events:{visible:function(r,i){t._view=new l({collection:t.collection,subCollection:t.subCollection,requests:t.requests}),e(i.elements.content).html("<p>"+n.UI.loader+"</p>"),t.fetch({success:function(){e(i.elements.content).html(t._view.render().el),t.resetCount()}})},hidden:function(){t._view&&(t._view.leave(),t._view=null)}}}))},qTipOptions:{position:{at:"bottom center",my:"top center",container:e("#header"),viewport:e(window),adjust:{x:0,y:-5,mouse:!0,resize:!0}},show:{solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus click",style:{classes:"notifications-tip qtip-light qtip-shadow",tip:{width:20,height:15}}}})}),define("hbs!modules/common/templates/common/community_notification_item",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function";return s+='<div class="media-box">\n    <a class="community-icon"><img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/community-icon.png",u):a.call(t,"imagePath","images/community-icon.png",u)))+'" ></a>\n\n    <div class="info">\n        <p class="notify-text">'+f((o=(o=t&&t.model,o==null||o===!1?o:o.badgeComm),typeof o===l?o.apply(t):o))+" ",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.new_notifications_from",u):a.call(t,"t","home.left_menu.new_notifications_from",u)))+"\n            <strong>"+f((o=(o=t&&t.model,o==null||o===!1?o:o.community_name),typeof o===l?o.apply(t):o))+'</strong></p>\n\n        <p><a href="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.go_to_community),typeof o===l?o.apply(t):o))+'">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.go_to_community",u):a.call(t,"t","home.left_menu.go_to_community",u)))+"</a></p>\n    </div>\n</div>\n",s})}),define("modules/common/views/common/community_notification_item",["jquery","underscore","tibbr","hbs!modules/common/templates/common/community_notification_item"],function(e,t,n,r){return n.View.extend({tagName:"li",className:"notification-li",events:{},render:function(){var e=n.host()+"/users/"+n.currentUser.id+"/go_to_community?tibbr_server_url="+this.model.get("community_url");return this.model.set("go_to_community",e,{silent:!0}),this.model.get("community_badges").badges&&this.model.get("community_badges").badges.unread>0&&(this.model.set("badgeComm",this.model.get("community_badges").badges.unread,{silent:!0}),this.$el.html(this.renderTemplate(r,{model:this.model.attributes}))),this}})}),define("hbs!templates/common/community_notification_container",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+="    <h4>",u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"home.left_menu.communityNotifications",u):a.call(t,"t","home.left_menu.communityNotifications",u)))+'</h4>\n    <ul class="stream js-community-notifications">\n    </ul>\n',s})}),define("views/common/community_notification_list",["jquery","underscore","tibbr","modules/common/views/common/community_notification_item","hbs!templates/common/community_notification_container"],function(t,n,r,i,s){var o=r.View.extend({className:"notification-box",maxToShow:5,events:{},render:function(){this.$el.html(this.renderTemplate(s,{}));var e=this.collection,t=this.$el,n=this;return e.length>0?(e.each(function(e,r){if(r>n.maxToShow-1)return;t.find("ul.js-community-notifications").append(n.initChild(i,{model:e,collection:n.collection}).render().el)}),e.length<4&&t.find(".js-notification-more").remove()):(t.find(".js-community-no-notifications").remove(),t.find("ul.js-community-notifications").append('<li class="js-community-no-notifications">'+this.t("subject.Notifications.you_have_no_notifications")+"</li>"),t.find(".js-notification-more").hide()),this}});return o}),define("hbs!modules/common/templates/messages/community_notifications",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<a data-seemore=\'1\' title="Community Notifications" class="community-top-notification js-community-top-notification" data-direct="true" >\n    <img src="',u={hash:{},data:i},s+=f((o=n.imagePath||t&&t.imagePath,o?o.call(t,"images/community-icon.png",u):a.call(t,"imagePath","images/community-icon.png",u)))+'" >\n    <span class="count"></span>\n</a>\n\n',s})}),define("modules/common/views/messages/community_notification",["jquery","underscore","tibbr","collections/community_notifications","views/common/community_notification_list","hbs!modules/common/templates/messages/community_notifications"],function(e,t,n,r,i,s){return n.View.extend({qtipConfig:n.qtipConfigs.popup,id:"js-community-notifications",className:"notification",countNo:10,initialize:function(){var e=this;this.collection=new r,this.bindTo(n.currentUser,"communityBadges:updated",this.updateCount,this),t.bindAll(this,"render","bind")},render:function(){return this.$el.html(this.renderTemplate(s)),this.bind(),this},updateCount:function(){var e=0;t.each(n.CommunityNotifications,function(t){e=e+(t.community_badges&&t.community_badges.badges)?t.community_badges.badges.unread:0});if(!(e>0))return!0;this.$(".count").show().text(e)},fetch:function(e){e=e||{};var t=this.collection,i=this;t.scopeId=n.currentUser.id,n.CommunityNotifications?(i.collection=new r(n.CommunityNotifications),e.success&&"function"==typeof e.success&&e.success()):t.getOrFetch({cacheKey:"communities-notifications",data:{params:{per_page:99}}}).done(function(t){n.CommunityNotifications=t,e.success&&"function"==typeof e.success&&e.success()})},bind:function(){var t=this;this.$(".js-community-top-notification").qtip(e.extend({},this.qTipOptions,{content:{text:function(){return t.collection.length===0?n.translate("subject.Notifications.no_notification"):n.UI.lineLoader}},show:{event:"click",solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},events:{visible:function(r,s){e(s.elements.content).html("<p>"+n.UI.loader+"</p>"),t.fetch({success:function(){t._view=new i({collection:t.collection}),e(s.elements.content).html(t._view.render().el)}})},hidden:function(){t._view&&(t._view.leave(),t._view=null)}}}))},qTipOptions:{position:{at:"bottom center",my:"top center",container:e("#header"),viewport:e(window),adjust:{x:0,y:-5,mouse:!0,resize:!0}},show:{solo:!0,modal:{on:!1,effect:!0,blur:!0,keyboard:!0}},hide:"unfocus click",style:{classes:"community-notifications-tip qtip-light qtip-shadow",tip:{width:20,height:15}}}})}),define("text!templates/users/change_password.html",[],function(){return'<div class="password-wrap">\r\n    <form method="post">\r\n        <h2>${t(\'change_password.change_password\')}</h2>\r\n        <fieldset>\r\n            <label for="old-password">${t(\'change_password.current_password\')}:</label>\r\n            <input type="password" id="old-password" name="old-password" size="35">\r\n        </fieldset>\r\n        <fieldset>\r\n            <label for="new-password">${t(\'change_password.new_password\')}:</label>\r\n            <input type="password" id="new-password" name="new-password" size="35">\r\n        </fieldset>\r\n        <fieldset>\r\n            <label for="verify-password">${t(\'change_password.verify_new_password\')}:</label>\r\n            <input type="password" id="verify-password" name="verify-password" size="35">\r\n        </fieldset>\r\n        <p id="action-link">\r\n            <input type="submit" class="btn btn-submit" id="submit-btn" name="commit" value="${t(\'change_password.change_password\')}">\r\n        </p>\r\n    </form>\r\n</div>\r\n'}),define("views/users/change_password",["jquery","underscore","tibbr","modules/dialog","text!templates/users/change_password.html"],function(e,t,n,r,i){return n.View.extend({className:"profile-wrap",initialize:function(){t.bindAll(this,"render"),this.bindTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template.render(i)),this.$("form").csrfToken(),this},events:{"click input:submit":"changePassword"},changePassword:function(t){e("#action-link .btn-submit").attr("disabled",!0).after(n.UI.spinner);var r=this;return n.currentUser.changePassword(this.$("#old-password").val(),this.$("#new-password").val(),this.$("#verify-password").val(),this.model.id,function(){e("#action-link .btn-submit").attr("disabled",!1),e(".spinner").remove()},r.dialog.close),!1}})}),define("hbs!templates/common/welcome",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n    <a class="home reload" rel="',s={hash:{},data:t},r+=l((i=n.url||e&&e.url,i?i.call(e,"admin/",s):f.call(e,"url","admin/",s)))+'">',s={hash:{},data:t},r+=l((i=n.t||e&&e.t,i?i.call(e,"main_tabs.administrator",s):f.call(e,"t","main_tabs.administrator",s)))+"</a>\n    ",r}function d(e,t){var r="",i;return r+='\n    <a class="home" href="',(i=n.go_to_base)?i=i.call(e,{hash:{},data:t}):(i=e&&e.go_to_base,i=typeof i===c?i.call(e,{hash:{},data:t}):i),r+=l(i)+'">',(i=n.baseCommunity)?i=i.call(e,{hash:{},data:t}):(i=e&&e.baseCommunity,i=typeof i===c?i.call(e,{hash:{},data:t}):i),r+=l(i)+"</a>\n    ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<span class="tblock js-block">\n   <a class="home reload" rel="/#">',a={hash:{},data:i},s+=l((o=n.t||t&&t.t,o?o.call(t,"main_tabs.home",a):f.call(t,"t","main_tabs.home",a)))+"</a>\n   ",u=n["if"].call(t,t&&t.adminPrivilege,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n      ",u=n["if"].call(t,t&&t.baseCommunity,{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;return s+="\n\n\n</span>\n\n\n",s})}),define("views/common/welcome_note",["jquery","underscore","tibbr","models/user","modules/dialog","modules/tags/select","views/users/upload_photo","views/users/change_password","hbs!templates/common/welcome"],function(e,t,n,r,i,s,o,u,a){return n.View.extend({className:"pvs welcome-greet",tagName:"p",initialize:function(){t.bindAll(this,"uploadPhoto","changePassword"),this.dropDownMenu=this.initChild(s,this.items()),this.bindTo(this.dropDownMenu,"change",this.navigate,this)},events:{"click a.reload":"reload"},render:function(){var e=n.currentUser.get("base_community"),t=n.host()+"/users/"+n.currentUser.id+"/go_to_community?tibbr_server_url="+e.app_url;return this.$el.html(this.renderTemplate(a,{go_to_base:t,baseCommunity:n.appConfig("webui","config","community","base_community")?!1:e.name,adminPrivilege:n.currentUser.hasAdminPrivilege()})),this.$(".js-block").append(this.dropDownMenu.render().el),this},navigate:function(e){t.isUndefined(e.method)?t.isUndefined(e.url)||n.redirectTo(e.url):this[e.method]()},items:function(){var r={defaultOption:{text:t.str.truncate(n.currentUser.get("display_name"),40),className:"profile-menu-link name",title:n.currentUser.get("display_name")},updateDefault:!1,selectedOptionHide:!1,listClassName:"profile-menu",selectedOptionCheck:!1,qtip:{style:{tip:{border:1,width:12,height:10,offset:12,corner:"top center",mimic:"top center"},classes:"profile-menu dropdown ui-action-menu qtip-light"},position:{my:"top center",at:"bottom center",container:e("#header"),viewport:e(window)}},options:[{text:this.t("user.view_my_profile"),url:n.currentUser.urlFor("show")},{text:this.t("user.edit_profile"),url:n.currentUser.urlFor("edit")},{text:this.t("user.upload_photo"),method:"uploadPhoto"},{text:this.t("user.edit_subscription"),url:n.currentUser.urlFor("message_delivery")}]};return n.appConfig("webui","config","password_control")==="master"&&n.currentUser.get("source").search("ldap")===-1&&"saml"!==e.cookie("login_by")&&r.options.push({text:this.t("user.change_password"),method:"changePassword"}),n.appConfig("webui","config","menu","logout")!=="disabled"&&r.options.push({text:this.t("main_tabs.logout"),method:"logout"}),r},uploadPhoto:function(){return this.$(".profile-menu-link").qtip("hide"),i.render(o,{model:n.currentUser}),!1},reload:function(t){var r=e(t.currentTarget).attr("rel");return n.app.navigate(r,!0),!1},changePassword:function(){return this.$(".profile-menu-link").qtip("hide"),i.render(u,{model:n.currentUser,dialog:{width:500}}),!1},logout:function(){return n.currentUser.trigger("logout"),n.currentUser.logout=!0,window.location.href=n.path("/users/logout.html"),!1}})}),define("hbs!modules/common/templates/messages/preview_panel",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div id="tibbits">\n    <div class="update_container">\n        <div id="update_search">\n            <div class="new_msg_container" from_homepage="true">\n                <span>',u={hash:{count:t&&t.count},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.new_message_count",u):a.call(t,"t","message.new_message_count",u)))+'</span>\n                <a href="#" class="refresh-wall-links js-refresh">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"message.refresh",u):a.call(t,"t","message.refresh",u)))+'<i class="ui-inline-icon refresh"></i></a>\n            </div>\n        </div>\n    </div>\n</div>',s})}),define("modules/common/views/messages/new_wall_messages",["jquery","underscore","tibbr","hbs!modules/common/templates/messages/preview_panel"],function(e,t,n,r){return n.View.extend({tagName:"div",events:{"click a.refresh-wall-links":"renderNewMessages"},attributes:{style:"border:0px"},initialize:function(){this.bindTo(n.currentUser,"badges:updated",this.render,this)},renderNewMessages:function(n){n.preventDefault();var r=e(n.currentTarget);return r.is(".js_loading")?!1:(t.delay(function(){e("#filters-main_wall").find("a.my_wall").click()},100),r.addClass("js_loading"),!1)},reset:function(){this.$el.empty()},render:function(){if(this.$("#preview_pane").is(":visible")){var t=n.currentUser.unreadMessageCount(),i=this;return this.$("div.new_msg_container span").html(n.translate("message.new_message_count",{count:t})),n.currentNav!=="home"&&this.$("span.js-refresh").hide(),this}return n.currentUser.unreadMessageCount()>0&&(t=n.currentUser.unreadMessageCount(),this.$el.html(this.renderTemplate(r,{count:t})),n.util.setTitle("("+t+") "),n.currentNav!="home"&&e("span.js-refresh",this.el).hide()),n.currentUser.unreadMessageCount()<=0&&(n.util.resetTitle(),this.$el.html("")),this},onLeave:function(){this.pagination&&this.pagination.leave()}})}),define("models/tenant",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"tenants",initialize:function(){e.bindAll(this,"salesContact")},salesContact:function(e,t){var t=t||{},n=this;this.url="tenants/contact_sales",this.save({enquiry:t},{complete:function(e){e.status===200?t.success&&"function"==typeof t.success&&t.success():t.error()}})}})}),define("text!templates/common/contact_sales_form.html",[],function(){return'<h2>Contact Sales</h2>\r\n<p class="note">We can\'t wait to hear from you!</p>\r\n<p class="note">Fill out the form below and we\'ll get back to you as soon as possible. </p>\r\n        <p class="js-error-messages" style="display:none">Please fill all required Information</p>\r\n<div class="contact-form-wrap js-sales-form">\r\n    <form id="js-sales-form">\r\n        <div class="details-fields">\r\n            <fieldset>\r\n                <input type="text" name="name"  id="js-username" placeholder=\'${user.get("display_name")}\' value=\'${user.get("display_name")}\' class="textbox js-required">\r\n                    <input type="text" name="state" id="js-state" placeholder=\'State\' value=\'${user.get("state")}\'  class="textbox js-required">\r\n            </fieldset>\r\n            <fieldset>\r\n                <input type="text" name="email"  id="js-email" placeholder=\'${user.get("email")}\' value=\'${user.get("email")}\' class="textbox js-required">\r\n                    <input type="text" name="country" id="js-country" placeholder=\'Country Name\' value=\'${user.get("country")}\'  class="textbox js-required">\r\n            </fieldset>\r\n            <fieldset>\r\n                <input type="text" name="title" id="js-title" placeholder="What is your job title?" value=\'${user.get("title")}\' class="textbox">\r\n                <input type="text" name="employees" id="js-employees" placeholder="No. of Employee" class="textbox">\r\n            </fieldset>\r\n            <fieldset>\r\n                <textarea name="comments" id="js-comment" class="js-required" placeholder="comments?" value=\'4\'></textarea>\r\n            </fieldset>\r\n        </div>\r\n        <p class="action-link"><button class="btn btn-submit js-contact-to-sale" type="button">submit<i class="arrow next"></i></button></p>\r\n    </form>\r\n</div>\r\n\r\n'}),define("views/common/contact_sales_form",["jquery","underscore","tibbr","modules/overlay","modules/dialog","models/tenant","text!templates/common/contact_sales_form.html"],function(e,t,n,r,i,s,o){return n.ContactSales=n.View.extend({className:"conatact-details-wrap",initialize:function(){t.bindAll(this,"render")},events:{"click .js-contact-to-sale":"contactToSales","click .js-not-current-user":"clearForm"},render:function(){return e(this.el).html(this.template.render(o,{user:n.currentUser})),this.$("[placeholder]").simplePlaceholder(),this},clearForm:function(){return this.$(".js-sales-form input:text").val(""),!1},contactToSales:function(){var e=this.$('.contact-form-wrap input:text[value=""], .contact-form-wrap textarea[value=""]').toArray(),o=this.$("#js-employees").val().replace(/[0-9]*/g,""),u=""!=o,a=this.$("#js-state").val()===this.$("#js-state").attr("placeholder"),f=this.$("#js-comment").val()===this.$("#js-comment").attr("placeholder"),l=this.$("#js-country").val()===this.$("#js-country").attr("placeholder"),c="";if(t.isEmpty(e)&&!u&&!a&&!f&&!l){console.log("in empty condition");var h=new s,p={};t.each(this.$("form#js-sales-form").serializeArray(),function(e){p[e.name]=e.value}),p.success=function(){i.alert({text:"Mail has been sent to Sales Team"}),r.close();var e=n.currentUser.get("tenant").is_expired;if(n.isEval&&e)return window.location.reload(),!1},p.error=function(){i.alert({text:"Mail has not been sent to Sales Team, Try Again !"})},h.salesContact(this.model,p)}else c="Please fill require information",u?(c="No. of employess information should be Number",i.alert({text:c})):i.alert({text:c});return!1}})}),define("text!templates/home/eval_end.html",[],function(){return'<div class="eval-end-wrap">\n    <h2>Your Evaluation has been expired, here is the summary of ${companyName} network in the past 60 days.</h2>\n\n    <div class="instance-overview">\n        <ul>\n            <li>\n                <p><strong>${usersCount}</strong> <span>PEOPLE</span> <img src="images/evaluation/people-icon.png" alt="people"\n                                                                class="icon"/></p>\n            </li>\n            <li>\n                <p><strong>${subjectsCount}</strong> <span>SUBJECTS</span> <img src="images/evaluation/subject-icon.png" alt="people"\n                                                                  class="icon"/></p>\n            </li>\n            <li>\n                <p><strong>${postsCount}</strong> <span>MESSAGES</span> <img src="images/evaluation/message-icon.png" alt="people"\n                                                                   class="icon"/></p>\n            </li>\n        </ul>\n    </div>\n\n    <p><a href="#" class="btn-submit btn extend_my_eval">Contact Us</a></p>\n</div>'}),define("views/home/eval_end",["jquery","underscore","tibbr","modules/overlay","views/common/contact_sales_form","text!templates/home/eval_end.html"],function(e,t,n,r,i,s){return n.View.extend({initialize:function(){t.bindAll(this,"render","show")},show:function(){var t=n.currentUser.get("tenant"),i=n.currentUser.get("email"),o=t.name,u=t.posts_count,a=t.subjects_count,f=t.users_count;return e(this.el).html(this.template.render(s,{email:i,companyName:o,postsCount:u,subjectsCount:a,usersCount:f})),r.html({html:this.el,overlayClose:!1,escKey:!1,onLoad:function(){e("#cboxClose").remove()}}),this},events:{"click a.extend_my_eval":"extend_eval"},extend_eval:function(){return r.html({html:this.initChild(i).render().el,overlayClose:!1,escKey:!1}),!1}})}),define("views/common/eval_help",["jquery","underscore","tibbr"],function(e,t,n,r){return n.View.extend({id:"eval-help-wrap",className:"notification",events:{"click .eval-help":"startTour"},render:function(){return this.$el.html('<a href="#" class="eval-help"></a>'),this},startTour:function(e){return e.preventDefault(),this.params().controller==="home"&&this.params().action==="index"&&n.Modules.Tour.index(n.tracker),this.params().controller==="users"&&(this.params().action==="show"||this.params().action==="profile")&&parseInt(this.params().id)===parseInt(n.currentUser.id)&&n.Modules.Tour.people(),this.params().controller==="subjects"&&this.params().action==="show"&&n.Modules.Tour.subject_workspace(),this.params().controller==="files"&&n.Modules.Tour.files(),n.tracker.trackSend("View Tour","On boarding"),!1}})}),define("controllers/application",["jquery","underscore","backbone","tibbr","require/moment","modules/dialog","views/common/menu","views/home/nav/left","views/common/post","views/common/wall_tab","views/common/global_search","modules/common/views/messages/notification","modules/common/views/messages/community_notification","views/common/quick_search","views/common/welcome_note","modules/common/views/messages/new_wall_messages","views/home/eval_end","views/common/eval_help"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return i.application={globalInclude:function(){return this.menuBar(),this.fixMainHeader(),this.welcomeNote(),this.setNotification(),this.setCommunityNotification(),this.setGlobalSearch(),this.NavigationLeft(),this.chat(),this.checkEval(),this.bindAppEvents(),this.showHelpIcon()?this.setEvalHelp():this.removeEvalHelp(),this},bindAppEvents:function(){this.postMessage(),this.postEvent()},postEvent:function(){i.Event.uniqueBind("user:send_post",function(e){var t=i.currentSubject;o.render(f,{inputClass:"user_send_post",type:"public",dialog:{width:700,max_height:400},complete:function(t){i.currentSubject=null,t.listenToOnce(i.Event,"message:created",function(){t.closeDialog()}),t.display(),t.postBoxView.postPrivacy(!0),t.postBoxView.showFooter(),t.changePostTo({caption:e.get("display_name"),value:e.get("login"),image:e.image("small").replace(new RegExp("^"+window.prefix),"/"),t:"u",s:"public"})},close:function(){i.currentSubject=t}})})},postMessage:function(){i.Event.uniqueBind("post:message",function(e){var n=i.currentUser,r=i.richText.enable;o.render(f,{inputClass:"post_message",type:"public",data:{caption:n.get("display_name"),value:n.get("login"),image:n.image("small").replace(new RegExp("^"+window.prefix),"/"),t:"u",s:"public"},dialog:{width:700},close:function(){i.richText.enable=r},complete:function(n){n.listenToOnce(i.Event,"message:created",function(){n.closeDialog()}),i.richText.enable=!1,n.display(),n.$("ul#post-tabs").remove(),n.$("textarea[name='__content']").val(e.message),n.postBoxView.showFooter(),e.url&&(n.$("a[data-type=link]").click(),n.$("input.link_url").val(e.url)),o.resize(),t("#cboxLoadedContent").find(".js-main-box-close").remove().end().on("click",o.resize).end()}})})},removeLoader:function(){t(".page-loader").remove()},setNavigation:function(e){return i.currentNav=e||"home",t("ul.primary-nav").find("li.current").removeClass("current"),t("ul.sub-nav").find("li.current").removeClass("current"),t("#global-nav").find("> li").removeClass("active"),t("#gn-"+i.currentNav).addClass("active"),this},setSubNav:function(e){return t("ul.sub-nav").find("li.active").removeClass("active").end().find("li.current").removeClass("current").end().find("a."+e).parent().addClass("current"),this},NavigationLeft:function(){this.leftNavView?this.leftNavView.profileChange(i.currentUser):(this.leftNavView=new a({model:i.currentUser}),t("#main-sidebar").html(this.leftNavView.render().el),this.leftNavView.bind(),i.Event.trigger("nav:left:rendered"));if(params.controller==="subjects")return;var e=t("ul.primary-nav"),n=i.currentNav,r=e.find(".has-sub-nav").not("."+n);r.parent().addClass("collapsed").not(".expand").find(".sub-nav").hide(),e.find("."+n).hasClass("collapsed")&&e.find(".has-sub-nav."+n).click(),e.find("li.current").removeClass("current"),e.find("li."+n).not(".has-sub-menu").addClass("current")},showHelpIcon:function(){var e={home:["index"],messages:["filters"],subjects:["show"],users:["show","profile"],files:["index"]},t=e[params.controller]||[];return params.controller==="users"?n.include(t,params.action)&&parseInt(params.id)===parseInt(i.currentUser.id):n.include(t,params.action)},setPost:function(e){this.postBoxView&&this.postBoxView.leave();var n=e.$container||t("#content");return this.postBoxView=new f(e),n.append(this.postBoxView.render().el),this.postBoxView.display(),this.postBoxView},initWall:function(e){return t("#wall").remove(),this.wallTabView&&this.wallTabView.leave(),this.wallTabView=(new l({name:e})).render(),this.initRefreshLink(),this.wallTabView},initRefreshLink:function(){this.refreshWallView&&this.refreshWallView.leave();if(i.currentNav==="home"){var e=t("#content").find("#stream-wrap");this.refreshWallView=new m,e.html(this.refreshWallView.render().el),this.refreshWallView.reset()}},setWallAndPost:function(){var e={};i.currentNav==="home"&&i.appConfig("ui_config","config","post_to")&&i.appConfig("ui_config","config","post_to")!="blank"&&(e={data:i.appConfig("ui_config","config","post_to")}),this.setPost(e),this.initWall()},setGlobalSearch:function(){t("#global-search").length===0&&(t("#header .wrap").prepend((new c).render().el),t("#global-search [placeholder]").simplePlaceholder())},setEvalHelp:function(){t("#eval-help-wrap").length===0&&t("#header").find("#js-apps-notifications").before((new y).render().el)},removeEvalHelp:function(){t("#eval-help-wrap").length>0&&t("#eval-help-wrap").remove()},setNotification:function(){if(t("div#js-apps-notifications").length===0){var e=new h;t("#header .wrap").prepend(e.render().el)}},setCommunityNotification:function(){if(i.appConfig("webui","config","community","base_community")&&i.currentUser.get("connected_communities").length>0&&t("div#js-community-notifications").length===0){var e=new p;t("#header .wrap").prepend(e.render().el)}},chat:function(){if(!i.appConfig("chat","enable"))return;var e=t("#chat-wrap");e.find(".wrap").length===0&&requirejs(["views/chat/chat"],function(n){var r=new n;e.html(r.render().el),t(window).resize(function(){r.maxHeight()}),t(window).unload(function(){r.bind()}),r.connect(!0).maxHeight(),t(window).blur(r.chat.winBlur),t(window).focus(r.chat.winFocus),t(document).blur(r.chat.winBlur),t(document).focus(r.chat.winFocus),t.browser.msie&&(document.onfocusout&&(document.onfocusout=r.chat.winBlur),document.onfocusin&&(document.onfocusin=r.chat.winFocus)),i.currentUser.on("logout",function(){r.disconnect(!1)})})},menuBar:function(){if(!i.appConfig("ui_config","config","top_menu_bar"))return;t("#global-nav").length===0&&t("#active-tab").after((new u).render().el)},checkEval:function(){var e=i.currentUser.get("tenant").is_expired;if(i.isEval&&e)return(new g).show(),!1},welcomeNote:function(){t(".welcome-greet").length===0&&(t("#header .wrap").prepend((new v).render().el),i.Event.trigger("nav:top:rendered"))},removeClientSteam:function(){return t("#client_side_event_stream").length>0&&(t("#client_side_event_stream").remove(),t("#content, #sidebar").show(),this.setPost()),this},timeRange:function(e){var t=i.translate("common.time"),n=[t.today,t.yesterday];switch(e){case"month":n=[t.this_month,t.last_month];break;case"week":n=[t.this_week,this.last_week];break;case"year":n=[t.this_year,t.last_year]}return n},navigateToClientApp:function(e,n,r){t(".qtip").qtip("hide");var s=i.currentUser.subscribedFilters.find(function(t){return t.id.toString()==e.toString()});if(!s){if(n)return this.navigateToAppWithURL(n);if(r)return this.navigateToAppWithURL(r);try{return window.history.back(),!0}catch(o){return!1}}var u=s.urlType("home")[0],a=s.showClientUrl();if(n){var f=a.indexOf("?")==-1?"?":"&";a=a+f+"redirect_uri="+escape(n.toString())}return u&&u.get("open_separete")?(window.open(a,"_blank"),window.focus(),!1):this.navigateToAppWithURL(a)},navigateToAppWithURL:function(e,n){t("ul.sub-nav li").removeClass("active"),t("div#content, #sidebar, div.subject-header").hide(),t("ul.primary-nav li.current").removeClass("current").end().find("li.apps").addClass("active"),this.leftNavView.profileChange(i.currentUser),this.appFrame(e),n!==!1&&i.app.navigate("#client-stream");try{window.scrollTo(0,0)}catch(r){}return this.removeEvalHelp(),!1},appFrame:function(e){t(".qtip").qtip("hide"),t("iframe.client-stream").remove(),t("div#content-wrap").addClass("application-container");var n=i.$iFrame().attr({"class":"client-stream",id:"client_side_event_stream",scrolling:"no",src:e,style:"width:100%; height:1000px;",name:"app-frame"});return t("div#content ").before(n),n},cleanUpLeftNav:function(){i.$menuRow&&(i.$menuRow.mouseleave(),i.$menuRow=null)},fixMainHeader:function(){if(this._fixMainHeader)return;var e=t("#header").offset();i.Event.on("page:scroll",function(){var n=t("#header");t(window).scrollTop()>e.top?n.addClass("fixed-header-shadow"):n.removeClass("fixed-header-shadow")}),this._fixMainHeader=!0}},i.application}),define("views/home/index",["jquery","underscore","backbone","tibbr","modules/common/views/messages/list","modules/common/views/messages/filters"],function(e,t,n,r,i,s){return r.View.extend({initialize:function(){this.event.bindTo(this,"filter:change",this.renderMessage)},render:function(){var n=e("#sidebar"),i=this;n.empty(),r.application.setWallAndPost(r.currentUser,!0),t.defer(function(){i.messageList(r.currentUser.id)}),t.defer(function(){i.renderWallApp()}),t.defer(function(){require(["views/common/right_nav"],function(e){var t=i.initChild(e,{model:r.currentUser});n.append(t.render().el)})})},messageList:function(n){this._cleanUp();var i=e("#filters-main_wall").find("li:first"),s=this,o=e("div.tibbit_div"),u="wall_messages";i.addClass("current"),i.length>0&&e("#active_wall").text(i.find("a").text());var a;r.currentUser.hasVipWall()?(u="vip_messages",a=r.currentUser.vipMessages,r.Event.trigger("section:change","vip")):(u="wall_messages",a=r.currentUser.messages),o.prepend("<div class='streams'/>"),a.load({silent:!0,data:{params:{set_actions:!0,wall_message_type:u}}}).done(function(e){s._renderMessages(e),r.currentUser.createPrefForTour("webclient.tour","home","1")&&t.delay(function(){r.Modules.Tour.index(r.tracker)},2e3),a.at(0)&&r.currentUser.set("last_msg_sort_id",a.at(0).get("sort_id"))})},renderMessage:function(e){this.initChild(s,{bind:!1}).renderMessage(e)},_cleanUp:function(){r.application._wallMessage&&(r.application._wallMessage.leave(),r.application._wallMessage=null)},onLeave:function(){this._cleanUp()},_renderMessages:function(t){var n=r.application._wallMessage=new i({collection:t}),s=e("div.tibbit_div");return s.htmlWithEvent(n.render().el,"messages:rendered"),s},renderWallApp:function(){t.each(r.currentUser.subscribedFilters.wallTabs(),function(e){r.application.wallTabView.addWithIframe({"switch":!1,className:"wall-tab-page",title:e.get("title"),src:e.url(),close:!1})})}})}),define("controllers/home",["jquery","underscore","backbone","tibbr","controllers/application","views/home/index"],function(e,t,n,r,i,s){return r.Controller.extend({name:"home",beforeFilter:function(){},index:function(){var e=this;t.defer(function(){i.globalInclude()}),t.defer(function(){e.renderAction(s)})}})}),define("hbs!modules/common/templates/common/flash",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="info">\n    <ul id="flash_messages">\n        <li> ',(o=n.message)?o=o.call(t,{hash:{},data:i}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+".</li>\n    </ul>\n</div>\n",s})}),define("modules/common/views/common/flash",["jquery","underscore","tibbr","hbs!modules/common/templates/common/flash"],function(e,t,n,r){return n.View.extend({displayLength:5e3,defaultMessage:"",initialize:function(){t.bindAll(this,"render"),this.render()},render:function(){var t=e(".flash-message"),n=this,i=this.options.type||"success";t.length===0&&(e("body").append("<div class='flash-message'></div>"),t=e(".flash-message")),this.$el.addClass(i+"-message"),this.$el.html(this.renderTemplate(r,{message:this.options.message})),t.html(this.el),e(t).slideDown();if(this.displayLength)var s=window.setInterval(function(){clearInterval(s),t.slideUp(200,function(){t.empty(),n.leave()})},n.displayLength);return this}})}),define("views/common/exception_handle",["jquery","underscore","tibbr","modules/common/views/common/flash"],function(e,t,n,r){return n.View.extend({events:{},initialize:function(e){n.Event.on("response:error",this.errorType,this)},render:function(e,t){return e.redirect&&n.app.navigate("/",!0),this.errorType(e),this},errorType:function(e){var t="";e=e.error_code;switch(e.toString()){case"401":t=n.translate("common.errors.error_401");break;case"402":t=n.translate("common.errors.error_402");break;case"403":t=n.translate("common.errors.error_403");break;case"404":t=n.translate("common.errors.error_404");break;default:t="Something went wrong"}this.initChild(r,{message:t,type:"error"}).render()},onLeave:function(){n.Event.off("response:error",this.errorType,this)}})}),define("controllers/router",["jquery","underscore","backbone","tibbr","controllers/application","controllers/home","views/common/exception_handle"],function(t,n,r,i,s,o,u){var a=function(e){s.setNavigation(e);try{t(".qtip").qtip("hide"),s.cleanUpLeftNav(),t(".ui-dialog").empty().remove()}catch(n){}var r=t("#content"),i=t("#content-wrap");r.empty().removeClass("search-results-wrap max-width").removeAttr("style").removeClass("sans-sidebar"),i.removeClass("app-store").removeClass("application-container");if(e==="event_streams"||e==="help_center"||e==="apps")r.attr("style","width:100%").addClass("sans-sidebar"),e==="apps"&&i.addClass("app-store");e==="static_pages"?r.addClass("mobile-app-wrap max-width"):r.removeClass("mobile-app-wrap max-width"),t("#sidebar").show(),t("header#header").show(),t("iframe.client-stream").remove(),t("#cboxOverlay").removeAttr("style").hide(),t("iframe.admin-stream").length>0&&(t("iframe.admin-stream").remove(),t("#main-sidebar, #content-wrap").show())};return i.Router.extend({initialize:function(){this._super(),i.Event.on("response:error",this.renderError)},index:function(){if(i._serverRedirect===null)return a("home"),new o},groups:function(){a("groups"),this.initController("groups",arguments)},users:function(){a("people"),this.initController("users",arguments)},subjects:function(){a("subjects"),this.initController("subjects",arguments)},files:function(){a("files"),this.initController("files",arguments)},messages:function(){a("home"),this.initController("messages",arguments)},explore:function(){a("people"),t("#sidebar").empty(),this.initController("explore",arguments)},apps:function(){a("apps"),this.initController("apps",arguments)},help_center:function(){a("help_center"),t("#sidebar").empty(),this.initController("help_support",arguments)},developer_center:function(){a("developer_center"),t("#sidebar").empty(),this.initController("developer_center",arguments)},static_pages:function(){a("static_pages"),t("#main-sidebar, #sidebar").empty(),this.initController("static_pages",arguments)},subscribe:function(){t("#main-sidebar, #sidebar").empty(),this.initController("subscribe",arguments)},resources:function(){a("resources"),t("#sidebar").empty(),this.initController("resources",arguments)},analytics:function(){a("insight"),t("#sidebar").empty(),this.initController("analytics",arguments)},logout:function(){i.currentUser.trigger("logout"),i.currentUser.action("logout","read",{data:{},complete:function(){i.goToLogin()}})},initController:function(e,t){t=Array.prototype.slice.call(t),requirejs(["controllers/"+e],function(e){return new e(t)})},admin:function(){window.params=window.params||{},s.globalInclude(),s.removeEvalHelp();if(!i.currentUser.hasAdminPrivilege())return i.app.navigate("/",!0);var e=i._adminLink||i.appConfig("ui_config","config","admin_url")||"/web/sessions/go_to_admin";if(e){var n=t("#container");n.find("#main-sidebar,#content-wrap").hide(),n.append(i.UI.loader).append("<iframe class='admin-stream' id='admin-iframe' src='"+e+"' scrolling='auto'  style='min-height:800px; overflow:auto; width:100%; bac' frameborder='0'> </iframe> "),n.find("iframe").on("load",function(){t("img.line-loader").remove();var e,n="admin-iframe";document.getElementById(n).height="600px",e=document.getElementById(n).contentWindow.document.body.scrollHeight,document.getElementById(n).height=e+"px"})}else i.app.navigate("/",!0);i._adminLink=null},unmatched:function(){i.redirectToHome()},renderError:function(e,t,n){(new u).render(e,n)}})}),define("modules/serverProxy",["jquery","tibbr"],function(e,t){return t.serverProxy=function(e,n,r){r.__badgeHandle=null,r.__CommbadgeHandle=null;var i=function(){var e={params:{set_actions:!0,messages_since:t.badgesSince,subscription_requests:{user_id:t.currentUser.id},notifications:{status:"unread",count:5}}};r.__proxyRequest=n.currentUser.action("badges","read",{global:!1,setModel:!1,data:e}).done(function(e){n.Event.trigger("server:polled:combinedApi",e);var t=e.badges||{};t.has_messages_since=e.has_messages_since,n.currentUser.set("badges",t,{silent:!0}),n.currentUser.trigger("badges:updated",t),n.currentUser.trigger("notification:updated",e),t.has_messages_since&&(n.currentUser.recentReadMessageID=n.currentUser.lastReadMessageID),r.__proxyRequest=null})},s=function(){r.__CommProxyRequest=n.currentUser.action("community_badges","read",{global:!1}).done(function(e){t.CommunityNotifications=e,n.currentUser.trigger("communityBadges:updated",e),r.__CommProxyRequest=null})},o=function(){var e=r.__proxyRequest,t=r.__CommProxyRequest,n=r.__badgeHandle,i=r.__CommbadgeHandle;e&&e.abort&&(e.abort(),r.__proxyRequest=null),t&&t.abort&&(t.abort(),r.__CommProxyRequest=null),n&&(r.clearInterval(n),r.__badgeHandle=null),i&&(r.clearInterval(i),r.__CommbadgeHandle=null)};return{initPolling:function(){o(),r.__badgeHandle=r.setInterval(function(){i()},n.appConfig("webui","config","wall_polling_interval",{"default":60})*1e3),t.appConfig("webui","config","community","base_community")&&t.currentUser.get("connected_communities").length>0&&(r.__CommbadgeHandle=r.setInterval(function(){s()},n.appConfig("webui","config","community_polling_interval",{"default":120})*1e3))},poll:i,stopPolling:o}}(e,t,window)}),define("collections/followers",["jquery","tibbr","collections/users"],function(e,t,n){return n.extend({className:"followers",tibbrURL:{controller:"users",action:"followers"}})}),define("collections/idols",["jquery","tibbr","collections/users"],function(e,t,n){return n.extend({className:"idols",tibbrURL:{controller:"users",action:"idols"}})}),define("models/privilege",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"privileges",defaults:{modelType:"Privilege"},can:function(t){return e.str.contains(this.get("privileges"),t)}})}),define("collections/privileges",["tibbr","models/privilege"],function(e,t){return e.Collection.extend({className:"privilege",tibbrURL:{controller:"privileges"},model:t,on:function(e){return this.detect(function(t){return t.get("target_class")===e})||new t}})}),define("models/preference",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"preferences",defaults:{modelType:"Preference"}})}),define("collections/preferences",["tibbr","models/preference"],function(e,t){return e.Collection.extend({className:"preference",tibbrURL:{controller:"preferences"},model:t,withName:function(e,t){return this.detect(function(n){return n.get("group_key")===e&&n.get("name")===t})},inGroup:function(e){return this.select(function(t){return t.get("group_key")===e})}})}),define("collections/user_preferences",["tibbr","collections/preferences"],function(e,t){return t.extend({className:"user_preferences",tibbrURL:{controller:"users",action:"preferences"},all:function(){return this},exist:function(e,t){return this.detect(function(n){return n.get("group_key")===e&&n.get("name")===t})}})}),define("collections/application_urls",["tibbr","modules/common/collections/application_urls"],function(e,t){return t.extend({})}),define("models/subscribed_filter",["underscore","tibbr","require/moment","models/filter","collections/application_urls"],function(e,t,n,r,i){return r.extend({defaults:{modelType:"SubscribedFilter"},initialize:function(){e.bindAll(this,"client","server","showUrl","image","appName"),this.set({type:this.get("name").replace(/®/g,"").split(" ")[0].toLowerCase()})},urls:function(){return this._urls=this._urls||new i(this.get("application_urls")),this._urls},urlType:function(e){return this.urls().urlType(e)},appName:function(){return this.get("guid").replace(/®/g,"").replace(/\s/g,"_").toLowerCase()},image:function(e){e=e||0;var n=this.get("icon_url");return n.length<10?t.Helper.imagePath("images/apps/icons/small/"+this.appName()+".png"):t.Helper.assetImage(n,e||3)},hasAppUrl:function(){return this.server()?!0:this.get("app_url")||this.urlType("home").length>0},cssClassName:"subscribed-filter-link",client:function(){return this.get("app_type")==="client"},server:function(){return this.get("app_type")==="server"},showClientUrl:function(){return t.path("oauth/authorizations/authorize?client_id=")+this.get("id")+"&user_id="+t.currentUser.get("id")},showServerUrl:function(){return this._url("messages/"+this.appName()+"/filters?name="+encodeURI(this.get("name")))},showUrl:function(){return this.client()?this.showClientUrl():this.showServerUrl()},for_template:{image:"image",showUrl:"showUrl",release_date:function(){return n(this.get("release_date")).format(t.dateFormat.LLLLL)}}})}),define("collections/subscribed_filters",["tibbr","models/subscribed_filter"],function(e,t){return e.Collection.extend({className:"streams",tibbrURL:{controller:"users",action:"subscribed_applications_filters"},model:t,inOrder:function(){return this.sortBy(function(e){return e.server()})},parse:function(e){return e},types:function(e,t){return this.filter(function(n){return n.attributes[e]===t})},servers:function(){return this.types("app_type","server")},withURL:function(e){return this.filter(function(t){return t.attributes[e]&&t.attributes[e]!==null})},hasPageApp:function(){return this.detect(function(t){return t.get("guid")===e.PageAppGuid})},urls:function(){var e=[];return this.each(function(t){t.urls().length>0&&e.push(t.urls())}),e},urlsType:function(e){var t=[];return _.each(this.urls(),function(n){n.urlType(e)&&t.push(n.urlType(e))}),_.flatten(t)},withIn:function(e){return _.compact(this.map(function(t){var n=_.detect(t.get("application_urls"),function(t){return t.url_type===e});if(n)return t}))},homes:function(){return this.urlsType("home")},messages:function(){return this.urlsType("message")},profiles:function(){return this.urlsType("profile")},leftNav:function(){return this.urlsType("left_nav")},wallTabs:function(){return this.urlsType("wall_tab")}})}),define("modules/common/models/channel",["underscore","tibbr"],function(e,t){return t.Model.extend({baseName:"channels",initialize:function(){},pause:function(){return t.currentUser.channelAction(this,"channel_pause")},play:function(){return t.currentUser.channelAction(this,"channel_play")},activate:function(e){return t.currentUser.channelActivate(this,e)},schedules:function(){return t.currentUser.scheduleChannel(this)},createSchedule:function(e){return t.currentUser.createChannel(this,e)}})}),define("modules/common/collections/channels",["jquery","tibbr","../models/channel"],function(e,t,n){return t.Collection.extend({className:"channels",model:n,tibbrURL:{controller:"users",action:"channels"}})}),define("collections/channels",["jquery","tibbr","modules/common/collections/channels"],function(e,t,n){return n.extend({})}),define("models/application_definition",["underscore","tibbr","modules/common/models/application_definition","models/subscribed_filter"],function(e,t,n,r){return n.extend({updateActions:function(){var n=this.isSubscribe()?"unsubscribe":"subscribe",i=this,s=i.get("actions");i.action(n,"update",{data:{params:{set_actions:!0}},success:function(o){n==="unsubscribe"?(t.currentUser.subscribedFilters.remove(new r(e.clone(i.attributes))),i.set("actions",s.replace("unsubscribe","subscribe"),{silent:!0})):(t.currentUser.subscribedFilters.add(new r(e.clone(i.attributes)),{at:0}),i.set("actions",s.replace("subscribe","unsubscribe"),{silent:!0})),i.trigger("action:change",n)}})},canLaunch:function(t){return this.urlsType("home")&&(t==="subscribed_applications"||e.include(this.actions(),"unsubscribe"))}})}),define("modules/common/collections/application_definitions",["jquery","tibbr","../models/application_definition"],function(e,t,n){return t.Collection.extend({className:"application_definitions",tibbrURL:{controller:"application_definitions"},model:n})}),define("collections/application_definitions",["tibbr","models/application_definition","modules/common/collections/application_definitions"],function(e,t,n){return n.extend({model:t})}),define("modules/initializer",["jquery","underscore","backbone","tibbr","collections/followers","collections/idols","collections/privileges","collections/user_preferences","collections/subjects","collections/subscribed_filters","collections/channels","collections/wall_messages","collections/application_definitions","models/user","collections/messages"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){return function(){var e;return{initCurrentUser:function(n){e=r.currentUser=new p(n),e.followers=new i,e.idols=new s,e.privileges=new o,e.messages=new c,e.vipMessages=new c([],{className:"VIPMessages",wall_type:"vip_messages"}),e.meetings=new h,e.filePickersApps=new h,e.myApps=new h([],{className:"subscribed_applications"}),e.browseShareApps=new f,e.systemApps=new h,e.filesApps=new h,e.subscribedFilters=new f,e.subjects=new a,e.favoriteSubjects=new a([],{className:"FavoriteSubject",tibbrURL:"users/<scopeId>/favorite_subjects",scopeId:e.id,dataParams:{per_page:12,params:{per_page:12}}}),e.channels=new l,e.meetings._set(e.get("instant_meeting_apps")),e.filePickersApps._set(e.get("file_picker_apps")),e.browseShareApps._set(e.get("browse_share_apps")),e.subscribedFilters._set(e.get("subscribed_applications_filters")),e.myApps._set(e.get("subscribed_applications_filters")),e.systemApps._set(e.get("system_file_apps")),e.filesApps._set(e.get("browse_share_apps")),e.favoriteSubjects._set(e.get("favorite_subjects")),e.vips={},e.buildVips=function(n){n=n||e.get("vips")||{users:[],subjects:[]};var r=n.users.concat(n.subjects);t.each(r,function(t){t.json_class==="User"?e.vips["user_"+t.id]=t:e.vips["subject_"+t.id]=t})},e.messages.scopeId=e.id,e.messages._set(e.get("messages")),e.vipMessages.scopeId=e.id,e.vipMessages._set(e.get("vip_messages")),r.data.get("preferences","current_user")&&(e.preferences=(new u)._set(r.data.get("preferences","current_user"))),e.newMessageCollection=new d,e.newMessageCollection.comparator=function(e){return-e.get("sort_id")},e.lastReadMessageID=e.recentReadMessageID=window.lastReadMessageID||e.get("last_read_message_id"),e.cacheSuccessQue=[],e.refreshHander=null,e.hasAdminPrivilege=function(){return!!this.privileges.detect(function(e){return e.can("manage")||e.can("read_analytics")||e.can("manage_licenses")})},e.cachedKeys=["followers","idols","subscriptions","privileges","subscribed_applications_filters","channels"],this.updateCurrentUserCache(n),this.synchCurrentUserfromCache();var v=this;e.syncUpCacheThrottled=function(e,t){t=t||2e3,clearTimeout(v.tID),v.tID=setTimeout(function(){v.synchCurrentUser(e)},t)},e.syncUpCache=function(e){v.synchCurrentUser(e)},r._synchCurrentUser&&this.initPeriodicCall()},synchCurrentUserfromCache:function(){e.followers.fetch({cacheKey:"followers",updateCache:!1,silent:!1}),e.idols.fetch({cacheKey:"idols",updateCache:!1,silent:!1}),e.privileges.fetch({cacheKey:"privileges",updateCache:!1,silent:!1}),e.subjects.fetch({cacheKey:"subscriptions",updateCache:!1,silent:!1}),e.subscribedFilters.fetch({cacheKey:"subscribed_applications_filters",updateCache:!1,silent:!1}),e.channels.fetch({cacheKey:"channels",updateCache:!1,silent:!1}),e.buildVips()},updateCurrentUserCache:function(e){t.each(r.currentUser.cachedKeys,function(t){r.cache.write(t,e[t],{expire_after:!1})})},synchCurrentUser:function(n){n=n||{};var i=new p({id:r.currentUser.get("id")}),s=this;r.currentUser.loading?n.success&&typeof n.success=="function"&&e.cacheSuccessQue.push(n.success):i.fetch({data:{set_actions:!0,profile:"complete"},global:!1,beforeSend:function(){e.loading=!0},success:function(n){s.updateCurrentUserCache(n.attributes),s.synchCurrentUserfromCache(),t.each(r.currentUser.cacheSuccessQue,function(e){e(n)});var i=e.meetings.length,o=e.filePickersApps.length,u=e.browseShareApps.length;e.meetings._set(n.attributes.instant_meeting_apps),e.filePickersApps._set(n.attributes.file_picker_apps),e.browseShareApps._set(n.attributes.browse_share_apps),e.myApps._set(n.attributes.subscribed_applications_filters),e.subscribedFilters._set(n.attributes.subscribed_applications_filters),e.filesApps._set(n.attributes.browse_share_apps),(i!==e.meetings.length||o!==e.filePickersApps.length||u!==e.browseShareApps.length)&&r.Event.trigger("render:menu"),e.cacheSuccessQue=[],e.loading=!1,s.resetPeriodicCall(),e.trigger("synch")}})},initPeriodicCall:function(){var t=this;e.refreshHander=window.setInterval(function(){t.synchCurrentUser({success:function(){t.resetPeriodicCall(),e.trigger("synchedUp")}})},3e5)},resetPeriodicCall:function(){this.stopPeriodicCall(),this.initPeriodicCall()},stopPeriodicCall:function(){r.currentUser.refreshHander&&(window.clearInterval(r.currentUser.refreshHander),r.currentUser.refreshHander=null)}}}(r)}),define("require/base64",[],function(){return function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t){var n="",r,i,s,o,u,a,f,l=0;do r=t.charCodeAt(l++),i=t.charCodeAt(l++),s=t.charCodeAt(l++),o=r>>2,u=(r&3)<<4|i>>4,a=(i&15)<<2|s>>6,f=s&63,isNaN(i)?a=f=64:isNaN(s)&&(f=64),n=n+e.charAt(o)+e.charAt(u)+e.charAt(a)+e.charAt(f);while(l<t.length);return n},decode:function(t){var n="",r,i,s,o,u,a,f,l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");do o=e.indexOf(t.charAt(l++)),u=e.indexOf(t.charAt(l++)),a=e.indexOf(t.charAt(l++)),f=e.indexOf(t.charAt(l++)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n+=String.fromCharCode(r),a!=64&&(n+=String.fromCharCode(i)),f!=64&&(n+=String.fromCharCode(s));while(l<t.length);return n}}}()}),define("modules/encryptor",["tibbr","require/base64","require/md5"],function(e,t,n){return e.Encryptor=function(e,t,n){var r=function(n,r){return r=r||e.appConfig(),t.encode(n+"__"+r)},i=function(e,n){return t.decode(e).replace("__"+n,"")};return{encodeWithKey:r,decodeWithKey:i,base64:t,MD5:n}}(e,t,n)}),define("modules/totango",["jquery","underscore","backbone","tibbr"],function(e,t,n,r){var i=function(e){this.currentUser=e};return t.extend(i.prototype,n.Events,{interval:1e3,init:function(){window.totango_options=window.totango_options||{},window.totango_options.service_id=r.totangoServerId,window.totango_options.username=this.currentUser.get("display_name")+"("+this.currentUser.get("email")+")",window.totango_options.disable_hearbeat=!0,window.totango_options.account={id:this.currentUser.get("tenant").name,name:this.currentUser.get("tenant").name,status:"free","Create Date":new Date},function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src=("https:"==document.location.protocol?"https://":"http://")+"s3.amazonaws.com/totango-cdn/totango2.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},send:function(){var e=arguments;return this.connect().done(function(){try{window.totango.track.apply(window.totango,e),window.totango.go(window.totango_options)}catch(t){console.log("Totango:error",t)}}).fail(function(e){console.log("Totango:Error:",e)})},connect:function(){var t=e.Deferred(),n=this,r=0;return window.totango?t.resolve(window.totango):(this.init(),this.refreshHander=window.setInterval(function(){console.log("totango loding ... check"),r+=1;if(r>60)return n._stop(),t.reject("Not able to load totango");if(window.totango)return n._stop(),t.resolve(window.totango)},this.interval),t.promise())},_stop:function(){this.refreshHander&&(window.clearInterval(this.refreshHander),this.refreshHander=null)}}),i}),define("modules/tracker",["jquery","underscore","backbone","tibbr","require/md5","require/moment","modules/totango"],function(e,t,n,r,i,s,o){var u=function(e){this.uniqueId=e.id,this.createSession(),this.url=r.path("/usage/track"),t.bindAll(this,"_push","destroySession"),this.start(),r.isTotango&&(this.totango=new o(e))};return t.extend(u.prototype,n.Events,{cookie:new r.cookie("_tibbr_t",{path:"/",secure:r.appConfig("ssl","enable")}),interval:1e4,oldIn:30,expireIn:30,sending:!1,activities:[],createSession:function(){this.cookie.get("updated_at")===undefined||this.isOld("updated_at",this.oldIn)?(this.cookie.set("session_id",i.hexdigest(this.uniqueId.toString()+"-"+(new Date).toString())),this.cookie.set("created_at",(new Date).toString()),this.setDate(),this.push("user_login"),r.pub("login")):this.setDate()},setDate:function(){this.cookie.set("updated_at",(new Date).toString())},_track:function(e,t,n){this.send({activity:e,resource:t,client_session_id:this.cookie.get("session_id")},n)},send:function(t,n){if(this.sending)return;var r=this;e.ajax({url:this.url,dataType:"json",data:t,global:window.gadget||!1,beforeSend:function(){r.sending=!0},success:function(){n>-1&&r.activities.splice(n,1),r.sending=!1}})},push:function(e,t){if(e===undefined)return this.activities;var n={activity:e};return t&&(n.resource=t),this.activities.push(n),this.activities},isOld:function(e,t){e=e||"updated_at";var n=s(),r=s(new Date(this.cookie.get(e)));return n.diff(r,"seconds")>t},start:function(){var e=this;this.refreshHander=window.setInterval(function(){try{e._push(),e.reset()}catch(t){console.warn("error while pusing track")}},this.interval)},reset:function(){this.stop(),this.start()},stop:function(){this.refreshHander&&(window.clearInterval(this.refreshHander),this.refreshHander=null)},trackSend:function(){this.totango&&this.totango.send.apply(this.totango,arguments)},_push:function(){if(this.sending)return;this.setDate();var e=this.activities[0];if(e===undefined)return;this._track(e.activity,e.resource,0)},destroySession:function(){this.cookie.empty()}}),u}),define("modules/google_map",["jquery","underscore","backbone","tibbr"],function(e,t,n,r){var i=function(){this.config=r.maps||{},this.apiKey=this.config.api_key,this.enabled=this.config.enabled,this.src="//maps.google.com/maps/api/js?sensor=false&callback=__GMapLoaded",this.apiKey&&(this.src=this.src+"&client="+this.apiKey+"&channel=webclient")};return t.extend(i.prototype,n.Event,{connect:function(){var t=e.Deferred();return window.google&&window.google.maps?t.resolve(window.google.maps):(window.__GMapLoaded=function(){t.resolve(window.google.maps)},e.getScript(this.src),t.promise())},display:function(n,r){r=r||{};var i=t.uniqueId("map-canvas-");n.append(e("<div/>",{id:i,width:r.width||600,height:r.height||400})),t.delay(function(){var e=new google.maps.LatLng(r.latitude,r.longitude),t={zoom:15,center:e},n=new window.google.maps.Map(document.getElementById(i),t);new window.google.maps.Marker({position:e,map:n})},100)}}),i}),define("modules/tibr_client",["underscore","./dialog","./utils","./overlay"],function(t,n,r,i){var s=window.tibClient||{},o={setHeight:function(e){$("iframe.client-stream:visible").height(e.height)},redirectTo:function(e){var n=e.url,i=e.target||"_self";i==="_self"?(n=t.last(n.split("#!")),r.redirectTo.call(this,n)):window.open(n,"_blank")},zoom:function(){var e=$("#client_side_event_stream"),t=$(document).height(),n="-130px",r="-73px";params.controller==="subjects"&&(n="0px",r="-165px",$("body").attr("style","margin-top:-10px")),e.removeAttr("style").css({height:t+100,width:"1245px","z-index":999999,position:"absolute","margin-left":n,"margin-top":r}).data("height",t).removeAttr("allowtransparency"),$("#cboxOverlay").css({opacity:"0.6",filter:"alpha(opacity=40)","z-index":9999}).show(),$("#content-wrap").attr("style","position: static;")},unZoom:function(){var e=$("#client_side_event_stream"),t=e.data("height")||e.height();e.removeAttr("style").css({height:t,width:"100%"}).data("height",t).attr("allowtransparency",!0),$("body").removeAttr("style"),$("#content-wrap").removeAttr("style"),$("#cboxOverlay").removeAttr("style").hide()},postMessage:function(e){return e=e||{},this.Event.trigger("post:message",{message:e.message})},actionLink:function(e){this.Modules.View.ActionLink.actionTargetLink.call({tibbr:this},e.action)},initialized:function(e){e=e||{},t.isEmpty(e)&&console.warn("client:app:initialized with out any arguments"),this.Event.trigger("client:app:initialized:"+e.app_name,e)},resize:function(e){e=e||{},t.isEmpty(e)&&console.warn("client:app:resize with out any arguments"),this.Event.trigger("client:app:resize:"+e.app_name,e)},sendFile:function(e){this.Event.trigger("file:added",{file:e.file,source:e.src})},onInstantMeetingCreate:function(e){return this.Event.trigger("instant_meeting:created",{meeting:e.meeting}),e},onMeetingAdd:function(e){return this.Event.trigger("meeting:added",{meeting:e.meeting}),e},closeDialog:function(e){return this.Event.trigger("dialog:close",{args:e}),e},removeApp:function(e){$("#js-app-"+e.cid).remove()},invoke:function(e,t){if(typeof o[e]=="function"){var n=requirejs("tibbr");o[e].call(n,t)}},trigger:function(e){this.Event.trigger(e.event_name,e)},Eval:{getConfig:function(){var e=requirejs("tibbr");return e.appConfig("evaluation","config","enabled")}},ClientStream:{getConfig:function(e,t){var n=requirejs("tibbr");return n.appConfig("client_stream","config",e,t)}},publish:function(e,t){if(window.tibClient.hasOwnProperty("_publish"))try{window.tibClient._publish(e,t)}catch(n){}},translation:(I18n||{t:function(){console.warn("I18n is not included on your project")}}).t,init:function(){var e=requirejs("tibbr");s.Event=e.Event,e.Dialog=n,e.overlay=i,e.Event.on("instant_meeting:created",function(r){n.closeAll();var i=e.host()+"/oauth/authorizations/authorize?client_id="+r.meeting.app_id+"&url_type=launch_meeting&meeting_id="+r.meeting.key;t.isObject(window.chrome)?(r.meeting.url=i,$.fn.launchMeeting(r.meeting)):window.open(i,"launch")}),e.Event.on("to.tibr.client",function(e,t){o.publish(e,t)}),e.Event.on("meeting:added",function(){n.closeAll()}),e.Event.on("dialog:close",function(){n.closeAll()})}};return window.tibClient=t.extend(s,{invoke:o.invoke,Eval:o.Eval,publish:o.publish,overlay:i,ClientStream:o.ClientStream,translation:o.translation}),o}),define("modules/time_zone",["underscore","tibbr","require/moment"],function(e,t,n){var r=function(){this.date=new Date,this.timeZones=t.translate("time_zones"),this.moment=n};return e.extend(r.prototype,{format:"Z",zone:function(t){return e.detect(this.timeZones,function(e){return e.id===t})||{}},inZone:function(e){return this.zone(e).current_utc_offset===(new Date).getTimezoneOffset()*-1},_zone:function(){return this.isDst()?this.dst():this.moment(new Date(this.date.getFullYear(),0,1)).format(this.format)},localZone:function(){var t=this,n=t.moment().format(t.format),r=e.collect(this.timeZones,function(e){if(e.formatted_offset===n)return e});return r=e.compact(r),r},dst:function(){return this.moment(new Date(this.date.getFullYear(),5,1)).format(this.format)},getDateOffset:function(e){var t=-e.getTimezoneOffset();return t!==null?t:0},getJanuaryOffset:function(){return this.getDateOffset(new Date(this.date.getFullYear(),0,1,0,0,0,0))},getJuneOffset:function(){return this.getDateOffset(new Date(this.date.getFullYear(),5,1,0,0,0,0))},isDst:function(){var e=this.date,t=e.getMonth()>5?this.getJuneOffset():this.getJanuaryOffset(),n=this.getDateOffset(e);return t-n!==0}}),r}),define("text!templates/common/time_zone.html",[],function(){return'<div class="timezone">\n    <h2>${t(\'time_zone.title\')}</h2>\n    <div class="timezone-details pvxl mvxl">\n        <h3 class="local-time mbl">${t(\'time_zone.ltime\')}: <select style="width: 350px;">\n            {{each locals}}\n                <option value="${id}">${value}</option>\n            {{/each}}\n        </select>\n        </h3>\n        <p>${t(\'time_zone.ptime\')}: ${user}</p>\n    </div>\n    <button class="btn btn-primary mrm js-change" type="button">${t(\'time_zone.change\')}<span class="arrow next"></span></button>\n    <button class="btn js-close" type="button">${t(\'time_zone.keep\')} <span class="arrow next"></span></button>\n</div>'}),define("views/common/time_zone",["jquery","underscore","tibbr","models/user","modules/time_zone","modules/dialog","text!templates/common/time_zone.html"],function(e,t,n,r,i,s,o){return n.View.extend({id:"timezone-wrap",className:"timezone-wrap",events:{"click button.js-change":"change","click button.js-close":"close"},initialize:function(){t.bindAll(this,"change"),this.timeZone=new i,this.userZone=n.currentUser.get("time_zone")||"International Date Line West"},check:function(){var e=this;return n.pCookie.get("zone")?this:(this.timeZone.inZone(this.userZone)||(this.$el.html(this.template.render(o,{locals:this.timeZone.localZone(),user:this.timeZone.zone(this.userZone).value})),s.view(this.el,{width:600})),this)},close:function(){n.pCookie.set("zone",1),s.closeAll()},change:function(){var e=this;n.currentUser.action("","update",{data:{user:{time_zone:this.$("select").val()}},beforeSend:function(){e.$(".btn").remove(),e.$el.append(n.UI.loader)},success:function(){location.reload()}})}})}),define("hbs!modules/common/templates/common/404",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<style type="text/css">\n    .content .info-message {\n        font-size: 1.857em;\n        color: #FFA500;\n        font-weight: normal;\n        margin: 50px 0 40px;\n        text-align: center;\n    }\n\n</style>\n\n<h2 class="info-message">',(o=n.message)?o=o.call(t,{hash:{},data:i}):(o=t&&t.message,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+"</h2>\n\n",s})}),define("modules/common/views/common/notice",["jquery","underscore","backbone","tibbr","hbs!modules/common/templates/common/404"],function(e,t,n,r,i){return r.NoticeView=r.View.extend({attributes:{style:"margin-left: 120px; margin-top: 100px;"},render:function(){return e("div.js-right-nav").remove(),e("#content").html(this.$el.html(this.renderTemplate(i,{message:this.options.message||this.t("common.errors.error_"+this.options.type)}))),this}})}),define("hbs!modules/common/templates/post/launch_meeting",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="launch-meeting" id="js-launch-meeting">\n    <div class="header-wrap">\n        <h4 class="heading"><img src="',(o=n.image)?o=o.call(t,{hash:{},data:i}):(o=t&&t.image,o=typeof o===u?o.call(t,{hash:{},data:i}):o),s+=a(o)+'">Launch meeting</h4>\n    </div>\n    <div class="launch-details">\n        <p class="text">\n        Your meeting is created. Click launch to start your meeting.</p>\n        <p class="rfloat actions-wrap">\n            <a href="'+a((o=t&&t.url,typeof o===u?o.apply(t):o))+'" class="btn btn-submit" target="_blank">Launch <span class="arrow next"></span></a>\n        </p>\n    </div>\n</div>',s})}),define("hbs!modules/common/templates/messages/eog_resources/link",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var r="",i,s;return r+='\n                <h5><a  class="js-link js-action-target-link"  data-action_link="',s={hash:{},data:t},r+=l((i=n.stringify||e&&e.stringify,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.default_link),s):f.call(e,"stringify",(i=e&&e.model,i==null||i===!1?i:i.default_link),s)))+'" data-target="'+l((i=(i=(i=e&&e.model,i==null||i===!1?i:i.default_link),i==null||i===!1?i:i.display_target),typeof i===c?i.apply(e):i))+'" data-native="'+l((i=(i=e&&e.model,i==null||i===!1?i:i.isNative),typeof i===c?i.apply(e):i))+'" data-app_id = "'+l((i=(i=e&&e.model,i==null||i===!1?i:i.app_id),typeof i===c?i.apply(e):i))+'" >'+l((i=(i=e&&e.model,i==null||i===!1?i:i.title),typeof i===c?i.apply(e):i))+"</a></h5>\n                ",r}function d(e,t){var n="",r,i;n+="\n                    <p>",i=(r=(r=e&&e.model,r==null||r===!1?r:r.description),typeof r===c?r.apply(e):r);if(i||i===0)n+=i;return n+=" </p>\n                ",n}function v(e,t,r){var i="",s,o,u;return i+='\n                <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===c?s.call(e,{hash:{},data:t}):s),i+=l(s)+'"  data-action_link="',u={hash:{},data:t},i+=l((s=n.stringify||e&&e.stringify,s?s.call(e,e,u):f.call(e,"stringify",e,u)))+'" class="btn js-action-target-link" data-native="'+l((s=(s=e&&e.model,s==null||s===!1?s:s.isNative),typeof s===c?s.apply(e):s))+'" data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===c?o.call(e,{hash:{},data:t}):o),i+=l(o)+'" data-app_id = '+l((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===c?s.apply(e):s))+" >",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===c?o.call(e,{hash:{},data:t}):o),i+=l(o)+"</a>\n                ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f=n.helperMissing,l=this.escapeExpression,c="function",h=this;s+='<a class="img js-link js-action-target-link js-link-img"\n   data-action_link="',a={hash:{},data:i},s+=l((o=n.stringify||t&&t.stringify,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.default_link),a):f.call(t,"stringify",(o=t&&t.model,o==null||o===!1?o:o.default_link),a)))+'"\n   data-target="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===c?o.apply(t):o))+'"\n   data-native="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===c?o.apply(t):o))+'"\n   data-app_id="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===c?o.apply(t):o))+'">\n    <img src="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.image),typeof o===c?o.apply(t):o))+'" alt="" style="max-width: 60px; max-height: 60px"></a>\n    <div class="info-app">\n        <div class="media-box">\n            <div class="info">\n                ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.title),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n                ",u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.description),{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;s+="\n                ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.action_links),{hash:{},inverse:h.noop,fn:h.programWithDepth(5,v,i,t),data:i});if(u||u===0)s+=u;return s+="\n            </div>\n        </div>\n </div>",s})}),define("hbs!modules/common/templates/messages/eog_resources/file",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function h(e,t){var r="",i,s;return r+='\n        <img src="',s={hash:{},data:t},r+=f((i=n.imagePath||e&&e.imagePath,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.icon),s):a.call(e,"imagePath",(i=e&&e.model,i==null||i===!1?i:i.icon),s)))+'" height="60"/>\n        ',r}function p(e,t){var r="",i,s;return r+='\n        <img src="',s={hash:{},data:t},r+=f((i=n.imagePath||e&&e.imagePath,i?i.call(e,(i=e&&e.model,i==null||i===!1?i:i.imageIcon),s):a.call(e,"imagePath",(i=e&&e.model,i==null||i===!1?i:i.imageIcon),s)))+'" height="60"/>\n        ',r}function d(e,t,r){var i="",s,o;return i+='\n        <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===l?s.call(e,{hash:{},data:t}):s),i+=f(s)+"&message_id="+f((s=r&&r.message_id,typeof s===l?s.apply(e):s))+'" class="btn js-action-target-link"\n           data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===l?o.call(e,{hash:{},data:t}):o),i+=f(o)+'" data-app_id='+f((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===l?s.apply(e):s))+">",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===l?o.call(e,{hash:{},data:t}):o),i+=f(o)+"</a>\n        ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression,l="function",c=this;s+='<div class="icon-wrap">\n    <a class="js-link js-action-target-link ui-inline file lfloat mrm icon js-qtip "\n       data-target="'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===l?o.apply(t):o))+'"\n       href="'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.link),typeof o===l?o.apply(t):o))+'"\n       data-native="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===l?o.apply(t):o))+'"\n       data-app_id="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===l?o.apply(t):o))+'"\n       style="text-align: left; height: 60px; "\n       title="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===l?o.apply(t):o))+'">\n        ',u=n["if"].call(t,(o=t&&t.model,o==null||o===!1?o:o.isImage),{hash:{},inverse:c.program(3,p,i),fn:c.program(1,h,i),data:i});if(u||u===0)s+=u;s+="\n        ",u=(o=(o=t&&t.model,o==null||o===!1?o:o.appIcon),typeof o===l?o.apply(t):o);if(u||u===0)s+=u;s+='\n    </a>\n\n    <div class="asset-details info">\n        <p><a class="js-link js-action-target-link passive-name file-name"\n              data-target="'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===l?o.apply(t):o))+'"\n              href="'+f((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.link),typeof o===l?o.apply(t):o))+'"\n              data-native="'+f((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===l?o.apply(t):o))+'"\n              data-app_id='+f((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===l?o.apply(t):o))+">"+f((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===l?o.apply(t):o))+"</a></p>\n        ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.action_links),{hash:{},inverse:c.noop,fn:c.programWithDepth(5,d,i,t),data:i});if(u||u===0)s+=u;return s+="\n\n    </div>\n\n</div>\n",s})}),define("hbs!modules/common/templates/messages/eog_resources/task",["handlebars"],function(e){return e.template(function(e,t,n,r,i){function p(e,t){var n="",r;return n+='\n                   <p class="render_properties">'+l((r=e&&e.label,typeof r===f?r.apply(e):r))+": "+l((r=e&&e.value,typeof r===f?r.apply(e):r))+"</p>\n               ",n}function d(e,t,r){var i="",s,o,u;return i+='\n                <a href="',(s=n.link)?s=s.call(e,{hash:{},data:t}):(s=e&&e.link,s=typeof s===f?s.call(e,{hash:{},data:t}):s),i+=l(s)+'" data-action_link="',u={hash:{},data:t},i+=l((s=n.stringify||e&&e.stringify,s?s.call(e,e,u):c.call(e,"stringify",e,u)))+'" class="btn js-action-target-link" data-native="'+l((s=(s=e&&e.model,s==null||s===!1?s:s.isNative),typeof s===f?s.apply(e):s))+'" data-target="',(o=n.display_target)?o=o.call(e,{hash:{},data:t}):(o=e&&e.display_target,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+'" data-app_id = '+l((s=(s=r&&r.model,s==null||s===!1?s:s.app_id),typeof s===f?s.apply(e):s))+" >",(o=n.label)?o=o.call(e,{hash:{},data:t}):(o=e&&e.label,o=typeof o===f?o.call(e,{hash:{},data:t}):o),i+=l(o)+"</a>\n                ",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<a class="img js-link js-action-target-link js-link-img"  data-action_link="',a={hash:{},data:i},s+=l((o=n.stringify||t&&t.stringify,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.default_link),a):c.call(t,"stringify",(o=t&&t.model,o==null||o===!1?o:o.default_link),a)))+'" data-target="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===f?o.apply(t):o))+'" data-native="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===f?o.apply(t):o))+'" data-app_id = "'+l((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===f?o.apply(t):o))+'"><img src="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.image),typeof o===f?o.apply(t):o))+'" alt="" width="60"></a>\n    <div class="info-app">\n        <div class="media-box">\n            <div class="info">\n                <h5><a  class="js-link js-action-target-link"  data-action_link="',a={hash:{},data:i},s+=l((o=n.stringify||t&&t.stringify,o?o.call(t,(o=t&&t.model,o==null||o===!1?o:o.default_link),a):c.call(t,"stringify",(o=t&&t.model,o==null||o===!1?o:o.default_link),a)))+'" data-target="'+l((o=(o=(o=t&&t.model,o==null||o===!1?o:o.default_link),o==null||o===!1?o:o.display_target),typeof o===f?o.apply(t):o))+'" data-native="'+l((o=(o=t&&t.model,o==null||o===!1?o:o.isNative),typeof o===f?o.apply(t):o))+'" data-app_id = "'+l((o=(o=t&&t.model,o==null||o===!1?o:o.app_id),typeof o===f?o.apply(t):o))+'" >'+l((o=(o=t&&t.model,o==null||o===!1?o:o.title),typeof o===f?o.apply(t):o))+"</a></h5>\n              ",a={hash:{},data:i},s+=l((o=n.debug||t&&t.debug,o?o.call(t,t&&t.model,a):c.call(t,"debug",t&&t.model,a)))+"\n               ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.render_properties),{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(u||u===0)s+=u;s+="\n                ",u=n.each.call(t,(o=t&&t.model,o==null||o===!1?o:o.action_links),{hash:{},inverse:h.noop,fn:h.programWithDepth(3,d,i,t),data:i});if(u||u===0)s+=u;return s+="\n            </div>\n        </div>\n </div>\n",s})}),define("modules/common/views/messages/resources/eog_item",["jquery","underscore","tibbr","../../../models/og_file","hbs!modules/common/templates/messages/eog_resources/link","hbs!modules/common/templates/messages/eog_resources/file","hbs!modules/common/templates/messages/eog_resources/task"],function(e,t,n,r,i,s,o){return n.View.extend({className:"js-eog-resource highlighted-section",initialize:function(e){this.message=e.message||{},this.model.get("type")==="og:file"&&(this.model=new r(this.model.attributes),this.$el.css("height",62))},render:function(){this.$el.html(this._template()).addClass(this.model.get("type").replace("og:",""));var e=this.model.actionLinks&&this.model.actionLinks.getDefault();return e&&this.$(".js-link").attr("href",e.link()),this},_template:function(){return this.renderTemplate({"og:file":s,"og:task":o,"og:task_list":o}[this.model.get("type")]||i,{message_id:this.message.id})}})}),define("hbs!templates/layouts/base",["handlebars"],function(e){return e.template(function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div id="content" class="content lfloat"></div>\n<div id="sidebar" class="sidebar"></div>'})}),define("hbs!templates/common/503",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="connection-lost" id="connection-lost">\n    <p class="desc">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.errors.error_503",u):a.call(t,"t","common.errors.error_503",u)))+'</p>\n    <div class="action-wrap">\n        <a href="#" class="btn js-close-error">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.errors.okay",u):a.call(t,"t","common.errors.okay",u)))+"</a>\n    </div>\n</div>",s})}),define("hbs!templates/common/unsave",["handlebars"],function(e){return e.template(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a=n.helperMissing,f=this.escapeExpression;return s+='<div class="connection-lost" id="page-lost">\n    <p class="desc">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.page.info",u):a.call(t,"t","common.page.info",u)))+'</p>\n    <div class="action-wrap" style="text-align: right">\n        <button href="#" class="btn js-close-stay">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.page.stay",u):a.call(t,"t","common.page.stay",u)))+'</button>\n        <button href="#" class="btn btn-primary js-close-leave">',u={hash:{},data:i},s+=f((o=n.t||t&&t.t,o?o.call(t,"common.page.leave",u):a.call(t,"t","common.page.leave",u)))+"</button>\n    </div>\n</div>",s})}),define("views/common/shared_views",["jquery","underscore","modules/dialog","views/home/meeting_list","hbs!modules/common/templates/post/launch_meeting","modules/common/views/messages/resources/eog_item","hbs!templates/layouts/base","hbs!templates/common/503","hbs!templates/common/unsave"],function(){var t=requirejs("jquery"),n=requirejs("modules/dialog"),r=requirejs("hbs!modules/common/templates/post/launch_meeting"),i=requirejs("hbs!templates/common/503"),s=requirejs("hbs!templates/common/unsave");t.fn.connectIssueDialog=function(){if(t("#connection-lost").length>0)return;t(".line-loader, .line-loader, .spinner").remove(),n.view(i(),{modal:!0,title:"<h2><span>"+I18n.t("common.errors.connection_lost")+"</span></h2>",className:"tibbr-ui-dialog connection-lost-overlay",open:function(e,n){t(".ui-dialog-titlebar-close").hide(),t(".js-close-error").one("click",function(){t.fn.closeConnectIssueDialog()})}})},t.fn.PageLost=function(e){if(t("#page-lost").length>0||window.gadget)return;n.view(s(),{modal:!0,title:'<h2><img alt="" src="/tibbr/images/browser-support/alert-icon-small.png"/><span>'+I18n.t("common.page.header")+"</span></h2>",className:"tibbr-ui-dialog connection-lost-overlay",open:function(r,i){t(".qtip").qtip("hide"),t(".ui-dialog-titlebar-close").hide(),t(".js-close-leave").one("click",function(){n.closeAll(),t("#page-lost").remove(),e.leave()}),t(".js-close-stay").one("click",function(){n.closeAll(),t("#page-lost").remove(),e.stay()})}})},t.fn.closeConnectIssueDialog=function(){t("#connection-lost").length>0&&(n.closeAll(),t("#connection-lost").remove())},t.fn.launchMeeting=function(e){n.view(r(e),{width:"400px",className:"no-title-no-padding",open:function(){t("#js-launch-meeting").on("click",".btn-submit",function(){n.closeAll()})}})},t.fn.manageVip=function(){requirejs(["modules/common/views/common/manage_vip"],function(e){n.render(e,{className:"manage-vip-dialog vip-dialog with-title",dialog:{title:'<i class="ui-inline-icon vip-icon"></i> Manage VIPs',width:"500px",max_height:"500px",canClose:!0}})})},t.fn.checkConnection=function(){t.ajax({url:"images/browser-support/alert-icon-small.png?"+(new Date).getTime(),global:!1}).done(function(){t.fn.closeConnectIssueDialog(),window.__offLine=!1}).fail(function(e,n){if(window.__offLine)return;n===0&&(t.fn.connectIssueDialog(),window.__offLine=!0)})}}),requirejs(["jquery","underscore","modules/jquery_plugin","require/qtip","backbone","tibbr","controllers/router","controllers/application","collections/messages","modules/serverProxy","modules/initializer","modules/encryptor","modules/tracker","modules/google_map","modules/tibr_client","views/common/time_zone","modules/common/views/common/notice","views/common/shared_views"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){function b(){var e=t(document).height()-t(window).height()-t(window).scrollTop();o.publishToClient("scroll",{document:{height:t(document).height()},window:{height:t(window).height(),scrollTop:t(window).scrollTop()}}),e>=0&&e<800&&o.Event.trigger("scrolled_to_end")}(function(){var e=function(e){window.console[e]=function(){}};if(!window.console){var t=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var n=0,r=t.length;n<r;++n)e(t[n])}})(),t(document).ajaxSend(function(e,n,r){var i=t("meta[name='csrf-token']").attr("content");n.setRequestHeader("X-CSRF-Token",i),r.globalLoading!==!1&&o.Progress.start()}).ajaxComplete(function(){o.Progress.done()}).ajaxSuccess(function(){t.fn.closeConnectIssueDialog()}).ajaxError(function(e,r){switch(r.status){case 401:o.goToLogin();break;case 404:(new g({type:404})).render();break;case 0:r.statusText==="error"&&n.delay(t.fn.connectIssueDialog,3e3);break;default:}}).on("scroll:stop",function(){if(o.IE7)return;t("html, body").css({overflow:"hidden"})}).on("scroll:resume",function(){t("html, body").css({overflow:"auto"})}).on("click","a.client-app-links",function(e){e.preventDefault();var n=t(e.currentTarget),r=n.attr("id"),i=n.attr("href");o.application.navigateToClientApp(r,i)}).on("click","a.reload",function(){var e=s.history.getFragment(t(this).attr("href"));s.history.fragment==e&&(s.history.fragment=null,s.history.navigate(e,!0))}).on("click","#expand-icon",function(e){e.preventDefault();var n=t(this),r=n.parents("#zoom-view"),i=t("#content-wrap").height(),s=t("#wall-tabs");r.hasClass("zoomed")?(s.removeAttr("style").find(".ui-tabs-nav").show(),r.removeClass("zoomed").find("iframe").height("500px")):(s.attr("style","top: -10px; position: absolute; width: 98%; background: #FFFFFF; left: 5px; z-index: 10000; height: "+i+"px").find(".ui-tabs-nav").hide(),r.addClass("zoomed").find("iframe").height(i-100+"px"))}).on("before:redirect","a",function(e){var r=t(this).attr("href"),i=t(this).attr("target");if(n.isUndefined(r)||i=="_blank"||r.match("^#!")===null)return!0;e.preventDefault();var s=n.compact(t("textarea.redactor").map(function(){return n.str.stripTags(t(this).val())}).toArray()).length>0;s?t.fn.PageLost({leave:function(){o.app.navigate(r,!0)}}):o.app.navigate(r,!0)}).on("click","a.js-publish-link",function(e){var n=t(this).attr("target");if(n==="_blank")return!0;e.preventDefault(),o.publish("link.selected",{url:t(this).attr("href"),target:t(this).attr("target")})}).on("drop dragover",function(e){var t=n.detect(e.originalEvent.dataTransfer.types,function(e){return e==="Files"});t&&o.Event.trigger("show:upload"),e.preventDefault()}).on("vip:updated",function(e,n,r){var i=r.get("json_class").toLowerCase(),s=t('<span class="vip-icon-wrap"><i class="ui-inline-icon vip-icon"></i></span>'),u=r.id,a=t(".js-vipable[data-type="+i+"][data-id="+u+"]"),f=t("#filters-main_wall").find("a.vip");t(".qtip").hide(),o.currentUser.vipMessages.expireCache(),o.currentUser.messages.expireCache(),n==="add"?a.not(':has(".vip-icon-wrap")').append(s):a.find(".vip-icon-wrap").remove(),f.parent().hasClass("current")&&f.click()}),t(window).bind("beforeunload",function(){var e=n.compact(t("textarea.redactor").map(function(){return n.str.stripTags(t(this).val())}).toArray()).length>0;if(e)return I18n.t("common.page.info")});var y={monthNames:o.i18n.defaults.date.months,monthNamesShort:o.i18n.defaults.date.monthsShort,dayNames:o.i18n.defaults.date.weekdays,dayNamesShort:o.i18n.defaults.date.weekdaysShort,dayNamesMin:o.i18n.defaults.date.weekdaysMini,isRTL:!1};t.datepicker.regional[I18n.locale]=t.extend(y,o.i18n.defaults.calendar),t.datepicker.setDefaults(t.datepicker.regional[I18n.locale]),I18n.jqPlotTranslation={monthNames:o.i18n.defaults.date.months,monthNamesShort:o.i18n.defaults.date.monthsShort,dayNames:o.i18n.defaults.date.weekdays,dayNamesShort:o.i18n.defaults.date.weekdaysShort,formatString:o.i18n.defaults.jq_plot.format_string},t("#main-loading").hide(),window.didScroll=!1,window.didDragOver=!1,t(window).scroll(function(){window.didScroll=!0}),setInterval(function(){window.didScroll&&(window.didScroll=!1,b(),o.Event.trigger("page:scroll"))},50),o.goToLogin=function(){window.location.href=o.host()},v.init(),o.configuration.setUp(window.AppSetting),o.maps=o.configuration.get("maps",{"default":{enabled:!1,api_key:null}}),o.isHierarchy=o.appConfig("users","hierarchy","enable"),o.isEval=o.appConfig("evaluation","config","enabled"),o.isTotango=o.isEval&&o.appConfig("evaluation","config","totango_integration","enabled"),o.totangoServerId=o.appConfig("evaluation","config","totango_integration","service_id"),o.hasGroup=o.appConfig("groups","enable"),o.hasInteractiveGroup=!1,o.hasVisibility=o.appConfig("subjects","visibility","enabled"),o.hasGeoLocation=o.appConfig("subjects","geo_location","enabled"),o.hasSharePoint=o.appConfig("sharepoint","enable"),o.displayEmail=o.appConfig("user","config","display_email"),o.displayCompany=o.appConfig("user","config","display_company"),o.disableFileUpload=o.appConfig("ui_config","config","features","upload_to_tibbr","enable"),o.gMap=new d,o.richText=o.appConfig("ui_config","config","rich_text"),o.hoverCard=!0;if(o.appConfig("ssl","enable")&&location.protocol==="http:"){location.href=o.appConfig("site","config","site_root").replace("http:","https:");return}var w=o.data.get("user","current_user");if(w!==undefined){c.initCurrentUser(w),o.user=o.currentUser,o.app=new u,o.tracker=new p(o.currentUser),o.currentUser.on("logout",o.tracker.destroySession),n.isFunction(window.onAppInit)&&n.delay(function(){window.onAppInit(o)});var E=t.cookie("hash_url"),S=t.cookie("download_file"),x=E&&E.length>1;o._serverRedirect=x,s.history.start({pushState:o.pushState()}),x&&(s.history.navigate(E,!0),t.cookie("hash_url","",{expires:-1,path:"/"}),o._serverRedirect=null),S&&(t("<iframe style='visibility: hidden;display: none;'></iframe>").attr("src",S).appendTo("body"),t.cookie("download_file","",{expires:-1,path:"/",secure:o.appConfig("ssl","enable")})),o.timeZones=(new m).check(),l.initPolling()}else console.error("NO USER FOUND !!! DIE")}),define("main",function(){})})();